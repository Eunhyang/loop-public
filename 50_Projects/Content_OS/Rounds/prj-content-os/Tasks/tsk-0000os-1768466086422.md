---
entity_type: Task
entity_id: tsk-0000os-1768466086422
entity_name: Content OS - API Content Data
created: '2026-01-15'
updated: '2026-01-15'
status: todo
project_id: prj-content-os
parent_id: prj-content-os
assignee: 김은향
priority: medium
start_date: '2026-01-15'
due: '2026-01-15'
aliases:
- tsk-0000os-1768466086422
tags: []
type: dev
---

# Content OS - API Content Data

## 설명

Replace client-side Firebase usage with server-side APIs for opportunities, contents, and tasks.

## Notes

### Tech Spec

**IMPORTANT - READ FIRST:**
- MUST read `/Users/gim-eunhyang/dev/loop/.agent/plan/prd-techspec-merge-content-os-into-dashboard-v2.md` before starting this task

**Architecture:**
- Move Firestore query logic from client to `code/api/` server-side
- Use Firebase Admin SDK with service credentials
- Replace real-time subscriptions with React Query polling (refetch interval)
- Maintain consistent DTO shapes across all endpoints

**New API Endpoints:**
- `GET /api/content-os/opportunities` - List content opportunities with filtering
- `GET /api/content-os/contents` - List content items by status
- `GET /api/content-os/tasks` - List pipeline tasks

**Query Parameters:**
- `status` - Filter by status (for contents/opportunities)
- `orderByField` - Ordering field (finalScore, createdAt, updatedAt)
- `limit` - Result limit (integer)
- `cursor` or `page` - Pagination

**Firebase Collections:**
- `contentos_contents` - Content items and opportunities
- `vault_tasks` - Pipeline tasks
- `contentos_publishes` - Published content (if used)
- `contentos_kpi` - KPI rollups (if used)

**Source Files to Migrate:**
- Firebase queries: `code/apps/content-os/lib/api/firestore/contents.ts`, `tasks.ts`, `publishes.ts`, `kpi.ts`
- Client hooks: `code/apps/content-os/lib/api/hooks/useOpportunities.ts`, `useContents.ts`, `useTasks.ts`, `usePublishes.ts`, `useKpiRollups.ts`
- Types: `code/apps/content-os/lib/types/opportunity.ts`, `task.ts`

**Response Envelope:**
```json
{
  "success": true,
  "data": {
    "items": [/* array of items */],
    "nextCursor": null
  },
  "meta": {
    "timestamp": "2026-01-14T12:00:00Z",
    "count": 100
  }
}
```

**ContentItem DTO:**
```json
{
  "id": "content-001",
  "status": "candidate",
  "keyword": "sleep routine",
  "finalScore": 8.7,
  "marketScore": 9.2,
  "fitScore": 8.5,
  "saturationScore": 0.15,
  "whyNow": "search volume up",
  "recommendedBundle": { "shorts": 2, "longform": 1 },
  "purposeType": "protocol",
  "targetLoop": "habit",
  "format": "shorts",
  "createdAt": "2026-01-01T00:00:00Z",
  "updatedAt": "2026-01-02T00:00:00Z"
}
```

**Ordering Behavior:**
- Primary: by specified field (finalScore, createdAt, etc.)
- Secondary: by createdAt
- Preserve existing Firestore ordering logic

### Todo

- [ ] Read PRD techspec document at `/Users/gim-eunhyang/dev/loop/.agent/plan/prd-techspec-merge-content-os-into-dashboard-v2.md`
- [ ] Create API router at `code/api/routers/content_os.py`
- [ ] Implement `GET /api/content-os/opportunities` endpoint
  - [ ] Migrate Firestore query from `lib/api/firestore/contents.ts`
  - [ ] Add status filtering
  - [ ] Add ordering by finalScore/createdAt
  - [ ] Add limit and pagination
  - [ ] Return normalized DTO with response envelope
- [ ] Implement `GET /api/content-os/contents` endpoint
  - [ ] Migrate Firestore query logic
  - [ ] Add status filtering
  - [ ] Add ordering support
  - [ ] Return ContentItem DTOs
- [ ] Implement `GET /api/content-os/tasks` endpoint
  - [ ] Migrate from `lib/api/firestore/tasks.ts`
  - [ ] Return PipelineTask DTOs
- [ ] Add Firebase Admin SDK service credential access in API
- [ ] Define DTOs in `code/api/models/content_os.py` or `src/types/content-os.ts`
- [ ] Test endpoints with curl
  - [ ] Verify filtering works correctly
  - [ ] Verify ordering matches Firestore behavior
  - [ ] Verify limit and pagination
- [ ] Compare API responses to existing UI data for parity
- [ ] Update frontend hooks to use new API endpoints (remove Firebase client dependency)
- [ ] Verify build succeeds
- [ ] Manual testing: UI can fetch and display data from new APIs

### 참고

**Acceptance Criteria:**
- Frontend can fetch opportunities/contents/tasks from `code/api` without Firebase client
- Response shapes match DTOs and require no ad-hoc mapping in UI
- Ordering behavior is identical to current Firestore implementation
- All filters and pagination work correctly

**Validation:**
- Manual curl test with filters to verify ordering and limits
- Compare results to existing UI data for parity
- Verify Firebase client imports can be removed from frontend
