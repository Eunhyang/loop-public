---
entity_type: Task
entity_id: tsk-0000os-1768466087103
entity_name: Content OS - Auth Flow in Vite
created: '2026-01-15'
updated: '2026-01-15'
status: todo
project_id: prj-content-os
parent_id: prj-content-os
assignee: 김은향
priority: medium
start_date: '2026-01-15'
due: '2026-01-15'
aliases:
- tsk-0000os-1768466087103
tags: []
type: dev
---

# Content OS - Auth Flow in Vite

## 설명

Align Content OS authentication with existing Dashboard V2 auth flows and integrate YouTube OAuth status into the UI.

## Notes

### Tech Spec

**IMPORTANT**: Read `/Users/gim-eunhyang/dev/loop/.agent/plan/prd-techspec-merge-content-os-into-dashboard-v2.md` before starting.

**Current auth baseline (Dashboard V2)**:
- Guard: `code/dashboard-v2/src/routes/ProtectedRoute.tsx`
- Token storage: `code/dashboard-v2/src/features/auth/storage.ts`
- HTTP client: `code/dashboard-v2/src/services/http.ts`

**Required behavior**:
- `/content-os/*` routes remain behind `ProtectedRoute`
- Login uses Dashboard V2 login page; no separate Content OS login route
- YouTube OAuth status is available for Content OS pages (especially Performance)

**Required changes**:
- Add Content OS auth hooks in `code/dashboard-v2/src/features/content-os/shared` or similar
- Replace any direct `/api/auth/youtube/*` calls with `/api/content-os/auth/youtube/*`
- Ensure redirect after login returns to the original Content OS route

**Redirect handling (explicit)**:
- Update `ProtectedRoute` to redirect to `/login?redirect=<encoded>` when unauthenticated
- Update `LoginPage` to read `redirect` from query params and navigate to it after login
- Default redirect remains `/kanban` when no param is present

**Storage decision**:
- Continue using `authStorage` in localStorage (`LOOP_API_TOKEN`, `LOOP_USER_ROLE`)
- All API calls remain authenticated via `httpClient` interceptor

### Todo

- [ ] Read master PRD document (`prd-techspec-merge-content-os-into-dashboard-v2.md`)
- [ ] Identify existing login flow in `code/dashboard-v2/src/pages/Login` and reuse
- [ ] Add Content OS auth helper (hook or service) that wraps:
  - Status check: `GET /api/content-os/auth/youtube/status`
  - Logout: `POST /api/content-os/auth/youtube/logout`
  - Login URL: `/api/content-os/auth/youtube/login`
- [ ] Ensure httpClient is used for any authenticated calls
- [ ] Update `ProtectedRoute` to redirect to `/login?redirect=<encoded>` when unauthenticated
- [ ] Update `LoginPage` to read `redirect` from query params and navigate after login
- [ ] Verify Content OS routes require authentication and use existing dashboard token
- [ ] Verify YouTube OAuth status can be checked from Vite app
- [ ] Verify OAuth login redirects back to `/content-os/performance`
- [ ] Manual test: login with deep-link to `/content-os/performance`
- [ ] Manual test: verify status and logout behavior

## 체크리스트

- [ ] Tech Spec reviewed
- [ ] Implementation complete
- [ ] Tests passed
- [ ] Code review complete

## 참고

**Acceptance criteria**:
- Content OS routes require authentication and use the existing dashboard token
- YouTube OAuth status can be checked from the Vite app
- OAuth login redirects back to `/content-os/performance`

**Validation**:
- Manual login with deep-link to `/content-os/performance`
- Verify status and logout behavior
