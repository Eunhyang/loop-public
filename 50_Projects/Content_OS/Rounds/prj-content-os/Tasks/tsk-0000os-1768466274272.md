---
entity_type: Task
entity_id: tsk-0000os-1768466274272
entity_name: Content OS - Migrate Pipeline UI
created: '2026-01-15'
updated: '2026-01-15'
closed: '2026-01-15'
status: done
project_id: prj-content-os
parent_id: prj-content-os
assignee: 김은향
priority: medium
start_date: '2026-01-15'
due: '2026-01-15'
aliases:
- tsk-0000os-1768466274272
tags: []
type: dev
target_project: loop
---

# Content OS - Migrate Pipeline UI

## 설명

Migrate the Pipeline (Kanban-style) UI from the standalone Content OS Next.js app to Dashboard V2 under `/content-os/pipeline`. This task is part of Phase 3 (Feature Migration) of the Content OS → Dashboard V2 merge project.

## Notes

### Context

**CRITICAL**: Read `/Users/gim-eunhyang/dev/loop/.agent/plan/prd-techspec-merge-content-os-into-dashboard-v2.md` before starting implementation.

This task migrates the Pipeline feature, which provides a Kanban-style interface for managing content tasks through various stages (Draft → Approved → Published → Reviewed). The Pipeline is a core workflow tool for content production tracking.

### Tech Spec

#### Source Files (Content OS Next.js)
- Page: `code/apps/content-os/app/pipeline/page.tsx`
- Components:
  - `code/apps/content-os/app/pipeline/components/pipeline-board.tsx`
  - `code/apps/content-os/app/pipeline/components/pipeline-column.tsx`
  - `code/apps/content-os/app/pipeline/components/pipeline-card.tsx`
  - `code/apps/content-os/app/pipeline/components/task-detail-modal.tsx`
- Types:
  - `code/apps/content-os/lib/types/task.ts`

#### Target Files (Dashboard V2)
- Page: `code/dashboard-v2/src/pages/ContentOS/Pipeline/index.tsx`
- Feature module:
  - `code/dashboard-v2/src/features/content-os/pipeline/api.ts`
  - `code/dashboard-v2/src/features/content-os/pipeline/queries.ts`
  - `code/dashboard-v2/src/features/content-os/pipeline/components/PipelineBoard.tsx`
  - `code/dashboard-v2/src/features/content-os/pipeline/components/PipelineColumn.tsx`
  - `code/dashboard-v2/src/features/content-os/pipeline/components/PipelineCard.tsx`
  - `code/dashboard-v2/src/features/content-os/pipeline/components/TaskDetailModal.tsx`
- Types: `code/dashboard-v2/src/types/content-os.ts` (shared)

#### Architecture Requirements

**SSOT Compliance**:
- HTTP client: Use `src/services/http.ts`
- Types: Define in `src/types/content-os.ts`
- Query keys: Add to `src/queries/keys.ts` → `contentOsTasks(filters)`
- API layer: `src/features/content-os/pipeline/api.ts`
- Queries: `src/features/content-os/pipeline/queries.ts`

**Replace Next.js APIs**:
- `next/navigation` → `react-router-dom` (`useNavigate`, `Link`)
- `next/link` → `<Link>` from `react-router-dom`
- `next/image` → standard `<img>` tag
- App routes → API calls to `code/api`

**DnD Library Migration**:
- Replace `@dnd-kit` with `@hello-pangea/dnd` (Dashboard V2 standard)
- Follow Dashboard V2 patterns for drag-and-drop implementation
- Maintain same UX for column-based task movement

#### API Integration

**Data Fetching**:
- Endpoint: `GET /api/content-os/tasks`
- Query key: `['content-os', 'tasks', filters]`
- Response: `PipelineTask[]`

**Status Update (Mutation)**:
- Endpoint: `PATCH /api/content-os/tasks/{taskId}`
- Body: `{ "status": "approved" }`
- Response: Updated `PipelineTask`
- Strategy: Optimistic update with error rollback

**Pipeline Status Order**:
```typescript
const PIPELINE_STATUS_ORDER = [
  'draft',
  'approved',
  'published',
  'reviewed'
];
```

#### DnD Implementation Rules

1. On drag end:
   - Optimistically update local state
   - Call mutation to persist change
   - Show loading indicator on dragged card

2. On mutation error:
   - Revert to previous state
   - Show error toast with retry option
   - Log error details

3. On mutation success:
   - Invalidate query to refetch fresh data
   - Show success toast (optional)

#### Component Structure

```
Pipeline/
├── index.tsx                    # Page component, route setup
└── components/
    ├── PipelineBoard.tsx        # Container, manages DnD context
    ├── PipelineColumn.tsx       # Single column (status group)
    ├── PipelineCard.tsx         # Task card in column
    └── TaskDetailModal.tsx      # Task details popup
```

#### Type Definitions

```typescript
// src/types/content-os.ts
export interface PipelineTask {
  id: string;
  title: string;
  status: 'draft' | 'approved' | 'published' | 'reviewed';
  assignee?: string;
  dueDate?: string;
  priority?: 'low' | 'medium' | 'high';
  tags?: string[];
  description?: string;
}

export interface UpdateTaskStatusRequest {
  status: string;
}

export interface UpdateTaskStatusResponse {
  success: boolean;
  task: PipelineTask;
}
```

### Todo

#### Phase 1: Setup & Types
- [x] Create feature folder structure under `src/features/content-os/pipeline/`
- [x] Add `PipelineTask` types to `src/types/content-os.ts`
- [x] Add query key `contentOsTasks(filters)` to `src/queries/keys.ts`
- [x] Create `api.ts` with `fetchTasks` and `updateTaskStatus` functions

#### Phase 2: API Integration
- [x] Implement `fetchTasks()` using `src/services/http.ts`
- [x] Implement `updateTaskStatus(taskId, status)` mutation
- [x] Create React Query hooks in `queries.ts`:
  - [x] `useTasksQuery(filters?)`
  - [x] `useUpdateTaskStatusMutation()`
- [ ] Test API integration with curl/Postman

#### Phase 3: Component Migration
- [x] Port `PipelineBoard.tsx` - replace `@dnd-kit` with `@hello-pangea/dnd`
- [x] Port `PipelineColumn.tsx` - update for new DnD library
- [x] Port `PipelineCard.tsx` - remove Next.js imports
- [x] Port `TaskDetailModal.tsx` - use react-router navigation
- [x] Update all component imports to use Dashboard V2 paths

#### Phase 4: Page Integration
- [x] Create `src/pages/ContentOS/Pipeline/index.tsx`
- [x] Add route to React Router config: `/content-os/pipeline`
- [ ] Integrate with ContentOSLayout (if exists) or main layout
- [ ] Add navigation link to Content OS section

#### Phase 5: DnD Implementation
- [x] Set up `DragDropContext` in PipelineBoard
- [x] Implement `onDragEnd` handler with optimistic update
- [x] Add loading state during mutation
- [x] Add error handling with toast notifications
- [ ] Add success confirmation (optional)

#### Phase 6: Testing & Validation
- [ ] Manual test: Render `/content-os/pipeline` route
- [ ] Manual test: Drag task between columns
- [ ] Manual test: Verify API call on drop
- [ ] Manual test: Error handling (network failure)
- [ ] Manual test: Task detail modal opens correctly
- [x] Build test: `npm run build` passes with no errors
- [x] Verify no Next.js imports remain

#### Phase 7: Cleanup
- [ ] Remove unused Next.js dependencies from migrated code
- [ ] Update comments/docs to reflect new paths
- [ ] Mark original Content OS pipeline as deprecated (comment only)

### Acceptance Criteria

- [ ] `/content-os/pipeline` route renders and displays task columns
- [ ] Dragging tasks between columns triggers API update
- [ ] Optimistic UI update provides immediate feedback
- [ ] Error states show user-friendly toast messages
- [ ] Task detail modal opens and closes correctly
- [ ] No TypeScript errors in migrated code
- [ ] No Next.js imports (`next/*`) remain in pipeline code
- [ ] Build passes: `npm run build` completes successfully
- [ ] Column order follows `PIPELINE_STATUS_ORDER`

### Testing Plan

**Manual Testing**:
1. Navigate to `/content-os/pipeline`
2. Verify all status columns render (Draft, Approved, Published, Reviewed)
3. Create test task in Draft column
4. Drag task to Approved column
5. Verify API call is made (check Network tab)
6. Verify task appears in Approved column after drop
7. Test error handling by disconnecting network mid-drag
8. Verify error toast appears and task reverts to original column
9. Click task card to open detail modal
10. Verify modal shows task details correctly

**Build Validation**:
```bash
cd code/dashboard-v2
npm run build
# Must complete with 0 errors
```

**API Contract Validation**:
```bash
# Test GET endpoint
curl -X GET "http://localhost:8081/api/content-os/tasks"

# Test PATCH endpoint
curl -X PATCH "http://localhost:8081/api/content-os/tasks/{taskId}" \
  -H "Content-Type: application/json" \
  -d '{"status": "approved"}'
```

### Implementation Notes

**DnD Library Differences**:
- `@dnd-kit` uses `useSensors`, `@hello-pangea/dnd` uses `DragDropContext`
- `@hello-pangea/dnd` has simpler API but less customization
- Reference existing Dashboard V2 Kanban implementation for patterns

**Optimistic Update Pattern**:
```typescript
const mutation = useUpdateTaskStatusMutation({
  onMutate: async ({ taskId, status }) => {
    // Cancel outgoing refetches
    await queryClient.cancelQueries(['content-os', 'tasks']);

    // Snapshot previous value
    const previous = queryClient.getQueryData(['content-os', 'tasks']);

    // Optimistically update
    queryClient.setQueryData(['content-os', 'tasks'], (old) => {
      // Update task status in cache
    });

    return { previous };
  },
  onError: (err, variables, context) => {
    // Revert on error
    queryClient.setQueryData(['content-os', 'tasks'], context.previous);
    toast.error('Failed to update task status');
  },
  onSuccess: () => {
    // Invalidate and refetch
    queryClient.invalidateQueries(['content-os', 'tasks']);
  }
});
```

**API Endpoint Status**:
- If `PATCH /api/content-os/tasks/{taskId}` does not exist yet, create a TODO stub in the component
- Add comment: `// TODO: Implement status update API endpoint`
- Log to console for now: `console.log('TODO: Update task', taskId, status)`

### References

- Master PRD: `/Users/gim-eunhyang/dev/loop/.agent/plan/prd-techspec-merge-content-os-into-dashboard-v2.md`
- Project: [[prj-content-os]]
- Related Tasks:
  - [[tsk-0000os-1768466096543]] - Dashboard V2 Scaffold (prerequisite)
  - [[tsk-0000os-1768466262169]] - Stabilize SSOT Build
  - [[tsk-0000os-1768466105945]] - Migrate Explorer UI
  - [[tsk-0000os-1768466263435]] - Migrate Retro UI

### 작업 로그

#### 2026-01-15 21:22
**개요**: Pipeline Kanban UI를 Dashboard V2로 마이그레이션 및 API 연동

**변경사항**
- 타입/라벨: `PipelineTask`/`PipelineStatus` 및 라벨/순서 추가 (`src/types/content-os.ts`)
- 쿼리키: `contentOsKeys.tasks` 추가 (`src/queries/keys.ts`)
- API/쿼리: `/api/content-os/tasks` GET, PATCH status 업데이트 훅 추가 (`features/content-os/pipeline/api.ts`, `queries.ts`)
- UI: `@hello-pangea/dnd` 기반 Pipeline 보드/컬럼/카드/디테일 모달 구현 (`features/content-os/pipeline/components/*`)
- 페이지: `/content-os/pipeline` 페이지에서 보드 렌더링 (`pages/ContentOS/Pipeline/index.tsx`)
- DnD 동작: 낙관적 업데이트 → 실패 시 롤백 + 토스트; 성공 시 쿼리 무효화

**테스트**
- `npm run build` (성공)

**커밋**: `675a81231` on branch `task/tsk-0000os-1768466274272`

## 체크리스트

See detailed Todo section in Notes above.

## 참고

- Dashboard V2 path: `code/dashboard-v2/`
- Content OS path: `code/apps/content-os/`
- SSOT rules: Must use `src/services/http.ts`, `src/types/*`, `src/queries/keys.ts`
- DnD library: `@hello-pangea/dnd` (Dashboard V2 standard)
