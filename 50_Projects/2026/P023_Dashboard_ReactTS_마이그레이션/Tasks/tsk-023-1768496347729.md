---
entity_type: Task
entity_id: tsk-023-1768496347729
entity_name: Dashboard - Track 통합 + Conditions_3Y UI 개선
created: '2026-01-16'
updated: '2026-01-16'
status: done
closed: '2026-01-16'
project_id: prj-023
parent_id: prj-023
assignee: 김은향
priority: medium
start_date: '2026-01-16'
due: '2026-01-16'
aliases:
- tsk-023-1768496347729
tags: []
type: dev
---

# Dashboard - Track 통합 + Conditions_3Y UI 개선

## 설명

ProjectForm에서 Track과 Track Contributes를 하나의 통합 UI로 만들고, Conditions_3Y에 공통 선택 컴포넌트를 적용합니다.

### 문제점
1. **Track 분리**: Track(parent_id)과 Track Contributes가 별도 섹션으로 분리되어 관계 파악 어려움
2. **Track 색상 미구분**: 메인 Track과 Contributes가 동일한 색상으로 구분 불가
3. **Conditions_3Y 선택 불가**: 현재 선택된 조건만 표시되고 새로운 조건 추가 불가
4. **조건 라벨 미표시**: cond-a 같은 ID만 표시, 한글 라벨(CondA-PMF신호) 미표시

### 해결 방향
- Track + Track Contributes 하나의 UI로 통합
- 메인 Track = 붉은색, Contributes = 회색으로 색상 구분
- Conditions_3Y에 EntitySelector 적용하여 선택 가능하게
- CONDITION_LABELS 상수로 한글 라벨 매핑

## Tech Spec

**Architecture Compliance:**
- Parent Project: prj-023
- 규칙: Feature 소유 원칙 (src/features/projects/)
- 공통 컴포넌트: EntitySelector, EntityChip 재사용

**File Structure:**
```
src/components/common/chipColors.ts          # 색상 추가
src/features/projects/constants/conditions.ts # 조건 라벨 매핑
src/features/projects/components/TrackSelector.tsx        # 새 컴포넌트
src/features/projects/components/ConditionSelector.tsx    # 새 컴포넌트
src/features/projects/components/ProjectForm.tsx          # 수정
```

**Implementation Details:**

### 1. 색상 정의 (chipColors.ts)
```typescript
export const primaryTrackColor: ChipColor = {
  bg: 'bg-white border-zinc-200',
  text: 'text-zinc-500',
  selected: '!bg-[#fee2e2] !text-[#991b1b] !border-[#fca5a5]',
};

export const trackContributeColor: ChipColor = {
  bg: 'bg-white border-zinc-200',
  text: 'text-zinc-500',
  selected: '!bg-[#f1f5f9] !text-[#334155] !border-[#cbd5e1]',
};
```

### 2. CONDITION_LABELS (conditions.ts)
```typescript
export const CONDITION_LABELS: Record<string, string> = {
  'cond-a': 'CondA-PMF신호',
  'cond-b': 'CondB-패턴/데이터',
  'cond-c': 'CondC-글로벌데이터',
  'cond-d': 'CondD-런웨이',
  'cond-e': 'CondE-팀',
};
```

### 3. TrackSelector 컴포넌트
```typescript
interface TrackSelectorProps {
  tracks: Track[];
  primaryTrackId: string | null;
  trackContributes: TrackContribution[];
  onPrimaryChange: (trackId: string) => void;
  onContributesChange: (contribs: TrackContribution[]) => void;
  onTrackClick?: (trackId: string) => void;
  readonly?: boolean;
}
```

**동작**:
- 모든 트랙을 버튼으로 표시
- 메인 트랙: 붉은색 배경 + 체크마크 (✓)
- Track Contributes: 회색 배경 (선택됨), 흰색 (미선택)
- 트랙 클릭 → contributes에 추가/제거 (토글)
- 체크마크 클릭 → 해당 트랙을 메인으로 설정
- → 버튼 → drawer로 이동
- 선택된 contributes에 가중치 슬라이더 (메인 제외)
- 메인 트랙이 contributes에 있으면 자동 제외

### 4. ConditionSelector 컴포넌트
- EntitySelector 재사용
- dashboardData.conditions에서 옵션 생성
- CONDITION_LABELS로 라벨 표시
- → 버튼: condition drawer로 이동

### 5. ProjectForm.tsx 수정
- Track 섹션 (439-476행)과 Track Contributes 섹션 (672-685행) 통합
- conditions_3y 섹션 (615-670행)을 ConditionSelector로 교체
- 라벨 "Track"으로 통합

**Edge Cases:**
- 메인 트랙 = contributes 중복: 메인만 표시, contributes에서 자동 제외
- 조건 0개: dashboardData.conditions 빈 배열일 때 "No conditions available" 표시
- 가중치 합계 > 100%: 기존 검증 로직 유지 (빨간색 경고)

## 체크리스트

- [ ] chipColors.ts - primaryTrackColor, trackContributeColor 추가
- [ ] conditions.ts - CONDITION_LABELS 상수 생성
- [ ] TrackSelector.tsx - 새 컴포넌트 생성
- [ ] ConditionSelector.tsx - 새 컴포넌트 생성
- [ ] ProjectForm.tsx - Track 섹션 통합 (TrackSelector 사용)
- [ ] ProjectForm.tsx - conditions_3y 섹션 교체 (ConditionSelector 사용)
- [ ] `npm run build` 통과 확인
- [ ] Edit 모드 Track UI 동작 검증
- [ ] Edit 모드 Conditions_3Y 선택/해제 동작 검증

## 참고

- Plan file: `~/.claude/plans/parallel-painting-anchor.md`
- prj-023 Architecture Rules: Drawer 표준 섹션 2.4
- 기존 TrackContributionEditor: `src/features/impact/components/TrackContributionEditor.tsx`
- 기존 EntitySelector: `src/components/common/entity/EntitySelector.tsx`

## 작업 로그

### 2026-01-16 01:30
**개요**: Track 통합 + Conditions_3Y UI 개선 완료

**변경사항**:
- 개발: TrackSelector, ConditionSelector, conditions.ts 신규 생성
- 수정: ProjectForm (Track 섹션 통합), chipColors (색상 정의 추가)
- 삭제: Track과 Track Contributes 별도 섹션 제거

**핵심 파일 (5개)**:

| 파일 | 역할 |
|------|------|
| `src/features/projects/components/TrackSelector.tsx` | Track + Track Contributes 통합 UI, 색상 구분 + 가중치 슬라이더 |
| `src/features/projects/components/ConditionSelector.tsx` | Conditions_3Y 선택 UI, EntitySelector 재사용 |
| `src/features/projects/constants/conditions.ts` | 조건 ID → 한글 라벨 매핑 (CONDITION_LABELS) |
| `src/components/common/chipColors.ts` | primaryTrackColor (붉은색), trackContributeColor (회색) 추가 |
| `src/features/projects/components/ProjectForm.tsx` | Track 섹션 통합, conditions_3y → ConditionSelector 교체 |

**데이터/호출 흐름**:
```
ProjectForm → TrackSelector
├─ primaryTrackId (parent_id) → 메인 Track (붉은색 + 체크마크)
└─ trackContributes (track_contributes) → Contributes (회색 + 가중치 슬라이더)

ProjectForm → ConditionSelector → EntitySelector
└─ conditions_3y (배열) → 조건 선택 chip UI
```

**Codex 리뷰 & 수정**:
- HIGH: track_contributes를 formData, hasChanges에 추가 (데이터 저장 버그 수정)
- HIGH: weight 계산 로직 수정 (primary track 중복 계산 제거)
- MEDIUM: nested button 구조를 div로 변경 (유효한 HTML 구조)

**결과**:

| 항목 | 상태 |
|------|------|
| 변경 파일 수 | 6개 (생성 3개, 수정 3개) |
| Codex 리뷰 | ✅ 통과 (이슈 3개 수정) |
| 빌드 | ✅ 성공 (프로젝트 관련 에러 0건) |
| 배포 | ✅ 완료 |

**커밋**:
- Initial: `f6d71e601` - feat(tsk-023-1768496347729): Track 통합 + Conditions_3Y UI 개선
- Fixes: `06b7bc4f4` - fix(tsk-023-1768496347729): Codex review 이슈 수정
- Merge: `371c77e05` on `main`
