---
entity_type: Task
entity_id: tsk-023-1768878808515
entity_name: MCP SSE 연결 안정화 - Synology nginx 설정
created: '2026-01-20'
updated: '2026-01-20'
status: done
project_id: prj-023
parent_id: prj-023
assignee: 김은향
priority: medium
start_date: '2026-01-20'
due: '2026-01-20'
aliases:
- tsk-023-1768878808515
tags: []
type: dev
---

# MCP SSE 연결 안정화 - Synology nginx 설정

## Notes

### Summary
ChatGPT MCP 연결이 10분 내 3번 끊기는 문제 해결을 위해 Synology 역방향 프록시에 SSE 필수 설정을 추가함.

### Changes Made

**수정 파일**: `/etc/nginx/sites-enabled/server.ReverseProxy.conf` (NAS)
- 실제 파일: `/usr/local/etc/nginx/sites-available/ea0f3c15-d3f6-4598-8aac-b72454f91042.w3conf` (symlink 대상)

**변경 내용** (mcp.sosilab.synology.me 섹션):

```nginx
# Before (WebSocket용 설정 - SSE에 부적합)
proxy_http_version 1.1;
proxy_set_header        Upgrade            $http_upgrade;
proxy_set_header        Connection         $connection_upgrade;
proxy_set_header        Host               $http_host;

# After (SSE 필수 설정 추가)
proxy_http_version 1.1;

# SSE 필수 설정
proxy_buffering off;
proxy_cache off;
chunked_transfer_encoding off;
proxy_set_header        Connection         '';

proxy_set_header        Host               $http_host;
```

**변경 사항 요약**:
1. `proxy_buffering off` - 응답 버퍼링 비활성화 (SSE 스트리밍 필수)
2. `proxy_cache off` - 캐싱 비활성화
3. `chunked_transfer_encoding off` - chunked 인코딩 비활성화
4. `proxy_set_header Connection ''` - Connection 헤더를 빈 값으로 (WebSocket용 $connection_upgrade 제거)
5. `proxy_set_header Upgrade` 라인 삭제 - SSE에 불필요

**백업 파일**: `/etc/nginx/sites-enabled/server.ReverseProxy.conf.bak.20260120120023`

### Plan

# MCP SSE 연결 안정화 - Synology 역방향 프록시 수정

## 문제
ChatGPT MCP 연결이 10분 내 3번 끊김

## 근본 원인
Synology 역방향 프록시에 SSE 필수 설정 누락:
- `proxy_buffering off` 없음
- `Connection` 헤더가 WebSocket용으로 설정됨

## 수정 대상
`/etc/nginx/sites-enabled/server.ReverseProxy.conf`의 `mcp.sosilab.synology.me` 섹션

## 실행 단계

1. SSH로 현재 설정 백업 ✓
2. Python 스크립트로 SSE 설정 추가 ✓
3. nginx 설정 테스트 (`nginx -t`) ✓
4. nginx 재시작 ✓
5. MCP 연결 테스트 ✓

## 검증
- /health 엔드포인트 정상 응답 확인
- /mcp/sse 엔드포인트 연결 확인

## 리스크
- DSM 업데이트/역방향 프록시 설정 변경 시 덮어쓰여질 수 있음

## 짧은 회고

SSE 연결 안정화를 위한 nginx 프록시 설정 완료. WebSocket과 SSE는 다른 Connection 헤더 설정이 필요함을 확인.
