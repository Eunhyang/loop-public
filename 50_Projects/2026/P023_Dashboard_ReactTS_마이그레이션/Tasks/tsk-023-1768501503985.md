---
entity_type: Task
entity_id: tsk-023-1768501503985
entity_name: Dashboard - Expected Impact Gate 추가
created: '2026-01-16'
updated: '2026-01-16'
status: done
closed: '2026-01-16'
project_id: prj-023
parent_id: prj-023
assignee: 김은향
priority: medium
start_date: '2026-01-16'
due: '2026-01-16'
aliases:
- tsk-023-1768501503985
tags: []
type: dev
---

# Dashboard - Expected Impact Gate 추가

## 설명

Project status 전환 시 Expected Impact 필수 체크 + Task → Project 연동 기능 구현

### 요구사항

1. **Expected Impact Gate**: Project status가 `planning` → `active`로 변경될 때 `expected_impact`가 null이면 저장 차단
2. **Task → Project 연동**: Task가 `doing`으로 변경될 때 상위 Project가 `planning`이면 확인 다이얼로그 표시
   - "프로젝트도 active로 바꿀까요?" (노션 스타일)
   - 사용자 선택에 따라 Project status 변경

---

## Tech Spec

### Architecture Compliance
- **Parent Project**: prj-023 (Dashboard v2)
- **Target**: loop (code/api + code/dashboard-v2)
- **준수 규칙**: prj-023 Dashboard V2 Architecture & LLM Work Rules

### File Structure

```
code/api/routers/
└── projects.py                    # expected_impact 체크 추가 (line 456 근처)

code/dashboard-v2/src/
├── components/common/
│   └── ConfirmDialog.tsx          # [NEW] 노션 스타일 확인 다이얼로그
├── features/tasks/components/
│   ├── TaskForm.tsx               # status 변경 시 Project 연동 로직
│   └── Kanban/
│       └── KanbanBoard.tsx        # D&D 시 Project 연동 로직
└── features/projects/components/
    └── ProjectForm.tsx            # Expected Impact Gate (프론트 체크)
```

### Implementation Details

#### 1. API - projects.py (line 456 근처)
```python
# 기존 hypothesis 체크 다음에 추가
if project.status == "active":
    current_expected_impact = frontmatter.get("expected_impact")
    if not current_expected_impact:
        raise HTTPException(
            status_code=400,
            detail="Project requires expected_impact before transitioning to active."
        )
```

#### 2. ConfirmDialog.tsx (NEW - common)
- Props: `open`, `title`, `description`, `confirmText`, `cancelText`, `onConfirm`, `onCancel`
- 비즈니스 로직 없음, UI만 (prj-023 룰 준수)
- 노션 스타일: 중앙 정렬, 둥근 모서리, 그림자

#### 3. TaskForm.tsx - status 변경 핸들러
- `doing`으로 변경 시 상위 Project status 체크
- `planning`이면 ConfirmDialog 표시
- 확인 시 Task + Project 모두 업데이트
- 취소 시 Task만 업데이트

#### 4. KanbanBoard.tsx - onDragEnd
- `doing` 컬럼으로 드롭 시 같은 로직 적용
- 다이얼로그 표시 후 사용자 선택 처리

#### 5. ProjectForm.tsx - handleSave
- Edit 모드에서 `planning` → `active` 변경 시
- `expected_impact` null이면 `setFormError()` 호출

### Edge Cases

1. **Project가 이미 active인 경우**: Task doing 전환 시 다이얼로그 표시 안 함
2. **expected_impact가 부분적으로 채워진 경우**: null 체크만 (내부 필드 검증은 기존 로직 활용)
3. **동시 업데이트**: Task와 Project 순차 업데이트 (Task 먼저, Project 다음)
4. **API 실패 시**: 에러 메시지 표시, 롤백 불필요 (각각 독립 API 호출)

---

## 체크리스트

- [ ] API: `projects.py`에 expected_impact 체크 추가
- [ ] Dashboard: `ConfirmDialog.tsx` 생성 (common)
- [ ] Dashboard: `TaskForm.tsx` status 변경 시 Project 연동
- [ ] Dashboard: `KanbanBoard.tsx` D&D 시 Project 연동
- [ ] Dashboard: `ProjectForm.tsx` Expected Impact Gate
- [ ] Build: `npm run build` 통과 확인
- [ ] Test: planning 프로젝트 → active 전환 테스트
- [ ] Test: Task doing 전환 시 다이얼로그 테스트

---

## 참고

- [[prj-023]] Dashboard v2 Architecture Rules
- 계획 파일: `/Users/gim-eunhyang/.claude/plans/majestic-crafting-anchor.md`

---

## 작업 로그

#### 2026-01-16 14:34
**개요**: Dashboard - Expected Impact Gate 추가 완료

**변경사항**:
- 개발: ConfirmDialog 공통 컴포넌트 (Notion 스타일)
- 수정: API expected_impact 체크 로직, TaskForm/KanbanBoard Project 연동, ProjectForm Impact Gate

**파일 변경**:
- `api/routers/projects.py` (line 458-467): expected_impact null 체크 추가
- `dashboard-v2/src/components/common/ConfirmDialog.tsx` (NEW): 공통 확인 다이얼로그 (82 lines)
- `dashboard-v2/src/features/tasks/components/TaskForm.tsx`: status→doing 시 Project 연동 로직 (+89 lines)
- `dashboard-v2/src/features/tasks/components/Kanban/KanbanBoard.tsx`: D&D→doing 시 Project 연동 로직 (+93 lines)
- `dashboard-v2/src/features/projects/components/ProjectForm.tsx`: planning→active 시 expected_impact 체크 (+10 lines)

**결과**: ✅ 빌드 성공, 배포 완료

**커밋**: `3f02dfd8e` on branch `task/tsk-023-1768501503985`
