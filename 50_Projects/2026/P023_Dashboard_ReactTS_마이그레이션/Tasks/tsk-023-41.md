---
entity_type: Task
entity_id: tsk-023-41
entity_name: Dashboard - Share URL v2 deep link 구현
created: '2026-01-09'
updated: '2026-01-09'
status: done
project_id: prj-023
assignee: 김은향
priority: high
type: dev
due: null
closed: '2026-01-09'
time_spent: null
pr_link: null
tags:
  - dashboard-v2
  - share-url
  - deep-link
  - routing
aliases:
  - tsk-023-41
  - Dashboard - Share URL v2 deep link 구현
---
# Dashboard - Share URL v2 deep link 구현

> Task ID: `tsk-023-41` | Project: [[prj-023]] | Status: done

---

## Summary

Share 버튼 클릭 시 생성되는 URL이 v2 라우터에서 작동하도록 수정:
- `/tasks/:id`, `/projects/:id` 라우트 추가
- 프로덕션 basename `/v2` 반영
- 복사 성공 시 토스트 피드백

---

## Notes

### Tech Spec

#### 의존성 방향 (Clean Architecture)

```
pages/Task, Project
       ↓
hooks/useDeepLink
       ↓
contexts/UiContext

features/tasks/TaskForm
       ↓
utils/url (SSOT)
       ↓
contexts/ToastContext
```

#### 파일 구조

| 구분 | 파일 | 역할 |
|------|------|------|
| NEW | `src/utils/url.ts` | Share URL 생성 SSOT |
| NEW | `src/hooks/useDeepLink.ts` | URL → Drawer 열기 훅 |
| NEW | `src/pages/Task/index.tsx` | `/tasks/:id` 라우트 |
| NEW | `src/contexts/ToastContext.tsx` | 토스트 상태 관리 |
| NEW | `src/components/common/ToastContainer.tsx` | 토스트 UI |
| MODIFY | `src/routes/index.tsx` | 라우트 추가 |
| MODIFY | `src/features/tasks/components/TaskForm.tsx` | Share 로직 교체 |
| MODIFY | `src/pages/Project/index.tsx` | placeholder → deep link |
| MODIFY | `src/components/layout/AppLayout.tsx` | ToastProvider 추가 |

---

### Implementation Details

#### 1. `src/utils/url.ts` (NEW - Share URL SSOT)

```typescript
export function getBaseUrl(): string {
  const origin = window.location.origin;
  const basename = import.meta.env.PROD ? '/v2' : '';
  return `${origin}${basename}`;
}

export function generateShareUrl(
  entityType: 'task' | 'project',
  entityId: string
): string {
  return `${getBaseUrl()}/${entityType}s/${entityId}`;
}
```

#### 2. `src/hooks/useDeepLink.ts` (NEW)

```typescript
import { useEffect } from 'react';
import { useNavigate, useParams } from 'react-router-dom';
import { useUi } from '@/contexts/UiContext';

interface UseDeepLinkOptions {
  entityType: 'task' | 'project';
  redirectTo?: string;
}

export function useDeepLink({ entityType, redirectTo = '/kanban' }: UseDeepLinkOptions) {
  const { id } = useParams<{ id: string }>();
  const navigate = useNavigate();
  const { openEntityDrawer } = useUi();

  useEffect(() => {
    if (id) {
      openEntityDrawer({ type: entityType, mode: 'edit', id });
      navigate(redirectTo, { replace: true });
    }
  }, [id, entityType, redirectTo, navigate, openEntityDrawer]);
}
```

#### 3. `src/pages/Task/index.tsx` (NEW)

```typescript
import { useDeepLink } from '@/hooks/useDeepLink';

export const TaskPage = () => {
  useDeepLink({ entityType: 'task' });
  return null;
};
```

#### 4. `src/pages/Project/index.tsx` (MODIFY)

```typescript
import { useDeepLink } from '@/hooks/useDeepLink';

export const ProjectPage = () => {
  useDeepLink({ entityType: 'project' });
  return null;
};
```

#### 5. `src/routes/index.tsx` (MODIFY)

```diff
+ import { TaskPage } from '@/pages/Task';

  children: [
    { index: true, element: <Navigate to="/kanban" replace /> },
    { path: 'kanban', element: <KanbanPage /> },
+   { path: 'tasks/:id', element: <TaskPage /> },
    { path: 'projects/:id', element: <ProjectPage /> },
    ...
  ]
```

#### 6. `src/contexts/ToastContext.tsx` (NEW)

```typescript
import { createContext, useContext, useState, useCallback, type ReactNode } from 'react';

interface Toast { id: string; message: string; type: 'success' | 'error' }

interface ToastContextType {
  showToast: (message: string, type?: 'success' | 'error') => void;
}

const ToastContext = createContext<ToastContextType | undefined>(undefined);

export function ToastProvider({ children }: { children: ReactNode }) {
  const [toasts, setToasts] = useState<Toast[]>([]);

  const showToast = useCallback((message: string, type: 'success' | 'error' = 'success') => {
    const id = Date.now().toString();
    setToasts(prev => [...prev, { id, message, type }]);
    setTimeout(() => setToasts(prev => prev.filter(t => t.id !== id)), 3000);
  }, []);

  return (
    <ToastContext.Provider value={{ showToast }}>
      {children}
      <ToastContainer toasts={toasts} />
    </ToastContext.Provider>
  );
}

export const useToast = () => {
  const ctx = useContext(ToastContext);
  if (!ctx) throw new Error('useToast must be used within ToastProvider');
  return ctx;
};
```

#### 7. `src/components/common/ToastContainer.tsx` (NEW)

```typescript
interface Toast { id: string; message: string; type: 'success' | 'error' }

export function ToastContainer({ toasts }: { toasts: Toast[] }) {
  if (!toasts.length) return null;
  return (
    <div className="fixed bottom-4 right-4 z-50 flex flex-col gap-2">
      {toasts.map(t => (
        <div key={t.id} className={`px-4 py-2 rounded-lg shadow-lg text-white ${
          t.type === 'success' ? 'bg-green-600' : 'bg-red-600'
        }`}>
          {t.message}
        </div>
      ))}
    </div>
  );
}
```

#### 8. `src/features/tasks/components/TaskForm.tsx` (MODIFY)

```diff
+ import { generateShareUrl } from '@/utils/url';
+ import { useToast } from '@/contexts/ToastContext';

  const TaskForm = ({ mode, id, prefill }) => {
+   const { showToast } = useToast();

-   const copyShareLink = () => {
-     if (id) {
-       const shareLink = `${window.location.origin}/tasks/${id}`;
-       navigator.clipboard.writeText(shareLink);
-     }
-   };

+   const copyShareLink = async () => {
+     if (id) {
+       const shareLink = generateShareUrl('task', id);
+       try {
+         await navigator.clipboard.writeText(shareLink);
+         showToast('Link copied');
+       } catch {
+         showToast('Copy failed', 'error');
+       }
+     }
+   };
```

#### 9. `src/components/layout/AppLayout.tsx` (MODIFY)

```diff
+ import { ToastProvider } from '@/contexts/ToastContext';

  export const AppLayout = () => (
    <UiProvider>
      <FilterProvider>
+       <ToastProvider>
          <AppLayoutContent />
+       </ToastProvider>
      </FilterProvider>
    </UiProvider>
  );
```

---

### Todo

- [ ] `utils/url.ts` 생성 (SSOT)
- [ ] `contexts/ToastContext.tsx` 생성
- [ ] `components/common/ToastContainer.tsx` 생성
- [ ] `AppLayout.tsx`에 ToastProvider 추가
- [ ] `TaskForm.tsx` 수정 (generateShareUrl + useToast)
- [ ] `hooks/useDeepLink.ts` 생성
- [ ] `pages/Task/index.tsx` 생성
- [ ] `pages/Project/index.tsx` 수정
- [ ] `routes/index.tsx`에 `/tasks/:id` 추가
- [ ] `npm run build` 검증

---

### Verification

1. **Share URL 복사 테스트**
   - TaskForm에서 Share 클릭 → 클립보드 확인
   - 개발: `http://localhost:5173/tasks/tsk-xxx`
   - 프로덕션: `https://domain.com/v2/tasks/tsk-xxx`

2. **Deep Link 테스트**
   - `/tasks/tsk-023-01` 접속 → Kanban + Task Drawer 열림
   - `/projects/prj-023` 접속 → Kanban + Project Drawer 열림

3. **토스트 테스트**
   - 복사 성공 → "Link copied" 표시 (3초 후 사라짐)

---

## Links

- Plan file: `/Users/gim-eunhyang/.claude/plans/quirky-cuddling-cake.md`

---

## Work Log

### 2026-01-09
**개요**: Task 완료 - Share URL v2 deep link 구현

**구현 내용**:
- `utils/url.ts` - Share URL 생성 SSOT (basename v2 반영)
- `contexts/ToastContext.tsx` + `ToastContainer.tsx` - 토스트 알림 시스템
- `hooks/useDeepLink.ts` - URL → Drawer 열기 훅
- `pages/Task/index.tsx` - `/tasks/:id` 라우트 (NEW)
- `pages/Project/index.tsx` - deep link 구현
- `routes/index.tsx` - 라우트 추가
- `TaskForm.tsx` - generateShareUrl + useToast 적용
- `AppLayout.tsx` - ToastProvider 추가

**검증 완료**:
- Share URL 복사 → 토스트 "Link copied" 표시
- Deep link 접속 → Drawer 자동 오픈
- 프로덕션 `/v2` basename 반영 확인

**최종 상태**: done
