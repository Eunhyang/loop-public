---
entity_type: Task
entity_id: tsk-023-1769054156236
entity_name: Entity Template System - Project+Tasks ì¼ê´„ ìƒì„± ê¸°ëŠ¥
created: '2026-01-22'
updated: '2026-01-22'
status: done
project_id: prj-023
parent_id: prj-023
assignee: ê¹€ì€í–¥
priority: medium
tags: []
type: dev
aliases:
- tsk-023-1769054156236
start_date: '2026-01-22'
due: '2026-01-22'
---

# Entity Template System - Project+Tasks ì¼ê´„ ìƒì„± ê¸°ëŠ¥

## ì„¤ëª…

Dashboardì—ì„œ ë°˜ë³µë˜ëŠ” Project+Tasksë¥¼ í…œí”Œë¦¿ìœ¼ë¡œ ì €ì¥í•˜ê³ , ë‚ ì§œë§Œ ì„ íƒí•˜ë©´ ì¼ê´„ ìƒì„±ë˜ëŠ” ì‹œìŠ¤í…œ êµ¬ì¶•.

## Notes

### Summary
Entity Template System êµ¬í˜„ - Vaultì˜ markdown í…œí”Œë¦¿ì„ ê¸°ë°˜ìœ¼ë¡œ Project+Tasksë¥¼ ì¼ê´„ ìƒì„±í•˜ëŠ” APIì™€ Dashboard UI ì¶”ê°€.

### Changes Made

**Backend (api/)**
- `api/routers/entity_templates.py` - ì‹ ê·œ ë¼ìš°í„°
  - `GET /api/entity-templates` - í…œí”Œë¦¿ ëª©ë¡
  - `GET /api/entity-templates/{id}` - í…œí”Œë¦¿ ìƒì„¸
  - `POST /api/entity-templates/{id}/instantiate` - Project+Tasks ì¼ê´„ ìƒì„±
- `api/main.py` - ë¼ìš°í„° ë“±ë¡

**Frontend (dashboard-v2/)**
- `src/features/entity-templates/` - ì‹ ê·œ feature í´ë”
  - `types.ts` - EntityTemplate, InstantiateRequest ë“± íƒ€ì…
  - `api.ts` - API í˜¸ì¶œ í•¨ìˆ˜
  - `queries.ts` - React Query hooks
  - `components/TemplateGalleryModal.tsx` - í…œí”Œë¦¿ ê°¤ëŸ¬ë¦¬ ëª¨ë‹¬
  - `components/TemplateCard.tsx` - í…œí”Œë¦¿ ì¹´ë“œ UI
  - `components/InstantiateDialog.tsx` - ë‚ ì§œ ì…ë ¥ ë‹¤ì´ì–¼ë¡œê·¸
  - `index.ts` - ëª¨ë“ˆ export
- `src/components/layout/Header.tsx` - ğŸ“‹ Template ë²„íŠ¼ ì¶”ê°€
- `src/queries/keys.ts` - entityTemplates, entityTemplate queryKey ì¶”ê°€

**í…œí”Œë¦¿ íŒŒì¼ (_build/)**
- `_build/entity_templates/tpl-youtube-weekly.md` - YouTube Weekly Round (11 tasks)
- `_build/entity_templates/tpl-weekly-review-meeting.md` - ì£¼ê°„ ë¦¬ë·° ë¯¸íŒ… (1 task)

### Plan

# Entity Template System Implementation Plan

> **ëª©í‘œ**: Dashboardì—ì„œ ë°˜ë³µë˜ëŠ” Project+Tasks ë˜ëŠ” Taskë¥¼ í…œí”Œë¦¿ìœ¼ë¡œ ì €ì¥í•˜ê³ , ë‚ ì§œë§Œ ì„ íƒí•˜ë©´ ì¼ê´„ ìƒì„±ë˜ëŠ” ì‹œìŠ¤í…œ êµ¬ì¶•

---

## 1. ê°œìš”

### ìš”êµ¬ì‚¬í•­
- Vault `_Templates/` í´ë”ì— markdown í…œí”Œë¦¿ ì €ì¥
- 2ê°€ì§€ í…œí”Œë¦¿ íƒ€ì…: `project_with_tasks` (Project + ì—¬ëŸ¬ Task), `task_only` (Task 1ê°œ)
- `day_offset`ìœ¼ë¡œ ì‹œì‘ì¼ ê¸°ì¤€ ìë™ ë‚ ì§œ ê³„ì‚°
- Headerì— ğŸ“‹ Template ë²„íŠ¼ ì¶”ê°€ â†’ í…œí”Œë¦¿ ê°¤ëŸ¬ë¦¬ â†’ ë‚ ì§œ ì„ íƒ â†’ ì¼ê´„ ìƒì„±

### ì´ˆê¸° í…œí”Œë¦¿ 2ê°œ
1. **YouTube Weekly Round**: Project 1ê°œ + Task 11ê°œ
2. **ì£¼ê°„ ë¦¬ë·° ë¯¸íŒ…**: Task 1ê°œ (16:00 meeting)

---

## 2. êµ¬í˜„ ë²”ìœ„

### Phase 1: Backend API
| íŒŒì¼ | ì‘ì—… |
|------|------|
| `code/api/routers/entity_templates.py` | ìƒˆ ë¼ìš°í„° ìƒì„± |
| `code/api/main.py` | ë¼ìš°í„° ë“±ë¡ |

### Phase 2: Vault í…œí”Œë¦¿
| íŒŒì¼ | ì‘ì—… |
|------|------|
| `public/_Templates/entity_templates/tpl-youtube-weekly.md` | YouTube í…œí”Œë¦¿ |
| `public/_Templates/entity_templates/tpl-weekly-review-meeting.md` | ë¯¸íŒ… í…œí”Œë¦¿ |

### Phase 3: Frontend
| íŒŒì¼ | ì‘ì—… |
|------|------|
| `dashboard-v2/src/features/entity-templates/` | ìƒˆ feature í´ë” |
| `dashboard-v2/src/components/layout/Header.tsx` | Template ë²„íŠ¼ ì¶”ê°€ |
| `dashboard-v2/src/queries/keys.ts` | queryKey ì¶”ê°€ |

---

## 3. ìƒì„¸ ì„¤ê³„

### 3.1 í…œí”Œë¦¿ ìŠ¤í‚¤ë§ˆ (Vault Markdown)

```yaml
---
entity_type: EntityTemplate
entity_id: tpl-youtube-weekly
entity_name: YouTube Weekly Round

template_type: project_with_tasks  # project_with_tasks | task_only
description: "YouTube 1ì£¼ 1ì—…ë¡œë“œ ë¼ìš´ë“œ ìƒì„±"
icon: video  # video | meeting | ops | dev
category: content

# Project ì •ì˜ (project_with_tasksì¼ ë•Œ)
project:
  name_template: "YouTube - {cycle}"
  program_id: pgm-youtube-weekly
  parent_id: trk-3
  owner: í•œëª…í•™

# Task ë°°ì—´
tasks:
  - seq: 1
    name_template: "ì£¼ì œ ì„ ì •"
    day_offset: 0
    assignee: ê¹€ì€í–¥
    type: ops
  - seq: 2
    name_template: "ì›ê³  ì‘ì„±"
    day_offset: 1
    assignee: í•œëª…í•™
    # ...
---
```

### 3.2 API Endpoints

```
GET  /api/entity-templates              â†’ í…œí”Œë¦¿ ëª©ë¡
GET  /api/entity-templates/{id}         â†’ í…œí”Œë¦¿ ìƒì„¸
POST /api/entity-templates/{id}/instantiate â†’ ìƒì„± ì‹¤í–‰
```

**InstantiateRequest**:
```python
{
  "start_date": "2026-01-24",  # ê¸°ì¤€ì¼ (í•„ìˆ˜)
  "cycle": "W04-26",           # ì„ íƒ (ì—†ìœ¼ë©´ ìë™ ê³„ì‚°)
  "project_id": "prj-..."      # task_onlyì¼ ë•Œ ì—°ê²°í•  í”„ë¡œì íŠ¸
}
```

**InstantiateResponse**:
```python
{
  "success": true,
  "template_id": "tpl-youtube-weekly",
  "project_id": "prj-yt-W04-26",
  "task_ids": ["tsk-yt-w04-26-01", ...],
  "message": "Created 1 project + 11 tasks"
}
```

### 3.3 UI íë¦„

```
Header [+ Task] [+ Project] [+ Program] [ğŸ“‹ Template]
                                              â†“
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚     í…œí”Œë¦¿ ê°¤ëŸ¬ë¦¬ (Modal)         â”‚
                          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                          â”‚  ğŸ¬ YouTube Weekly Round         â”‚
                          â”‚     Project + 11 Tasks           â”‚
                          â”‚                                 â”‚
                          â”‚  ğŸ“… ì£¼ê°„ ë¦¬ë·° ë¯¸íŒ…               â”‚
                          â”‚     Task only (16:00)           â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                              â†“
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚     ë‚ ì§œ ì„ íƒ (Dialog)           â”‚
                          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                          â”‚  ì‹œì‘ì¼: [2026-01-24]  ğŸ“…        â”‚
                          â”‚  Cycle: W04-26 (ìë™)           â”‚
                          â”‚                                 â”‚
                          â”‚  ìƒì„± ì˜ˆì •:                      â”‚
                          â”‚  - Project: YouTube - W04-26    â”‚
                          â”‚  - Tasks: 11ê°œ                  â”‚
                          â”‚                                 â”‚
                          â”‚     [Cancel]  [Create]          â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. YouTube Weekly í…œí”Œë¦¿ Task ëª©ë¡

| seq | name | day_offset | assignee | ë¹„ê³  |
|-----|------|------------|----------|------|
| 1 | ì£¼ì œ ì„ ì • | 0 | ê¹€ì€í–¥ | |
| 2 | ì›ê³  ì‘ì„± | 1 | í•œëª…í•™ | |
| 3 | ì›ê³  ìˆ˜ì • + ì´¬ì˜ | 2 | í•œëª…í•™ | |
| 4 | í¸ì§‘ ì™¸ì£¼ | 3 | ì™¸ì£¼ | |
| 5 | ì¸ë„¤ì¼ ì œì‘ | 10 | ê¹€ì€í–¥ | **ë¶„ë¦¬ë¨** |
| 6 | ì—…ë¡œë“œ | 10 | í•œëª…í•™ | **ì²´í¬ë¦¬ìŠ¤íŠ¸ í¬í•¨** |
| 7 | ì‡¼ì¸  #1 | 11 | í•œëª…í•™ | |
| 8 | ì‡¼ì¸  #2 | 12 | í•œëª…í•™ | |
| 9 | ì‡¼ì¸  #3 | 13 | í•œëª…í•™ | |
| 10 | ì‡¼ì¸  #4 | 14 | í•œëª…í•™ | |
| 11 | ì‡¼ì¸  #5 | 15 | í•œëª…í•™ | |

**ì—…ë¡œë“œ Task ì²´í¬ë¦¬ìŠ¤íŠ¸**:
- [ ] ë³¸ë¬¸ ì‘ì„±
- [ ] ëŒ“ê¸€ ê³ ì • ë‚´ìš© ì‘ì„±
- [ ] Branch.io ì¸¡ì • ë§í¬ ì„¤ì •

---

## 5. íŒŒì¼ë³„ êµ¬í˜„ ë‚´ìš©

### 5.1 `code/api/routers/entity_templates.py` (ì‹ ê·œ)

```python
"""
Entity Template Router
- í…œí”Œë¦¿ ëª©ë¡/ìƒì„¸ ì¡°íšŒ
- í…œí”Œë¦¿ ê¸°ë°˜ ì—”í‹°í‹° ì¼ê´„ ìƒì„± (instantiate)
"""

router = APIRouter(prefix="/api/entity-templates", tags=["entity-templates"])

TEMPLATES_DIR = VAULT_DIR / "_Templates" / "entity_templates"

@router.get("/")
def list_templates() -> list[EntityTemplateSummary]

@router.get("/{template_id}")
def get_template(template_id: str) -> EntityTemplate

@router.post("/{template_id}/instantiate")
def instantiate_template(template_id: str, request: InstantiateRequest) -> InstantiateResponse
```

- `youtube_weekly.py`ì˜ `create_round` ë¡œì§ ì¬ì‚¬ìš©
- `SSOTService`ë¡œ ID ìƒì„± (TaskëŠ” project hash í¬í•¨)

### 5.2 `dashboard-v2/src/features/entity-templates/` (ì‹ ê·œ)

```
entity-templates/
â”œâ”€â”€ api.ts                    # API í˜¸ì¶œ
â”œâ”€â”€ queries.ts                # useEntityTemplates, useInstantiateTemplate
â”œâ”€â”€ types.ts                  # EntityTemplate, InstantiateRequest ë“±
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ TemplateGalleryModal.tsx   # í…œí”Œë¦¿ ëª©ë¡ ëª¨ë‹¬
â”‚   â”œâ”€â”€ TemplateCard.tsx           # ì¹´ë“œ UI
â”‚   â””â”€â”€ InstantiateDialog.tsx      # ë‚ ì§œ ì…ë ¥ ë‹¤ì´ì–¼ë¡œê·¸
â””â”€â”€ index.ts
```

### 5.3 `dashboard-v2/src/components/layout/Header.tsx`

L157 (Program ë²„íŠ¼ ë‹«ëŠ” `}` ë’¤)ì— ì¶”ê°€:

```tsx
<button
  onClick={() => setTemplateGalleryOpen(true)}
  className="px-2 py-1 border border-amber-500 text-gray-600 hover:bg-amber-50 rounded text-xs font-medium transition-colors flex items-center gap-0.5"
>
  <span>ğŸ“‹</span>Template
</button>

<TemplateGalleryModal
  open={templateGalleryOpen}
  onOpenChange={setTemplateGalleryOpen}
/>
```

### 5.4 `dashboard-v2/src/queries/keys.ts`

```typescript
entityTemplates: () => ['entity-templates'] as const,
entityTemplate: (id: string) => ['entity-templates', id] as const,
```

---

## 6. ê²€ì¦ ë°©ë²•

### Backend
```bash
# 1. API ì„œë²„ ì‹¤í–‰
cd ~/dev/loop/code
poetry run uvicorn api.main:app --reload --port 8081

# 2. í…œí”Œë¦¿ ëª©ë¡ ì¡°íšŒ
curl http://localhost:8081/api/entity-templates

# 3. í…œí”Œë¦¿ instantiate í…ŒìŠ¤íŠ¸
curl -X POST http://localhost:8081/api/entity-templates/tpl-youtube-weekly/instantiate \
  -H "Content-Type: application/json" \
  -d '{"start_date": "2026-01-24"}'
```

### Frontend
```bash
# 1. Dashboard ê°œë°œ ì„œë²„
cd ~/dev/loop/code/dashboard-v2
npm run dev

# 2. ë¹Œë“œ í™•ì¸
npm run build
```

### E2E
1. Dashboardì—ì„œ ğŸ“‹ Template ë²„íŠ¼ í´ë¦­
2. YouTube Weekly Round ì„ íƒ
3. ë‚ ì§œ ì…ë ¥ í›„ Create
4. Project + 11 Tasks ìƒì„± í™•ì¸
5. Calendar ë·°ì—ì„œ Tasks í‘œì‹œ í™•ì¸

---

## 7. ì£¼ìš” ìˆ˜ì • íŒŒì¼

| íŒŒì¼ | ë³€ê²½ ìœ í˜• |
|------|----------|
| `code/api/routers/entity_templates.py` | ì‹ ê·œ |
| `code/api/main.py` | ë¼ìš°í„° ë“±ë¡ ì¶”ê°€ |
| `public/_Templates/entity_templates/tpl-youtube-weekly.md` | ì‹ ê·œ |
| `public/_Templates/entity_templates/tpl-weekly-review-meeting.md` | ì‹ ê·œ |
| `dashboard-v2/src/features/entity-templates/*` | ì‹ ê·œ í´ë” |
| `dashboard-v2/src/components/layout/Header.tsx` | Template ë²„íŠ¼ ì¶”ê°€ |
| `dashboard-v2/src/queries/keys.ts` | queryKey ì¶”ê°€ |

---

## 8. í–¥í›„ í™•ì¥

- n8nì—ì„œ `/api/entity-templates/{id}/instantiate` í˜¸ì¶œ ê°€ëŠ¥
- ê¸°ì¡´ `youtube_weekly.py`ëŠ” ìœ ì§€ (n8n í˜¸í™˜ì„±), ì ì§„ì  ë§ˆì´ê·¸ë ˆì´ì…˜
- í…œí”Œë¦¿ CRUD UI (ìƒì„±/ìˆ˜ì •/ì‚­ì œ) ì¶”í›„ ì¶”ê°€ ê°€ëŠ¥

---

## ì²´í¬ë¦¬ìŠ¤íŠ¸

- [x] Backend API router ìƒì„±
- [x] main.pyì— ë¼ìš°í„° ë“±ë¡
- [x] Vault í…œí”Œë¦¿ íŒŒì¼ ìƒì„±
- [x] Frontend feature í´ë” ìƒì„±
- [x] Headerì— Template ë²„íŠ¼ ì¶”ê°€
- [x] keys.tsì— queryKey ì¶”ê°€
- [x] ë¹Œë“œ í…ŒìŠ¤íŠ¸ í†µê³¼

## ì°¸ê³ 

- ì»¤ë°‹: `7737c9662 feat(entity-templates): Add Entity Template System for batch creation`
- ì›Œí¬íŠ¸ë¦¬ ì‚¬ìš©: `code-entity-templates` ë¸Œëœì¹˜ì—ì„œ ì‘ì—… í›„ mainì— ë¨¸ì§€

## ì§§ì€ íšŒê³ 

ì›Œí¬íŠ¸ë¦¬ë¥¼ í™œìš©í•˜ì—¬ main ë¸Œëœì¹˜ë¥¼ ê¹”ë”í•˜ê²Œ ìœ ì§€í•˜ë©´ì„œ feature ê°œë°œ ì™„ë£Œ.
