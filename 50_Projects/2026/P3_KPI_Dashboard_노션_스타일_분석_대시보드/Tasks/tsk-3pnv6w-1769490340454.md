---
entity_type: Task
entity_id: tsk-3pnv6w-1769490340454
entity_name: KPI - PMF Core Metrics Dashboard
created: '2026-01-27'
updated: '2026-01-27'
status: done
project_id: prj-3pnv6w
parent_id: prj-3pnv6w
assignee: 김은향
priority: medium
start_date: '2026-01-27'
due: '2026-01-27'
notes: "# PRD — PMF Core Metrics Dashboard (Q1)\n\n제품: 꼭꼭앱 (trk1 PMF 신호 확보)\\\n목표:\
  \ Amplitude 이벤트를 기반으로 “PMF 핵심 7개 지표”를 **대시보드에서 바로 계산/표현**한다. (Amplitude 차트 생성 없이)\n\
  \n---\n\n## 1) 배경/문제\n\n- 이벤트는 이미 Amplitude로 지속 수집 중이나, PMF 판단에 필요한 핵심 지표가 대시보드에\
  \ 표준화되어 있지 않다.\n\n- Q1에서 가장 중요한 것은 “코어 가치(activation) → 반복(usage) → 유지(retention)\
  \ → 확장(adoption) → 유료 의향(intent)”의 흐름이 존재하는지 빠르게 확인하는 것이다.\n\n---\n\n## 2) 목표/성공\
  \ 정의\n\n### 2.1 목표\n\n- 아래 7개 메트릭을 **일/주 단위**로 확인 가능하게 만든다.\n\n- 동일한 정의로 매주 반복 산출\
  \ 가능(정의 흔들림 없이 SSOT).\n\n### 2.2 성공 조건(Delivery)\n\n- 대시보드에 7개 메트릭이 모두 표시된다.\n\n\
  - 날짜 범위 선택(예: 최근 7/14/30일, 커스텀) 가능.\n\n- 플랫폼 필터(iOS/Android) 및 신규/전체 필터 가능.\n\n\
  - 데이터 갱신: 최소 일 1회(권장: 1시간 1회 캐시 갱신).\n\n### 2.3 성공 조건(Business)\n\n- 주간 리뷰에서 “PMF\
  \ 신호가 강화/약화되는지”를 10분 내 판단할 수 있다.\n\n- 신규 기능(예: 폭식 개입) 출시 시, 코어 지표가 무너지는지(guardrail)\
  \ 즉시 감지한다.\n\n---\n\n## 3) 범위(Scope)\n\n### 3.1 In Scope\n\n- Amplitude에서 API로 집계\
  \ 데이터를 조회해 대시보드에 표준화된 메트릭을 계산/표시\n\n- 메트릭 정의/분모/필터/집계 단위 표준화\n\n- 캐시 저장(서버) 및 대시보드\
  \ 렌더\n\n### 3.2 Out of Scope (이번 PRD에서 제외)\n\n- Raw event export를 자체 DB에 적재해 완전\
  \ 자가계산(향후 Q2 옵션)\n\n- 실험/코호트 자동 배정(A/B) 시스템\n\n- 유료 결제 리포팅 정합성(RevenueCat 등) 통합\n\
  \n---\n\n## 4) 데이터 소스 / 전제\n\n### 4.1 데이터 소스\n\n- Amplitude Events (이미 수집 중)\n\n\
  - 사용자 이벤트(가입/로그인), 타이머 이벤트, 설정/프리셋, Pro/Subscription 이벤트\n\n### 4.2 핵심 전제\n\n- `user_id`\
  \ 식별자가 이벤트에 일관되게 포함됨\n\n- `timestamp` 기반으로 일/주 단위 집계 가능\n\n- 신규 유저 정의를 위해 `user_signup_completed`\
  \ 또는 equivalent 이벤트가 존재\n\n---\n\n## 5) 메트릭 정의(SSOT)\n\n아래 7개는 반드시 “정의가 고정”되어야 한다.\\\
  \n표기 원칙:\n\n- 분모(denominator)와 분자(numerator)를 명시한다.\n\n- “유니크 유저 기준”을 기본으로 한다(이벤트\
  \ 카운트 vs 유저 수 혼동 방지).\n\n---\n\n### M1. Activation Rate (24h)\n\n**정의**: 신규 유저 중\
  \ 가입 후 24시간 내 `timer_session_completed`를 1회 이상 경험한 비율\n\n- **대상 코호트**: 기간 내 `user_signup_completed`\
  \ 발생 유저(신규)\n\n- **분자**: 신규 유저 중 signup_time + 24h 내 `timer_session_completed` ≥\
  \ 1\n\n- **분모**: 기간 내 `user_signup_completed` 유니크 유저 수\n\n- **집계**: 일별(가입일 기준),\
  \ 주간(가입 주 기준) 둘 다 제공\n\n**필터**: platform(iOS/Android), 신규만(기본)\n\n---\n\n### M2.\
  \ TTFV (Time to First Value) p50\n\n**정의**: 신규 유저의 signup → 첫 `timer_session_completed`까지\
  \ 걸린 시간의 p50(중앙값)\n\n- **대상 코호트**: 기간 내 `user_signup_completed` 유저 중, 7일 이내 completed가\
  \ 존재하는 유저(측정 가능 집합)\n\n- **측정값**: first_completed_time - signup_time (minutes)\n\
  \n- **지표**: p50 (선택: p80도 옵션)\n\n**주의**: completed 없는 신규 유저는 TTFV 계산에서 제외(별도로 “Activation\
  \ Rate”에서 반영)\n\n---\n\n### M3. Completion Rate\n\n**정의**: `timer_session_started`\
  \ 대비 `timer_session_completed` 비율\n\n- 기본: **유저 기준**과 **이벤트 기준** 중 택1 (권장: 이벤트 기준)\n\
  \n  - **이벤트 기준**: completed_count / started_count\n\n  - **유저 기준(보조)**: started\
  \ 유저 중 completed 유저 비율\n\n- **집계**: 일/주\n\n**Guardrail**: cancelled/paused 비율도 같이\
  \ 보는 옵션 제공(추가 위젯은 선택)\n\n---\n\n### M4. Weekly Repeat Rate (2+ completions)\n\n\
  **정의**: 주간 단위로 `timer_session_completed`를 2회 이상 수행한 유저 비율\n\n- **분자**: 해당 주에 completed_count\
  \ ≥ 2 인 유저 수\n\n- **분모**: 해당 주에 completed_count ≥ 1 인 유저 수\n\n- **집계**: 주간(ISO week)\n\
  \n---\n\n### M5. Core WAU (Core Weekly Active Users)\n\n**정의**: 주간에 `timer_session_completed`를\
  \ 1회 이상 수행한 유니크 유저 수\n\n- **집계**: 주간\n\n- **필터**: platform\n\n---\n\n### M6. Customization\
  \ Adoption Rate\n\n**정의**: 활성 사용자 중 “커스터마이즈 행동”을 한 유저 비율\n\n- **커스터마이즈 행동 이벤트(OR)**:\n\
  \n  - `timer_settings_updated` OR `timer_preset_created`\n\n- **분자**: 해당 기간 내 커스터마이즈\
  \ 이벤트 1회 이상 유저 수\n\n- **분모(권장)**: 해당 기간 내 `timer_session_started` 또는 `timer_session_completed`\
  \ 1회 이상 유저 수(활성 유저)\n\n- **집계**: 주간(기본) + 일간(옵션)\n\n---\n\n### M7. Pro Intent (Upgrade\
  \ Intent)\n\n**정의**: Pro/구독 전환 “의향” 신호\n\n- **Pro Prompt CTR** = `pro_prompt_clicked`\
  \ / `pro_prompt_shown`\n\n- **Pricing View Rate(보조)** = `pro_pricing_viewed` / 활성\
  \ 유저 수\n\n- **집계**: 일/주\n\n**Guardrail**: 지나친 프롬프트 노출로 코어 지표(M3/M4/M5)가 하락하면 경고\n\
  \n---\n\n## 6) 대시보드 요구사항(화면/위젯)\n\n### 6.1 화면 구성\n\n- 섹션 A: Activation & TTFV (M1,\
  \ M2)\n\n- 섹션 B: Core Usage (M3, M4, M5)\n\n- 섹션 C: Adoption & Monetization Intent\
  \ (M6, M7)\n\n### 6.2 공통 UI 기능\n\n- 날짜 범위: last 7/14/30 days + custom\n\n- 집계 단위\
  \ 토글: daily / weekly\n\n- 필터: platform (All/iOS/Android), 신규/전체(Activation 섹션은 신규\
  \ 기본)\n\n- 각 지표 위젯: “현재값 + 이전 기간 대비 증감(%)” 표시(옵션)\n\n---\n\n## 7) 시스템/구현 요구사항\n\n\
  ### 7.1 데이터 파이프라인\n\n- 서버에서 Amplitude API 호출 → 결과를 캐시 → 대시보드가 캐시를 조회\n\n- 캐시 저장소:\
  \ (예) Firestore/DB 테이블 `metrics_cache`\n\n- 캐시 키: `{metric_id}:{granularity}:{platform}:{date_range_start}:{date_range_end}`\n\
  \n### 7.2 갱신 주기\n\n- 최소: 하루 1회(새벽)\n\n- 권장: 1시간 1회(최근 7일 범위만)\n\n### 7.3 실패/오류 처리\n\
  \n- API 실패 시: 마지막 성공 캐시를 보여주고 “last updated” 표시\n\n- 부분 실패 시: 실패한 메트릭 위젯만 에러 상태\
  \ 표시\n\n---\n\n## 8) 데이터 품질/검증(필수 QA)\n\n### 8.1 정합성 체크(샘플링)\n\n- 임의의 날짜 1일을 선택해:\n\
  \n  - Amplitude UI(Events Segmentation 간단 조회) 숫자와\n\n  - 대시보드 집계 숫자가 ±3% 이내인지 확인(시간대/중복\
  \ 제외 고려)\n\n- `user_id` 누락 이벤트 비율을 점검(가능하면 별도 QA 리포트로)\n\n### 8.2 타임존 표준\n\n- 대시보드\
  \ 집계 기준 타임존을 고정(UTC 또는 KST)\n\n- Amplitude 쿼리/캐시 저장 시 동일 기준 적용\n\n---\n\n## 9) 릴리즈/운영\n\
  \n### 9.1 단계적 릴리즈\n\n- Phase 1(1\\~2일): M3/M5 같은 단순 집계부터 연결(성공 확인)\n\n- Phase 2(2\\\
  ~4일): M1/M2/M4 추가(신규/코호트 계산)\n\n- Phase 3(4\\~5일): M6/M7 추가(채택/의향)\n\n### 9.2 주간\
  \ 운영\n\n- 주간 리뷰 템플릿(고정 질문)\n\n  1. 신규 Activation(M1)이 오르고 있는가?\n\n  2. Core WAU(M5)와\
  \ Weekly Repeat(M4)가 같이 오르는가?\n\n  3. Completion(M3)이 떨어지면 UX 문제인가, 유입 품질 문제인가?\n\
  \n  4. Adoption(M6)이 늘면 Repeat(M4)가 동반 상승하는가?\n\n  5. Pro Intent(M7)이 코어 지표를 해치지\
  \ 않는가?\n\n---\n\n## 10) 오픈 이슈 / 결정 필요(개발 착수 전)\n\n1. 신규 유저 정의 이벤트: `user_signup_completed`가\
  \ 단일 진실인가? (게스트/익명 포함 여부)\n\n2. 활성 분모 정의:\n\n   - M6 분모를 `timer_session_started`로\
  \ 할지 `completed`로 할지 최종 확정\n\n3. TTFV 측정 window:\n\n   - signup 후 7일 이내 completed까지로\
  \ 제한할지(권장), 무제한으로 둘지\n\n---\n\n## 11) Acceptance Criteria (완료 조건)\n\n- 7개 메트릭이 대시보드에\
  \ 표시된다.\n\n- 날짜/집계/플랫폼 필터가 동작한다.\n\n- last updated가 표기된다.\n\n- 샘플 날짜 1일 기준으로 핵심\
  \ 카운트/유저수가 ±3% 이내로 맞는다.\n\n- 주간(weekly) 기준에서 M4/M5가 ISO week로 일관된다.\n\n---\n\n##\
  \ 12) Metric IDs (대시보드/캐시용)\n\n- M1_activation_24h_rate\n\n- M2_ttfv_first_completed_p50_minutes\n\
  \n- M3_timer_completion_rate\n\n- M4_weekly_repeat_rate_2plus\n\n- M5_core_wau_completed_users\n\
  \n- M6_customization_adoption_rate\n\n- M7_pro_intent_prompt_ctr\n\n- M7b_pro_intent_pricing_view_rate"
tags: []
type: dev
links: []
aliases:
- tsk-3pnv6w-1769490340454
---
# KPI - # PMF Core Metrics Dashboard

## 설명

## 체크리스트

- [ ]

## 참고

### Amplitude 이벤트 의존성 분석 (2026-01-27)

**API 연결 상태**: ✅ 정상 (Event Segmentation API 사용 가능)

#### 현재 Amplitude에 존재하는 이벤트
| 이벤트 | 용도 |
|--------|------|
| `timer_session_started` | M5 Core WAU 대체 가능 |
| `subscription_purchase_clicked` | M7 Pro Intent |
| `subscription_payment_completed` | Conversion 계산 |
| `pro_page_viewed` | M7 보조 지표 |
| `pro_banner_clicked` | M7 보조 지표 |

#### ⚠️ 누락된 필수 이벤트 (앱 구현 필요)
| 이벤트 | 필요한 메트릭 | 우선순위 |
|--------|-------------|---------|
| `timer_session_completed` | M1, M2, M3, M4, M5 | **P0 (필수)** |
| `user_signup_completed` | M1, M2 | **P0 (필수)** |
| `timer_settings_updated` | M6 | P1 |
| `timer_preset_created` | M6 | P1 |
| `pro_prompt_shown` | M7 CTR 계산 | P1 |
| `pro_prompt_clicked` | M7 CTR 계산 | P1 |
| `timer_session_cancelled` | M3 Guardrail | P2 |
| `timer_session_paused` | M3 Guardrail | P2 |

#### 구현 가능 메트릭 현황
| 메트릭 | 이벤트 추가 전 | 이벤트 추가 후 |
|--------|--------------|--------------|
| M1. Activation Rate | ❌ | ✅ |
| M2. TTFV p50 | ❌ | ⚠️ (Export API 필요) |
| M3. Completion Rate | ❌ | ✅ |
| M4. Weekly Repeat | ❌ | ⚠️ (유저별 집계 필요) |
| M5. Core WAU | ⚠️ (started 기준) | ✅ (completed 기준) |
| M6. Customization | ❌ | ✅ |
| M7. Pro Intent | ⚠️ (일부만) | ✅ |

#### 다음 단계
1. **꼭꼭앱 Flutter 코드에 P0 이벤트 추가** → 별도 Task 생성 필요
2. 이벤트 배포 후 대시보드 구현 진행

## 짧은 회고

---

## Notes

### Summary
PMF Metrics Dashboard를 Clean Architecture로 구현 완료. Backend(FastAPI)에 8개 메트릭 프로바이더와 v2 API 엔드포인트 추가, Frontend(React)에 PMFDashboardPage, RetentionWidget, StickinessWidget 등 컴포넌트 구현.

### Changes Made

**Backend (31 files created/modified)**
- `api/services/kpi/domain/` - entities.py, interfaces.py (도메인 레이어)
- `api/services/kpi/use_cases/` - get_metrics.py, period_resolver.py (유스케이스)
- `api/services/kpi/adapters/` - amplitude_chart.py, amplitude_event.py (데이터 소스)
- `api/services/kpi/adapters/metric_providers/` - 8개 프로바이더 (dau, mau, retention, conversion, paid_users, core_wau, stickiness, subscription_rate)
- `api/routers/kpi_v2.py` - v2 API 엔드포인트 (`/api/kpi/v2/metrics`)
- `api/main.py` - 라우터 등록

**Frontend**
- `dashboard-v2/src/features/kpi/components/PMFDashboardPage.tsx` - 메인 대시보드
- `dashboard-v2/src/features/kpi/components/PeriodSelector.tsx` - 기간 선택기 (7D/30D/60D/90D)
- `dashboard-v2/src/features/kpi/components/RetentionWidget.tsx` - D1/D7/D14 리텐션 차트
- `dashboard-v2/src/features/kpi/components/StickinessWidget.tsx` - DAU/MAU 스티키니스 차트
- `dashboard-v2/src/features/kpi/api.ts` - kpiV2Api 함수
- `dashboard-v2/src/features/kpi/queries.ts` - usePMFMetrics, usePMFMetric hooks
- `dashboard-v2/src/types/kpi.ts` - v2 타입 정의
- `dashboard-v2/src/routes/index.tsx` - /pmf 라우트 추가

**code-simplifier 적용**
- `parse_percentage()` 공유 함수 추출 (retention, conversion 중복 제거)
- `kpi_v2.py`에서 `resolve_period()`, `validate_metric_type()` 헬퍼 추출
- 프론트엔드: `formatChartDate` 유틸 공유, 차트 상수 추출

### Plan

# PMF Metrics Dashboard 구현 계획

## 목표
8개 KPI 메트릭을 기간별로 조회 가능한 확장 가능한 대시보드 구현

## UI 요구사항
- **레이아웃**: 화면 가로 영역 최대 활용 (full-width)
- **상단 배치**: Retention + Stickiness 차트 (기간별 트렌드 그래프)
- **차트 타입**: 기간별 라인/영역 차트로 트렌드 시각화

## 다음 태스크 (Out of Scope)
- 마스터 차트: 모든 이벤트를 한 그래프에서 다중 축으로 비교

---

## 1. 아키텍처 설계 (Clean Architecture)

### Backend (FastAPI)

```
code/api/services/kpi/
├── domain/                    # 도메인 레이어
│   ├── entities.py            # Metric, Period, MetricResult
│   └── interfaces.py          # IMetricProvider, IDataSource
│
├── use_cases/                 # 유스케이스 레이어
│   ├── get_metrics.py         # GetMetricsUseCase
│   └── period_resolver.py     # PeriodResolver (preset/month/custom)
│
├── adapters/                  # 어댑터 레이어
│   ├── amplitude_chart.py     # Chart API 데이터 소스
│   ├── amplitude_event.py     # Event Segmentation API 데이터 소스
│   └── metric_providers/      # 메트릭별 프로바이더
│       ├── base.py            # BaseMetricProvider
│       ├── dau.py
│       ├── mau.py
│       ├── retention.py
│       ├── conversion.py
│       ├── paid_users.py
│       ├── core_wau.py
│       ├── stickiness.py
│       └── subscription_rate.py
│
├── config.py                  # 기존 설정
└── amplitude_client.py        # 기존 클라이언트 (리팩토링)
```

### Frontend (React + TypeScript)

```
code/dashboard-v2/src/features/kpi-dashboard/
├── api/
│   └── kpi-api.ts             # API 호출
│
├── hooks/
│   ├── useMetrics.ts          # React Query 훅
│   └── usePeriod.ts           # 기간 선택 훅
│
├── components/
│   ├── MetricCard.tsx         # 메트릭 카드 (확장 가능)
│   ├── MetricChart.tsx        # 차트 컴포넌트
│   ├── PeriodSelector.tsx     # 기간 선택기
│   ├── DashboardGrid.tsx      # 드래그/리사이즈 가능 그리드
│   └── widgets/               # 메트릭별 위젯
│       ├── RetentionWidget.tsx    # 상단 - 풀와이드
│       ├── StickinessWidget.tsx   # 상단 - 풀와이드
│       ├── DAUWidget.tsx
│       ├── MAUWidget.tsx
│       └── ...
│
├── types/
│   └── kpi.types.ts           # 타입 정의
│
└── KPIDashboardPage.tsx       # 메인 페이지
```

### 레이아웃 구조

```
┌─────────────────────────────────────────────────────────────┐
│  [PeriodSelector: Last 30d | Last 60d | Month | Custom]     │
├─────────────────────────────────────────────────────────────┤
│  ┌───────────────────────────────────────────────────────┐  │
│  │  Retention 트렌드 차트 (D1/D7/D14 라인)  [full-width] │  │
│  └───────────────────────────────────────────────────────┘  │
│  ┌───────────────────────────────────────────────────────┐  │
│  │  Stickiness 트렌드 차트 (DAU/MAU %)      [full-width] │  │
│  └───────────────────────────────────────────────────────┘  │
├─────────────────────────────────────────────────────────────┤
│  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌───────┐  │
│  │ DAU         │ │ MAU         │ │ Core WAU    │ │ Conv. │  │
│  │ 145 avg     │ │ 879         │ │ 217         │ │ 19%   │  │
│  └─────────────┘ └─────────────┘ └─────────────┘ └───────┘  │
│  ┌─────────────┐ ┌─────────────┐                            │
│  │ Paid Users  │ │ Sub. Rate   │                            │
│  └─────────────┘ └─────────────┘                            │
└─────────────────────────────────────────────────────────────┘
```

---

## 2. 핵심 인터페이스 설계

### Domain Entities

```python
# domain/entities.py
@dataclass
class Period:
    start_date: date
    end_date: date
    period_type: Literal["preset", "month", "custom"]
    label: str  # "Last 30 days", "2026-01", etc.

@dataclass
class MetricResult:
    metric_id: str
    value: float | dict
    trend: list[dict] | None
    unit: str
    period: Period
    updated_at: datetime

class MetricType(Enum):
    DAU = "dau"
    MAU = "mau"
    RETENTION = "retention"
    CONVERSION = "conversion"
    PAID_USERS = "paid_users"
    CORE_WAU = "core_wau"
    STICKINESS = "stickiness"
    SUBSCRIPTION_RATE = "subscription_rate"
```

### Interfaces

```python
# domain/interfaces.py
class IMetricProvider(Protocol):
    metric_type: MetricType

    async def get_metric(self, period: Period) -> MetricResult:
        ...

class IDataSource(Protocol):
    async def fetch_chart_data(self, chart_id: str, start: date, end: date) -> dict:
        ...

    async def fetch_event_data(self, event_type: str, start: date, end: date, **kwargs) -> dict:
        ...
```

---

## 3. API 엔드포인트 설계

### 새 엔드포인트

```
GET /api/kpi/v2/metrics
  Query params:
    - period: "last_7d" | "last_30d" | "last_60d" | "all_time"
    - month: "2026-01" (YYYY-MM)
    - start: "2026-01-01" (YYYY-MM-DD)
    - end: "2026-01-31" (YYYY-MM-DD)
    - metrics: "dau,mau,retention" (선택적, 기본=전체)

GET /api/kpi/v2/metrics/{metric_id}
  - 단일 메트릭 상세 조회

GET /api/kpi/v2/metrics/{metric_id}/trend
  - 트렌드 데이터 (차트용)
```

### 응답 스키마

```json
{
  "period": {
    "start": "2026-01-01",
    "end": "2026-01-27",
    "type": "month",
    "label": "January 2026"
  },
  "metrics": {
    "dau": {
      "value": 145.3,
      "unit": "users/day",
      "trend": [{"date": "2026-01-01", "value": 143}, ...],
      "change": {"value": 5.2, "direction": "up"}
    },
    "retention": {
      "value": {"d1": 48.17, "d7": 37.07, "d14": 32.89},
      "unit": "%",
      "trend": null
    }
  },
  "updated_at": "2026-01-27T15:30:00Z"
}
```

---

## 4. Frontend 라이브러리 선택

### 대시보드 그리드
- **react-grid-layout**: 드래그/리사이즈 가능한 그리드 ✅ 선택
  - 위젯 위치 저장/복원 (localStorage)
  - 반응형 레이아웃

### 차트
- **Recharts**: 기존 dashboard-v2와 일관성 유지 ✅ 선택

### 기간 선택
- **date-fns**: 날짜 유틸리티
- 커스텀 PeriodSelector 컴포넌트

### 캐싱
- **메모리 캐시**: TTL 1시간 ✅ 선택
  - `cachetools` 라이브러리 사용
  - 키: `{metric_id}:{period_hash}`

---

## 5. 구현 순서

### Phase 1: Backend 기반 (Day 1-2)
1. domain/ 레이어 구현 (entities, interfaces)
2. PeriodResolver 구현
3. AmplitudeChartSource, AmplitudeEventSource 리팩토링
4. 8개 MetricProvider 구현

### Phase 2: API 엔드포인트 (Day 2-3)
1. `/api/kpi/v2/metrics` 엔드포인트
2. 기간 파라미터 파싱 및 검증
3. 캐싱 레이어 (선택적)

### Phase 3: Frontend (Day 3-4)
1. kpi-dashboard feature 폴더 구조
2. API 훅 및 타입
3. MetricCard, PeriodSelector 컴포넌트
4. DashboardGrid (react-grid-layout)

### Phase 4: 위젯 및 통합 (Day 4-5)
1. 8개 메트릭 위젯
2. 대시보드 페이지 통합
3. 라우팅 추가

---

## 6. 파일 변경 목록

### 새 파일 (Backend)
- `code/api/services/kpi/domain/entities.py`
- `code/api/services/kpi/domain/interfaces.py`
- `code/api/services/kpi/use_cases/get_metrics.py`
- `code/api/services/kpi/use_cases/period_resolver.py`
- `code/api/services/kpi/adapters/amplitude_chart.py`
- `code/api/services/kpi/adapters/amplitude_event.py`
- `code/api/services/kpi/adapters/metric_providers/*.py` (8개)
- `code/api/routers/kpi_v2.py`

### 새 파일 (Frontend)
- `code/dashboard-v2/src/features/kpi-dashboard/**/*`

### 수정 파일
- `code/api/main.py` - 라우터 등록
- `code/dashboard-v2/src/App.tsx` - 라우팅 추가

---

## 7. 확장 포인트

### 새 메트릭 추가 시
1. `MetricType` enum에 추가
2. `metric_providers/`에 새 프로바이더 구현
3. 프론트엔드 위젯 추가

### 새 데이터 소스 추가 시
1. `IDataSource` 구현
2. 기존 프로바이더에서 DI로 주입

### 새 기간 타입 추가 시
1. `PeriodResolver`에 파싱 로직 추가

---

## 8. 검증 방법

1. **Backend 테스트**
   ```bash
   curl "http://localhost:8081/api/kpi/v2/metrics?period=last_30d"
   curl "http://localhost:8081/api/kpi/v2/metrics?month=2026-01"
   ```

2. **Frontend 확인**
   - 대시보드 페이지 접속
   - 기간 변경 시 데이터 갱신 확인
   - 위젯 드래그/리사이즈 동작 확인
