---
entity_type: Task
entity_id: tsk-1kthoh-1768971618133
entity_name: 'Loop Vault - SSOT Write Targets 중앙화 '
created: '2026-01-21'
updated: '2026-01-21'
status: todo
project_id: prj-1kthoh
parent_id: prj-1kthoh
assignee: 김은향
priority: medium
start_date: '2026-01-21'
due: '2026-01-21'
notes: "# PRD — SSOT Write Targets 중앙화 (YAML Authority + Doc/Code Derived)\n\n- **Owner**:\
  \ Vault System / LOOP API\n\n- **Primary Stakeholders**: Dashboard(UI), API(Server),\
  \ Vault Maintainers\n\n- **Status**: Draft\n\n- **Created**: 2026-01-21\n\n- **Last\
  \ Updated**: 2026-01-21\n\n---\n\n## 0) TL;DR (One-liner)\n\n“수정 가능 필드(Write Targets)”를\
  \ `00_Meta/schema_constants.yaml`에 **SSOT로 편입**하고, **문서/라우터 검증을 YAML에서 자동 파생**시켜\
  \ **드리프트를 원천 차단**한다.\n\n---\n\n## 1) Background / Problem\n\n### 1.1 현재 구조의 결함\n\
  \nSSOT를 표방하지만, “Write Targets(수정 가능 필드)” 정의가 여러 곳에 분산되어 **동기화 메커니즘 없이 하드코딩**되어 있다.\\\
  \n결과적으로 새 필드 추가/변경 시 다음과 같은 문제가 반복된다.\n\n- 문서와 코드가 서로 다른 “진실”을 말함\n\n- 라우터가 허용해야\
  \ 할 필드를 막거나(거부), 반대로 금지해야 할 필드를 허용(오염)할 수 있음\n\n- 운영 과정에서 누락/불일치가 누적되어 **SSOT 철학이\
  \ 붕괴**\n\n### 1.2 근본 원인\n\n- `schema_constants.yaml`이 SSOT라고 선언되어도,\n\n- 문서/코드가\
  \ 이를 “참조”하지 않고 각자 하드코딩하고,\n\n- “자동 생성/검증”이 없어서 드리프트를 막을 장치가 없음\n\n---\n\n## 2) Goals\
  \ / Non-goals\n\n### 2.1 Goals (성공 목표)\n\n1. **Authority는 오직 1곳**: `00_Meta/schema_constants.yaml`\n\
  \n2. 문서(Write Targets 표)는 YAML에서 **자동 생성(Derived)**\n\n3. 라우터(update)는 YAML allowlist로\
  \ **수정 가능 필드 강제**\n\n4. “새 필드 추가/변경”은 **YAML 1곳 수정**만으로 완료되도록 만든다\n\n5. 드리프트가 발생하면\
  \ PR 단계에서 즉시 감지되도록 **CI/Pre-commit 가드레일**을 둔다\n\n### 2.2 Non-goals (이번 범위 제외)\n\n\
  - Pydantic 모델을 YAML 기반으로 완전 자동 생성(Codegen)하는 것\n\n- DB/저장소 구조 변경(현재 저장 방식 유지)\n\n\
  - 기존 필드/데이터 마이그레이션(필요 시 별도 PRD)\n\n---\n\n## 3) Users & Use Cases\n\n### 3.1 사용자\
  \ 유형\n\n- **API 개발자**: 신규 필드 추가/수정 시, update 허용 범위를 빠르고 안전하게 변경하고 싶다\n\n- **문서 사용자(팀원)**:\
  \ “어떤 필드를 수정할 수 있는지”를 항상 최신 상태로 보고 싶다\n\n- **Dashboard/UI**: 동일한 정의(Write Targets)를\
  \ 기반으로 UI 편집 가능 영역을 제어하고 싶다\n\n### 3.2 핵심 Use Cases\n\n- (UC1) Project에 새 필드 추가\
  \ → 수정 가능 여부를 즉시 반영\n\n- (UC2) Task update 요청에서 금지 필드가 들어오면 서버가 거부\n\n- (UC3) 문서의\
  \ 표가 항상 YAML 기준으로 자동 갱신되어 최신 상태 유지\n\n---\n\n## 4) Proposed Solution (권장 설계)\n\n\
  ### 4.1 핵심 결정\n\n**Write Targets도 YAML SSOT로 편입한다.**\\\n문서/코드는 “정의”가 아니라 “참조 + 파생(Derived)”이\
  \ 된다.\n\n### 4.2 SSOT 위치\n\n- **Authority**: `00_Meta/schema_constants.yaml`\n\n\
  - **Derived 문서**: `00_Meta/SSOT_WRITE_TARGETS.md` (자동 생성)\n\n- **(옵션) 계약서/가이드 문서**:\
  \ 계약서에는 표를 두지 않고, `SSOT_WRITE_TARGETS.md`를 링크한다\n\n---\n\n## 5) Functional Requirements\n\
  \n### 5.1 YAML: Write Targets 정의 추가 (Authority)\n\n`00_Meta/schema_constants.yaml`에\
  \ `write_targets.writable_fields` 섹션을 추가한다.\n\n- 엔티티별로 “수정 가능한 top-level 필드 목록”을\
  \ 명시한다\n\n- 원칙: **allowlist only**\n\n  - 금지 필드(예: `entity_id`, `created`, `parent_id`)는\
  \ 따로 blacklist로 관리하지 않고\n\n  - allowlist에 없으면 “무조건 수정 불가”가 되도록 한다\n\n5.1.1 YAML\
  \ 예시\n\n```\nwrite_targets:\n  # 엔티티별 수정 가능한 top-level 필드 allowlist\n  writable_fields:\n\
  \    Task:\n      - status\n      - assignee\n      - due\n      - priority\n  \
  \    - type\n      - target_project\n      - tags\n      - aliases\n    Project:\n\
  \      - status\n      - owner\n      - deadline\n      - expected_impact\n    \
  \  - realized_impact\n      - validates\n      - tags\n      - aliases\n    Hypothesis:\n\
  \      - evidence_status\n      - confidence\n      - tags\n      - aliases\n```\n\
  \n> 초기 버전은 **top-level 키만 허용**을 권장한다.\\\n> dotted path(예: `expected_impact.confidence`)는\
  \ 추후 필요 시 확장.\n\n---\n\n### 5.2 API: update 라우터 검증 강제\n\nupdate 요청 payload에 대해 다음\
  \ **2단 검증**을 수행한다.\n\n1. `payload.keys()` ⊆ `known_fields[Entity]`\n\n2. `payload.keys()`\
  \ ⊆ `writable_fields[Entity]`\n\n5.2.1 검증 동작 규칙\n\n- payload에 있는 키 중 하나라도 허용되지 않으면\
  \ 요청은 실패(4xx)한다\n\n- 허용 필드만 포함되면 정상 처리한다\n\n- allowlist는 반드시 YAML에서 로드한다 (하드코딩 금지)\n\
  \n5.2.2 응답 형태(권장)\n\n- 에러 시, 어떤 키들이 거부되었는지 명확히 반환한다\n\n예시:\n\n```\n{\n  \"error\"\
  : \"WRITE_TARGET_VIOLATION\",\n  \"entity_type\": \"Project\",\n  \"rejected_fields\"\
  : [\"entity_id\", \"created\"],\n  \"allowed_fields\": [\"status\", \"owner\", \"\
  deadline\", \"expected_impact\", \"realized_impact\", \"validates\", \"tags\", \"\
  aliases\"]\n}\n```\n\n---\n\n### 5.3 Docs: Write Targets 표 자동 생성 (Derived)\n\n-\
  \ YAML의 `write_targets.writable_fields`를 기반으로 Markdown 문서를 자동 생성한다\n\n- 생성 파일: `00_Meta/SSOT_WRITE_TARGETS.md`\n\
  \n- 계약서(또는 동등 문서)에는 표를 직접 두지 않고 다음만 유지한다:\n\n  - “출처: `00_Meta/schema_constants.yaml`\
  \ → `write_targets.writable_fields`”\n\n  - `SSOT_WRITE_TARGETS.md` 링크\n\n5.3.1\
  \ 문서 생성 포맷(예시)\n\n- 각 Entity별 섹션 + 표 형식\n\n```\n## Project\n수정 가능 필드(allowlist):\n\
  - status\n- owner\n- deadline\n- expected_impact\n- realized_impact\n- validates\n\
  - tags\n- aliases\n```\n\n(또는)\n\n```\n| Entity | Writable Fields |\n|---|---|\n\
  | Project | `status`, `owner`, `deadline`, `expected_impact`, `realized_impact`,\
  \ `validates`, `tags`, `aliases` |\n```\n\n---\n\n### 5.4 Tooling: Pre-commit/CI\
  \ 가드레일\n\n5.4.1 필수 체크\n\n- `schema_constants.yaml` 변경 시, 생성 문서(`SSOT_WRITE_TARGETS.md`)가\
  \ 최신인지 검사\n\n  - 최신이 아니면 CI 실패 (자동 생성 커밋 누락 방지)\n\n5.4.2 권장 체크(옵션)\n\n- 라우터가 allowlist를\
  \ 하드코딩하지 않는지(문자열 리스트 직접 선언 등) 간단한 정적 검사\n\n- (선택) Pydantic 필드와 known_fields의 “치명적\
  \ 불일치” 감지\n\n  - 단, “완전 일치” 강제는 유지비가 크므로 **치명적 수준만** 체크 권장\n\n---\n\n## 6) Non-functional\
  \ Requirements\n\n- **Single Authority**: Write Targets 정의는 반드시 YAML 한 곳만\n\n- **Low\
  \ drift**: 문서/코드는 YAML을 참조하여 자동으로 따라오게 만들 것\n\n- **Developer UX**: 신규 필드 추가/변경 시\
  \ 수정 포인트가 명확할 것\n\n- **Backward compatibility**: 기존 엔티티 파일 포맷/데이터는 그대로 유지\n\n---\n\
  \n## 7) Data Model / Spec Details\n\n### 7.1 YAML Schema (개념)\n\n- `write_targets`\
  \ (object)\n\n  - `writable_fields` (map)\n\n    - key: Entity Type (string)\n\n\
  \    - value: list\\[string\\] (top-level writable field names)\n\n### 7.2 권장 설계\
  \ 원칙\n\n- allowlist only\n\n- top-level 우선\n\n- nested 구조는 객체 단위 교체로 시작하고, 필요해지면\
  \ dotted path 확장\n\n---\n\n## 8) API Design (Behavior Spec)\n\n### 8.1 Update Request\
  \ 흐름(개념)\n\n1. `entity_type` 결정\n\n2. YAML 로드 → `known_fields[entity_type]`, `writable_fields[entity_type]`\
  \ 획득\n\n3. `payload_keys` 추출\n\n4. unknown 키 검출 → 실패\n\n5. writable 아닌 키 검출 → 실패\n\
  \n6. 통과 시 update 수행\n\n### 8.2 Edge Cases\n\n- writable_fields에 entity_type 정의가\
  \ 없으면:\n\n  - 기본 정책: **전부 수정 불가**(fail-closed) 권장\n\n- payload가 빈 객체면:\n\n  - no-op\
  \ 처리 또는 400 처리 (현재 정책에 맞춤)\n\n---\n\n## 9) UX / Dashboard Considerations (Optional\
  \ but Recommended)\n\n- UI에서 편집 가능 필드를 동일한 source(YAML→API constants)로 가져오면\n\n\
  \  - 서버/클라이언트 정책이 일치\n\n  - “UI는 가능하지만 서버가 거부” 같은 UX 불일치 감소\n\n권장:\n\n- `/api/constants`\
  \ (or `/api/schema`) 응답에 `write_targets` 포함\n\n- Dashboard는 해당 allowlist를 기반으로 edit\
  \ UI를 제한할 수 있음\n\n---\n\n## 10) Implementation Plan (Phased)\n\n### Phase 0 — 준비\
  \ (1 PR)\n\n- `schema_constants.yaml`에 `write_targets.writable_fields` 추가 (초기 엔티티:\
  \ Task/Project/Hypothesis부터)\n\n- 문서 자동 생성 스크립트 초안 작성 (생성 파일 path 고정)\n\n### Phase\
  \ 1 — 서버 강제 (1\\~2 PR)\n\n- update 라우터(Projects/Tasks/…)에 2단 검증 적용\n\n- 에러 메시지/코드\
  \ 표준화\n\n### Phase 2 — 문서 Derived 전환 (1 PR)\n\n- 기존 계약서/가이드의 하드코딩 표 제거\n\n- `SSOT_WRITE_TARGETS.md`\
  \ 링크로 대체\n\n- CI/Pre-commit: 생성 파일 최신성 체크 추가\n\n### Phase 3 — UI 정합성(Optional)\n\
  \n- API constants/schema endpoint에 write_targets 포함\n\n- Dashboard에서 edit 가능한 필드\
  \ UX 개선(선택)\n\n---\n\n## 11) Acceptance Criteria (Must Pass)\n\n### AC1 — Authority\
  \ 단일화\n\n- Write Targets 정의가 YAML `write_targets.writable_fields` 한 곳에 존재한다\n\n\
  - 문서/코드에 동일 리스트가 하드코딩되어 있지 않다(또는 최소화되어 있고 참조가 명확)\n\n### AC2 — 라우터 강제\n\n- update\
  \ 요청에서 allowlist에 없는 필드가 포함되면 항상 거부된다\n\n- 거부 응답에 `rejected_fields`가 포함되어 디버깅 가능하다\n\
  \n### AC3 — 문서 자동 생성\n\n- `SSOT_WRITE_TARGETS.md`가 YAML 변경에 따라 자동 갱신된다\n\n- CI/Pre-commit이\
  \ “생성 문서 누락”을 감지해 실패시킨다\n\n### AC4 — 변경 작업 단순화\n\n- 신규 필드 추가 시, “수정 가능하게 만들기”는 YAML의\
  \ allowlist 수정 1회로 완료된다\\\n  (문서/코드는 자동으로 따라온다)\n\n---\n\n## 12) Testing Plan\n\n\
  ### 12.1 Unit Tests\n\n- (T1) unknown field 포함 update → 4xx + rejected_fields\n\n\
  - (T2) known but non-writable field 포함 update → 4xx + rejected_fields\n\n- (T3)\
  \ writable fields만 update → 200\n\n### 12.2 Integration Tests\n\n- (I1) YAML 변경\
  \ → constants endpoint에 write_targets 반영(해당 시)\n\n- (I2) 문서 생성 스크립트 실행 → 결과 파일 생성/갱신\
  \ 확인\n\n### 12.3 Pre-commit/CI\n\n- (C1) YAML 수정 후 생성 파일 미갱신 → CI 실패\n\n- (C2) YAML\
  \ 수정 후 생성 파일 포함 커밋 → CI 통과\n\n---\n\n## 13) Risks & Mitigations\n\n### Risk 1 —\
  \ “fail-closed”로 인해 기존 클라이언트가 갑자기 막힘\n\n- **Mitigation**: 초기 allowlist를 현재 운영에서\
  \ 사용 중인 필드 기준으로 충분히 넓게 설정\n\n- 단계적 적용(Phase 1 적용 전, 로그 기반으로 실제 update payload 샘플\
  \ 확인)\n\n### Risk 2 — nested 업데이트 요구 발생\n\n- **Mitigation**: 초기에는 top-level만 허용하고,\
  \ nested는 객체 전체 교체로 대응\n\n- 필요 시 dotted path 확장 PRD를 후속으로 분리\n\n### Risk 3 — 문서\
  \ 생성/체크가 개발 속도를 느림\n\n- **Mitigation**: 생성 스크립트를 빠르게 실행되게 유지\n\n- pre-commit에서는\
  \ “변경된 경우만” 수행하도록 최적화\n\n---\n\n## 14) Open Questions (Decision Log)\n\n1. `writable_fields`는\
  \ top-level만 허용할 것인가, dotted path까지 허용할 것인가?\n\n   - **Default**: top-level only\
  \ (현재 PRD 기준)\n\n2. entity_type별 정의가 없을 때 정책:\n\n   - **Default**: fail-closed (전부\
  \ 불가)\n\n3. 계약서 파일명/섹션(SSOT_CONTRACT 6.3)이 현재 어디에 있는지:\n\n   - **Default**: 표 제거\
  \ + 링크 전환은 “현행 계약 문서”에 적용 (파일명은 리포 구조에 맞춰 조정)\n\n---\n\n## 15) Deliverables\n\n\
  1. `00_Meta/schema_constants.yaml`\n\n   - `write_targets.writable_fields` 섹션 추가\n\
  \n2. `00_Meta/SSOT_WRITE_TARGETS.md`\n\n   - YAML 기반 자동 생성 파일 (Derived)\n\n3. API\
  \ update 라우터\n\n   - allowlist/known_fields 2단 검증 적용\n\n4. CI/Pre-commit\n\n   -\
  \ 생성 문서 최신성 체크\n\n---\n\n## 16) Appendix — Recommended Conventions\n\n### 16.1 Field\
  \ Naming\n\n- YAML에는 실제 frontmatter key와 1:1 매칭되는 문자열 사용\n\n- Entity 이름은 Pydantic/프론트의\
  \ entity_type 표준 명칭을 사용\n\n### 16.2 Error Codes\n\n- `UNKNOWN_FIELD`\n\n- `WRITE_TARGET_VIOLATION`\n\
  \n- `MISSING_WRITE_TARGET_CONFIG` (정의 누락 시, fail-closed에서 발생 가능)\n\n---\n\n## 17)\
  \ Success Metrics\n\n- 신규 필드 추가/변경 시 “수정 포인트”가 YAML 1곳으로 수렴\n\n- PR에서 문서/코드 드리프트로\
  \ 인한 QA 이슈 감소\n\n- update 관련 운영 장애(예: 필드 막힘/허용 누락) 발생률 감소\n\n---\n\n[DEVELOPER MODE](#settings/Connectors/Advanced)\n\
  \n![](blob:https://chatgpt.com/a4276ea7-19d2-44eb-9476-612a410ffa3f)\n\nChatGPT\
  \ can make mistakes. Check important info. See Cookie Preferences."
tags: []
type: dev
links: []
aliases:
- tsk-1kthoh-1768971618133
start_time: '13:30'
end_time: '14:30'
---
# Loop Vault - SSOT Write Targets 중앙화 

## 설명

## 체크리스트

- [ ]

## 참고

## 짧은 회고
