---
entity_type: Task
entity_id: "tsk-023-20"
entity_name: "FilterPanel - 기본 필터 활성화 상태 개선"
created: 2026-01-08
updated: 2026-01-08
status: doing

# === 계층 ===
parent_id: "prj-023"
project_id: "prj-023"
aliases: ["tsk-023-20"]

# === 관계 ===
outgoing_relations: []
validates: []
validated_by: []

# === Task 전용 ===
assignee: "김은향"
start_date: 2026-01-08
due: 2026-01-08
priority: medium
estimated_hours: null
actual_hours: null

# === Task 유형 (dev Task 연동용) ===
type: dev
target_project: loop

# === 분류 ===
tags: ["dashboard", "filter", "ux"]
priority_flag: medium
---

# FilterPanel - 기본 필터 활성화 상태 개선

> Task ID: `tsk-023-20` | Project: `prj-023` | Status: doing

## 목표

**완료 조건**:
1. FilterPanel에서 기본 필터(taskStatus, taskPriority, taskTypes, projectPriority)가 활성화 상태로 표시됨
2. 버튼 클릭 시 toggle 동작이 직관적으로 작동함
3. 기존 localStorage 데이터가 새 기본값으로 마이그레이션됨

---

## 상세 내용

### 배경

현재 FilterPanel에서 `taskStatus: []` (빈 배열)은 "모든 태스크 표시"를 의미하지만, UI에서는 버튼이 아무것도 선택되지 않은 상태로 표시됨.

**UX 문제점**:
- 사용자가 칸반에서 모든 태스크가 보이는 것을 확인
- FilterPanel 열면 Task Status 버튼이 하나도 활성화되지 않음
- "왜 필터가 없는데 모든 태스크가 보이지?" → 직관적이지 않음

**참고**: `projectStatus`는 이미 전체 값이 기본으로 설정되어 있어 문제 없음 (Option B 패턴)

### 작업 내용

Option B (데이터 구조 변경) 방식으로 수정:
- 기본값을 빈 배열 대신 전체 항목으로 변경
- selector 로직에서 "전체 선택 = 필터링 스킵" 조건 추가
- localStorage 마이그레이션 처리

---

## 체크리스트

- [ ] filterDefaults.ts - 기본값 변경
- [ ] selectors.ts - applyLocalFilters() 전체 선택 스킵 조건
- [ ] useCalendarEvents.ts - 동일 조건 추가
- [ ] localFilterStore.ts - 마이그레이션 로직

---

## Notes

### Tech Spec

#### 변경 대상 파일

| 파일 | 변경 내용 |
|------|----------|
| `constants/filterDefaults.ts` | 기본값을 전체 배열로 변경 |
| `features/tasks/selectors.ts` | 전체 선택 = 필터링 스킵 조건 |
| `features/calendar/queries/useCalendarEvents.ts` | 동일 조건 |
| `stores/localFilterStore.ts` | localStorage 마이그레이션 |

#### 변경 상세

**1. filterDefaults.ts**
```typescript
// Before
taskStatus: [],
taskPriority: [],
taskTypes: [],
projectPriority: [],

// After
taskStatus: ['todo', 'doing', 'hold', 'done', 'blocked'],
taskPriority: ['critical', 'high', 'medium', 'low'],
taskTypes: ['dev', 'bug', 'strategy', 'research', 'ops', 'meeting'],
projectPriority: ['critical', 'high', 'medium', 'low'],
```

**2. selectors.ts (applyLocalFilters)**
```typescript
// Before
if (taskStatus.length > 0) {
  filtered = filtered.filter((t) => taskStatus.includes(t.status));
}

// After - 전체 선택이면 필터링 스킵
const ALL_TASK_STATUSES = ['todo', 'doing', 'hold', 'done', 'blocked'];
if (taskStatus.length > 0 && taskStatus.length < ALL_TASK_STATUSES.length) {
  filtered = filtered.filter((t) => taskStatus.includes(t.status));
}
```

**3. useCalendarEvents.ts**
```typescript
// 동일한 패턴 적용
if (filters.taskStatus && filters.taskStatus.length > 0 &&
    filters.taskStatus.length < ALL_TASK_STATUSES.length) {
  filteredTasks = filteredTasks.filter(...)
}
```

**4. localFilterStore.ts (마이그레이션)**
```typescript
const loadFromStorage = (): LocalFilterState => {
  const saved = localStorage.getItem(FILTER_STORAGE_KEY);
  if (saved) {
    const parsed = JSON.parse(saved);
    // 마이그레이션: 빈 배열 → 전체 배열
    if (parsed.taskStatus?.length === 0) {
      parsed.taskStatus = DEFAULT_LOCAL_FILTERS.taskStatus;
    }
    if (parsed.taskPriority?.length === 0) {
      parsed.taskPriority = DEFAULT_LOCAL_FILTERS.taskPriority;
    }
    if (parsed.taskTypes?.length === 0) {
      parsed.taskTypes = DEFAULT_LOCAL_FILTERS.taskTypes;
    }
    if (parsed.projectPriority?.length === 0) {
      parsed.projectPriority = DEFAULT_LOCAL_FILTERS.projectPriority;
    }
  }
  return merged;
};
```

### Todo

- [x] filterDefaults.ts 수정
- [x] selectors.ts 수정
- [x] useCalendarEvents.ts 수정
- [x] localFilterStore.ts 마이그레이션 로직 추가
- [x] useFilterIndicator.ts 수정 (Codex 피드백)
- [x] projects/selectors.ts 수정 (Codex 피드백)
- [ ] 테스트: 초기 로드 시 모든 버튼 활성화
- [ ] 테스트: 버튼 클릭 시 비활성화 동작
- [ ] 테스트: Reset All 동작
- [ ] 테스트: Calendar 페이지 동작

### 작업 로그

#### Implementation Complete (2026-01-08)

**Files Modified:**
1. `src/constants/filterDefaults.ts` - Changed defaults to full arrays, added schema version
2. `src/features/tasks/selectors.ts` - Added isFullSelection helper, full-selection logic
3. `src/features/calendar/queries/useCalendarEvents.ts` - Same full-selection logic
4. `src/stores/localFilterStore.ts` - One-time migration with version flag
5. `src/hooks/useFilterIndicator.ts` - Fixed array mutation bug, compare against defaults
6. `src/features/projects/selectors.ts` - Added full-selection semantics to projectPriority

**Key Changes:**
- Empty array (`[]`) now means "show NOTHING" (user deselected all)
- Full selection (all values) means "show ALL" (skip filtering)
- Partial selection applies filter normally
- Migration converts legacy `[]` to full arrays (one-time only with version flag)
- Filter indicator correctly identifies active filters (compares to defaults without mutation)
- Project priority filter now includes projects with null priority when all selected

**Codex Review:**
- Phase 2: Plan validation passed with feedback (addressed empty array logic, migration strategy)
- Phase 5: Code review identified 2 issues (filter indicator mutation, project filter bug)
- Phase 6: Final review confirmed no blocking issues

**Next Steps:**
- Manual testing in browser
- Verify migration works for existing users
- Test Calendar page filtering


---

## 참고 문서

- [[prj-023]] - 소속 Project
- Plan: `/Users/gim-eunhyang/.claude/plans/jiggly-popping-manatee.md`

---

**Created**: 2026-01-08
**Assignee**: 김은향
**Due**: 2026-01-08
