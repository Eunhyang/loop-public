---
entity_type: Task
entity_id: tsk-023-39
entity_name: Dashboard - ëŒ“ê¸€ ì‹œìŠ¤í…œ + @ë©˜ì…˜ êµ¬í˜„
created: 2026-01-09
updated: '2026-01-10'
status: done
closed: 2026-01-09
parent_id: prj-023
project_id: prj-023
aliases:
- tsk-023-39
outgoing_relations: []
validates: []
validated_by: []
assignee: ê¹€ì€í–¥
start_date: 2026-01-09
due: null
priority: high
estimated_hours: null
actual_hours: null
type: dev
target_project: loop
tags:
- comments
- mentions
- oauth
- tiptap
priority_flag: high
notes: "# Dashboard - ëŒ“ê¸€ ì‹œìŠ¤í…œ + @ë©˜ì…˜ êµ¬í˜„\n\n> Task ID: `tsk-023-39` | Project: `prj-023`\
  \ | Status: done\n\n## ëª©í‘œ\n\n**ì™„ë£Œ ì¡°ê±´**:\n\n1. OAuth ì‚¬ìš©ì ê³„ì • ìƒì„± (ê¹€ì€í–¥, í•œëª…í•™) + Members\
  \ ì—°ê²°\n2. Comments ë°±ì—”ë“œ API êµ¬í˜„ (CRUD)\n3. @ë©˜ì…˜ ê¸°ëŠ¥ êµ¬í˜„ (Tiptap í™•ì¥)\n4. ëŒ“ê¸€ UI ì»´í¬ë„ŒíŠ¸ êµ¬í˜„\n\
  5. Task Drawerì— ëŒ“ê¸€ ì„¹ì…˜ í†µí•©\n\n---\n\n## Tech Spec\n\n### 1. OAuth ê³„ì • + Members ì—°ê²°\n\
  \n**1.1 members.yamlì— email í•„ë“œ ì¶”ê°€**\n\n```yaml\n# exec/40_People/members.yaml\n\
  - id: \"ê¹€ì€í–¥\"\n  email: \"eunhyang@kkokkkok.app\"  # ì¶”ê°€\n  ...\n- id: \"í•œëª…í•™\"\n\
  \  email: \"myeonghak@kkokkkok.app\"  # ì¶”ê°€\n  ...\n```\n\n**1.2 OAuth ê³„ì • ìƒì„± (CLI)**\n\
  \n```bash\ncd ~/dev/loop/public\npython -m api.oauth.cli create-user --email eunhyang@kkokkkok.app\
  \ --password admin123 --role admin\npython -m api.oauth.cli create-user --email\
  \ myeonghak@kkokkkok.app --password admin123 --role admin\n```\n\n**1.3 VaultCacheì—\
  \ emailâ†’member ì¡°íšŒ ì¶”ê°€**\n\n- íŒŒì¼: `public/api/cache/vault_cache.py`\n- ë©”ì„œë“œ: `get_member_by_email(email:\
  \ str) -> Optional[Dict]`\n\n---\n\n### 2. Comments ë°±ì—”ë“œ\n\n**2.1 SQLite í…Œì´ë¸”**\n\n\
  ```sql\nCREATE TABLE comments (\n    id INTEGER PRIMARY KEY AUTOINCREMENT,\n   \
  \ entity_type VARCHAR(32) NOT NULL,  -- 'task' | 'project'\n    entity_id VARCHAR(64)\
  \ NOT NULL,    -- 'tsk-023-01' | 'prj-023'\n    author_email VARCHAR(256) NOT NULL,\n\
  \    content TEXT NOT NULL,             -- ë§ˆí¬ë‹¤ìš´ (ë©˜ì…˜ í¬í•¨)\n    mentions JSON,    \
  \                 -- [\"tsk-023-02\", \"prj-023\"]\n    parent_id INTEGER,     \
  \            -- ë‹µê¸€ìš© (NULL = ìµœìƒìœ„)\n    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n\
  \    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n    FOREIGN KEY (parent_id)\
  \ REFERENCES comments(id)\n);\n\nCREATE INDEX idx_comments_entity ON comments(entity_type,\
  \ entity_id);\n```\n\n**2.2 API ì—”ë“œí¬ì¸íŠ¸**\n\n| Method | Endpoint | ì„¤ëª… |\n| --- | ---\
  \ | --- |\n| GET | `/api/comments?entity_type=task&entity_id=tsk-023-01` | ëŒ“ê¸€ ëª©ë¡\
  \ |\n| POST | `/api/comments` | ëŒ“ê¸€ ìƒì„± |\n| PUT | `/api/comments/{id}` | ëŒ“ê¸€ ìˆ˜ì • |\n\
  | DELETE | `/api/comments/{id}` | ëŒ“ê¸€ ì‚­ì œ |\n\n**2.3 ì‘ë‹µ í˜•ì‹**\n\n```json\n{\n  \"id\"\
  : 1,\n  \"entity_type\": \"task\",\n  \"entity_id\": \"tsk-023-01\",\n  \"author\"\
  : {\n    \"email\": \"eunhyang@kkokkkok.app\",\n    \"member_id\": \"ê¹€ì€í–¥\",\n  \
  \  \"name\": \"ê¹€ì€í–¥\",\n    \"icon\": \"\U0001F469â€\U0001F4BB\"\n  },\n  \"content\"\
  : \"ì´ íƒœìŠ¤í¬ëŠ” [@tsk-023-02](/tasks/tsk-023-02) ì™„ë£Œ í›„ ì§„í–‰\",\n  \"mentions\": [\"tsk-023-02\"\
  ],\n  \"replies\": [...],\n  \"created_at\": \"2026-01-09T10:00:00Z\"\n}\n```\n\n\
  ---\n\n### 3. @ë©˜ì…˜ í”„ë¡ íŠ¸ì—”ë“œ (Tiptap í™•ì¥)\n\n**3.1 MentionExtension ìƒì„±**\n\n- íŒŒì¼: `dashboard-v2/src/components/MarkdownEditor/MentionExtension.tsx`\n\
  - SlashMenu.tsx íŒ¨í„´ ë³µì‚¬ í›„ ìˆ˜ì •:\n  - `char: '/'` â†’ `char: '@'`\n  - ë°ì´í„° ì†ŒìŠ¤: `useDashboardInit()`ì˜\
  \ tasks, projects, members\n\n**3.2 MentionMenu ì»´í¬ë„ŒíŠ¸**\n\n- íŒŒì¼: `dashboard-v2/src/components/MarkdownEditor/MentionMenu.tsx`\n\
  - ê¸°ëŠ¥:\n  - ì—”í‹°í‹° ê²€ìƒ‰/í•„í„°ë§\n  - í‚¤ë³´ë“œ ë„¤ë¹„ê²Œì´ì…˜ (â†‘â†“ Enter Esc)\n  - íƒ€ì…ë³„ ì•„ì´ì½˜ (Task, Project,\
  \ Member)\n\n**3.3 ë©˜ì…˜ ë Œë”ë§**\n\n- ì €ì¥ í˜•ì‹: `[@tsk-023-01](tsk-023-01)`\n- ë Œë”ë§: í´ë¦­ ê°€ëŠ¥í•œ\
  \ ë§í¬ (ë°°ê²½ìƒ‰ êµ¬ë¶„)\n\n**3.4 í´ë¦­ ì‹œ ë„¤ë¹„ê²Œì´ì…˜**\n\n```typescript\nconst handleMentionClick =\
  \ (entityId: string) => {\n  if (entityId.startsWith('tsk-')) {\n    openEditTask(entityId);\n\
  \  } else if (entityId.startsWith('prj-')) {\n    navigate(`/projects/${entityId}`);\n\
  \  }\n};\n```\n\n---\n\n### 4. ëŒ“ê¸€ UI ì»´í¬ë„ŒíŠ¸\n\n**4.1 CommentSection ì»´í¬ë„ŒíŠ¸**\n\n- íŒŒì¼:\
  \ `dashboard-v2/src/features/comments/CommentSection.tsx`\n- Props: `entityType`,\
  \ `entityId`\n\n**4.2 CommentItem ì»´í¬ë„ŒíŠ¸**\n\n- íŒŒì¼: `dashboard-v2/src/features/comments/CommentItem.tsx`\n\
  \n**4.3 CommentEditor ì»´í¬ë„ŒíŠ¸**\n\n- íŒŒì¼: `dashboard-v2/src/features/comments/CommentEditor.tsx`\n\
  - Tiptap MarkdownEditor + MentionExtension\n\n**4.4 React Query í›…**\n\n- `useComments(entityType,\
  \ entityId)`\n- `useCreateComment()`\n- `useUpdateComment()`\n- `useDeleteComment()`\n\
  \n---\n\n### 5. Task/Project í†µí•©\n\n**5.1 TaskDrawerì— ëŒ“ê¸€ ì„¹ì…˜ ì¶”ê°€**\n\n- íŒŒì¼: `dashboard-v2/src/features/tasks/components/TaskDrawer.tsx`\n\
  \n---\n\n## íŒŒì¼ ëª©ë¡\n\n### ìˆ˜ì •í•  íŒŒì¼\n\n| íŒŒì¼ | ë³€ê²½ ë‚´ìš© |\n| --- | --- |\n| `exec/40_People/members.yaml`\
  \ | email í•„ë“œ ì¶”ê°€ |\n| `public/api/cache/vault_cache.py` | `get_member_by_email()`\
  \ ì¶”ê°€ |\n| `public/api/main.py` | comments ë¼ìš°í„° ë“±ë¡ |\n| `dashboard-v2/src/components/MarkdownEditor/index.tsx`\
  \ | MentionExtension ì¶”ê°€ |\n| `dashboard-v2/src/features/tasks/components/TaskDrawer.tsx`\
  \ | CommentSection ì¶”ê°€ |\n\n### ìƒì„±í•  íŒŒì¼\n\n| íŒŒì¼ | ì„¤ëª… |\n| --- | --- |\n| `public/api/routers/comments.py`\
  \ | Comments API |\n| `public/api/models/comments.py` | Comment ëª¨ë¸ + DB |\n| `dashboard-v2/src/components/MarkdownEditor/MentionExtension.tsx`\
  \ | @ë©˜ì…˜ Tiptap í™•ì¥ |\n| `dashboard-v2/src/components/MarkdownEditor/MentionMenu.tsx`\
  \ | ë©˜ì…˜ íŒì—… ë©”ë‰´ |\n| `dashboard-v2/src/features/comments/CommentSection.tsx` | ëŒ“ê¸€ ì„¹ì…˜\
  \ |\n| `dashboard-v2/src/features/comments/CommentItem.tsx` | ëŒ“ê¸€ ì•„ì´í…œ |\n| `dashboard-v2/src/features/comments/CommentEditor.tsx`\
  \ | ëŒ“ê¸€ ì—ë””í„° |\n| `dashboard-v2/src/features/comments/queries.ts` | React Query í›…\
  \ |\n| `dashboard-v2/src/features/comments/types.ts` | íƒ€ì… ì •ì˜ |\n\n---\n\n## ê³„ì • ì •ë³´\n\
  \n| ì´ë¦„ | ì´ë©”ì¼ | ë¹„ë°€ë²ˆí˜¸ | Role |\n| --- | --- | --- | --- |\n| ê¹€ì€í–¥ | eunhyang@kkokkkok.app\
  \ | admin123 | admin |\n| í•œëª…í•™ | myeonghak@kkokkkok.app | admin123 | admin |\n\n\
  ---\n\n## ê²€ì¦ ë°©ë²•\n\n### 1. OAuth ê³„ì • í…ŒìŠ¤íŠ¸\n\n```bash\npython -m api.oauth.cli list-users\n\
  ```\n\n### 2. Comments API í…ŒìŠ¤íŠ¸\n\n```bash\n# ëŒ“ê¸€ ìƒì„±\ncurl -X POST http://localhost:8081/api/comments\
  \ \\\n  -H \"Authorization: Bearer $TOKEN\" \\\n  -H \"Content-Type: application/json\"\
  \ \\\n  -d '{\"entity_type\":\"task\",\"entity_id\":\"tsk-023-01\",\"content\":\"\
  í…ŒìŠ¤íŠ¸ ëŒ“ê¸€\"}'\n\n# ëŒ“ê¸€ ì¡°íšŒ\ncurl \"http://localhost:8081/api/comments?entity_type=task&entity_id=tsk-023-01\"\
  \ \\\n  -H \"Authorization: Bearer $TOKEN\"\n```\n\n### 3. í”„ë¡ íŠ¸ì—”ë“œ í…ŒìŠ¤íŠ¸\n\n1. Dashboard\
  \ ë¡œê·¸ì¸\n2. Task Drawer ì—´ê¸°\n3. ëŒ“ê¸€ ì…ë ¥ë€ì— `@` ì…ë ¥ â†’ ë©˜ì…˜ íŒì—… í™•ì¸\n4. ì—”í‹°í‹° ì„ íƒ â†’ ë§í¬ë¡œ ë³€í™˜ í™•ì¸\n\
  5. ëŒ“ê¸€ ì €ì¥ â†’ ëª©ë¡ì— í‘œì‹œ í™•ì¸\n6. ë©˜ì…˜ í´ë¦­ â†’ í•´ë‹¹ ì—”í‹°í‹°ë¡œ ì´ë™ í™•ì¸\n\n---\n\n## ì˜ì¡´ì„±\n\n### ë°±ì—”ë“œ\n\n-\
  \ ê¸°ì¡´ FastAPI, SQLAlchemy ì‚¬ìš© (ì¶”ê°€ ì—†ìŒ)\n\n### í”„ë¡ íŠ¸ì—”ë“œ\n\n- ì´ë¯¸ ì„¤ì¹˜ë¨: `@tiptap/core`, `@tiptap/suggestion`,\
  \ `tippy.js`\n\n---\n\n## Codex Review Suggestions\n\n> Codex PRD ê²€í†  ê²°ê³¼ (2026-01-09)\n\
  \n### ë³´ì•ˆ ê´€ë ¨\n\n- [ ] ëŒ“ê¸€ ìˆ˜ì •/ì‚­ì œ ì‹œ ì‘ì„±ì ë³¸ì¸ë§Œ ê°€ëŠ¥í•˜ë„ë¡ ê¶Œí•œ ì²´í¬\n\n- [ ] XSS ë°©ì§€ë¥¼ ìœ„í•œ ë§ˆí¬ë‹¤ìš´ sanitization\
  \ (DOMPurify ë“±)\n\n- [ ] content ìµœëŒ€ ê¸¸ì´ ì œí•œ (ì˜ˆ: 10,000ì)\n\n### ë°ì´í„° ë¬´ê²°ì„±\n\n- [ ] parent_idê°€\
  \ ê°™ì€ entity_type/entity_id ë‚´ì—ì„œë§Œ ì°¸ì¡°í•˜ë„ë¡ ê²€ì¦\n\n- [ ] ë©˜ì…˜ëœ ì—”í‹°í‹° ì¡´ì¬ ì—¬ë¶€ ê²€ì¦ (ì˜µì…˜)\n\n### API\
  \ ê°œì„ \n\n- [ ] GET ì—”ë“œí¬ì¸íŠ¸ì— pagination ì¶”ê°€ (`?page=1&limit=20`)\n\n- [ ] created_at\
  \ ê¸°ì¤€ ì •ë ¬ (ìµœì‹ ìˆœ/ì˜¤ë˜ëœìˆœ)\n\n- [ ] replies í¬í•¨ ì—¬ë¶€ ì˜µì…˜ (`?include_replies=true`)\n\n### UI/UX\n\
  \n- [ ] ë¹ˆ ìƒíƒœ, ë¡œë”© ìƒíƒœ, ì—ëŸ¬ ìƒíƒœ ì²˜ë¦¬\n\n- [ ] ëŒ“ê¸€ ì‘ì„±/ìˆ˜ì •/ì‚­ì œ ì‹œ í† ìŠ¤íŠ¸ ì•Œë¦¼\n\n- [ ] ë©˜ì…˜ ê²€ìƒ‰ debounce\
  \ (300ms)\n\n### ì„±ëŠ¥\n\n- [ ] `created_at` ì¸ë±ìŠ¤ ì¶”ê°€ (ì •ë ¬ ìµœì í™”)\n\n- [ ] ëŒ“ê¸€ ëª©ë¡ ì´ˆê¸° ë¡œë“œ ì œí•œ\
  \ (ìµœê·¼ 50ê°œ)\n\n**ìš°ì„ ìˆœìœ„**: ë³´ì•ˆ ê´€ë ¨ í•­ëª©ì€ í•„ìˆ˜, ë‚˜ë¨¸ì§€ëŠ” v1 ì´í›„ ì ì§„ì  ê°œì„ \n\n---\n\n## Notes\n\nB\
  \ Score (Realized Impact) ì—°ë™:\n\n- ëŒ“ê¸€ ë°ì´í„°ëŠ” í–¥í›„ Evidence ìƒì„± ì‹œ ì°¸ê³  ìë£Œë¡œ í™œìš© ê°€ëŠ¥\n- `mentions`\
  \ í•„ë“œë¡œ ì–´ë–¤ ì—”í‹°í‹°ê°€ ë…¼ì˜ë˜ì—ˆëŠ”ì§€ ì¶”ì  ê°€ëŠ¥\n\n---\n\n## ì‘ì—… ë¡œê·¸\n\n### 2026-01-09\n\n**ê°œìš”**: ëŒ“ê¸€ ì‹œìŠ¤í…œ\
  \ + @ë©˜ì…˜ ê¸°ëŠ¥ êµ¬í˜„ ì™„ë£Œ\n\n**êµ¬í˜„ ë‚´ìš©**:\n\n**Backend (LOOP Vault API)**:\n\n- OAuth ê³„ì • ìƒì„±\
  \ ì™„ë£Œ (ê¹€ì€í–¥, í•œëª…í•™)\n- `members.yaml`ì— email í•„ë“œ ì¶”ê°€\n- `VaultCache.get_member_by_email()`\
  \ ë©”ì„œë“œ ì¶”ê°€\n- Comments API êµ¬í˜„:\n  - SQLite í…Œì´ë¸” ìƒì„± (comments í…Œì´ë¸”)\n  - CRUD ì—”ë“œí¬ì¸íŠ¸:\
  \ GET/POST/PUT/DELETE `/api/comments`\n  - author ì •ë³´ ìë™ ì¡°íšŒ (email â†’ member)\n  -\
  \ mentions íŒŒì‹± ë° ì €ì¥\n- íŒŒì¼: `api/routers/comments.py`, `api/models/comments.py`\n\n\
  **Frontend (Dashboard v2)**:\n\n- Tiptap MentionExtension êµ¬í˜„:\n  - `@` íŠ¸ë¦¬ê±°ë¡œ ì—”í‹°í‹°\
  \ ê²€ìƒ‰\n  - Task/Project/Member ìë™ì™„ì„± ë©”ë‰´\n  - í‚¤ë³´ë“œ ë„¤ë¹„ê²Œì´ì…˜ (â†‘â†“ Enter Esc)\n- CommentSection\
  \ ì»´í¬ë„ŒíŠ¸ êµ¬í˜„:\n  - ëŒ“ê¸€ ëª©ë¡ í‘œì‹œ (ê³„ì¸µ êµ¬ì¡° ì§€ì›)\n  - ì‹¤ì‹œê°„ CRUD ì—°ë™\n  - React Query ìºì‹±\n- CommentEditor\
  \ ì»´í¬ë„ŒíŠ¸:\n  - MarkdownEditor + MentionExtension\n  - ë©˜ì…˜ ë Œë”ë§ (í´ë¦­ ì‹œ ë„¤ë¹„ê²Œì´ì…˜)\n- TaskDrawerì—\
  \ ëŒ“ê¸€ ì„¹ì…˜ í†µí•©\n- íŒŒì¼:\n  - `src/components/MarkdownEditor/MentionExtension.tsx`\n  -\
  \ `src/components/MarkdownEditor/MentionMenu.tsx`\n  - `src/features/comments/CommentSection.tsx`\n\
  \  - `src/features/comments/CommentItem.tsx`\n  - `src/features/comments/CommentEditor.tsx`\n\
  \  - `src/features/comments/queries.ts`\n  - `src/features/comments/types.ts`\n\n\
  **Infrastructure**:\n\n- NAS ì„œë²„ rebuild ì™„ë£Œ (`/mcp-server rebuild`)\n- API ìºì‹œ ê°±ì‹ \
  \ ì™„ë£Œ\n- Frontend build & deploy ì™„ë£Œ\n\n**ê²€ì¦ ì™„ë£Œ**:\n\n- OAuth ê³„ì • ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸\n- ëŒ“ê¸€ CRUD\
  \ ë™ì‘ í™•ì¸\n- @ë©˜ì…˜ íŒì—… ë° ìë™ì™„ì„± ë™ì‘ í™•ì¸\n- ë©˜ì…˜ ë§í¬ í´ë¦­ ì‹œ ë„¤ë¹„ê²Œì´ì…˜ í™•ì¸\n- Task Drawerì—ì„œ ëŒ“ê¸€ ì„¹ì…˜ ì •ìƒ\
  \ í‘œì‹œ\n\n**ìµœì¢… ìƒíƒœ**: done\n\n**ë‚¨ì€ ì‘ì—… (í›„ì† ê°œì„ )**:\n\n- Codex Review Suggestions í•­ëª©ë“¤\
  \ (ë³´ì•ˆ, pagination, UI/UX ê°œì„ )\n- ëŒ“ê¸€ ì•Œë¦¼ ê¸°ëŠ¥ (í–¥í›„ Taskë¡œ ë¶„ë¦¬)"
---
# Dashboard - ëŒ“ê¸€ ì‹œìŠ¤í…œ + @ë©˜ì…˜ êµ¬í˜„

> Task ID: `tsk-023-39` | Project: `prj-023` | Status: done

## ëª©í‘œ

**ì™„ë£Œ ì¡°ê±´**:
1. OAuth ì‚¬ìš©ì ê³„ì • ìƒì„± (ê¹€ì€í–¥, í•œëª…í•™) + Members ì—°ê²°
2. Comments ë°±ì—”ë“œ API êµ¬í˜„ (CRUD)
3. @ë©˜ì…˜ ê¸°ëŠ¥ êµ¬í˜„ (Tiptap í™•ì¥)
4. ëŒ“ê¸€ UI ì»´í¬ë„ŒíŠ¸ êµ¬í˜„
5. Task Drawerì— ëŒ“ê¸€ ì„¹ì…˜ í†µí•©

---

## Tech Spec

### 1. OAuth ê³„ì • + Members ì—°ê²°

**1.1 members.yamlì— email í•„ë“œ ì¶”ê°€**
```yaml
# exec/40_People/members.yaml
- id: "ê¹€ì€í–¥"
  email: "eunhyang@kkokkkok.app"  # ì¶”ê°€
  ...
- id: "í•œëª…í•™"
  email: "myeonghak@kkokkkok.app"  # ì¶”ê°€
  ...
```

**1.2 OAuth ê³„ì • ìƒì„± (CLI)**
```bash
cd ~/dev/loop/public
python -m api.oauth.cli create-user --email eunhyang@kkokkkok.app --password admin123 --role admin
python -m api.oauth.cli create-user --email myeonghak@kkokkkok.app --password admin123 --role admin
```

**1.3 VaultCacheì— emailâ†’member ì¡°íšŒ ì¶”ê°€**
- íŒŒì¼: `public/api/cache/vault_cache.py`
- ë©”ì„œë“œ: `get_member_by_email(email: str) -> Optional[Dict]`

---

### 2. Comments ë°±ì—”ë“œ

**2.1 SQLite í…Œì´ë¸”**
```sql
CREATE TABLE comments (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    entity_type VARCHAR(32) NOT NULL,  -- 'task' | 'project'
    entity_id VARCHAR(64) NOT NULL,    -- 'tsk-023-01' | 'prj-023'
    author_email VARCHAR(256) NOT NULL,
    content TEXT NOT NULL,             -- ë§ˆí¬ë‹¤ìš´ (ë©˜ì…˜ í¬í•¨)
    mentions JSON,                     -- ["tsk-023-02", "prj-023"]
    parent_id INTEGER,                 -- ë‹µê¸€ìš© (NULL = ìµœìƒìœ„)
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (parent_id) REFERENCES comments(id)
);

CREATE INDEX idx_comments_entity ON comments(entity_type, entity_id);
```

**2.2 API ì—”ë“œí¬ì¸íŠ¸**
| Method | Endpoint | ì„¤ëª… |
|--------|----------|------|
| GET | `/api/comments?entity_type=task&entity_id=tsk-023-01` | ëŒ“ê¸€ ëª©ë¡ |
| POST | `/api/comments` | ëŒ“ê¸€ ìƒì„± |
| PUT | `/api/comments/{id}` | ëŒ“ê¸€ ìˆ˜ì • |
| DELETE | `/api/comments/{id}` | ëŒ“ê¸€ ì‚­ì œ |

**2.3 ì‘ë‹µ í˜•ì‹**
```json
{
  "id": 1,
  "entity_type": "task",
  "entity_id": "tsk-023-01",
  "author": {
    "email": "eunhyang@kkokkkok.app",
    "member_id": "ê¹€ì€í–¥",
    "name": "ê¹€ì€í–¥",
    "icon": "ğŸ‘©â€ğŸ’»"
  },
  "content": "ì´ íƒœìŠ¤í¬ëŠ” [@tsk-023-02](/tasks/tsk-023-02) ì™„ë£Œ í›„ ì§„í–‰",
  "mentions": ["tsk-023-02"],
  "replies": [...],
  "created_at": "2026-01-09T10:00:00Z"
}
```

---

### 3. @ë©˜ì…˜ í”„ë¡ íŠ¸ì—”ë“œ (Tiptap í™•ì¥)

**3.1 MentionExtension ìƒì„±**
- íŒŒì¼: `dashboard-v2/src/components/MarkdownEditor/MentionExtension.tsx`
- SlashMenu.tsx íŒ¨í„´ ë³µì‚¬ í›„ ìˆ˜ì •:
  - `char: '/'` â†’ `char: '@'`
  - ë°ì´í„° ì†ŒìŠ¤: `useDashboardInit()`ì˜ tasks, projects, members

**3.2 MentionMenu ì»´í¬ë„ŒíŠ¸**
- íŒŒì¼: `dashboard-v2/src/components/MarkdownEditor/MentionMenu.tsx`
- ê¸°ëŠ¥:
  - ì—”í‹°í‹° ê²€ìƒ‰/í•„í„°ë§
  - í‚¤ë³´ë“œ ë„¤ë¹„ê²Œì´ì…˜ (â†‘â†“ Enter Esc)
  - íƒ€ì…ë³„ ì•„ì´ì½˜ (Task, Project, Member)

**3.3 ë©˜ì…˜ ë Œë”ë§**
- ì €ì¥ í˜•ì‹: `[@tsk-023-01](tsk-023-01)`
- ë Œë”ë§: í´ë¦­ ê°€ëŠ¥í•œ ë§í¬ (ë°°ê²½ìƒ‰ êµ¬ë¶„)

**3.4 í´ë¦­ ì‹œ ë„¤ë¹„ê²Œì´ì…˜**
```typescript
const handleMentionClick = (entityId: string) => {
  if (entityId.startsWith('tsk-')) {
    openEditTask(entityId);
  } else if (entityId.startsWith('prj-')) {
    navigate(`/projects/${entityId}`);
  }
};
```

---

### 4. ëŒ“ê¸€ UI ì»´í¬ë„ŒíŠ¸

**4.1 CommentSection ì»´í¬ë„ŒíŠ¸**
- íŒŒì¼: `dashboard-v2/src/features/comments/CommentSection.tsx`
- Props: `entityType`, `entityId`

**4.2 CommentItem ì»´í¬ë„ŒíŠ¸**
- íŒŒì¼: `dashboard-v2/src/features/comments/CommentItem.tsx`

**4.3 CommentEditor ì»´í¬ë„ŒíŠ¸**
- íŒŒì¼: `dashboard-v2/src/features/comments/CommentEditor.tsx`
- Tiptap MarkdownEditor + MentionExtension

**4.4 React Query í›…**
- `useComments(entityType, entityId)`
- `useCreateComment()`
- `useUpdateComment()`
- `useDeleteComment()`

---

### 5. Task/Project í†µí•©

**5.1 TaskDrawerì— ëŒ“ê¸€ ì„¹ì…˜ ì¶”ê°€**
- íŒŒì¼: `dashboard-v2/src/features/tasks/components/TaskDrawer.tsx`

---

## íŒŒì¼ ëª©ë¡

### ìˆ˜ì •í•  íŒŒì¼
| íŒŒì¼ | ë³€ê²½ ë‚´ìš© |
|------|----------|
| `exec/40_People/members.yaml` | email í•„ë“œ ì¶”ê°€ |
| `public/api/cache/vault_cache.py` | `get_member_by_email()` ì¶”ê°€ |
| `public/api/main.py` | comments ë¼ìš°í„° ë“±ë¡ |
| `dashboard-v2/src/components/MarkdownEditor/index.tsx` | MentionExtension ì¶”ê°€ |
| `dashboard-v2/src/features/tasks/components/TaskDrawer.tsx` | CommentSection ì¶”ê°€ |

### ìƒì„±í•  íŒŒì¼
| íŒŒì¼ | ì„¤ëª… |
|------|------|
| `public/api/routers/comments.py` | Comments API |
| `public/api/models/comments.py` | Comment ëª¨ë¸ + DB |
| `dashboard-v2/src/components/MarkdownEditor/MentionExtension.tsx` | @ë©˜ì…˜ Tiptap í™•ì¥ |
| `dashboard-v2/src/components/MarkdownEditor/MentionMenu.tsx` | ë©˜ì…˜ íŒì—… ë©”ë‰´ |
| `dashboard-v2/src/features/comments/CommentSection.tsx` | ëŒ“ê¸€ ì„¹ì…˜ |
| `dashboard-v2/src/features/comments/CommentItem.tsx` | ëŒ“ê¸€ ì•„ì´í…œ |
| `dashboard-v2/src/features/comments/CommentEditor.tsx` | ëŒ“ê¸€ ì—ë””í„° |
| `dashboard-v2/src/features/comments/queries.ts` | React Query í›… |
| `dashboard-v2/src/features/comments/types.ts` | íƒ€ì… ì •ì˜ |

---

## ê³„ì • ì •ë³´

| ì´ë¦„ | ì´ë©”ì¼ | ë¹„ë°€ë²ˆí˜¸ | Role |
|------|--------|----------|------|
| ê¹€ì€í–¥ | eunhyang@kkokkkok.app | admin123 | admin |
| í•œëª…í•™ | myeonghak@kkokkkok.app | admin123 | admin |

---

## ê²€ì¦ ë°©ë²•

### 1. OAuth ê³„ì • í…ŒìŠ¤íŠ¸
```bash
python -m api.oauth.cli list-users
```

### 2. Comments API í…ŒìŠ¤íŠ¸
```bash
# ëŒ“ê¸€ ìƒì„±
curl -X POST http://localhost:8081/api/comments \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"entity_type":"task","entity_id":"tsk-023-01","content":"í…ŒìŠ¤íŠ¸ ëŒ“ê¸€"}'

# ëŒ“ê¸€ ì¡°íšŒ
curl "http://localhost:8081/api/comments?entity_type=task&entity_id=tsk-023-01" \
  -H "Authorization: Bearer $TOKEN"
```

### 3. í”„ë¡ íŠ¸ì—”ë“œ í…ŒìŠ¤íŠ¸
1. Dashboard ë¡œê·¸ì¸
2. Task Drawer ì—´ê¸°
3. ëŒ“ê¸€ ì…ë ¥ë€ì— `@` ì…ë ¥ â†’ ë©˜ì…˜ íŒì—… í™•ì¸
4. ì—”í‹°í‹° ì„ íƒ â†’ ë§í¬ë¡œ ë³€í™˜ í™•ì¸
5. ëŒ“ê¸€ ì €ì¥ â†’ ëª©ë¡ì— í‘œì‹œ í™•ì¸
6. ë©˜ì…˜ í´ë¦­ â†’ í•´ë‹¹ ì—”í‹°í‹°ë¡œ ì´ë™ í™•ì¸

---

## ì˜ì¡´ì„±

### ë°±ì—”ë“œ
- ê¸°ì¡´ FastAPI, SQLAlchemy ì‚¬ìš© (ì¶”ê°€ ì—†ìŒ)

### í”„ë¡ íŠ¸ì—”ë“œ
- ì´ë¯¸ ì„¤ì¹˜ë¨: `@tiptap/core`, `@tiptap/suggestion`, `tippy.js`

---

## Codex Review Suggestions

> Codex PRD ê²€í†  ê²°ê³¼ (2026-01-09)

### ë³´ì•ˆ ê´€ë ¨
- [ ] ëŒ“ê¸€ ìˆ˜ì •/ì‚­ì œ ì‹œ ì‘ì„±ì ë³¸ì¸ë§Œ ê°€ëŠ¥í•˜ë„ë¡ ê¶Œí•œ ì²´í¬
- [ ] XSS ë°©ì§€ë¥¼ ìœ„í•œ ë§ˆí¬ë‹¤ìš´ sanitization (DOMPurify ë“±)
- [ ] content ìµœëŒ€ ê¸¸ì´ ì œí•œ (ì˜ˆ: 10,000ì)

### ë°ì´í„° ë¬´ê²°ì„±
- [ ] parent_idê°€ ê°™ì€ entity_type/entity_id ë‚´ì—ì„œë§Œ ì°¸ì¡°í•˜ë„ë¡ ê²€ì¦
- [ ] ë©˜ì…˜ëœ ì—”í‹°í‹° ì¡´ì¬ ì—¬ë¶€ ê²€ì¦ (ì˜µì…˜)

### API ê°œì„ 
- [ ] GET ì—”ë“œí¬ì¸íŠ¸ì— pagination ì¶”ê°€ (`?page=1&limit=20`)
- [ ] created_at ê¸°ì¤€ ì •ë ¬ (ìµœì‹ ìˆœ/ì˜¤ë˜ëœìˆœ)
- [ ] replies í¬í•¨ ì—¬ë¶€ ì˜µì…˜ (`?include_replies=true`)

### UI/UX
- [ ] ë¹ˆ ìƒíƒœ, ë¡œë”© ìƒíƒœ, ì—ëŸ¬ ìƒíƒœ ì²˜ë¦¬
- [ ] ëŒ“ê¸€ ì‘ì„±/ìˆ˜ì •/ì‚­ì œ ì‹œ í† ìŠ¤íŠ¸ ì•Œë¦¼
- [ ] ë©˜ì…˜ ê²€ìƒ‰ debounce (300ms)

### ì„±ëŠ¥
- [ ] `created_at` ì¸ë±ìŠ¤ ì¶”ê°€ (ì •ë ¬ ìµœì í™”)
- [ ] ëŒ“ê¸€ ëª©ë¡ ì´ˆê¸° ë¡œë“œ ì œí•œ (ìµœê·¼ 50ê°œ)

**ìš°ì„ ìˆœìœ„**: ë³´ì•ˆ ê´€ë ¨ í•­ëª©ì€ í•„ìˆ˜, ë‚˜ë¨¸ì§€ëŠ” v1 ì´í›„ ì ì§„ì  ê°œì„ 

---

## Notes

B Score (Realized Impact) ì—°ë™:
- ëŒ“ê¸€ ë°ì´í„°ëŠ” í–¥í›„ Evidence ìƒì„± ì‹œ ì°¸ê³  ìë£Œë¡œ í™œìš© ê°€ëŠ¥
- `mentions` í•„ë“œë¡œ ì–´ë–¤ ì—”í‹°í‹°ê°€ ë…¼ì˜ë˜ì—ˆëŠ”ì§€ ì¶”ì  ê°€ëŠ¥

---

## ì‘ì—… ë¡œê·¸

### 2026-01-09
**ê°œìš”**: ëŒ“ê¸€ ì‹œìŠ¤í…œ + @ë©˜ì…˜ ê¸°ëŠ¥ êµ¬í˜„ ì™„ë£Œ

**êµ¬í˜„ ë‚´ìš©**:

**Backend (LOOP Vault API)**:
- OAuth ê³„ì • ìƒì„± ì™„ë£Œ (ê¹€ì€í–¥, í•œëª…í•™)
- `members.yaml`ì— email í•„ë“œ ì¶”ê°€
- `VaultCache.get_member_by_email()` ë©”ì„œë“œ ì¶”ê°€
- Comments API êµ¬í˜„:
  - SQLite í…Œì´ë¸” ìƒì„± (comments í…Œì´ë¸”)
  - CRUD ì—”ë“œí¬ì¸íŠ¸: GET/POST/PUT/DELETE `/api/comments`
  - author ì •ë³´ ìë™ ì¡°íšŒ (email â†’ member)
  - mentions íŒŒì‹± ë° ì €ì¥
- íŒŒì¼: `api/routers/comments.py`, `api/models/comments.py`

**Frontend (Dashboard v2)**:
- Tiptap MentionExtension êµ¬í˜„:
  - `@` íŠ¸ë¦¬ê±°ë¡œ ì—”í‹°í‹° ê²€ìƒ‰
  - Task/Project/Member ìë™ì™„ì„± ë©”ë‰´
  - í‚¤ë³´ë“œ ë„¤ë¹„ê²Œì´ì…˜ (â†‘â†“ Enter Esc)
- CommentSection ì»´í¬ë„ŒíŠ¸ êµ¬í˜„:
  - ëŒ“ê¸€ ëª©ë¡ í‘œì‹œ (ê³„ì¸µ êµ¬ì¡° ì§€ì›)
  - ì‹¤ì‹œê°„ CRUD ì—°ë™
  - React Query ìºì‹±
- CommentEditor ì»´í¬ë„ŒíŠ¸:
  - MarkdownEditor + MentionExtension
  - ë©˜ì…˜ ë Œë”ë§ (í´ë¦­ ì‹œ ë„¤ë¹„ê²Œì´ì…˜)
- TaskDrawerì— ëŒ“ê¸€ ì„¹ì…˜ í†µí•©
- íŒŒì¼:
  - `src/components/MarkdownEditor/MentionExtension.tsx`
  - `src/components/MarkdownEditor/MentionMenu.tsx`
  - `src/features/comments/CommentSection.tsx`
  - `src/features/comments/CommentItem.tsx`
  - `src/features/comments/CommentEditor.tsx`
  - `src/features/comments/queries.ts`
  - `src/features/comments/types.ts`

**Infrastructure**:
- NAS ì„œë²„ rebuild ì™„ë£Œ (`/mcp-server rebuild`)
- API ìºì‹œ ê°±ì‹  ì™„ë£Œ
- Frontend build & deploy ì™„ë£Œ

**ê²€ì¦ ì™„ë£Œ**:
- OAuth ê³„ì • ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸
- ëŒ“ê¸€ CRUD ë™ì‘ í™•ì¸
- @ë©˜ì…˜ íŒì—… ë° ìë™ì™„ì„± ë™ì‘ í™•ì¸
- ë©˜ì…˜ ë§í¬ í´ë¦­ ì‹œ ë„¤ë¹„ê²Œì´ì…˜ í™•ì¸
- Task Drawerì—ì„œ ëŒ“ê¸€ ì„¹ì…˜ ì •ìƒ í‘œì‹œ

**ìµœì¢… ìƒíƒœ**: done

**ë‚¨ì€ ì‘ì—… (í›„ì† ê°œì„ )**:
- Codex Review Suggestions í•­ëª©ë“¤ (ë³´ì•ˆ, pagination, UI/UX ê°œì„ )
- ëŒ“ê¸€ ì•Œë¦¼ ê¸°ëŠ¥ (í–¥í›„ Taskë¡œ ë¶„ë¦¬)

### 2026-01-11
**ê°œìš”**: ëŒ“ê¸€ ìˆ˜ì • ë²„ê·¸ ìˆ˜ì •

**ë¬¸ì œ ë°œê²¬**:
- ëŒ“ê¸€ ìˆ˜ì • ë²„íŠ¼ í´ë¦­ ì‹œ ë¹ˆ í™”ë©´ì´ í‘œì‹œë¨
- CommentEditorì— initialContent propì´ ì „ë‹¬ë˜ì§€ ì•ŠìŒ

**êµ¬í˜„ ë‚´ìš©**:
- CommentEditorì— `initialContent` prop ì¶”ê°€
- CommentItemì—ì„œ ìˆ˜ì • ì‹œ `comment.content` ì „ë‹¬
- íŒŒì¼: `src/features/comments/CommentEditor.tsx`, `src/features/comments/CommentItem.tsx`

**ê²€ì¦ ì™„ë£Œ**:
- ëŒ“ê¸€ ìˆ˜ì • ë²„íŠ¼ í´ë¦­ ì‹œ ê¸°ì¡´ ë‚´ìš© í‘œì‹œ í™•ì¸
- ìˆ˜ì • ì €ì¥ í›„ ì •ìƒ ì—…ë°ì´íŠ¸ í™•ì¸
- Dashboard ë¡œì»¬ ë¹Œë“œ ì„±ê³µ

**ë°°í¬ ìƒíƒœ**:
- ì½”ë“œ ì»¤ë°‹ ë° GitHub í‘¸ì‹œ ì™„ë£Œ (commit: 9457dca)
- NAS ë°°í¬ ëŒ€ê¸°ì¤‘

**Commit**: `fix(comments): pass initialContent when editing comment`
