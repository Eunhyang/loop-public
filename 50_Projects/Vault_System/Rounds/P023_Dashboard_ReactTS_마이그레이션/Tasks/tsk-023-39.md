---
entity_type: Task
entity_id: "tsk-023-39"
entity_name: "Dashboard - ëŒ“ê¸€ ì‹œìŠ¤í…œ + @ë©˜ì…˜ êµ¬í˜„"
created: 2026-01-09
updated: 2026-01-09
status: done
closed: 2026-01-09

# === ê³„ì¸µ ===
parent_id: "prj-023"
project_id: "prj-023"
aliases: ["tsk-023-39"]

# === ê´€ê³„ ===
outgoing_relations: []
validates: []
validated_by: []

# === Task ì „ìš© ===
assignee: "ê¹€ì€í–¥"
start_date: 2026-01-09
due: null
priority: high
estimated_hours: null
actual_hours: null

# === Task ìœ í˜• (dev Task ì—°ë™ìš©) ===
type: dev
target_project: loop

# === ë¶„ë¥˜ ===
tags: [comments, mentions, oauth, tiptap]
priority_flag: high
---

# Dashboard - ëŒ“ê¸€ ì‹œìŠ¤í…œ + @ë©˜ì…˜ êµ¬í˜„

> Task ID: `tsk-023-39` | Project: `prj-023` | Status: done

## ëª©í‘œ

**ì™„ë£Œ ì¡°ê±´**:
1. OAuth ì‚¬ìš©ì ê³„ì • ìƒì„± (ê¹€ì€í–¥, í•œëª…í•™) + Members ì—°ê²°
2. Comments ë°±ì—”ë“œ API êµ¬í˜„ (CRUD)
3. @ë©˜ì…˜ ê¸°ëŠ¥ êµ¬í˜„ (Tiptap í™•ì¥)
4. ëŒ“ê¸€ UI ì»´í¬ë„ŒíŠ¸ êµ¬í˜„
5. Task Drawerì— ëŒ“ê¸€ ì„¹ì…˜ í†µí•©

---

## Tech Spec

### 1. OAuth ê³„ì • + Members ì—°ê²°

**1.1 members.yamlì— email í•„ë“œ ì¶”ê°€**
```yaml
# exec/40_People/members.yaml
- id: "ê¹€ì€í–¥"
  email: "eunhyang@kkokkkok.app"  # ì¶”ê°€
  ...
- id: "í•œëª…í•™"
  email: "myeonghak@kkokkkok.app"  # ì¶”ê°€
  ...
```

**1.2 OAuth ê³„ì • ìƒì„± (CLI)**
```bash
cd ~/dev/loop/public
python -m api.oauth.cli create-user --email eunhyang@kkokkkok.app --password admin123 --role admin
python -m api.oauth.cli create-user --email myeonghak@kkokkkok.app --password admin123 --role admin
```

**1.3 VaultCacheì— emailâ†’member ì¡°íšŒ ì¶”ê°€**
- íŒŒì¼: `public/api/cache/vault_cache.py`
- ë©”ì„œë“œ: `get_member_by_email(email: str) -> Optional[Dict]`

---

### 2. Comments ë°±ì—”ë“œ

**2.1 SQLite í…Œì´ë¸”**
```sql
CREATE TABLE comments (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    entity_type VARCHAR(32) NOT NULL,  -- 'task' | 'project'
    entity_id VARCHAR(64) NOT NULL,    -- 'tsk-023-01' | 'prj-023'
    author_email VARCHAR(256) NOT NULL,
    content TEXT NOT NULL,             -- ë§ˆí¬ë‹¤ìš´ (ë©˜ì…˜ í¬í•¨)
    mentions JSON,                     -- ["tsk-023-02", "prj-023"]
    parent_id INTEGER,                 -- ë‹µê¸€ìš© (NULL = ìµœìƒìœ„)
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (parent_id) REFERENCES comments(id)
);

CREATE INDEX idx_comments_entity ON comments(entity_type, entity_id);
```

**2.2 API ì—”ë“œí¬ì¸íŠ¸**
| Method | Endpoint | ì„¤ëª… |
|--------|----------|------|
| GET | `/api/comments?entity_type=task&entity_id=tsk-023-01` | ëŒ“ê¸€ ëª©ë¡ |
| POST | `/api/comments` | ëŒ“ê¸€ ìƒì„± |
| PUT | `/api/comments/{id}` | ëŒ“ê¸€ ìˆ˜ì • |
| DELETE | `/api/comments/{id}` | ëŒ“ê¸€ ì‚­ì œ |

**2.3 ì‘ë‹µ í˜•ì‹**
```json
{
  "id": 1,
  "entity_type": "task",
  "entity_id": "tsk-023-01",
  "author": {
    "email": "eunhyang@kkokkkok.app",
    "member_id": "ê¹€ì€í–¥",
    "name": "ê¹€ì€í–¥",
    "icon": "ğŸ‘©â€ğŸ’»"
  },
  "content": "ì´ íƒœìŠ¤í¬ëŠ” [@tsk-023-02](/tasks/tsk-023-02) ì™„ë£Œ í›„ ì§„í–‰",
  "mentions": ["tsk-023-02"],
  "replies": [...],
  "created_at": "2026-01-09T10:00:00Z"
}
```

---

### 3. @ë©˜ì…˜ í”„ë¡ íŠ¸ì—”ë“œ (Tiptap í™•ì¥)

**3.1 MentionExtension ìƒì„±**
- íŒŒì¼: `dashboard-v2/src/components/MarkdownEditor/MentionExtension.tsx`
- SlashMenu.tsx íŒ¨í„´ ë³µì‚¬ í›„ ìˆ˜ì •:
  - `char: '/'` â†’ `char: '@'`
  - ë°ì´í„° ì†ŒìŠ¤: `useDashboardInit()`ì˜ tasks, projects, members

**3.2 MentionMenu ì»´í¬ë„ŒíŠ¸**
- íŒŒì¼: `dashboard-v2/src/components/MarkdownEditor/MentionMenu.tsx`
- ê¸°ëŠ¥:
  - ì—”í‹°í‹° ê²€ìƒ‰/í•„í„°ë§
  - í‚¤ë³´ë“œ ë„¤ë¹„ê²Œì´ì…˜ (â†‘â†“ Enter Esc)
  - íƒ€ì…ë³„ ì•„ì´ì½˜ (Task, Project, Member)

**3.3 ë©˜ì…˜ ë Œë”ë§**
- ì €ì¥ í˜•ì‹: `[@tsk-023-01](tsk-023-01)`
- ë Œë”ë§: í´ë¦­ ê°€ëŠ¥í•œ ë§í¬ (ë°°ê²½ìƒ‰ êµ¬ë¶„)

**3.4 í´ë¦­ ì‹œ ë„¤ë¹„ê²Œì´ì…˜**
```typescript
const handleMentionClick = (entityId: string) => {
  if (entityId.startsWith('tsk-')) {
    openEditTask(entityId);
  } else if (entityId.startsWith('prj-')) {
    navigate(`/projects/${entityId}`);
  }
};
```

---

### 4. ëŒ“ê¸€ UI ì»´í¬ë„ŒíŠ¸

**4.1 CommentSection ì»´í¬ë„ŒíŠ¸**
- íŒŒì¼: `dashboard-v2/src/features/comments/CommentSection.tsx`
- Props: `entityType`, `entityId`

**4.2 CommentItem ì»´í¬ë„ŒíŠ¸**
- íŒŒì¼: `dashboard-v2/src/features/comments/CommentItem.tsx`

**4.3 CommentEditor ì»´í¬ë„ŒíŠ¸**
- íŒŒì¼: `dashboard-v2/src/features/comments/CommentEditor.tsx`
- Tiptap MarkdownEditor + MentionExtension

**4.4 React Query í›…**
- `useComments(entityType, entityId)`
- `useCreateComment()`
- `useUpdateComment()`
- `useDeleteComment()`

---

### 5. Task/Project í†µí•©

**5.1 TaskDrawerì— ëŒ“ê¸€ ì„¹ì…˜ ì¶”ê°€**
- íŒŒì¼: `dashboard-v2/src/features/tasks/components/TaskDrawer.tsx`

---

## íŒŒì¼ ëª©ë¡

### ìˆ˜ì •í•  íŒŒì¼
| íŒŒì¼ | ë³€ê²½ ë‚´ìš© |
|------|----------|
| `exec/40_People/members.yaml` | email í•„ë“œ ì¶”ê°€ |
| `public/api/cache/vault_cache.py` | `get_member_by_email()` ì¶”ê°€ |
| `public/api/main.py` | comments ë¼ìš°í„° ë“±ë¡ |
| `dashboard-v2/src/components/MarkdownEditor/index.tsx` | MentionExtension ì¶”ê°€ |
| `dashboard-v2/src/features/tasks/components/TaskDrawer.tsx` | CommentSection ì¶”ê°€ |

### ìƒì„±í•  íŒŒì¼
| íŒŒì¼ | ì„¤ëª… |
|------|------|
| `public/api/routers/comments.py` | Comments API |
| `public/api/models/comments.py` | Comment ëª¨ë¸ + DB |
| `dashboard-v2/src/components/MarkdownEditor/MentionExtension.tsx` | @ë©˜ì…˜ Tiptap í™•ì¥ |
| `dashboard-v2/src/components/MarkdownEditor/MentionMenu.tsx` | ë©˜ì…˜ íŒì—… ë©”ë‰´ |
| `dashboard-v2/src/features/comments/CommentSection.tsx` | ëŒ“ê¸€ ì„¹ì…˜ |
| `dashboard-v2/src/features/comments/CommentItem.tsx` | ëŒ“ê¸€ ì•„ì´í…œ |
| `dashboard-v2/src/features/comments/CommentEditor.tsx` | ëŒ“ê¸€ ì—ë””í„° |
| `dashboard-v2/src/features/comments/queries.ts` | React Query í›… |
| `dashboard-v2/src/features/comments/types.ts` | íƒ€ì… ì •ì˜ |

---

## ê³„ì • ì •ë³´

| ì´ë¦„ | ì´ë©”ì¼ | ë¹„ë°€ë²ˆí˜¸ | Role |
|------|--------|----------|------|
| ê¹€ì€í–¥ | eunhyang@kkokkkok.app | admin123 | admin |
| í•œëª…í•™ | myeonghak@kkokkkok.app | admin123 | admin |

---

## ê²€ì¦ ë°©ë²•

### 1. OAuth ê³„ì • í…ŒìŠ¤íŠ¸
```bash
python -m api.oauth.cli list-users
```

### 2. Comments API í…ŒìŠ¤íŠ¸
```bash
# ëŒ“ê¸€ ìƒì„±
curl -X POST http://localhost:8081/api/comments \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"entity_type":"task","entity_id":"tsk-023-01","content":"í…ŒìŠ¤íŠ¸ ëŒ“ê¸€"}'

# ëŒ“ê¸€ ì¡°íšŒ
curl "http://localhost:8081/api/comments?entity_type=task&entity_id=tsk-023-01" \
  -H "Authorization: Bearer $TOKEN"
```

### 3. í”„ë¡ íŠ¸ì—”ë“œ í…ŒìŠ¤íŠ¸
1. Dashboard ë¡œê·¸ì¸
2. Task Drawer ì—´ê¸°
3. ëŒ“ê¸€ ì…ë ¥ë€ì— `@` ì…ë ¥ â†’ ë©˜ì…˜ íŒì—… í™•ì¸
4. ì—”í‹°í‹° ì„ íƒ â†’ ë§í¬ë¡œ ë³€í™˜ í™•ì¸
5. ëŒ“ê¸€ ì €ì¥ â†’ ëª©ë¡ì— í‘œì‹œ í™•ì¸
6. ë©˜ì…˜ í´ë¦­ â†’ í•´ë‹¹ ì—”í‹°í‹°ë¡œ ì´ë™ í™•ì¸

---

## ì˜ì¡´ì„±

### ë°±ì—”ë“œ
- ê¸°ì¡´ FastAPI, SQLAlchemy ì‚¬ìš© (ì¶”ê°€ ì—†ìŒ)

### í”„ë¡ íŠ¸ì—”ë“œ
- ì´ë¯¸ ì„¤ì¹˜ë¨: `@tiptap/core`, `@tiptap/suggestion`, `tippy.js`

---

## Codex Review Suggestions

> Codex PRD ê²€í†  ê²°ê³¼ (2026-01-09)

### ë³´ì•ˆ ê´€ë ¨
- [ ] ëŒ“ê¸€ ìˆ˜ì •/ì‚­ì œ ì‹œ ì‘ì„±ì ë³¸ì¸ë§Œ ê°€ëŠ¥í•˜ë„ë¡ ê¶Œí•œ ì²´í¬
- [ ] XSS ë°©ì§€ë¥¼ ìœ„í•œ ë§ˆí¬ë‹¤ìš´ sanitization (DOMPurify ë“±)
- [ ] content ìµœëŒ€ ê¸¸ì´ ì œí•œ (ì˜ˆ: 10,000ì)

### ë°ì´í„° ë¬´ê²°ì„±
- [ ] parent_idê°€ ê°™ì€ entity_type/entity_id ë‚´ì—ì„œë§Œ ì°¸ì¡°í•˜ë„ë¡ ê²€ì¦
- [ ] ë©˜ì…˜ëœ ì—”í‹°í‹° ì¡´ì¬ ì—¬ë¶€ ê²€ì¦ (ì˜µì…˜)

### API ê°œì„ 
- [ ] GET ì—”ë“œí¬ì¸íŠ¸ì— pagination ì¶”ê°€ (`?page=1&limit=20`)
- [ ] created_at ê¸°ì¤€ ì •ë ¬ (ìµœì‹ ìˆœ/ì˜¤ë˜ëœìˆœ)
- [ ] replies í¬í•¨ ì—¬ë¶€ ì˜µì…˜ (`?include_replies=true`)

### UI/UX
- [ ] ë¹ˆ ìƒíƒœ, ë¡œë”© ìƒíƒœ, ì—ëŸ¬ ìƒíƒœ ì²˜ë¦¬
- [ ] ëŒ“ê¸€ ì‘ì„±/ìˆ˜ì •/ì‚­ì œ ì‹œ í† ìŠ¤íŠ¸ ì•Œë¦¼
- [ ] ë©˜ì…˜ ê²€ìƒ‰ debounce (300ms)

### ì„±ëŠ¥
- [ ] `created_at` ì¸ë±ìŠ¤ ì¶”ê°€ (ì •ë ¬ ìµœì í™”)
- [ ] ëŒ“ê¸€ ëª©ë¡ ì´ˆê¸° ë¡œë“œ ì œí•œ (ìµœê·¼ 50ê°œ)

**ìš°ì„ ìˆœìœ„**: ë³´ì•ˆ ê´€ë ¨ í•­ëª©ì€ í•„ìˆ˜, ë‚˜ë¨¸ì§€ëŠ” v1 ì´í›„ ì ì§„ì  ê°œì„ 

---

## Notes

B Score (Realized Impact) ì—°ë™:
- ëŒ“ê¸€ ë°ì´í„°ëŠ” í–¥í›„ Evidence ìƒì„± ì‹œ ì°¸ê³  ìë£Œë¡œ í™œìš© ê°€ëŠ¥
- `mentions` í•„ë“œë¡œ ì–´ë–¤ ì—”í‹°í‹°ê°€ ë…¼ì˜ë˜ì—ˆëŠ”ì§€ ì¶”ì  ê°€ëŠ¥

---

## ì‘ì—… ë¡œê·¸

### 2026-01-09
**ê°œìš”**: ëŒ“ê¸€ ì‹œìŠ¤í…œ + @ë©˜ì…˜ ê¸°ëŠ¥ êµ¬í˜„ ì™„ë£Œ

**êµ¬í˜„ ë‚´ìš©**:

**Backend (LOOP Vault API)**:
- OAuth ê³„ì • ìƒì„± ì™„ë£Œ (ê¹€ì€í–¥, í•œëª…í•™)
- `members.yaml`ì— email í•„ë“œ ì¶”ê°€
- `VaultCache.get_member_by_email()` ë©”ì„œë“œ ì¶”ê°€
- Comments API êµ¬í˜„:
  - SQLite í…Œì´ë¸” ìƒì„± (comments í…Œì´ë¸”)
  - CRUD ì—”ë“œí¬ì¸íŠ¸: GET/POST/PUT/DELETE `/api/comments`
  - author ì •ë³´ ìë™ ì¡°íšŒ (email â†’ member)
  - mentions íŒŒì‹± ë° ì €ì¥
- íŒŒì¼: `api/routers/comments.py`, `api/models/comments.py`

**Frontend (Dashboard v2)**:
- Tiptap MentionExtension êµ¬í˜„:
  - `@` íŠ¸ë¦¬ê±°ë¡œ ì—”í‹°í‹° ê²€ìƒ‰
  - Task/Project/Member ìë™ì™„ì„± ë©”ë‰´
  - í‚¤ë³´ë“œ ë„¤ë¹„ê²Œì´ì…˜ (â†‘â†“ Enter Esc)
- CommentSection ì»´í¬ë„ŒíŠ¸ êµ¬í˜„:
  - ëŒ“ê¸€ ëª©ë¡ í‘œì‹œ (ê³„ì¸µ êµ¬ì¡° ì§€ì›)
  - ì‹¤ì‹œê°„ CRUD ì—°ë™
  - React Query ìºì‹±
- CommentEditor ì»´í¬ë„ŒíŠ¸:
  - MarkdownEditor + MentionExtension
  - ë©˜ì…˜ ë Œë”ë§ (í´ë¦­ ì‹œ ë„¤ë¹„ê²Œì´ì…˜)
- TaskDrawerì— ëŒ“ê¸€ ì„¹ì…˜ í†µí•©
- íŒŒì¼:
  - `src/components/MarkdownEditor/MentionExtension.tsx`
  - `src/components/MarkdownEditor/MentionMenu.tsx`
  - `src/features/comments/CommentSection.tsx`
  - `src/features/comments/CommentItem.tsx`
  - `src/features/comments/CommentEditor.tsx`
  - `src/features/comments/queries.ts`
  - `src/features/comments/types.ts`

**Infrastructure**:
- NAS ì„œë²„ rebuild ì™„ë£Œ (`/mcp-server rebuild`)
- API ìºì‹œ ê°±ì‹  ì™„ë£Œ
- Frontend build & deploy ì™„ë£Œ

**ê²€ì¦ ì™„ë£Œ**:
- OAuth ê³„ì • ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸
- ëŒ“ê¸€ CRUD ë™ì‘ í™•ì¸
- @ë©˜ì…˜ íŒì—… ë° ìë™ì™„ì„± ë™ì‘ í™•ì¸
- ë©˜ì…˜ ë§í¬ í´ë¦­ ì‹œ ë„¤ë¹„ê²Œì´ì…˜ í™•ì¸
- Task Drawerì—ì„œ ëŒ“ê¸€ ì„¹ì…˜ ì •ìƒ í‘œì‹œ

**ìµœì¢… ìƒíƒœ**: done

**ë‚¨ì€ ì‘ì—… (í›„ì† ê°œì„ )**:
- Codex Review Suggestions í•­ëª©ë“¤ (ë³´ì•ˆ, pagination, UI/UX ê°œì„ )
- ëŒ“ê¸€ ì•Œë¦¼ ê¸°ëŠ¥ (í–¥í›„ Taskë¡œ ë¶„ë¦¬)
