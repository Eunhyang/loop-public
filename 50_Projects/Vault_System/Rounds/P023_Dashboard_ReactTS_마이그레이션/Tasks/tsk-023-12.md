---
entity_type: Task
entity_id: "tsk-023-12"
entity_name: "Dashboard - Kanban Visibility 필터 수정"
created: 2026-01-08
updated: 2026-01-08
status: doing

# === 계층 ===
parent_id: "prj-023"
project_id: "prj-023"
aliases: ["tsk-023-12"]

# === 관계 ===
outgoing_relations: []
validates: []
validated_by: []

# === Task 전용 ===
assignee: "김은향"
start_date: 2026-01-08
due: 2026-01-08
priority: medium
estimated_hours: null
actual_hours: null

# === Task 유형 (dev Task 연동용) ===
type: dev
target_project: null

# === 분류 ===
tags: ["dashboard", "filter", "kanban", "visibility"]
priority_flag: high
---

# Dashboard - Kanban Visibility 필터 수정

> Task ID: `tsk-023-12` | Project: `prj-023` | Status: doing

## 목표

**완료 조건**:
1. 4개 Visibility 필터 모두 정상 작동
2. 토글 변경 시 Kanban 즉시 반영
3. 페이지 새로고침 후에도 필터 상태 유지 (localStorage)

---

## 문제 현황

### 작동하지 않는 필터들

| 필터 | UI | localStorage | 필터링 로직 | 원인 |
|------|----|--------------|--------------|----|
| Show Inactive Members | ✅ | ✅ | ❌ | 로직 미구현 + 데이터 필드 없음 |
| Show Non-Core Members | ✅ | ✅ | ❌ | 로직 미구현 + 데이터 필드 없음 |
| Show Inactive Projects | ✅ | ✅ | ❌ | Kanban에서 하드코딩 |
| Show Inactive Tasks | ✅ | ✅ | ❌ | Kanban에서 하드코딩 |

### 근본 원인

1. **아키텍처 미완성**: OLD(FilterContext) → NEW(useCombinedFilters) 전환 중단
2. **Kanban 하드코딩**: `pages/Kanban/index.tsx`가 localStorage 값을 읽지 않고 DEFAULT 값 강제
3. **Member 타입 불완전**: `active`, `role` 필드 미반영
4. **필터링 로직 미구현**: `selectors.ts`에 member 필터 처리 없음

---

## Tech Spec

### Core Member 정의 (확정)

| 분류 | role 값 | 멤버 예시 |
|------|---------|----------|
| **Core** | Founder, Cofounder, Member | 김은향, 한명학, 임단 |
| **Non-Core** | Advisor, External, Unassigned | 황종필, 신동진, 외주, 미정 |

### 데이터 흐름 (목표)

```
localStorage ──┐
               ├──→ useCombinedFilters() ──→ Kanban/index.tsx
URL params ────┘                                    │
                                                    ▼
                                          buildKanbanColumns()
                                                    │
                                                    ▼
                                          applyLocalFilters()
                                                    │
                                    ┌───────────────┼───────────────┐
                                    ▼               ▼               ▼
                            filterByMembers  filterByProjects  filterByTasks
```

### 필터 동작 명세

| 필터 | OFF 시 동작 |
|------|-------------|
| Show Inactive Members | `active: false` 멤버의 Task 숨김 |
| Show Non-Core Members | Advisor/External/Unassigned 멤버의 Task 숨김 |
| Show Inactive Projects | `status: completed` 프로젝트의 Task 숨김 |
| Show Inactive Tasks | `status: done` Task 숨김 |

---

## 구현 단계

### Phase 1: Member 타입 확장

**파일**: `dashboard-v2/src/types/index.ts`

```typescript
export interface Member {
  id: string;
  name: string;
  role: string;
  aliases?: string[];
  active?: boolean;  // 추가
}
```

### Phase 2: Kanban 페이지 수정 (핵심)

**파일**: `dashboard-v2/src/pages/Kanban/index.tsx`

**현재 문제 (하드코딩)**:
```typescript
const combinedFilters: CombinedFilterState = {
  ...urlFilters,
  ...panelFilters,
  showInactiveMembers: DEFAULT_LOCAL_FILTERS.showInactiveMembers,  // 하드코딩!
  showNonCoreMembers: DEFAULT_LOCAL_FILTERS.showNonCoreMembers,    // 하드코딩!
};
```

**수정 방향**:
```typescript
import { useCombinedFilters } from '@/hooks/useCombinedFilters';

const { filters: combinedFilters, setLocalFilter } = useCombinedFilters();
// localStorage 값이 자동으로 반영됨
```

### Phase 3: 필터링 로직 구현

**파일**: `dashboard-v2/src/features/tasks/selectors.ts`

```typescript
const CORE_ROLES = ['Founder', 'Cofounder', 'Member'];

/**
 * Member 기반 Task 필터링
 */
export const filterTasksByMembers = (
  tasks: Task[],
  members: Member[],
  filters: LocalFilterState
): Task[] => {
  const memberMap = new Map(members.map(m => [m.id, m]));

  return tasks.filter(task => {
    const member = memberMap.get(task.assignee);
    if (!member) return true;

    // Inactive member 필터
    if (!filters.showInactiveMembers && member.active === false) {
      return false;
    }

    // Non-core member 필터 (role 기반)
    if (!filters.showNonCoreMembers && !CORE_ROLES.includes(member.role)) {
      return false;
    }

    return true;
  });
};
```

**buildKanbanColumns 수정**:
```typescript
export const buildKanbanColumns = (
  tasks: Task[],
  projects: Project[],
  members: Member[],  // 추가
  filters: CombinedFilterState
): KanbanColumns => {
  const allowedProjectIds = filterProjects(projects, filters);

  let filtered = applyUrlFilters(tasks, filters, projects);
  filtered = applyLocalFilters(filtered, filters);
  filtered = filterTasksByProjects(filtered, allowedProjectIds);
  filtered = filterTasksByMembers(filtered, members, filters);  // 추가

  return groupTasksByStatus(filtered);
};
```

### Phase 4: FilterContext 정리

**파일**: `dashboard-v2/src/features/filters/context/FilterContext.tsx`

- Kanban에서 FilterContext 의존성 제거
- useCombinedFilters로 완전 전환

---

## 수정 파일 목록

| 파일 | 변경 내용 | 우선순위 |
|------|----------|---------|
| `types/index.ts` | Member 타입에 active 추가 | P1 |
| `pages/Kanban/index.tsx` | useCombinedFilters 사용, 하드코딩 제거 | P1 |
| `features/tasks/selectors.ts` | filterTasksByMembers 함수 추가 | P1 |
| `hooks/useCombinedFilters.ts` | 필요시 수정 | P2 |
| `features/filters/context/FilterContext.tsx` | 의존성 정리 또는 제거 | P3 |

---

## 체크리스트

- [ ] Phase 1: Member 타입 확장
- [ ] Phase 2: Kanban 하드코딩 제거
- [ ] Phase 3: filterTasksByMembers 구현
- [ ] Phase 4: FilterContext 정리
- [ ] 테스트: Show Inactive Members 필터
- [ ] 테스트: Show Non-Core Members 필터
- [ ] 테스트: Show Inactive Projects 필터
- [ ] 테스트: Show Inactive Tasks 필터
- [ ] 테스트: 페이지 새로고침 후 유지

---

## Notes

### Todo
- [x] Phase 1: Member 타입 확장
- [x] Phase 2: Kanban 하드코딩 제거
- [x] Phase 3: filterTasksByMembers 구현
- [x] Phase 4: buildKanbanColumns 시그니처 업데이트
- [x] Codex 코드 리뷰 통과

### 구현 완료 (2026-01-08)

#### 수정된 파일

1. `dashboard-v2/src/types/index.ts`
   - Member 인터페이스에 `active?: boolean` 필드 추가

2. `dashboard-v2/src/features/tasks/selectors.ts`
   - `filterTasksByMembers()` 함수 구현 (Member.active + Member.role 필터링)
   - `buildKanbanColumns()` 시그니처에 members 파라미터 추가
   - Phase 2 필터링 순서에 member 필터 추가 (Step 4)

3. `dashboard-v2/src/pages/Kanban/index.tsx`
   - 하드코딩 제거: useCombinedFilters 훅 사용
   - buildKanbanColumns 호출 시 data.members 전달

#### Codex 리뷰 결과

✅ **통과 항목**:
- 타입 안전성 (CombinedFilterState 올바르게 사용)
- Member.active 옵셔널 필드 처리 (undefined = active)
- Orphan task 처리 (member 없는 task 유지)
- 필터 로직 정확성

⚠️ **주의 사항**:
- CORE_ROLES 대소문자 구분 (현재 정확히 매칭 필요)

### 작업 로그
<!--
작업 완료 시 아래 형식으로 기록 (workthrough 스킬 자동 생성)
-->

---

## 참고 문서

- [[prj-023]] - 소속 Project
- [[플랜 파일]](/Users/gim-eunhyang/.claude/plans/misty-wondering-robin.md) - 상세 플랜

---

**Created**: 2026-01-08
**Assignee**: 김은향
**Due**: 2026-01-08
