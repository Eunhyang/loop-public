---
entity_type: Task
entity_id: tsk-023-43
entity_name: Dashboard - Notes 인라인 이미지 삽입 기능
created: 2026-01-09
updated: '2026-01-10'
status: todo
closed: null
project_id: prj-023
assignee: 김은향
type: dev
priority: high
start_date: null
due: null
validates: []
links: []
notes: <p></p>
tags:
- task
- dashboard
- markdown-editor
- image-upload
- tiptap
---
# Dashboard - Notes 인라인 이미지 삽입 기능

> Task ID: `tsk-023-43` | Project: [[prj-023]] | Status: todo

## Summary

Task notes 필드에 노션처럼 이미지를 자유롭게 삽입할 수 있도록 구현. 드래그앤드롭, `/image` 슬래시 명령어, 클립보드 붙여넣기 지원.

---

## Tech Spec

### 목표
노션처럼 Task notes 필드에 이미지를 자유롭게 삽입할 수 있도록 구현

### 기능 요구사항
- 드래그앤드롭으로 이미지 삽입
- `/image` 슬래시 명령어로 파일 선택
- Ctrl+V로 클립보드 이미지 붙여넣기
- 에디터 내 이미지 미리보기
- 새 Task 생성 시 자동 저장 후 업로드

### 설계 결정
- **저장소**: 기존 Attachment API 재사용 (`/api/tasks/{task_id}/attachments`)
- **URL 포맷**: `/api/tasks/{task_id}/attachments/{filename}`
- **에디터**: Tiptap Image extension 사용

### 수정 파일

| 파일 | 변경 내용 |
|------|----------|
| `dashboard-v2/package.json` | @tiptap/extension-image 추가 |
| `dashboard-v2/src/components/MarkdownEditor/imageUpload.ts` | **신규** - 업로드 유틸리티 |
| `dashboard-v2/src/components/MarkdownEditor/extensions.ts` | Image extension 추가 |
| `dashboard-v2/src/components/MarkdownEditor/MarkdownEditor.tsx` | drop/paste 핸들러, taskId prop |
| `dashboard-v2/src/components/MarkdownEditor/SlashMenu.tsx` | /image 명령어 추가 |
| `dashboard-v2/src/components/MarkdownEditor/styles.css` | 이미지 스타일 |
| `dashboard-v2/src/features/tasks/components/TaskForm.tsx` | taskId, onAutoSave 전달 |

---

## Todo

### Step 1: 패키지 설치
- [ ] `npm install @tiptap/extension-image`

### Step 2: 이미지 업로드 유틸리티 생성
- [ ] `imageUpload.ts` 파일 생성
- [ ] `isImageFile()` 함수 구현
- [ ] `uploadImage()` 함수 구현

### Step 3: Tiptap Image Extension 추가
- [ ] `extensions.ts`에 Image extension import
- [ ] Image.configure() 설정 추가

### Step 4: MarkdownEditor Props 업데이트
- [ ] `taskId` prop 추가
- [ ] `onAutoSave` callback prop 추가

### Step 5: 드래그앤드롭 + 붙여넣기 핸들러
- [ ] `handleDrop` 이벤트 핸들러 구현
- [ ] `handlePaste` 이벤트 핸들러 구현
- [ ] 업로드 중 로딩 표시
- [ ] 에러 처리

### Step 6: `/image` 슬래시 명령어 추가
- [ ] SlashMenu에 Image 명령어 추가
- [ ] 파일 선택 다이얼로그 트리거 구현

### Step 7: 이미지 스타일 추가
- [ ] `.tiptap-image` 스타일 정의
- [ ] 선택 시 아웃라인 스타일

### Step 8: TaskForm 연동
- [ ] MarkdownEditor에 taskId 전달
- [ ] create 모드용 onAutoSave 핸들러 구현

---

## Verification

### 빌드 확인
```bash
cd ~/dev/loop/public/dashboard-v2 && npm run build
```

### 수동 테스트
1. 기존 Task 열기 → 이미지 드래그앤드롭 → 업로드 및 표시 확인
2. `/image` 입력 → 파일 선택 → 삽입 확인
3. 스크린샷 Cmd+V → 붙여넣기 확인
4. 새 Task 생성 → 이미지 드롭 → 자동 저장 후 업로드 확인
5. 저장 후 다시 열기 → 이미지 정상 표시 확인
6. 읽기 전용 모드에서 업로드 비활성화 확인

---

## Notes

Plan Mode에서 작성된 구현 계획 기반.
예상 작업량: 약 25 story points (3-5시간)

---

## Codex Review Summary (2026-01-09)

### Critical Issues (must address)

1. **Auto-save 실패 처리**
   - Task 생성 실패 시 업로드된 이미지 롤백 필요
   - 업로드 실패 시 Task 상태 복구 필요
   - **해결**: 업로드 실패 시 에러 메시지 표시, Task는 이미 저장된 상태 유지

2. **서버 측 보안 검증**
   - 기존 attachment API가 이미 서버 측 MIME/확장자 검증 수행 (`attachments.py:99-102`)
   - Auth/ACL은 Bearer token으로 보호됨 (`Authorization: Bearer`)
   - **확인됨**: 기존 API에서 이미 처리

3. **파일명 충돌**
   - 기존 API가 `get_unique_filename()` 으로 중복 처리 (`attachments.py:149-165`)
   - `filename.pdf` 존재 시 → `filename_1.pdf` 자동 생성
   - **확인됨**: 기존 API에서 이미 처리

### Medium Issues (address if time permits)

4. **웹 이미지 드롭/붙여넣기**
   - 결정: 로컬 파일만 지원, URL 이미지는 무시
   - 이유: 외부 URL은 보안 위험, CORS 문제

5. **업로드 중 UX**
   - 업로드 중: placeholder 이미지 표시 + progress bar
   - 실패 시: toast 에러 메시지
   - 취소: 지원 안 함 (MVP)

6. **Alt text**
   - MVP에서는 파일명을 alt로 자동 설정
   - 추후: 이미지 클릭 시 alt 편집 기능

### Deferred (out of scope for MVP)

- 이미지 삭제 시 attachment cleanup (수동 삭제 가능)
- 다국어 에러 메시지
- EXIF orientation 처리
- 동시 업로드 제한 (기존 API 제한 사용)
