---
entity_type: Task
entity_id: "tsk-023-29"
entity_name: "Dashboard - Program Drawer Delete 버튼 추가"
created: 2026-01-09
updated: 2026-01-09
status: doing

# === 계층 ===
parent_id: "prj-023"
project_id: "prj-023"
aliases: ["tsk-023-29"]

# === 관계 ===
outgoing_relations: []
validates: []
validated_by: []

# === Task 전용 ===
assignee: "김은향"
start_date: 2026-01-09
due: 2026-01-09
priority: medium
estimated_hours: null
actual_hours: null

# === Task 유형 (dev Task 연동용) ===
type: dev
target_project: loop

# === 분류 ===
tags: []
priority_flag: medium
---

# Dashboard - Program Drawer Delete 버튼 추가

> Task ID: `tsk-023-29` | Project: `prj-023` | Status: doing

## 목표

**완료 조건**:
1. Program drawer에 Delete 버튼이 표시됨
2. 하위 Project가 있으면 삭제 차단 (에러 메시지 표시)
3. 하위 Project가 없으면 삭제 성공 + drawer 닫힘

---

## 상세 내용

### 배경

- Task/Project drawer에는 Delete 버튼이 있으나 Program drawer에는 없음
- 백엔드에도 `DELETE /api/programs/{id}` 엔드포인트가 없음
- 사용자 요청으로 Program 삭제 기능 추가 필요

### 작업 내용

**백엔드 (FastAPI)**:
- `DELETE /api/programs/{program_id}` 엔드포인트 추가
- 하위 Projects 확인 → 있으면 400 에러 반환
- 파일/폴더 삭제 + 캐시 업데이트 + 감사 로그

**프론트엔드 (React)**:
- `api.ts`: deleteProgram 함수 추가
- `queries.ts`: useDeleteProgram mutation hook 추가
- `EntityDrawer.tsx`: handleDelete에 program case 추가, renderFooter 조건 수정

---

## 체크리스트

- [ ] 백엔드: DELETE /api/programs/{id} 엔드포인트 추가
- [ ] 프론트엔드: api.ts에 deleteProgram 함수 추가
- [ ] 프론트엔드: queries.ts에 useDeleteProgram hook 추가
- [ ] 프론트엔드: EntityDrawer.tsx 수정 (handleDelete + renderFooter)
- [ ] 테스트: 하위 Project 없는 Program 삭제 성공 확인
- [ ] 테스트: 하위 Project 있는 Program 삭제 차단 확인

---

## Notes

### Tech Spec

#### 1. 백엔드 - DELETE 엔드포인트 추가
**파일**: `public/api/routers/programs.py`

```python
@router.delete("/{program_id}")
def delete_program(program_id: str):
    """Program 삭제 (하위 Project 있으면 차단)"""
    cache = get_cache()
    program = cache.get_program(program_id)

    if not program:
        raise HTTPException(404, f"Program not found: {program_id}")

    # 하위 Projects 확인
    projects = cache.get_all_projects()
    child_projects = [p for p in projects if p.get("program_id") == program_id]

    if child_projects:
        raise HTTPException(400,
            f"Cannot delete: {len(child_projects)} projects linked. Delete them first.")

    # 파일 삭제
    file_path = program.get("_file_path")
    # ... 파일 및 폴더 삭제 로직

    # 캐시 업데이트
    cache.remove_program(program_id)

    # 감사 로그
    log_entity_action("delete", "Program", program_id, ...)
```

#### 2. 프론트엔드 - API 함수 추가
**파일**: `public/dashboard-v2/src/features/programs/api.ts`

```typescript
deleteProgram: (id: string) =>
    httpClient.delete<{ success: boolean; message: string }>(`/api/programs/${id}`),
```

#### 3. 프론트엔드 - Mutation Hook 추가
**파일**: `public/dashboard-v2/src/features/programs/queries.ts`

```typescript
export const useDeleteProgram = () => {
  const queryClient = useQueryClient();
  return useMutation({
    mutationFn: (id: string) => programApi.deleteProgram(id),
    onSuccess: (_data, id) => {
      queryClient.removeQueries({ queryKey: queryKeys.program(id) });
      queryClient.invalidateQueries({ queryKey: queryKeys.dashboardInit });
      queryClient.invalidateQueries({ queryKey: queryKeys.programs() });
    },
  });
};
```

#### 4. 프론트엔드 - EntityDrawer 수정
**파일**: `public/dashboard-v2/src/components/layout/EntityDrawer.tsx`

**4.1 Import 추가**
```typescript
import { useDeleteProgram } from '@/features/programs/queries';
```

**4.2 Hook 호출 추가**
```typescript
const { mutate: deleteProgram } = useDeleteProgram();
```

**4.3 handleDelete에 program case 추가**
```typescript
else if (type === 'program') {
  if (window.confirm(`Are you sure you want to delete program ${id}?\nThis cannot be undone.`)) {
    deleteProgram(id, {
      onSuccess: () => closeEntityDrawer(),
      onError: (err) => alert(err.message)  // 하위 Project 있을 때 에러 표시
    });
  }
}
```

**4.4 renderFooter 조건 수정**
```typescript
// 변경 전
if (type !== 'task' && type !== 'project') return undefined;

// 변경 후
if (type !== 'task' && type !== 'project' && type !== 'program') return undefined;
```

### Todo
- [ ] 백엔드 DELETE 엔드포인트 구현
- [ ] 프론트엔드 API + hook + UI 구현
- [ ] 테스트 실행

### 작업 로그


---

## 참고 문서

- [[prj-023]] - 소속 Project
- Plan: `/Users/gim-eunhyang/.claude/plans/cached-hopping-kettle.md`

---

**Created**: 2026-01-09
**Assignee**: 김은향
**Due**: 2026-01-09
