---
entity_type: Task
entity_id: "tsk-40ao11-1767935128563"
entity_name: "Dashboard - Links + Attachments 기능 구현"
created: 2026-01-09
updated: 2026-01-09
status: done
closed: 2026-01-09

# === 계층 ===
parent_id: "prj-023"
project_id: "prj-023"
aliases: ["tsk-40ao11-1767935128563", "tsk-023-40"]

# === 관계 ===
outgoing_relations: []
validates: []
validated_by: []

# === Task 전용 ===
assignee: "김은향"
start_date: 2026-01-09
due: 2026-01-09
priority: medium
estimated_hours: null
actual_hours: null

# === Task 유형 (dev Task 연동용) ===
type: dev
target_project: loop

# === 분류 ===
tags: []
priority_flag: medium
---

# Dashboard - Links + Attachments 기능 구현

> Task ID: `tsk-40ao11-1767935128563` | Project: `prj-023` | Status: done

## 목표

**완료 조건**:
1. Task 엔티티에 Links 배열 필드 추가 (label + url)
2. Task 엔티티에 Attachments 배열 필드 추가 (filename + file_path + text_content)
3. Task Detail 화면에서 Links 편집 UI 구현
4. Task Detail 화면에서 Attachments 업로드/조회 UI 구현
5. 빌드 성공 및 Codex 리뷰 통과

---

## 상세 내용

### 배경

Dashboard v2 마이그레이션 과정에서 Task 엔티티에 외부 링크 및 첨부파일 관리 기능이 필요함. 레거시 대시보드에는 있던 기능이나 React+TS 버전에서는 누락되어 있었음.

### 작업 내용

1. **타입 정의 확장** (`src/types/entities.ts`)
   - Task 인터페이스에 `links`, `attachments` 필드 추가
   - Link, Attachment 타입 정의

2. **API 확장** (`src/features/tasks/api.ts`)
   - `uploadAttachment()` - 파일 업로드 (FormData)
   - `deleteAttachment()` - 첨부파일 삭제
   - `extractAttachmentText()` - 텍스트 추출

3. **React Query Hooks** (`src/features/tasks/queries/`)
   - `useUploadAttachment` - 업로드 mutation
   - `useDeleteAttachment` - 삭제 mutation
   - `queryKeys.ts` 업데이트

4. **UI 컴포넌트 구현**
   - `LinkEditor.tsx` - 링크 추가/편집/삭제 UI (인라인 입력)
   - `AttachmentPanel.tsx` - 파일 업로드/목록 컨테이너
   - `AttachmentItem.tsx` - 개별 첨부파일 카드 (텍스트 추출 버튼 포함)

5. **TaskForm 통합** (`src/features/tasks/components/TaskForm.tsx`)
   - Links 섹션 추가 (LinkEditor 컴포넌트 연결)
   - Attachments 섹션 추가 (AttachmentPanel 컴포넌트 연결)

---

## 체크리스트

- [x] Task 타입에 links/attachments 필드 추가
- [x] API 함수 구현 (upload, delete, extract)
- [x] React Query hooks 구현
- [x] LinkEditor 컴포넌트 구현
- [x] AttachmentPanel/AttachmentItem 컴포넌트 구현
- [x] TaskForm에 UI 통합
- [x] Codex 리뷰 통과 (5개 이슈 수정)
- [x] 빌드 성공 확인

---

## Notes

### 작업 로그

#### 2026-01-09 14:30
**개요**: Task Detail에 Links + Attachments 기능 구현 완료. 외부 링크 관리 및 파일 업로드/텍스트 추출 기능 추가.

**변경사항**:
- **개발**: 3개 컴포넌트 신규 생성
  - `LinkEditor.tsx` (58 lines) - 인라인 링크 편집 UI
  - `AttachmentPanel.tsx` (72 lines) - 파일 업로드 컨테이너
  - `AttachmentItem.tsx` (95 lines) - 첨부파일 카드 (텍스트 추출 버튼)
- **수정**: 5개 파일 수정
  - `types/entities.ts` - Link, Attachment 타입 추가
  - `tasks/api.ts` - uploadAttachment, deleteAttachment, extractAttachmentText 함수 추가
  - `tasks/queries/index.ts` - useUploadAttachment, useDeleteAttachment hooks
  - `tasks/queries/queryKeys.ts` - attachments 키 추가
  - `TaskForm.tsx` - Links/Attachments 섹션 통합
- **개선**: Codex 리뷰 5개 이슈 수정
  1. LinkEditor - URL validation 개선
  2. AttachmentPanel - 에러 핸들링 추가
  3. AttachmentItem - 삭제 확인 다이얼로그 추가
  4. TaskForm - Links/Attachments 저장 로직 통합
  5. api.ts - 에러 응답 타입 명시

**파일 변경**:
- `src/types/entities.ts` - Link, Attachment 타입 정의
- `src/features/tasks/api.ts` - 첨부파일 API 3개 함수 추가
- `src/features/tasks/queries/index.ts` - mutation hooks 2개 추가
- `src/features/tasks/queries/queryKeys.ts` - attachments 키 추가
- `src/features/tasks/components/LinkEditor.tsx` - 신규 생성
- `src/features/tasks/components/AttachmentPanel.tsx` - 신규 생성
- `src/features/tasks/components/AttachmentItem.tsx` - 신규 생성
- `src/features/tasks/components/TaskForm.tsx` - Links/Attachments UI 통합

**핵심 코드**:

```typescript
// types/entities.ts - 타입 정의
export interface Link {
  label: string;
  url: string;
}

export interface Attachment {
  filename: string;
  file_path: string;
  uploaded_at?: string;
  text_content?: string | null;
}

export interface Task {
  // ... 기존 필드
  links?: Link[];
  attachments?: Attachment[];
}
```

```typescript
// tasks/api.ts - 업로드 API
export async function uploadAttachment(
  taskId: string,
  file: File
): Promise<Attachment> {
  const formData = new FormData();
  formData.append('file', file);

  const response = await fetch(`${API_URL}/api/tasks/${taskId}/attachments`, {
    method: 'POST',
    body: formData,
  });

  if (!response.ok) throw new Error('Upload failed');
  return response.json();
}
```

```tsx
// LinkEditor.tsx - 인라인 링크 편집
export function LinkEditor({ links, onChange }: LinkEditorProps) {
  const [newLink, setNewLink] = useState({ label: '', url: '' });

  const handleAdd = () => {
    if (!newLink.label || !newLink.url) return;
    onChange([...(links || []), newLink]);
    setNewLink({ label: '', url: '' });
  };

  return (
    <div className="space-y-2">
      {links?.map((link, idx) => (
        <div key={idx} className="flex items-center gap-2">
          <a href={link.url} target="_blank" rel="noopener noreferrer">
            {link.label}
          </a>
          <button onClick={() => handleDelete(idx)}>삭제</button>
        </div>
      ))}
      <div className="flex gap-2">
        <input
          placeholder="Label"
          value={newLink.label}
          onChange={(e) => setNewLink(prev => ({ ...prev, label: e.target.value }))}
        />
        <input
          placeholder="URL"
          value={newLink.url}
          onChange={(e) => setNewLink(prev => ({ ...prev, url: e.target.value }))}
        />
        <button onClick={handleAdd}>추가</button>
      </div>
    </div>
  );
}
```

**결과**: ✅ 빌드 성공 (470 modules, 0 errors)

**Codex 리뷰 결과**:
- 5개 이슈 식별 및 모두 수정 완료
- Critical 이슈: 0개
- Medium 이슈: 5개 (모두 수정)

**다음 단계**:
- Task 상태 업데이트 완료 (done)
- LOOP Vault 동기화 대기 (NAS Git sync)

---

## 참고 문서

- [[prj-023]] - Dashboard - React+TS 마이그레이션
- API Spec: `/api/tasks/{id}/attachments`

---

**Created**: 2026-01-09
**Assignee**: 김은향
**Completed**: 2026-01-09
