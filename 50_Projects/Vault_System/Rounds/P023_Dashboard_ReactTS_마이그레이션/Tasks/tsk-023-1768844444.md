---
entity_type: Task
entity_id: tsk-023-1768844444
entity_name: Strategic Context MCP Action 노출
parent_id: prj-023
status: done
assignee: 김은향
type: dev
created: 2026-01-20
updated: 2026-01-20
---

# Strategic Context MCP Action 노출

## Notes

### Summary
`normalize_strategic_context`를 포함한 Strategic Context API를 MCP action으로 노출. Project와 Task의 Strategic Context + Ontology Lite 그래프를 MCP 엔드포인트로 제공.

### Changes Made
- `api/routers/mcp_composite.py`: strategic-context 엔드포인트 2개 추가 (+168 lines)
  - `GET /api/mcp/project/{project_id}/strategic-context`
  - `GET /api/mcp/task/{task_id}/strategic-context`
- `api/main.py`: MCP_ALLOWED_OPERATIONS에 operation 2개 등록 (+3 lines)

### Plan
# Plan: Strategic Context MCP Action 노출

## 목표
`normalize_strategic_context`를 포함한 Strategic Context API를 MCP action으로 노출

## 수정 파일

### 1. `code/api/routers/mcp_composite.py`
두 개의 엔드포인트 추가 (line ~1000 이후):

```python
@router.get("/project/{project_id}/strategic-context")
async def get_project_strategic_context(project_id: str):
    """Project의 Strategic Context + Ontology Lite 그래프"""

@router.get("/task/{task_id}/strategic-context")
async def get_task_strategic_context(task_id: str):
    """Task의 Strategic Context + Ontology Lite 그래프"""
```

**응답 구조**:
```json
{
  "context": "마크다운 포맷 텍스트",
  "raw": { "project/task, track, conditions, hypotheses, ..." },
  "graph": { "nodes": [...], "edges": [...], "diagnostics": {...} }
}
```

### 2. `code/api/main.py`
MCP_ALLOWED_OPERATIONS 리스트에 추가 (line 381-418):

```python
# Strategic Context (normalize_strategic_context 포함)
"get_project_strategic_context_api_mcp_project__project_id__strategic_context_get",
"get_task_strategic_context_api_mcp_task__task_id__strategic_context_get",
```

## 구현 세부사항

기존 `/api/projects/{id}/strategic-context`, `/api/tasks/{id}/strategic-context` 로직을 MCP composite 패턴으로 래핑:

1. cache에서 project/task 조회
2. 상위 엔티티 수집 (track, conditions, hypotheses, northstar, metahypotheses)
3. `build_strategic_context()` → 마크다운 텍스트
4. `normalize_strategic_context()` → nodes/edges 그래프

## 검증

```bash
# 로컬 API 서버 실행
cd ~/dev/loop/code && poetry run uvicorn api.main:app --reload --port 8081

# 엔드포인트 테스트
curl http://localhost:8081/api/mcp/project/prj-023/strategic-context | jq '.graph.nodes | length'
curl http://localhost:8081/api/mcp/task/tsk-023-01/strategic-context | jq '.graph.edges'

# MCP action 노출 확인
curl http://localhost:8081/mcp | jq '.tools[] | select(.name | contains("strategic"))'
```
