---
entity_type: Task
entity_id: tsk-023-1768201736397
entity_name: Quick Create Task - 자연어 AI prefill
created: '2026-01-12'
updated: '2026-01-12'
status: done
project_id: prj-023
parent_id: prj-023
assignee: 김은향
priority: medium
start_date: '2026-01-12'
due: '2026-01-12'
closed: '2026-01-12'
aliases:
- tsk-023-1768201736397
tags: []
type: dev
---

# Quick Create Task - 자연어 AI prefill

## 설명

Quick Create Task에 자연어 AI prefill 기능 추가. 사용자가 "로그인 버그 수정, 김철수, 높은 우선순위, 내일까지"처럼 자연어로 입력하면 TaskForm의 모든 필드를 자동으로 채워줍니다.

## 아키텍처 도식

```
┌─────────────────────────────────────────────────────────────┐
│ Quick Create Task with AI Prefill Architecture              │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  [1] UI Layer (src/features/tasks/components/)              │
│      ┌──────────────────────────────────────────┐           │
│      │ TaskForm.tsx (Create Mode)               │           │
│      │  ├─ AI Input Textarea (NEW)              │           │
│      │  │   └─ "Type natural language..."       │           │
│      │  ├─ Parse Button (NEW)                   │           │
│      │  └─ Existing Form Fields                 │           │
│      │      (prefilled after AI parse)          │           │
│      └──────────────────────────────────────────┘           │
│                       │                                      │
│                       ↓ (AI Parse Button Click)             │
│                                                              │
│  [2] API Layer (src/features/tasks/api.ts)                  │
│      ┌──────────────────────────────────────────┐           │
│      │ parseTaskNaturalLanguage()               │           │
│      │   POST /api/tasks/parse-nl               │           │
│      │   Body: { text: string }                 │           │
│      │   Returns: Partial<Task>                 │           │
│      └──────────────────────────────────────────┘           │
│                       │                                      │
│                       ↓ (HTTP Request)                       │
│                                                              │
│  [3] Backend (FastAPI)                                      │
│      ┌──────────────────────────────────────────┐           │
│      │ POST /api/tasks/parse-nl                 │           │
│      │   ├─ Call Claude API (Sonnet 4.5)       │           │
│      │   ├─ Structured prompt with schema       │           │
│      │   └─ Parse response → Task fields        │           │
│      └──────────────────────────────────────────┘           │
│                       │                                      │
│                       ↓ (Return parsed fields)               │
│                                                              │
│  [4] Form Prefill (TaskForm.tsx)                            │
│      ┌──────────────────────────────────────────┐           │
│      │ setCreateFormData(parsedData)            │           │
│      │   ├─ entity_name                         │           │
│      │   ├─ assignee                            │           │
│      │   ├─ priority                            │           │
│      │   ├─ due                                 │           │
│      │   └─ notes (optional)                    │           │
│      └──────────────────────────────────────────┘           │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

## 프로젝트 컨텍스트

- **Framework**: React 19 + TypeScript
- **Architecture**: Feature-based (Dashboard V2 Architecture)
- **State**: React Query + Local State
- **HTTP Client**: Axios (src/services/http.ts)
- **Backend**: FastAPI (existing)

## 구현 범위

### [1] UI Layer - TaskForm.tsx (Create Mode)

**위치**: `src/features/tasks/components/TaskForm.tsx`

**목적**: 자연어 입력 UI 추가 및 파싱 결과 반영

**구현**:
- Create mode 상단에 AI Input 섹션 추가
  - Textarea: "로그인 버그 수정, 김철수, 높은 우선순위, 내일까지"
  - Parse Button: "AI로 채우기" (또는 "Parse")
  - Loading state 표시
  - Error handling (API 실패 시 메시지)
- Parse 성공 시 `setCreateFormData()`로 폼 필드 자동 채우기
- 사용자는 자동 채워진 값을 수정 가능 (기존 폼 유지)

**예상 코드 위치**: Line 356 (Create mode 시작 직후)

---

### [2] API Layer - tasks/api.ts

**위치**: `src/features/tasks/api.ts`

**목적**: 자연어 파싱 API 호출 함수

**구현**:
```typescript
export const parseTaskNaturalLanguage = async (text: string): Promise<Partial<Task>> => {
  const response = await httpClient.post<Partial<Task>>('/api/tasks/parse-nl', { text });
  return response.data;
};
```

---

### [3] React Query Hook (NEW)

**위치**: `src/features/tasks/queries.ts` (또는 별도 파일)

**목적**: 파싱 API 호출용 mutation hook

**구현**:
```typescript
export const useParseTaskNL = () => {
  return useMutation({
    mutationFn: (text: string) => parseTaskNaturalLanguage(text),
    // onSuccess/onError는 TaskForm에서 처리
  });
};
```

---

### [4] Backend - FastAPI Endpoint (NEW)

**위치**: Backend API (FastAPI router)

**목적**: Claude API 호출하여 자연어 파싱

**구현**:
- Endpoint: `POST /api/tasks/parse-nl`
- Request Body: `{ "text": string }`
- Response: `Partial<Task>` (JSON)
- Claude API 호출 (Sonnet 4.5 권장)
- Structured prompt:
  - 입력 텍스트 분석
  - Task 스키마 기반 필드 추출
  - 날짜 파싱 (오늘, 내일, 2026-01-15 등)
  - 담당자 이름 매칭 (members 리스트 참조)
  - Priority 키워드 매칭 (높은 → high, 긴급 → critical)
- Error handling (Claude API 실패, timeout 등)

---

### [5] Types (필요 시 확장)

**위치**: `src/types/index.ts` (또는 tasks/types.ts)

**목적**: API 요청/응답 타입 정의

**구현**:
```typescript
export interface ParseTaskNLRequest {
  text: string;
}

export interface ParseTaskNLResponse extends Partial<Task> {
  // Task 필드 중 일부만 반환 가능
}
```

---

## 성공 기준

- [ ] 자연어 입력 UI가 TaskForm Create mode에 표시됨
- [ ] "AI로 채우기" 버튼 클릭 시 API 호출
- [ ] 파싱 결과가 폼 필드에 자동 반영됨 (entity_name, assignee, priority, due 등)
- [ ] 사용자가 자동 채워진 값을 수정 가능
- [ ] API 에러 시 사용자에게 메시지 표시
- [ ] 기존 TaskForm 기능 유지 (템플릿, 수동 입력 등)
- [ ] Dashboard V2 아키텍처 규칙 준수 (SSOT, feature 구조)
- [ ] `npm run build` 통과
- [ ] TypeScript 에러 없음

---

## 확인 사항

1. **Claude API Key**: Backend에서 Claude API 호출 가능한가? (환경변수 설정 필요)
2. **Members 데이터**: 담당자 이름 매칭을 위해 members 리스트를 Claude에 제공할 것인가?
3. **날짜 파싱**: 상대 날짜(오늘, 내일) vs 절대 날짜(2026-01-15) 모두 지원?
4. **프로젝트 선택**: 자연어에서 프로젝트까지 파싱할 것인가? (현재 PRD에는 제외)
5. **UX 개선**: Parse 버튼 vs 자동 파싱 (debounce) 중 선택?

---

## 체크리스트

### Backend
- [ ] POST /api/tasks/parse-nl 엔드포인트 생성
- [ ] Claude API 통합 (Sonnet 4.5)
- [ ] Structured prompt 작성 (Task schema 기반)
- [ ] 날짜 파싱 로직 (상대/절대)
- [ ] 담당자 이름 매칭 (members 참조)
- [ ] Priority 키워드 매칭
- [ ] Error handling (Claude API 실패)

### Frontend
- [ ] TaskForm.tsx에 AI Input 섹션 추가
- [ ] parseTaskNaturalLanguage() API 함수 작성
- [ ] useParseTaskNL() mutation hook 작성
- [ ] Parse 버튼 클릭 → API 호출 → 폼 채우기 플로우
- [ ] Loading state UI
- [ ] Error message UI
- [ ] TypeScript 타입 정의

### Testing
- [ ] 자연어 파싱 정확도 테스트 (10+ 샘플)
- [ ] Edge case (빈 입력, 이상한 텍스트)
- [ ] 날짜 파싱 정확도
- [ ] 담당자 이름 매칭 정확도

### Build & Review
- [ ] npm run build 통과
- [ ] Codex code review
- [ ] Dashboard V2 아키텍처 규칙 체크

---

## 참고

### 예시 자연어 입력

- "로그인 버그 수정, 김철수, 높은 우선순위, 내일까지"
- "대시보드 성능 개선 작업, 김은향, critical, 2026-01-15"
- "회의록 작성, 미정, low, 이번 주 금요일"

### 파싱 결과 예시

```json
{
  "entity_name": "로그인 버그 수정",
  "assignee": "김철수",
  "priority": "high",
  "due": "2026-01-13",
  "type": "bug"
}
```

---

## Execution Log

### 2026-01-12 - Implementation Complete

**Status**: ✅ Implementation completed and build successful

**Implemented Components**:

1. **Backend - FastAPI Endpoint** (`/api/tasks/parse-nl`)
   - Location: `/Users/gim-eunhyang/dev/loop/public/api/routers/tasks.py`
   - Lines: 550-691
   - Features:
     - LLM integration using `LLMService` with Claude Sonnet 4.5
     - Structured prompt with Task schema, member list, and keyword mappings
     - Date parsing (relative dates: 오늘, 내일, today, tomorrow)
     - Priority/Type keyword matching (Korean + English)
     - Member name matching with validation
     - Field validation and normalization
     - Run logging for audit trail

2. **Frontend - API Client** (`src/features/tasks/api.ts`)
   - Added `parseNaturalLanguage()` function
   - Returns parsed fields as `Partial<Task>`

3. **Frontend - React Query Hook** (`src/features/tasks/queries.ts`)
   - Added `useParseTaskNL()` mutation hook
   - Integrates with React Query for caching and state management

4. **Frontend - TaskForm UI** (`src/features/tasks/components/TaskForm.tsx`)
   - AI Natural Language Input section added at top of Create mode
   - Features:
     - Textarea for natural language input
     - "AI Fill" button with loading state
     - Cmd+Enter keyboard shortcut support
     - Success/error toast notifications
     - Auto-clear input after successful parse
     - Example hint text
     - Blue-themed UI to distinguish from regular form
   - Handler function `handleParseLLM()` with:
     - Field filtering (only non-null values)
     - Type-safe state updates
     - Toast feedback

**Build Status**:
- ✅ `npm run build` passed successfully
- ✅ No TypeScript errors
- ✅ All Dashboard V2 architecture rules followed:
  - Backend endpoint in `api/routers/tasks.py`
  - API client in `features/tasks/api.ts`
  - React Query hook in `features/tasks/queries.ts`
  - Feature-specific UI in `features/tasks/components/`
  - SSOT maintained (constants from API)

**Files Modified**:
1. `/Users/gim-eunhyang/dev/loop/public/api/routers/tasks.py` (+142 lines)
2. `/Users/gim-eunhyang/dev/loop/public/dashboard-v2/src/features/tasks/api.ts` (+7 lines)
3. `/Users/gim-eunhyang/dev/loop/public/dashboard-v2/src/features/tasks/queries.ts` (+5 lines)
4. `/Users/gim-eunhyang/dev/loop/public/dashboard-v2/src/features/tasks/components/TaskForm.tsx` (+41 lines UI, +28 lines handler)

**Architecture Compliance**:
- ✅ No direct LLM calls in frontend
- ✅ Backend handles all AI logic
- ✅ Proper error handling and user feedback
- ✅ Type safety maintained
- ✅ Feature-based structure preserved
- ✅ No common component pollution

**Next Steps**:
1. Deploy to staging for testing
2. Test with real natural language inputs
3. Monitor LLM parsing accuracy
4. Collect user feedback on UX
5. Consider adding auto-parse on blur (optional enhancement)

**Ready for**: `/done-dev-task tsk-023-1768201736397` (LOOP Vault - no PR needed)
