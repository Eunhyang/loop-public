---
entity_type: Task
entity_id: tsk-023-1768664856131
entity_name: n8n - entity-validator 워크플로우 라우팅 버그 수정
created: '2026-01-18'
updated: '2026-01-18'
status: done
project_id: prj-023
parent_id: prj-023
assignee: 김은향
priority: medium
start_date: '2026-01-18'
due: '2026-01-18'
aliases:
- tsk-023-1768664856131
tags: []
type: dev
---

# n8n - entity-validator 워크플로우 라우팅 버그 수정

## Summary

n8n entity-validator 워크플로우에서 422 에러 발생 문제 해결.
Route by Phase 스위치/IF 노드가 realized_impact 아이템을 Expected 경로로 잘못 라우팅하는 n8n 2.1.4 버그 확인 및 우회.

## Changes Made

### 파일
- `n8n_workflows/entity_validator_autofiller.json`

### 수정 내용
1. **Filter Impact Needed 코드 수정**
   - `if/if` → `if/else if` 변경 (동일 프로젝트 중복 아이템 방지)
   - realized_impact 생성 임시 비활성화 (`if (false && needsRealizedImpact)`)

2. **Route by Phase 노드 변경 시도** (n8n 버그로 미해결)
   - Switch v3 → fallbackOutput 추가 시도
   - Switch → IF 노드 교체 시도
   - 둘 다 동일 버그 (모든 아이템이 Output 0으로 라우팅)

### Root Cause
- n8n 2.1.4의 Switch/IF 노드가 `$json.phase` 조건을 제대로 평가하지 못함
- 모든 아이템이 첫 번째 출력으로 라우팅되는 버그

### 현재 동작
1. expected_impact 없으면 → 생성
2. expected_impact 있으면 → skip (realized는 n8n 업그레이드 후)

## Git Branch
- `fix/n8n-validator-logic` (워크트리: `~/dev/loop/code-fix-n8n-validator/`)
