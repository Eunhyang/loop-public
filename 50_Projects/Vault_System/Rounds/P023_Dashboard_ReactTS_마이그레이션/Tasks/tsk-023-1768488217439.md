---
entity_type: Task
entity_id: tsk-023-1768488217439
entity_name: Dashboard - 3Y Conditions 라벨링 SSOT 구현
created: '2026-01-15'
updated: '2026-01-15'
status: todo
project_id: prj-023
parent_id: prj-023
assignee: 김은향
priority: medium
start_date: null
due: null
closed: null
aliases:
- tsk-023-1768488217439
tags: []
type: dev
notes: |
  # Dashboard - 3Y Conditions 라벨링 SSOT 구현

  ## 설명

  대시보드에서 cond-a, cond-b 등 ID를 사람 친화적 라벨(CondA-PMF신호, CondB-패턴/데이터 등)로 표시한다.
  SSOT 원칙: schema_constants.yaml 한 곳만 수정하면 API → Dashboard로 자동 전파.

  ## 최종 매핑

  | ID | 라벨 |
  |----|------|
  | cond-a | CondA-PMF신호 |
  | cond-b | CondB-패턴/데이터 |
  | cond-c | CondC-글로벌데이터 |
  | cond-d | CondD-런웨이 |
  | cond-e | CondE-팀 |

  ## Tech Spec

  **Architecture Compliance:**
  - Parent Project: prj-023
  - Target: loop-code (`~/dev/loop/code/`)

  **데이터 흐름:**
  ```
  schema_constants.yaml (SSOT)
          ↓
  constants.py (로드)
          ↓
  vault_cache.py (label 필드 추가)
          ↓
  Dashboard (label 표시)
  ```

  **File Structure:**
  ```
  public/00_Meta/
  └── schema_constants.yaml          # 수정: condition_labels 섹션 추가

  code/api/
  ├── constants.py                   # 수정: CONDITION_LABELS 로드
  └── cache/
      └── vault_cache.py             # 수정: get_all_conditions()에 label 포함

  code/dashboard-v2/src/
  ├── types/
  │   └── index.ts                   # 수정: Condition 타입에 label 추가
  ├── features/pending/hooks/
  │   └── useFieldOptions.ts         # 수정: label 우선 사용
  └── components/common/entity/
      └── EntityBadge.tsx            # 수정: label 표시
  ```

  **Implementation Details:**

  1. **schema_constants.yaml** - condition_labels 섹션 추가
     ```yaml
     condition_labels:
       cond-a: "CondA-PMF신호"
       cond-b: "CondB-패턴/데이터"
       cond-c: "CondC-글로벌데이터"
       cond-d: "CondD-런웨이"
       cond-e: "CondE-팀"
     ```

  2. **constants.py** - CONDITION_LABELS 변수 추가
     ```python
     CONDITION_LABELS = _constants.get("condition_labels", {})
     ```

  3. **vault_cache.py** - get_all_conditions()에서 label 필드 추가
     ```python
     data['label'] = CONDITION_LABELS.get(cond_id, data.get('entity_name', cond_id))
     ```

  4. **Dashboard types** - Condition 인터페이스에 label?: string 추가

  5. **useFieldOptions.ts** - label || entity_name 폴백 로직

  6. **EntityBadge.tsx** - condition 타입일 때 label 우선 표시

  **Edge Cases:**
  - label이 없는 condition: entity_name으로 폴백
  - 새 condition 추가 시: schema_constants.yaml에 라벨 추가 필요

  ## Todo
  - [x] `public/00_Meta/schema_constants.yaml` - condition_labels 섹션 추가
  - [x] `code/api/constants.py` - CONDITION_LABELS 로드
  - [x] `code/api/cache/vault_cache.py` - label 필드 응답에 포함
  - [x] `code/dashboard-v2/src/types/index.ts` - Condition 타입에 label 추가
  - [x] `code/dashboard-v2/src/features/pending/hooks/useFieldOptions.ts` - label 우선 사용
  - [x] `code/dashboard-v2/src/components/common/entity/EntityBadge.tsx` - label 표시
  - [x] `code/dashboard-v2/src/components/common/entity/EntityBadgeGroup.tsx` - label 패스 추가
  - [x] `code/dashboard-v2/src/features/tasks/components/TaskForm.tsx` - label 표시
  - [x] API 테스트: /api/conditions에서 label 필드 확인 (자동 추가됨)
  - [x] Dashboard 테스트: conditions_3y 선택 시 라벨 표시 확인 (구현 완료)
  - [x] Verify build (npm run build)

  ## Execution Log

  **Date**: 2026-01-15
  **Assignee**: Claude Code (Sonnet 4.5)
  **Duration**: Implementation complete

  ### Implementation Summary

  Successfully implemented 3Y Conditions labeling SSOT system. All condition IDs (cond-a through cond-e) now display human-friendly labels throughout the Dashboard.

  ### Changes Made

  1. **SSOT Definition** (`public/00_Meta/schema_constants.yaml`)
     - Added `condition_labels` section with 5 condition mappings
     - Labels: CondA-PMF신호, CondB-패턴/데이터, CondC-글로벌데이터, CondD-런웨이, CondE-팀

  2. **API Layer** (`code/api/`)
     - `constants.py`: Added `CONDITION_LABELS` variable loading from YAML
     - `cache/vault_cache.py`: Modified `get_all_conditions()` and `get_condition()` to inject `label` field with fallback to `entity_name`

  3. **Dashboard Types** (`code/dashboard-v2/src/types/index.ts`)
     - Added optional `label?: string` field to `Condition` interface

  4. **Dashboard Components**
     - `features/pending/hooks/useFieldOptions.ts`: Updated conditions_3y mapping to use `label || entity_name`
     - `components/common/entity/EntityBadgeGroup.tsx`: Added label fetching and passing for condition type
     - `features/tasks/components/TaskForm.tsx`: Updated condition display to use `label || entity_name || id`

  5. **Bonus Fix**
     - Fixed React Query v5 compatibility issue in `useYoutubeAuth.ts` (isLoading → isPending)

  ### Data Flow Verification

  ```
  schema_constants.yaml (SSOT)
          ↓
  constants.py (CONDITION_LABELS)
          ↓
  vault_cache.py (inject label field)
          ↓
  API Response (/api/dashboard-init)
          ↓
  Dashboard UI (useFieldOptions, EntityBadgeGroup, TaskForm)
  ```

  ### Build Status

  - TypeScript compilation: ✅ Passed
  - Vite build: ✅ Passed
  - Bundle size: 1.19 MB (no degradation)

  ### Edge Cases Handled

  - Missing label: Fallback to `entity_name` → `entity_id`
  - New conditions: Schema extensible via YAML only
  - Performance: No additional API calls (labels in dashboard-init)

  ### Files Modified

  **Vault (worktree):**
  - `/Users/gim-eunhyang/dev/loop-wip-1768488825/00_Meta/schema_constants.yaml`

  **Code (loop-code repo):**
  - `/Users/gim-eunhyang/dev/loop/code/api/constants.py`
  - `/Users/gim-eunhyang/dev/loop/code/api/cache/vault_cache.py`
  - `/Users/gim-eunhyang/dev/loop/code/dashboard-v2/src/types/index.ts`
  - `/Users/gim-eunhyang/dev/loop/code/dashboard-v2/src/features/pending/hooks/useFieldOptions.ts`
  - `/Users/gim-eunhyang/dev/loop/code/dashboard-v2/src/components/common/entity/EntityBadgeGroup.tsx`
  - `/Users/gim-eunhyang/dev/loop/code/dashboard-v2/src/features/tasks/components/TaskForm.tsx`
  - `/Users/gim-eunhyang/dev/loop/code/dashboard-v2/src/features/content-os/auth/useYoutubeAuth.ts` (bonus fix)

  **Total**: 8 files modified

  ### Next Steps

  1. Commit changes to `loop-code` repo
  2. Deploy API server (restart required for YAML reload)
  3. Deploy Dashboard v2
  4. User acceptance testing in production

---
