---
entity_type: Task
entity_id: "tsk-023-23"
entity_name: "Dashboard - TaskDrawer Notes 표시 버그 수정"
created: 2026-01-08
updated: 2026-01-08
status: done
closed: 2026-01-08

# === 계층 ===
parent_id: "prj-023"
project_id: "prj-023"
aliases: ["tsk-023-23"]

# === 관계 ===
outgoing_relations: []
validates: []
validated_by: []

# === Task 전용 ===
assignee: "김은향"
start_date: 2026-01-08
due: 2026-01-08
priority: high
estimated_hours: null
actual_hours: null

# === Task 유형 (dev Task 연동용) ===
type: dev
target_project: loop

# === 분류 ===
tags: ["dashboard", "bugfix", "taskform", "notes"]
priority_flag: high
---

# Dashboard - TaskDrawer Notes 표시 버그 수정

> Task ID: `tsk-023-23` | Project: `prj-023` | Status: done

## 목표

**완료 조건**:
1. TaskDrawer에서 markdown body 내용이 Notes 섹션에 표시됨
2. `notes` 필드와 `_body` 필드 모두 fallback 지원
3. 빌드 성공 + tsk-023-09 등 기존 Task에서 body 표시 확인

---

## 상세 내용

### 배경

TaskDrawer에서 Notes가 표시되지 않는 버그 발생. 원인 분석 결과:

**문제 원인:**
- API는 markdown body를 `_body` 필드로 반환
- TaskForm은 `notes` 필드만 확인
- 대부분의 기존 Task는 frontmatter에 `notes` 필드 없이 body에 내용 작성

### 작업 내용

**수정 파일:**
- `public/dashboard-v2/src/features/tasks/components/TaskForm.tsx`

**변경 포인트:**
1. Preview 모드에서 `formData?.notes || formData?._body` 로 fallback
2. Edit 모드의 textarea는 `notes` 필드만 편집 (body는 읽기 전용)

---

## Tech Spec

### 현재 코드 (문제)

```tsx
// TaskForm.tsx line 514-520
{formData?.notes ? (
    <div dangerouslySetInnerHTML={{ __html: renderMarkdown(formData.notes) }} />
) : (
    <span className="text-zinc-400 italic">No notes</span>
)}
```

### 수정 코드

**1. Preview 모드 (line 514-520):**
```tsx
// Notes/Body 통합 표시
{(formData?.notes || formData?._body) ? (
    <div dangerouslySetInnerHTML={{ __html: renderMarkdown(formData.notes || formData?._body || '') }} />
) : (
    <span className="text-zinc-400 italic">No notes</span>
)}
```

**2. Edit 모드 (line 510) - Codex 피드백 반영:**
```tsx
// Edit 모드에서도 fallback 적용 (빈 notes로 _body 덮어쓰기 방지)
defaultValue={formData?.notes || formData?._body || ''}
```

**3. onBlur 핸들러 (line 511) - 빈 값 가드:**
```tsx
// 빈 값일 때 불필요한 업데이트 방지
onBlur={(e) => {
    const value = e.target.value;
    if (value !== (formData?.notes || formData?._body || '')) {
        handleUpdate('notes', value);
    }
}}
```

---

## Codex Review Summary (2026-01-08)

**Critical Issues Found: 2**

1. **Edit mode blank issue**: Preview fallback만 있으면 Edit 모드 진입 시 빈 textarea 표시 → blur 시 빈 notes로 업데이트되어 _body 데이터 손실 위험
   - 해결: Edit 모드 defaultValue에도 동일한 fallback 적용

2. **XSS 보안 고려**: _body에 신뢰할 수 없는 HTML이 있을 경우 dangerouslySetInnerHTML로 렌더링 시 XSS 벡터 확대
   - 현재 상태: renderMarkdown()이 이미 markdown만 파싱하므로 HTML 태그는 이스케이프됨 (기존 notes와 동일 수준)
   - 결론: 추가 조치 불필요 (이미 안전)

---

## 체크리스트

- [x] TaskForm.tsx Preview 모드 수정 (notes || _body fallback)
- [x] TaskForm.tsx Edit 모드 defaultValue에 fallback 추가 (Codex 피드백)
- [x] TaskForm.tsx onBlur에 변경 감지 가드 추가 (Codex 피드백)
- [x] 빌드 테스트 (npm run build)
- [x] tsk-023-09 열어서 body 내용 표시 확인
- [x] Edit → Preview 전환 시 데이터 유지 확인
- [x] notes 필드 있는 Task에서도 정상 동작 확인

---

## Notes

### 작업 로그

#### 2026-01-08
**개요**: Task 완료 - TaskDrawer Notes 표시 버그 수정 완료

**작업 내용**:
- TaskForm.tsx Preview 모드: `notes ?? _body` fallback 로직 추가
- TaskForm.tsx Edit 모드: `defaultValue` fallback + key prop 추가
- TaskForm.tsx onBlur: 변경 감지 가드 추가 (불필요한 업데이트 방지)
- Codex 최종 리뷰 2회 실행 및 통과 (Critical 이슈 0건)
- 빌드 테스트 성공 (npm run build)

**검증 결과**:
- tsk-023-09 등 기존 Task의 body 내용 정상 표시 확인
- Edit/Preview 모드 전환 시 데이터 유지 확인
- notes 필드 있는 Task에서도 정상 동작 확인

**최종 상태**: done

---

### 영향 범위

- TaskForm 컴포넌트만 수정
- API 변경 없음 (호환성 유지)
- 기존 notes 필드 있는 Task: 정상 동작
- notes 없고 _body만 있는 Task: 이제 표시됨

---

## 참고 문서

- [[prj-023]] - Dashboard - React+TS 마이그레이션 프로젝트
- Plan Mode 계획: `/Users/gim-eunhyang/.claude/plans/curious-seeking-whistle.md`

---

**Created**: 2026-01-08
**Assignee**: 김은향
**Due**: 2026-01-08
**Closed**: 2026-01-08
