---
entity_type: Task
entity_id: "tsk-023-13"
entity_name: "Dashboard - 캘린더 필터 통합"
created: 2026-01-08
updated: 2026-01-08
status: todo

# === 계층 ===
project_id: "prj-023"
aliases: ["tsk-023-13", "Dashboard - 캘린더 필터 통합"]

# === Task 전용 ===
assignee: "김은향"
type: dev
priority: normal
due: null
closed: null
pr_url: null
---

> Task ID: `tsk-023-13` | Project: `prj-023` | Status: todo

## Summary

칸반과 캘린더에서 동일한 필터 시스템을 공유하여 뷰 전환 시 필터 상태가 유지되도록 구현.

현재 칸반에서 필터 설정 후 캘린더로 이동하면 필터가 무시되고 모든 태스크가 표시되는 문제를 해결.

## Notes

### Tech Spec

#### 목표
칸반과 캘린더에서 동일한 필터 시스템을 공유하여 뷰 전환 시 필터 상태 유지

#### Phase 1: useUrlFilters 확장

**파일**: `src/hooks/useUrlFilters.ts`

추가할 항목:
```typescript
// State
projectIds: string[]           // 복수 프로젝트 선택

// Setters
setProjectIds: (ids: string[]) => void
toggleProjectId: (id: string) => void
```

- `projectIds`: `searchParams.getAll('project_ids')`
- `setProjectIds`: project_ids 파라미터 일괄 설정
- `toggleProjectId`: 개별 프로젝트 토글 (있으면 제거, 없으면 추가)

**타입 파일**: `src/types/filters.ts`
- `UseUrlFiltersReturn` 인터페이스에 위 필드 추가

#### Phase 2: 공용 필터 UI 컴포넌트 생성

**이동**: `src/pages/Kanban/KanbanFilters.tsx` → `src/features/filters/components/TaskFilterBar.tsx`

변경 사항:
1. 컴포넌트명: `KanbanFilters` → `TaskFilterBar`
2. props 타입 변경: `KanbanFilters` → `UseUrlFiltersReturn`
3. 내부 로직은 동일 유지

#### Phase 3: 칸반 페이지 수정

**파일**: `src/pages/Kanban/KanbanPage.tsx`

```typescript
// Before
import { useKanbanFilters } from './useKanbanFilters';
import { KanbanFilters } from './KanbanFilters';

// After
import { useUrlFilters } from '@/hooks/useUrlFilters';
import { TaskFilterBar } from '@/features/filters/components/TaskFilterBar';
```

#### Phase 4: useKanbanFilters 제거

**삭제**: `src/pages/Kanban/useKanbanFilters.ts`

#### Phase 5: 캘린더 페이지에 필터 적용

**파일**: `src/features/calendar/CalendarPage.tsx`

```typescript
import { useUrlFilters } from '@/hooks/useUrlFilters';
import { TaskFilterBar } from '@/features/filters/components/TaskFilterBar';

export default function CalendarPage() {
  const filters = useUrlFilters();
  const { data: dashboardData } = useDashboardInit();

  const { events } = useCalendarEvents({
    range,
    enabledCalendarKeys: enabledCalendarIds,
    expandMode,
    filters,  // 추가
  });

  return (
    <div>
      <TaskFilterBar
        filters={filters}
        members={dashboardData?.members || []}
        projects={dashboardData?.projects || []}
        programs={dashboardData?.programs || []}
        tasks={dashboardData?.tasks || []}
      />
      {/* 기존 캘린더 UI */}
    </div>
  );
}
```

#### Phase 6: useCalendarEvents 필터링 로직 추가

**파일**: `src/features/calendar/queries/useCalendarEvents.ts`

```typescript
interface UseCalendarEventsArgs {
  range: CalendarRange | null;
  enabledCalendarKeys: string[];
  expandMode: boolean;
  filters?: {
    assignees: string[];
    projectIds: string[];
    programId: string | null;
    selectedWeeks: string[];
    selectedMonths: string[];
  };
}

export function useCalendarEvents({ range, enabledCalendarKeys, filters }: UseCalendarEventsArgs) {
  // 필터링 로직 추가
  const filteredTasks = useMemo(() => {
    let result = allTasks;

    // Assignee 필터
    if (filters?.assignees?.length) {
      result = result.filter(t => filters.assignees.includes(t.assignee));
    }

    // Project 필터
    if (filters?.projectIds?.length) {
      result = result.filter(t => filters.projectIds.includes(t.project_id));
    } else if (filters?.programId) {
      const programProjectIds = projects
        .filter(p => p.program_id === filters.programId)
        .map(p => p.entity_id);
      result = result.filter(t => programProjectIds.includes(t.project_id));
    }

    return result;
  }, [allTasks, projects, filters]);

  // 필터링된 tasks를 이벤트로 변환
  // ...
}
```

### 수정 파일 목록

| 파일 | 작업 |
|------|------|
| `src/hooks/useUrlFilters.ts` | projectIds, toggleProjectId, setProjectIds 추가 |
| `src/types/filters.ts` | UseUrlFiltersReturn 타입 확장 |
| `src/pages/Kanban/KanbanFilters.tsx` | → `src/features/filters/components/TaskFilterBar.tsx` 이동 |
| `src/pages/Kanban/KanbanPage.tsx` | useUrlFilters + TaskFilterBar 사용 |
| `src/pages/Kanban/useKanbanFilters.ts` | 삭제 |
| `src/features/calendar/CalendarPage.tsx` | 필터 UI + useUrlFilters 추가 |
| `src/features/calendar/queries/useCalendarEvents.ts` | 필터링 로직 추가 |

### 검증 방법

1. **칸반 테스트**: Assignee/Project 필터 → 해당 태스크만 표시, URL 반영 확인
2. **캘린더 테스트**: 동일한 필터 UI 작동, 필터 적용 시 이벤트 필터링 확인
3. **뷰 전환 테스트**: 칸반 ↔ 캘린더 전환 시 필터 상태 유지 확인
4. **URL 공유 테스트**: 필터 적용된 URL 복사 → 새 탭에서 열기 → 필터 상태 복원 확인

---

### Codex Review Summary (2026-01-08)

**Critical Issues**: 2개
**Suggestions**: 12개

#### Critical Issues (반영됨)

1. **Program vs Project 우선순위 미정의**
   - 문제: programId와 projectIds가 동시에 설정된 경우 동작 불명확
   - 해결: **projectIds가 있으면 projectIds 우선, 없으면 programId로 필터링** (기존 칸반 동작과 동일)

2. **Assignees 필터 시맨틱스 미정의**
   - 문제: 복수 assignee 선택 시 AND/OR 불명확
   - 해결: **OR 연산** (선택된 assignee 중 하나라도 일치하면 표시)

#### Suggestions (참고용)

| 항목 | 설명 | 대응 |
|------|------|------|
| 삭제된 프로젝트 ID 처리 | URL에 존재하지 않는 project_id가 있을 경우 | 무시하고 유효한 ID만 필터링 |
| URL 길이 제한 | 다수 projectIds 선택 시 URL 길이 초과 가능 | 현재 프로젝트 규모에서 문제없음, 추후 필요시 압축 |
| TaskFilterBar props 인터페이스 | UseUrlFiltersReturn 직접 사용 vs 좁은 인터페이스 | 현재는 직접 사용, 추후 리팩토링 가능 |
| Empty state UX | 필터 결과가 없을 때 안내 메시지 | 기존 칸반과 동일하게 빈 상태 표시 |
| useKanbanFilters 제거 시 import 오류 | 다른 곳에서 import 중일 수 있음 | grep으로 확인 후 제거 |
| 클라이언트 필터링 성능 | 대량 이벤트 시 성능 저하 가능 | 현재 규모에서 문제없음, useMemo로 최적화 |

## Related

- [[prj-023|Dashboard - React+TS 마이그레이션]]
