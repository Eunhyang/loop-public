---
entity_type: Task
entity_id: "tsk-023-01"
entity_name: "Dashboard - 필터 시스템 통합 구현"
created: 2026-01-08
updated: 2026-01-08
status: done
closed: 2026-01-08

# === 계층 ===
parent_id: "prj-023"
project_id: "prj-023"
aliases: ["tsk-023-01", "Dashboard - 필터 시스템 통합 구현"]

# === 관계 ===
outgoing_relations: []
validates: []
validated_by: []

# === Task 전용 ===
assignee: "김은향"
start_date: 2026-01-08
due: 2026-01-08
priority: high
estimated_hours: null
actual_hours: null

# === Task 유형 (dev Task 연동용) ===
type: dev
target_project: loop

# === 분류 ===
tags: ["dashboard", "filter", "react", "typescript"]
priority_flag: high
---

# Dashboard - 필터 시스템 통합 구현

> Task ID: `tsk-023-01` | Project: `prj-023` | Status: done

## 목표

**완료 조건**:
1. URL params + localStorage 기반 필터 상태 통합
2. Phase 1/2 분리된 필터 파이프라인 구현
3. FilterPanel UI 완성 (Visibility, Project, Task, Date 섹션)
4. Filter Indicator 적용

---

## 상세 내용

### 배경

레거시 대시보드(`_dashboard/`)와 V2(`dashboard-v2/`) 필터 시스템 비교 분석 결과:
- V2에서 URL params와 React Context로 상태가 분리되어 관리 복잡
- localStorage 영속성 부재로 새로고침 시 설정 초기화
- Quick Date Filter UI, Visibility Toggles 등 누락 기능 존재

### 작업 내용

1. **필터 상태 통합**
   - `useUrlFilters.ts` - Navigation/Date 필터 (공유 가능)
   - `useLocalFilters.ts` - View Preferences (개인 설정)
   - `useCombinedFilters.ts` - 통합 상태 제공

2. **필터 파이프라인 분리**
   - Phase 1: Project 필터링 (allowedProjectIds)
   - Phase 2: Task 필터링 (assignee, status, priority, date)

3. **UI 컴포넌트**
   - VisibilityToggles: inactive members/projects/tasks
   - DateFilters: Range picker + Quick Date (Week/Month)
   - Filter Indicator: 활성 필터 표시

---

## 체크리스트

- [ ] types/filters.ts 생성
- [ ] constants/filterDefaults.ts 생성
- [ ] hooks/useLocalFilters.ts 구현
- [ ] hooks/useUrlFilters.ts 리팩토링
- [ ] hooks/useCombinedFilters.ts 구현
- [ ] selectors.ts Phase 1/2 분리
- [ ] FilterPanel/VisibilityToggles 완성
- [ ] FilterPanel/DateFilters 추가
- [ ] KanbanFilters에 Program 드롭다운 추가
- [ ] Filter Indicator 적용
- [ ] 새로고침 복원 테스트
- [ ] URL 공유 테스트

---

## Notes

### PRD (Product Requirements Document)

#### 아키텍처 개요

```
State Layer:
  useUrlFilters (URL) + useLocalFilters (localStorage)
         ↓
  useCombinedFilters() → CombinedFilterState
         ↓
Selector Layer:
  Phase 1: filterProjects() → allowedProjectIds[]
         ↓
  Phase 2: filterTasks() → filteredTasks[]
         ↓
  groupTasksByStatus() → KanbanColumns
```

#### 타입 정의

**UrlFilterState** (공유 가능):
- assignees[], projectId, programId, trackId, hypothesisId, conditionId
- dateFilter ('W'|'M'|''), selectedWeeks[], selectedMonths[]

**LocalFilterState** (개인 설정):
- showInactiveMembers, showNonCoreMembers, showInactiveProjects, showInactiveTasks
- projectStatus[], projectPriority[]
- taskStatus[], taskPriority[], taskTypes[]
- dueDateStart, dueDateEnd

#### 기본값 (레거시 호환)
- showNonCoreMembers: false (core만)
- projectStatus: done 제외
- 선택 없음 = 전체

#### 파일 구조

```
NEW:
- types/filters.ts
- constants/filterDefaults.ts
- hooks/useUrlFilters.ts (리팩토링)
- hooks/useLocalFilters.ts
- hooks/useCombinedFilters.ts
- hooks/useFilterIndicator.ts
- features/filters/components/FilterPanel/DateFilters.tsx

MODIFY:
- features/tasks/selectors.ts (Phase 1/2 분리)
- features/filters/components/FilterPanel/VisibilityToggles.tsx (4개 토글)
- pages/Kanban/KanbanFilters.tsx (Program + Indicator)
```

#### 구현 순서
1. types + constants
2. useLocalFilters
3. useUrlFilters 리팩토링
4. useCombinedFilters
5. selectors Phase 1/2
6. VisibilityToggles 4개
7. DateFilters
8. KanbanFilters Program + Indicator
9. 테스트

### Codex Review Feedback

**Critical Issues (Must Address):**
1. **Date filter conflicts**: Quick Date vs custom range 충돌 시 우선순위 정의 필요
   - 해결: Quick Date 선택 시 custom range 자동 clear, 반대도 동일
2. **Program filter edge**: "All programs" vs "No program" 구분 필요
   - 해결: `programId: null` = All, `programId: 'none'` = Unassigned

**Suggestions (Consider):**
- URL/localStorage 우선순위: URL → localStorage → defaults 순으로 hydration
- Reset 동작: "Clear All" 시 URL params + localStorage 모두 초기화
- Timezone: 모든 날짜 비교는 local midnight 기준 (기존 date.ts 패턴 유지)
- end date inclusive 처리 확인

**Open Questions:**
- 공유 링크 시 localStorage 필터 제외할지? (현재 설계: URL만 공유)
- debounce 필요성? (React 18+ automatic batching으로 대부분 해결)

### Tech Spec Todo
- [ ] types/filters.ts 생성
- [ ] constants/filterDefaults.ts 생성
- [ ] hooks/useLocalFilters.ts 구현
- [ ] hooks/useUrlFilters.ts 리팩토링
- [ ] hooks/useCombinedFilters.ts 구현
- [ ] hooks/useFilterIndicator.ts 구현
- [ ] selectors.ts Phase 1/2 분리
- [ ] VisibilityToggles 4개 토글
- [ ] DateFilters 컴포넌트
- [ ] KanbanFilters Program + Indicator
- [ ] 새로고침 복원 테스트
- [ ] URL 공유 테스트

### 작업 로그

#### 2026-01-08
**개요**: Dashboard V2 필터 시스템 통합 구현 완료. URL params + localStorage 기반 필터 상태 통합, Phase 1/2 분리된 필터 파이프라인 구현, FilterPanel UI 완성.

**변경사항**:
- 개발:
  - types/filters.ts: UrlFilterState, LocalFilterState, CombinedFilterState 타입 정의
  - constants/filterDefaults.ts: 필터 기본값 및 레거시 호환 설정
  - hooks/useLocalFilters.ts: localStorage 기반 View Preferences 관리
  - hooks/useUrlFilters.ts: URL params 기반 Navigation/Date 필터 (리팩토링)
  - hooks/useCombinedFilters.ts: 통합 필터 상태 제공
  - hooks/useFilterIndicator.ts: 활성 필터 표시 로직
  - features/filters/components/FilterPanel/DateFilters.tsx: Range picker + Quick Date
- 수정:
  - features/tasks/selectors.ts: Phase 1/2 분리된 필터 파이프라인 (Project → Task)
  - features/projects/selectors.ts: Project 필터링 로직 분리
  - features/filters/components/FilterPanel/VisibilityToggles.tsx: 4개 토글 완성
  - pages/Kanban/index.tsx: Filter Indicator 적용

**결과**: ✅ 구현 완료

**최종 상태**: done


---

## 참고 문서

- [[prj-023]] - 소속 Project (Dashboard - React+TS 마이그레이션)
- 레거시 대시보드: `public/_dashboard/js/components/filter-panel.js`
- V2 대시보드: `public/dashboard-v2/src/features/filters/`

---

**Created**: 2026-01-08
**Assignee**: 김은향
**Due**: 2026-01-08
