---
entity_type: Task
entity_id: tsk-023-1768637569532
entity_name: API - hypothesis_seeder에 build_strategic_context 적용
created: '2026-01-17'
updated: '2026-01-17'
status: done
project_id: prj-023
parent_id: prj-023
assignee: 김은향
priority: medium
start_date: '2026-01-17'
due: '2026-01-17'
aliases:
- tsk-023-1768637569532
tags: []
type: dev
---

# API - hypothesis_seeder에 build_strategic_context 적용

## 설명

docs/mcp_logic_supplement.md 섹션 4-1 TODO 완료. hypothesis_seeder.py에 build_strategic_context를 적용하여 SSOT 패턴 준수 및 중복 방지 기능 추가.

## Notes

### Summary
hypothesis_seeder 프롬프트 생성 로직을 build_strategic_context 기반으로 리팩토링. 기존 Hypotheses와 Conditions 상세 정보를 LLM에 전달하여 중복 방지 가능하도록 개선.

### Changes Made
- `api/prompts/hypothesis_seeder.py`
  - `build_strategic_context` import 추가
  - `_build_hypothesis_seeder_command()` 함수 분리 (SSOT)
  - `build_hypothesis_seeder_prompt()` 확장 (conditions, hypotheses, constraints 파라미터 추가)
  - 중복 방지 가이드 추가

- `api/routers/ai.py` (2267-2304줄)
  - Conditions 조회 로직 추가 (project.conditions_3y 기반 필터링)
  - 기존 Hypotheses 조회 로직 추가 (Track 기반, 중복 방지용)
  - Constraints 구성 추가
  - 프롬프트 생성 호출 수정

### Data Flow (After)
```
Request → Project/Track 조회 (기존)
       → Conditions 조회 (NEW) ← cache.get_all_conditions() + filter
       → Hypotheses 조회 (NEW) ← cache.get_all_hypotheses() + filter
       → build_hypothesis_seeder_prompt(project, track, conditions, hypotheses, constraints)
           → build_strategic_context() ← SSOT 모듈
           → 가설 소스 섹션
           → _build_hypothesis_seeder_command() ← 도메인 명령어
```

## 체크리스트

- [x] hypothesis_seeder.py - build_strategic_context import 추가
- [x] hypothesis_seeder.py - _build_hypothesis_seeder_command() 함수 추가
- [x] hypothesis_seeder.py - build_hypothesis_seeder_prompt() 시그니처 확장
- [x] ai.py - 컨텍스트 수집 (conditions, hypotheses) 추가
- [x] ai.py - 프롬프트 생성 호출 수정
- [x] Python 문법 검증 통과
- [x] main 머지 완료

## 참고

- expected_impact.py의 build_strategic_context 사용 구조 참조
- 하위 호환성 유지 (새 파라미터 모두 Optional)
