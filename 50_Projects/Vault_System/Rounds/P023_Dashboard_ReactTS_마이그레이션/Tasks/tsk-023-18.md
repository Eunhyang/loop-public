---
entity_type: Task
entity_id: "tsk-023-18"
entity_name: "Dashboard - Child Project 필터 버그 수정"
created: 2026-01-08
updated: 2026-01-08
status: doing

# === 계층 ===
parent_id: "prj-023"
project_id: "prj-023"
aliases: ["tsk-023-18"]

# === 관계 ===
outgoing_relations: []
validates: []
validated_by: []

# === Task 전용 ===
assignee: "김은향"
start_date: 2026-01-08
due: 2026-01-08
priority: high
estimated_hours: null
actual_hours: null

# === Task 유형 (dev Task 연동용) ===
type: dev
target_project: loop

# === 분류 ===
tags: ["bugfix", "dashboard", "filter"]
priority_flag: high
---

# Dashboard - Child Project 필터 버그 수정

> Task ID: `tsk-023-18` | Project: `prj-023` | Status: doing

## 목표

**완료 조건**:
1. Program 버튼 클릭 후 하위 Project 버튼 클릭 시 버튼들이 유지되어야 함
2. 선택한 Project로 Task 필터링이 정상 작동해야 함
3. 버튼 토글(선택 해제)이 가능해야 함

---

## 상세 내용

### 배경

Program 버튼을 클릭하면 하위 Project 버튼들이 동적으로 생성됩니다.
하지만 하위 Project 버튼을 클릭하면 버튼들이 사라지는 버그가 있습니다.

**현상:**
- Task 필터링 자체는 작동함 (projectIds로 필터링됨)
- 하지만 UI에서 child project 버튼들이 전체 사라짐
- 사용자가 "필터가 안 됨"으로 인지

### 원인 분석

**파일:** `public/dashboard-v2/src/hooks/useUrlFilters.ts`

`toggleProjectId` 함수에서 `program` 파라미터를 삭제하는 것이 문제:

```typescript
// Line 95-110
const toggleProjectId = useCallback(
  (id: string) => {
    const newParams = new URLSearchParams(searchParams);
    // ...
    newParams.delete('program'); // ← 이 라인이 문제
    // ...
  }
);
```

**시나리오:**
1. Program "Vault 시스템 체계화" 클릭 → URL: `?program=pgm-vault`
2. Child Project "Dashboard" 클릭 → `toggleProjectId("prj-023")` 호출
3. `program` 파라미터 삭제됨 → URL: `?project_ids=prj-023`
4. `programId`가 null → TaskFilterBar에서 child buttons 미렌더링

### 작업 내용

**수정 파일:** `public/dashboard-v2/src/hooks/useUrlFilters.ts`

**수정 1 - Line 101 삭제 (toggleProjectId):**
```typescript
newParams.delete('program'); // Clear programId when toggling projectIds
```

**수정 2 - Line 88 삭제 (setProjectIds) - Codex 발견:**
```typescript
newParams.delete('program'); // Clear programId when setting projectIds
```

**이유:**
- 독립 프로젝트 클릭 시 program 삭제는 `handleIndependentProjectClick`에서 별도 처리 (TaskFilterBar.tsx Line 117)
- child project 클릭 시에는 program을 유지해야 함
- child "All" 버튼 클릭 시에도 program 컨텍스트 유지 필요

---

## 체크리스트

- [ ] `useUrlFilters.ts` Line 88 삭제 (setProjectIds)
- [ ] `useUrlFilters.ts` Line 101 삭제 (toggleProjectId)
- [ ] 대시보드에서 Program → Child Project 클릭 테스트
- [ ] 대시보드에서 Program → Child "All" 클릭 테스트
- [ ] 버튼 토글 동작 확인
- [ ] Task 필터링 정상 동작 확인

---

## Notes

### Tech Spec

**수정 범위:** 2줄 삭제

| 파일 | 라인 | 변경 | 영향 |
|------|------|------|------|
| `useUrlFilters.ts` | 88 | 삭제: `newParams.delete('program');` | child "All" 버튼 |
| `useUrlFilters.ts` | 101 | 삭제: `newParams.delete('program');` | child project 버튼 |

### Codex Review Summary
- **Blocker 확인**: Line 101 삭제 필요 (PRD와 일치)
- **추가 발견**: Line 88도 같은 문제 → 함께 수정

### Todo
- [ ] Line 88 삭제
- [ ] Line 101 삭제
- [ ] 수동 테스트
- [ ] 커밋

### 작업 로그


---

## 참고 문서

- [[prj-023]] - 소속 Project
- Plan: `/Users/gim-eunhyang/.claude/plans/happy-bouncing-dawn.md`

---

**Created**: 2026-01-08
**Assignee**: 김은향
**Due**: 2026-01-08
