---
entity_type: Task
entity_id: "tsk-023-24"
entity_name: "Pending - Workflow/Run 필터 기능"
created: 2026-01-08
updated: 2026-01-08
status: done

# === 계층 ===
parent_id: "prj-023"
project_id: "prj-023"
aliases: ["tsk-023-24"]

# === 관계 ===
outgoing_relations: []
validates: []
validated_by: []

# === Task 전용 ===
assignee: "김은향"
start_date: 2026-01-08
due: 2026-01-08
priority: medium
estimated_hours: null
actual_hours: null

# === Task 유형 (dev Task 연동용) ===
type: dev
target_project: loop

# === 분류 ===
tags: ["dashboard", "pending", "filter", "react"]
priority_flag: medium
---

# Pending - Workflow/Run 필터 기능

> Task ID: `tsk-023-24` | Project: `prj-023` | Status: done

## 목표

**완료 조건**:
1. Pending 페이지에서 Workflow 드롭다운으로 source_workflow 필터링 가능
2. Pending 페이지에서 Run ID 드롭다운으로 run_id 필터링 가능
3. Delete Filtered 버튼으로 필터된 리뷰 일괄 삭제 가능
4. ReviewCard에 workflow/run_id/AUTO-SYNTH 뱃지 표시

---

## 상세 내용

### 배경

레거시 대시보드 `_dashboard/js/components/pending-panel.js`에 구현된 workflow/run 필터 기능을 React 대시보드(dashboard-v2)로 마이그레이션.

**레거시 기능**:
- `filterWorkflow`, `filterRunId` 상태 관리
- `updateFilterDropdowns()` - 드롭다운 옵션 업데이트
- `getFilteredReviews(status)` - 필터 적용된 리뷰 반환
- `deleteFiltered()` - 필터된 리뷰 일괄 삭제
- ReviewCard에 workflow/run_id 뱃지, AUTO-SYNTH 뱃지

**백엔드 API 상태**:
- `DELETE /api/pending/batch` 이미 존재 (source_workflow, run_id, status 필터 지원)
- `GET /api/pending` 쿼리 파라미터 지원 (source_workflow, run_id)

### 작업 내용

1. **ReviewCard 개선** - run_id 뱃지, AUTO-SYNTH 뱃지 추가
2. **WorkflowFilters 컴포넌트** - 드롭다운 2개 + Delete Filtered 버튼
3. **usePendingFilters 훅** - 필터 상태 관리 + 필터링 로직
4. **API 클라이언트** - deleteBatch 함수 추가
5. **PendingPage 통합** - 컴포넌트 조립

---

## 체크리스트

- [ ] ReviewCard.tsx 수정 (run_id, AUTO-SYNTH 뱃지)
- [ ] WorkflowFilters.tsx 생성
- [ ] usePendingFilters.ts 훅 생성
- [ ] api.ts에 deleteBatch 추가
- [ ] PendingPage 통합
- [ ] 빌드 확인

---

## Notes

### Tech Spec

```
파일 변경 목록:
├── src/features/pending/components/ReviewCard.tsx (수정)
├── src/features/pending/components/WorkflowFilters.tsx (신규)
├── src/features/pending/components/index.ts (수정)
├── src/features/pending/hooks/usePendingFilters.ts (신규)
├── src/features/pending/api.ts (수정)
├── src/features/pending/queries/index.ts (수정)
└── src/pages/Pending/index.tsx (수정)
```

### Todo
- [ ] Step 1: ReviewCard 개선
- [ ] Step 2: WorkflowFilters 컴포넌트 생성
- [ ] Step 3: usePendingFilters 훅 생성
- [ ] Step 4: API 클라이언트 추가
- [ ] Step 5: PendingPage 통합

### Codex Review Summary (2026-01-08)

**Critical Issues Found**: 0
**Suggestions**: 8

#### Edge Cases to Handle:
1. **Empty filter state**: Delete Filtered 버튼은 필터가 없을 때 비활성화 (레거시와 동일)
2. **Confirmation dialog**: 일괄 삭제 전 confirm() 필수 (레거시 구현 참조)
3. **Loading state**: Delete 중 버튼 비활성화로 중복 클릭 방지

#### UX Clarifications (레거시 동작 따름):
- Workflow/Run ID: 단일 선택 드롭다운 (status는 탭으로 이미 분리됨)
- 드롭다운 옵션: 현재 리뷰 데이터에서 동적 추출 (서버 호출 없음)
- Run ID 표시: 24자 초과 시 truncate (레거시: `substring(0, 24) + '...'`)
- AUTO-SYNTH 뱃지: `source_workflow === 'retro-synth'` 조건

#### Technical Decisions:
- 필터 상태: URL params 아닌 로컬 state (탭 전환 시 초기화)
- Query invalidation: deleteBatch 후 usePendingReviews refetch
- Error handling: catch + toast (기존 패턴 따름)

### 작업 로그

#### 2026-01-08 (Completed)
**개요**: Pending 페이지에 Workflow/Run ID 필터 기능 추가 완료. ReviewCard 뱃지 개선, WorkflowFilters 컴포넌트 생성, usePendingFilters 훅 구현, deleteBatch API 추가, PendingPage 통합.

**변경사항**:
- 개발:
  - `WorkflowFilters.tsx` - Workflow/Run ID 드롭다운 필터 + Delete Filtered 버튼
  - `usePendingFilters.ts` - 필터 상태 관리 훅 (filter, reset on tab change, delete handler)
  - `api.ts` - `deleteBatch()` 함수 (DELETE with request body)
  - `queries/usePendingReviews.ts` - `useDeleteBatch()` mutation hook
- 수정:
  - `ReviewCard.tsx` - source_workflow를 뱃지로 변경, AUTO-SYNTH 뱃지 추가 (retro-synth 시), run_id 뱃지 추가 (24자 truncate + tooltip)
  - `PendingPage/index.tsx` - WorkflowFilters 통합, isPending 수정 (React Query v5)
- 개선 (Codex 피드백 반영):
  - React Query v5 호환: `isLoading` → `isPending` 수정
  - 삭제 버튼 개선: `filteredCount === 0` 시 비활성화 + 툴팁
  - 에러 처리: deleteBatch 실패 시 try/catch로 alert 표시

**핵심 코드**:
```typescript
// usePendingFilters.ts - Filter & Delete logic
const filteredReviews = useMemo(() => {
  let result = reviews.filter((r) => r.status === activeStatus);
  if (filterWorkflow !== '') result = result.filter((r) => r.source_workflow === filterWorkflow);
  if (filterRunId !== '') result = result.filter((r) => r.run_id === filterRunId);
  return result;
}, [reviews, activeStatus, filterWorkflow, filterRunId]);

// WorkflowFilters.tsx - canDelete logic
const canDelete = hasFilter && filteredCount > 0 && !isDeleting;
```

**결과**: ✅ 빌드 성공 (npm run build passed)

**Codex Review 피드백 (3건 모두 수정)**:
1. ✅ `isPending` vs `isLoading` (React Query v5) - 수정 완료
2. ✅ `filteredCount === 0` 시 삭제 방지 - canDelete 조건 추가
3. ✅ deleteBatch 에러 처리 - try/catch + alert 추가

**다음 단계**: 배포 후 사용자 피드백 수집


---

## 참고 문서

- [[prj-023]] - 소속 Project
- `_dashboard/js/components/pending-panel.js` - 레거시 구현 참조
- `/Users/gim-eunhyang/.claude/plans/hidden-cuddling-cascade.md` - Plan Mode 계획

---

**Created**: 2026-01-08
**Assignee**: 김은향
**Due**: 2026-01-08
