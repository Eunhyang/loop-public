---
entity_type: Task
entity_id: tsk-023-1768064163160
entity_name: Dashboard v2 - Pending Review Auto-Applied UI 및 Project Review Mode 구현
created: '2026-01-11'
updated: '2026-01-11'
status: todo
project_id: prj-023
parent_id: prj-023
assignee: 김은향
priority: high
start_date: '2026-01-11'
due: '2026-01-11'
aliases:
- tsk-023-1768064163160
tags: []
type: dev
---

# Dashboard v2 - Pending Review Auto-Applied UI 및 Project Review Mode 구현

> Task ID: `tsk-023-1768064163160` | Project: `prj-023` | Status: todo

## 목표

tsk-n8n-23에서 구현한 Entity Validator Auto-Apply 기능의 **대시보드 UI 지원**을 완성하고, Pending Review 페이지에서 **Project 엔티티 리뷰**를 가능하게 함.

## 완료 조건

1. `auto_applied` 상태가 Pending Review 탭에 표시됨
2. Project 엔티티 선택 시 "Not yet implemented" 대신 리뷰 폼 표시
3. Project 리뷰에서 제안 필드 시각화 + Approve/Reject 동작

---

## Tech Spec

### 문제 1: Auto-Applied UI 미구현

**현재 상태:**
- `types.ts` Line 6: `status: 'pending' | 'approved' | 'rejected'` - `auto_applied` 없음
- `ReviewList.tsx` Line 21-25: 탭 3개만 정의 (pending/approved/rejected)
- tsk-n8n-23에서 정의한 `status: "auto_applied"`를 위한 UI가 없음

**수정 필요:**
| 파일 | 변경 |
|------|------|
| `src/features/pending/types.ts` | PendingStatus에 'auto_applied' 추가 |
| `src/features/pending/components/ReviewList.tsx` | "Auto-Applied" 탭 추가 |
| `src/features/pending/components/ReviewCard.tsx` | auto_applied 상태 배지 추가 (녹색 "AUTO" 배지) |

### 문제 2: Project Review Mode 미구현

**현재 상태:**
- `ProjectForm.tsx` Line 13: `mode: 'create' | 'edit' | 'view'` - `review` 모드 없음
- `PendingPage` Line 217-225: Project case가 플레이스홀더

**수정 필요:**
| 파일 | 변경 |
|------|------|
| `src/features/projects/components/ProjectForm.tsx` | review mode 지원 추가 |
| `src/pages/Pending/index.tsx` | Project case 구현 (TaskForm 패턴 복제) |

### ProjectForm Review Mode 설계

```typescript
interface ProjectFormProps {
    mode: 'create' | 'edit' | 'view' | 'review';  // review 추가
    id?: string;
    prefill?: Partial<Project>;
    // Review mode props
    suggestedFields?: Record<string, unknown>;
    reasoning?: Record<string, string>;
    onFieldChange?: (field: string, value: unknown) => void;
    onRelationClick?: (id: string, type: string) => void;
}
```

**Review Mode 렌더링:**
- ReviewFieldWrapper로 제안 필드 감싸기
- useReviewMode 훅 연동
- 필드 변경 시 onFieldChange 호출
- 기존 edit/view 로직 재사용

---

## Todo

### Step 1: Auto-Applied 타입/UI 추가
- [ ] `types.ts`: PendingReview.status에 'auto_applied' 추가
- [ ] `types.ts`: PendingStatus에 'auto_applied' 추가
- [ ] `ReviewList.tsx`: 4번째 탭 "Auto-Applied" 추가
- [ ] `ReviewCard.tsx`: status === 'auto_applied' 시 녹색 "AUTO" 배지 표시

### Step 2: ProjectForm Review Mode 구현
- [ ] `ProjectForm.tsx`: Props에 review mode 관련 필드 추가
- [ ] `ProjectForm.tsx`: review mode 분기 처리 (edit/view 로직 기반)
- [ ] `ProjectForm.tsx`: ReviewFieldWrapper import 및 적용
- [ ] `ProjectForm.tsx`: onFieldChange/onRelationClick 연결

### Step 3: PendingPage Project Case 구현
- [ ] `PendingPage`: Project case에서 ProjectForm mode="review" 사용
- [ ] `PendingPage`: Task case와 동일한 패턴 (header + form + action buttons)
- [ ] `PendingPage`: handleApprove/handleReject/handleDelete 연결 확인

### Step 4: 빌드 및 검증
- [ ] `npm run build` 통과
- [ ] 로컬 테스트: Auto-Applied 탭 표시 확인
- [ ] 로컬 테스트: Project 리뷰 선택 시 form 표시 확인
- [ ] 로컬 테스트: Approve/Reject 동작 확인

---

## 수정 파일 목록

| 파일 | 작업 |
|------|------|
| `dashboard-v2/src/features/pending/types.ts` | auto_applied 상태 추가 |
| `dashboard-v2/src/features/pending/components/ReviewList.tsx` | Auto-Applied 탭 추가 |
| `dashboard-v2/src/features/pending/components/ReviewCard.tsx` | auto_applied 배지 추가 |
| `dashboard-v2/src/features/projects/components/ProjectForm.tsx` | review mode 지원 |
| `dashboard-v2/src/pages/Pending/index.tsx` | Project case 구현 |

---

## Notes

### 관련 Task
- tsk-n8n-23: Entity Validator Auto-Apply 기능 (백엔드 완료, 대시보드 UI 미구현)

### 참고 패턴
- `TaskForm.tsx`: review mode 구현 참고 (완성된 패턴)
- `useReviewMode.ts`: 변경사항 추적 훅
- `ReviewFieldWrapper.tsx`: 제안 필드 시각화 컴포넌트

---

## PRD (Product Requirements Document)

### 프로젝트 컨텍스트

**Technology Stack:**
- Framework: React 19 + TypeScript + Vite
- State Management: Tanstack Query (React Query)
- Routing: React Router v6
- Styling: Tailwind CSS v4
- Rich Text: TipTap (Markdown editor)

**Architecture Pattern:**
- Feature-based directory structure (`src/features/`)
- Custom hooks for business logic
- Compound components pattern
- Server state via React Query, UI state via Context

### 아키텍처 도식

```
┌───────────────────────────────────────────────────────────────────────┐
│ Pending Review System - Auto-Applied + Project Review                │
├───────────────────────────────────────────────────────────────────────┤
│                                                                       │
│  UI Layer (Pages)                                                     │
│  ┌─────────────────────────────────────────────────────────────┐    │
│  │ PendingPage (/pending)                                       │    │
│  │  ├─ ReviewList (Left Pane)                                   │    │
│  │  │   ├─ Tabs: Pending | Approved | Rejected | AUTO-APPLIED  │    │
│  │  │   └─ ReviewCard[] ← PendingReview[]                       │    │
│  │  ├─ Review Detail (Center)                                   │    │
│  │  │   ├─ case 'Task': TaskForm(mode="review") ✅             │    │
│  │  │   ├─ case 'Project': ProjectForm(mode="review") ⚠️ NEW   │    │
│  │  │   └─ case 'Hypothesis': (placeholder)                     │    │
│  │  └─ Entity Preview (Right)                                   │    │
│  └─────────────────────────────────────────────────────────────┘    │
│                          ↓ props                                      │
│  Feature Layer (Components)                                           │
│  ┌─────────────────────────────────────────────────────────────┐    │
│  │ ProjectForm({ mode, id, suggestedFields, reasoning, ... })  │    │
│  │  ├─ mode: 'create' | 'edit' | 'view' | 'review' ⚠️ NEW     │    │
│  │  ├─ if (mode === 'review'):                                  │    │
│  │  │    └─ Wrap fields with <ReviewFieldWrapper>              │    │
│  │  └─ onFieldChange → reviewMode.setFieldValue()              │    │
│  └─────────────────────────────────────────────────────────────┘    │
│                          ↓ state                                      │
│  Hook Layer (Business Logic)                                          │
│  ┌─────────────────────────────────────────────────────────────┐    │
│  │ useReviewMode({ suggestedFields, reasoning })                │    │
│  │  ├─ Track field changes (modified vs suggested)             │    │
│  │  └─ getModifiedFields() → Approve 시 전송                   │    │
│  └─────────────────────────────────────────────────────────────┘    │
│                          ↓ API calls                                  │
│  Data Layer (React Query)                                             │
│  ┌─────────────────────────────────────────────────────────────┐    │
│  │ usePendingReviews() ← GET /api/pending                       │    │
│  │ useApproveReview() → POST /api/pending/{id}/approve          │    │
│  │ useRejectReview() → POST /api/pending/{id}/reject            │    │
│  └─────────────────────────────────────────────────────────────┘    │
│                                                                       │
└───────────────────────────────────────────────────────────────────────┘

Data Flow:
1. API (/api/pending) returns PendingReview[] with status: 'auto_applied'
2. ReviewList renders 4th tab "Auto-Applied"
3. User selects Project entity → PendingPage renders ProjectForm(mode="review")
4. ProjectForm wraps suggested fields with ReviewFieldWrapper (yellow highlight)
5. User modifies fields → reviewMode tracks changes
6. User clicks Approve → Send only modified fields → Backend applies
```

### 구현 범위

#### 1. Type Definitions (`src/features/pending/types.ts`)
**위치:** Feature types layer
**목적:** Auto-applied 상태를 타입 시스템에 반영
**구현:**
```typescript
// Line 6: Add 'auto_applied' to status union
status: 'pending' | 'approved' | 'rejected' | 'auto_applied';

// Line 15: Add to type alias
export type PendingStatus = 'pending' | 'approved' | 'rejected' | 'auto_applied';
```

#### 2. Review List UI (`src/features/pending/components/ReviewList.tsx`)
**위치:** Feature component layer
**목적:** Auto-Applied 탭 추가로 자동 적용된 리뷰 표시
**구현:**
```typescript
// Line 21-25: Add 4th tab
const tabs: { value: PendingStatus; label: string }[] = [
  { value: 'pending', label: 'Pending' },
  { value: 'approved', label: 'Approved' },
  { value: 'rejected', label: 'Rejected' },
  { value: 'auto_applied', label: 'Auto-Applied' }, // NEW
];
```

#### 3. Review Card Badge (`src/features/pending/components/ReviewCard.tsx`)
**위치:** Feature component layer
**목적:** Auto-applied 상태를 시각적으로 구분 (녹색 AUTO 배지)
**구현:**
```typescript
// After Line 45: Add auto_applied badge
{review.status === 'auto_applied' && (
  <span className="px-2 py-0.5 bg-green-100 text-green-700 rounded text-xs font-medium">
    AUTO
  </span>
)}
```

#### 4. ProjectForm Review Mode (`src/features/projects/components/ProjectForm.tsx`)
**위치:** Feature component layer (117 lines analyzed)
**목적:** Project 엔티티의 제안 필드를 시각화하고 수정 가능하게 함
**구현:**
- Props 인터페이스 확장 (Line 12-16)
  ```typescript
  interface ProjectFormProps {
      mode: 'create' | 'edit' | 'view' | 'review'; // 'review' added
      id?: string;
      prefill?: Partial<Project>;
      // Review mode props
      suggestedFields?: Record<string, unknown>;
      reasoning?: Record<string, string>;
      onFieldChange?: (field: string, value: unknown) => void;
      onRelationClick?: (id: string, type: string) => void;
  }
  ```
- Review mode 분기 처리 (Line 19 참고)
  ```typescript
  const isReadOnly = mode === 'view';
  const isReviewMode = mode === 'review'; // NEW
  ```
- ReviewFieldWrapper import 및 적용 (TaskForm 패턴 참고)
  ```typescript
  import { ReviewFieldWrapper } from '@/features/pending/components/ReviewFieldWrapper';

  // Wrap each editable field
  <ReviewFieldWrapper
    fieldName="status"
    currentValue={formData.status}
    suggestedValue={suggestedFields?.status}
    reasoning={reasoning?.status}
    isModified={reviewMode?.isFieldModified('status')}
  >
    {/* existing field UI */}
  </ReviewFieldWrapper>
  ```

#### 5. Pending Page Project Case (`src/pages/Pending/index.tsx`)
**위치:** Page layer
**목적:** Project 선택 시 "Not yet implemented" 플레이스홀더를 실제 리뷰 폼으로 교체
**구현:** Line 217-225 교체 (Task case 패턴 복제)
```typescript
case 'Project':
  return (
    <div className="h-full flex flex-col">
      {/* Header */}
      <div className="flex-shrink-0 px-6 pt-4 pb-2 border-b">
        <div className="flex items-center gap-2 mb-2">
          <span className="px-2 py-0.5 bg-purple-100 text-purple-700 rounded text-sm font-medium">
            {selectedReview.entity_type}
          </span>
          <button
            onClick={() => handleRelationClick(selectedReview.entity_id, selectedReview.entity_type)}
            className="text-sm text-blue-600 hover:underline"
          >
            {selectedReview.entity_id}
          </button>
        </div>
        <h2 className="text-lg font-semibold text-gray-900">{selectedReview.entity_name}</h2>
        <div className="text-xs text-gray-500 mt-1">
          {new Date(selectedReview.created_at).toLocaleString()}
        </div>
      </div>

      {/* ProjectForm in review mode */}
      <div className="flex-1 min-h-0 overflow-y-auto">
        <ProjectForm
          mode="review"
          id={selectedReview.entity_id}
          suggestedFields={selectedReview.suggested_fields}
          reasoning={selectedReview.reasoning}
          onRelationClick={handleRelationClick}
          onFieldChange={handleFieldChange}
        />
      </div>

      {/* Action Buttons */}
      <div className="flex-shrink-0 p-4 border-t bg-gray-50 flex justify-end gap-3">
        <button onClick={handleDelete} disabled={isLoadingAction} className="px-4 py-2 text-sm text-gray-600 hover:text-gray-900 disabled:opacity-50" title="Remove this review suggestion">
          Dismiss
        </button>
        <button onClick={handleReject} disabled={isLoadingAction} className="px-4 py-2 text-sm bg-white border border-gray-300 rounded hover:bg-gray-50 disabled:opacity-50">
          Reject
        </button>
        <button onClick={handleApprove} disabled={isLoadingAction} className="px-4 py-2 text-sm bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50">
          {approveMutation.isPending ? 'Approving...' : 'Approve'}
        </button>
      </div>
    </div>
  );
```

### 성공 기준

- [ ] Build 성공 (`npm run build` 오류 없음)
- [ ] Auto-Applied 탭이 4번째 탭으로 표시됨
- [ ] Auto-applied 상태의 리뷰에 녹색 "AUTO" 배지 표시
- [ ] Project 엔티티 선택 시 리뷰 폼 표시 (플레이스홀더 제거)
- [ ] 제안 필드에 노란색 배경 하이라이트 + 아이콘 표시
- [ ] 필드 수정 후 Approve 클릭 시 수정된 필드만 전송
- [ ] Reject/Dismiss 동작 정상 작동
- [ ] 기존 Task/Hypothesis 리뷰 기능 영향 없음 (regression 없음)

### 확인 사항

**Q1. ReviewFieldWrapper가 ProjectForm의 모든 필드 타입을 지원하는가?**
- ProjectForm uses: text input, select, ChipSelectExpand (multi-select)
- TaskForm pattern confirms ReviewFieldWrapper wraps entire field blocks
- Need to verify ChipSelectExpand compatibility

**Q2. ProjectForm의 program_id 필드는 review mode에서 어떻게 처리?**
- Check if program_id is in suggested_fields from tsk-n8n-23
- If not suggested, render normally without wrapper

**Q3. Auto-applied 리뷰는 수정 불가능하게 해야 하나?**
- Assumption: Auto-applied는 이미 적용된 상태이므로 view-only
- Confirm: ReviewFieldWrapper should show "Already applied" state

---

위 요구사항으로 진행할까요? 수정이 필요한 부분이 있다면 말씀해주세요!
