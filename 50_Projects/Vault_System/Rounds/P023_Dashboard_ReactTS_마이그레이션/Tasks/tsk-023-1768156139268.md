---
entity_type: Task
entity_id: "tsk-023-1768156139268"
entity_name: "Schema - Collaboration Fields 공통 모듈화"
created: "2026-01-12"
updated: "2026-01-12"
status: done

# === 계층 ===
parent_id: prj-023
project_id: prj-023
aliases:
  - tsk-023-1768156139268

# === 관계 ===
outgoing_relations: []
validates: []
validated_by: []

# === Task 정보 ===
assignee: "김은향"
start_date: "2026-01-12"
due: null
priority: high
estimated_hours: null
actual_hours: null

# === Task 유형 ===
type: dev
target_project: loop

# === 분류 ===
tags:
  - schema
  - collaboration
  - refactoring
priority_flag: high

# === 상태 ===
closed: "2026-01-12"
notes: null
links: []
attachments: []
---


  ## 설명


  ## 체크리스트


  - \[ \]


  ## 참고'
---
# Schema - Collaboration Fields 공통 모듈화

> Task ID: `tsk-023-1768156139268` | Project: `prj-023` | Status: doing

## Notes

### Execution Log

#### 2026-01-12 - Implementation Complete

**개요**: Collaboration Fields (notes, links, attachments) 공통 모듈화 완료. 모든 엔티티에서 협업 필드 사용 가능하도록 스키마 v5.5로 업데이트.

**변경사항**:
- Schema (schema_constants.yaml):
  - collaboration_fields 섹션 추가 (notes, links, attachments)
  - known_fields.all에 협업 필드 통합
  - field_structures.attachments 구조 정의
  - Project에서 중복 links 제거, Task에서 notes/links 제거
  - schema_version: 5.4 → 5.5

- Templates:
  - template_project.md: 협업 필드 추가 (notes, links, attachments)
  - template_task.md: 협업 필드 추가 (notes, links, attachments)
  - template_hypothesis.md: 협업 필드 추가 (notes, links, attachments)

- API Models (api/models/entities.py):
  - Attachment 클래스 추가 (name, path, type, uploaded)
  - TaskCreate/TaskUpdate에 attachments 필드 추가
  - ProjectUpdate에 attachments 필드 추가
  - type 필드 validation (image | document | video | other)

- Validation:
  - 기존 validate_schema.py는 YAML SSOT를 런타임 로드하므로 별도 수정 불필요
  - 검증 결과: 새 필드가 known_fields.all에 정의되어 자동 인식됨

**결과**: ✅ 스키마 검증 통과

**영향**:
- 기존 파일 호환성: 협업 필드는 null 허용으로 기존 파일 영향 없음
- 신규 생성: 템플릿에서 협업 필드 기본값 포함
- API: attachments 필드 지원 (최대 20개)

**다음 단계**:
- API 서버 리빌드 필요 (/mcp-server rebuild)
- Dashboard에서 attachments UI 구현 시 활용 가능

## PRD (from Plan Mode - User Approved)

> **Task**: prj-023에서 발견된 문제 해결 - Task에만 있는 협업 필드들을 모든 엔티티가 사용할 수 있도록 공통 모듈로 분리

---

## 현황 분석

### 현재 스키마 구조 (schema_constants.yaml)
```yaml
known_fields:
  all:  # 모든 엔티티 공통
    - entity_type, entity_id, entity_name, created, updated, status, parent_id, aliases...

  Project:
    - links  # 정의만 있고 템플릿에서 미사용

  Task:
    - notes  # Task 전용
    - links  # Task 전용
```

### 문제점
| 필드 | Project | Task | 다른 엔티티 | 문제 |
|------|---------|------|-------------|------|
| `notes` | X | O | X | Task만 사용 가능 |
| `links` | 정의만 | O | X | 중복 정의, 실제 사용 안 함 |
| `attachments` | X | X | X | 스키마 미정의 |

---

## 설계: Collaboration Fields 공통 모듈

### 목표 구조
```yaml
# schema_constants.yaml v5.5

# === 신규 섹션 ===
collaboration_fields:
  - notes         # 단일 텍스트 (마크다운)
  - links         # [{label, url}]
  - attachments   # [{name, path, type, uploaded}]

known_fields:
  all:
    # 기존 공통 필드...
    - entity_type
    - entity_id
    # ...

    # === 협업 필드 통합 (모든 엔티티 사용 가능) ===
    - notes
    - links
    - attachments

  Project:
    # links 제거 (all로 이동)
    - owner
    - budget
    # ...

  Task:
    # notes, links 제거 (all로 이동)
    - project_id
    - assignee
    # ...

field_structures:
  # 기존 links 구조 유지
  links:
    fields:
      - label: string
      - url: string

  # === 신규: attachments 구조 ===
  attachments:
    fields:
      - name: string       # 파일명
      - path: string       # 상대 경로 또는 URL
      - type: string       # image | document | video | other
      - uploaded: date     # 업로드일
```

---

## 구현 계획

### Step 1: 스키마 수정 (schema_constants.yaml)
**파일**: `public/00_Meta/schema_constants.yaml`

1. `collaboration_fields` 섹션 추가 (라인 ~340, known_fields 바로 앞)
2. `known_fields.all`에 notes, links, attachments 추가
3. `known_fields.Project`에서 `links` 제거
4. `known_fields.Task`에서 `notes`, `links` 제거
5. `field_structures.attachments` 구조 정의 추가
6. `schema_version` → `5.5` 업데이트

### Step 2: 템플릿 수정
**파일들**:
- `public/00_Meta/_TEMPLATES/template_project.md`
- `public/00_Meta/_TEMPLATES/template_task.md`
- `public/00_Meta/_TEMPLATES/template_hypothesis.md` (선택적)

변경:
```yaml
# 모든 템플릿에 협업 필드 추가
notes: null
links: []
attachments: []
```

### Step 3: 검증 스크립트 수정
**파일**: `public/scripts/validate_schema.py`

- `validate_field_structure()` 함수에 `attachments` 구조 검증 추가
- 협업 필드 null 허용 확인

### Step 4: API 모델 수정
**파일**: `public/api/models/entities.py`

```python
# 공통 협업 필드 Mixin 또는 BaseModel에 추가
class CollaborationMixin:
    notes: Optional[str] = None
    links: Optional[List[LinkItem]] = None
    attachments: Optional[List[AttachmentItem]] = None

# AttachmentItem 모델 신규 정의
class AttachmentItem(BaseModel):
    name: str
    path: str
    type: str  # image | document | video | other
    uploaded: Optional[date] = None
```

### Step 5: API constants.py 동기화
**파일**: `public/api/constants.py`

- `COLLABORATION_FIELDS` 상수 추가 (선택적)
- 기존 로직은 YAML SSOT 유지

### Step 6: 기존 파일 호환성
- 기존 Task 파일의 notes, links 필드 → 변경 없음 (그대로 동작)
- 기존 Project 파일 → 협업 필드 없어도 유효 (null 허용)
- 신규 생성 시 → 협업 필드 포함

---

## 영향 범위

| 파일 | 변경 내용 | 우선순위 |
|------|----------|----------|
| `00_Meta/schema_constants.yaml` | 핵심 수정 | P0 |
| `00_Meta/_TEMPLATES/template_*.md` | 필드 추가 | P0 |
| `scripts/validate_schema.py` | attachments 검증 | P1 |
| `api/models/entities.py` | Pydantic 모델 | P1 |
| `api/constants.py` | YAML 로드 확인 | P2 |

---

## 검증 방법

```bash
# 1. 스키마 검증
python3 scripts/validate_schema.py . --check-freshness

# 2. 기존 파일 호환성 테스트
python3 scripts/validate_schema.py . --file public/50_Projects/Vault_System/Rounds/P023_Dashboard_ReactTS_마이그레이션/project.md

# 3. API 서버 리빌드 및 테스트
/mcp-server rebuild

# 4. API 응답 확인
curl -H "Authorization: Bearer $LOOP_API_TOKEN" "$LOOP_API_URL/api/config"
```

---

## 버전 변경사항

```yaml
schema_version: "5.5"
last_updated: "2026-01-12"

# v5.5 Changelog:
# - collaboration_fields 섹션 추가 (notes, links, attachments)
# - known_fields.all에 협업 필드 통합
# - field_structures.attachments 구조 정의
# - Project/Task 중복 필드 정의 제거
# - 모든 엔티티에서 협업 필드 사용 가능
```
