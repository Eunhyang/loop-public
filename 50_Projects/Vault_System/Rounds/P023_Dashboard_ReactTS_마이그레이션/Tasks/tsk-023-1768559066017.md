---
entity_type: Task
entity_id: tsk-023-1768559066017
entity_name: Dashboard - Form migration
created: '2026-01-16'
updated: '2026-01-16'
status: done
closed: '2026-01-16'
project_id: prj-023
parent_id: prj-023
assignee: ê¹€ì€í–¥
priority: medium
start_date: '2026-01-16'
due: '2026-01-16'
aliases:
- tsk-023-1768559066017
tags: []
type: dev
---

# Dashboard - Form migration

## ì„¤ëª…

ëª¨ë“  entity formì„ `useEntityFormState` + `FormActions` íŒ¨í„´ìœ¼ë¡œ í†µì¼í•˜ì—¬ ì¼ê´€ëœ UXì™€ ì½”ë“œ ìœ ì§€ë³´ìˆ˜ì„± í™•ë³´.

**í˜„ì¬ ìƒíƒœ**:
| Form | íŒ¨í„´ | ë³µì¡ë„ |
|------|------|--------|
| ProjectForm | âœ… Modern | ì¤‘ |
| HypothesisForm | ğŸ”´ Legacy | ì¤‘ |
| ProgramForm | ğŸ”´ Legacy | ë‚® |
| TaskForm | ğŸŸ¡ Hybrid | ë†’ |

**ëª©í‘œ**: HypothesisForm, ProgramForm, TaskFormì„ ProjectFormê³¼ ë™ì¼í•œ íŒ¨í„´ìœ¼ë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜

## Notes

### Tech Spec

**Architecture Compliance:**
- Parent Project: prj-023
- Target: loop (dashboard-v2)

**Reference Implementation**: `src/features/projects/components/ProjectForm.tsx`

**Core Pattern**:
```typescript
// 1. Import forms ëª¨ë“ˆ
import { useEntityFormState, FormActions } from '@/features/forms';

// 2. FormData íƒ€ì… ì •ì˜ (extends Record<string, unknown>)
interface HypothesisFormData extends Record<string, unknown> {
  entity_name: string;
  // ...
}

// 3. useEntityFormState í›… ì‚¬ìš©
const {
  values: formData,
  setField,
  errors,
  canSave,
  handleSave,
} = useEntityFormState<HypothesisFormData>({
  initialData,
  mode,
  validate: validateForm,
  onSubmit: (payload) => { ... },
  isSaving,
});

// 4. FormActionsë¡œ footer ë Œë”
<FormActions
  canSave={canSave}
  isSaving={isSaving}
  onSave={handleSave}
  onClose={onClose}
  onDelete={mode === 'edit' ? handleDelete : undefined}
/>
```

**File Structure:**
```
dashboard-v2/src/features/
â”œâ”€â”€ strategy/components/
â”‚   â”œâ”€â”€ HypothesisForm.tsx        # ìˆ˜ì • (useEntityFormState ì ìš©)
â”‚   â””â”€â”€ HypothesisFormLegacy.tsx  # ì‹ ê·œ (ë°±ì—…)
â”œâ”€â”€ programs/components/
â”‚   â”œâ”€â”€ ProgramForm.tsx           # ìˆ˜ì • (useEntityFormState ì ìš©)
â”‚   â””â”€â”€ ProgramFormLegacy.tsx     # ì‹ ê·œ (ë°±ì—…)
â””â”€â”€ tasks/components/
    â”œâ”€â”€ TaskForm.tsx              # ìˆ˜ì • (ì „ì²´ ë§ˆì´ê·¸ë ˆì´ì…˜)
    â””â”€â”€ TaskFormLegacy.tsx        # ì‹ ê·œ (ë°±ì—…)
```

**Implementation Details:**

1. **HypothesisForm** (~250ì¤„):
   - `PropertiesGrid/PropertyRow` ë ˆì´ì•„ì›ƒ ìœ ì§€
   - `PercentSlider`, `MarkdownEditor` ì»´í¬ë„ŒíŠ¸ ìœ ì§€
   - Create/Edit mode ëª¨ë‘ useEntityFormState ì ìš©
   - Review mode ì§€ì› ì¶”ê°€ (`useReviewMode` ì—°ë™)
   - Footer â†’ `FormActions` êµì²´

2. **ProgramForm** (~150ì¤„):
   - Create/Edit mode ëª¨ë‘ useEntityFormState ì ìš©
   - Footer â†’ `FormActions` êµì²´
   - ê°„ë‹¨í•œ í•„ë“œ êµ¬ì„± (entity_name, program_type, owner, description)

3. **TaskForm** (~1,100ì¤„, ê°€ì¥ ë³µì¡):
   - Create + Edit mode ëª¨ë‘ useEntityFormState ì ìš©
   - Edit mode autosave ì œê±° â†’ Manual Saveë¡œ ë³€ê²½
   - AI NL parsing, templates ê¸°ëŠ¥ ìœ ì§€
   - Footer â†’ `FormActions` í†µì¼

**Edge Cases:**
- Edit modeì—ì„œ ë°ì´í„° ë¡œë”© ì „ formDataê°€ undefinedì¸ ê²½ìš° â†’ initialFormData useMemoì—ì„œ ì²˜ë¦¬
- ë™ì‹œ í¸ì§‘ ì‹œ optimistic update ì¶©ëŒ â†’ expected_updated_at ì‚¬ìš©
- Review modeì—ì„œ suggestedFields ì ìš© ì‹œ ê¸°ì¡´ ê°’ê³¼ ë¨¸ì§€ í•„ìš”

### Todo

- [ ] HypothesisForm: HypothesisFormLegacy.tsxë¡œ ë°±ì—… ìƒì„±
- [ ] HypothesisForm: useEntityFormState í›… ì ìš©
- [ ] HypothesisForm: FormActions ì»´í¬ë„ŒíŠ¸ë¡œ footer êµì²´
- [ ] HypothesisForm: Review mode ì§€ì› ì¶”ê°€
- [ ] HypothesisForm: ë¹Œë“œ ê²€ì¦ (npm run build)
- [ ] ProgramForm: ProgramFormLegacy.tsxë¡œ ë°±ì—… ìƒì„±
- [ ] ProgramForm: useEntityFormState í›… ì ìš©
- [ ] ProgramForm: FormActions ì»´í¬ë„ŒíŠ¸ë¡œ footer êµì²´
- [ ] ProgramForm: ë¹Œë“œ ê²€ì¦ (npm run build)
- [ ] TaskForm: TaskFormLegacy.tsxë¡œ ë°±ì—… ìƒì„±
- [ ] TaskForm: Create + Edit mode useEntityFormState ì ìš©
- [ ] TaskForm: Edit mode autosave â†’ Manual Save ë³€ê²½
- [ ] TaskForm: FormActions ì»´í¬ë„ŒíŠ¸ë¡œ footer êµì²´
- [ ] TaskForm: AI NL parsing, templates ê¸°ëŠ¥ ìœ ì§€ í™•ì¸
- [ ] TaskForm: ë¹Œë“œ ê²€ì¦ (npm run build)
- [ ] ì „ì²´ ìˆ˜ë™ í…ŒìŠ¤íŠ¸: Create/Edit/View mode ë™ì‘ í™•ì¸

## ì°¸ê³ 

- Reference: `src/features/forms/` (useEntityFormState, FormActions)
- Reference: `src/features/projects/components/ProjectForm.tsx` (modern pattern)
- ê¸°ì¡´ ê³„íš: Entity Form ë§ˆì´ê·¸ë ˆì´ì…˜ ê³„íš (plan file)

### ì‘ì—… ë¡œê·¸

#### 2026-01-16 20:16
**ê°œìš”**: HypothesisForm, ProgramForm, TaskForm ë§ˆì´ê·¸ë ˆì´ì…˜ ì™„ë£Œ

**ë³€ê²½ì‚¬í•­**:
- **Phase 1**: HypothesisForm (~400ì¤„)
  - `useState` â†’ `useEntityFormState` í›… ì ìš©
  - `FormActions` ì»´í¬ë„ŒíŠ¸ë¡œ footer í†µì¼
  - Review mode ì§€ì› ì¶”ê°€ (useReviewMode ì—°ë™)
  - Validation function í†µí•©
  - Create/Edit ëª¨ë“œ ëª¨ë‘ í†µí•© íŒ¨í„´ ì ìš©

- **Phase 2**: ProgramForm (~150ì¤„)
  - Create/Edit ëª¨ë“œ useEntityFormState ì ìš©
  - FormActions footer êµì²´
  - ê°„ë‹¨í•œ êµ¬ì¡°ë¡œ ë¹ ë¥¸ ë§ˆì´ê·¸ë ˆì´ì…˜

- **Phase 3**: TaskForm (~1,100ì¤„, ê°€ì¥ ë³µì¡)
  - Autosave ì œê±° â†’ Manual Save ë²„íŠ¼
  - Create + Edit ëª¨ë“œ í†µí•©
  - AI NL parsing, templates ê¸°ëŠ¥ ìœ ì§€
  - Project status dialog ë¡œì§ ìœ ì§€
  - LinkEditor, AttachmentPanel, CommentSection ëª¨ë‘ ìœ ì§€

**íŒŒì¼ ë³€ê²½**:
- ìˆ˜ì •: `HypothesisForm.tsx`, `ProgramForm.tsx`, `TaskForm.tsx`
- ì‹ ê·œ (ë°±ì—…): `*Legacy.tsx` 3ê°œ íŒŒì¼ (rollback safety)
- ì´ 6ê°œ íŒŒì¼, +2,450 / -482 ì¤„

**ê¸°ìˆ  ì´ìŠˆ í•´ê²°**:
- TypeScript ì˜¤ë¥˜ ìˆ˜ì • (unused imports, API call signatures)
- `HypothesisDetailResponse` â†’ `.data` ì§ì ‘ ì‚¬ìš©
- TaskForm type casting (onSubmit handlers)

**ê²€ì¦**:
- âœ… TypeScript ì»´íŒŒì¼ ì„±ê³µ
- âœ… Dashboard ë¹Œë“œ ì„±ê³µ
- âœ… NAS ë°°í¬ ì™„ë£Œ (https://mcp.sosilab.synology.me/v2/)

**ê²°ê³¼**:
- 3ê°œ form ëª¨ë‘ unified pattern ì ìš© ì™„ë£Œ
- ì¼ê´€ëœ UX (manual Save ë²„íŠ¼)
- ì½”ë“œ ìœ ì§€ë³´ìˆ˜ì„± í–¥ìƒ
- ëª¨ë“  ê¸°ì¡´ ê¸°ëŠ¥ ìœ ì§€

**ì»¤ë°‹**:
- Main: `ed9ddbfe6` (feat: migrate forms)
- Fix: `d7c2e4421` (fix: TypeScript errors)
- Fix: `fd92a2d25` (fix: unused params)
