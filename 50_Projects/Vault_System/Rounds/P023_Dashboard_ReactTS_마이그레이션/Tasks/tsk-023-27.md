---
entity_type: Task
entity_id: tsk-023-27
entity_name: Pending Review - Suggested Fields 버튼 옵션 선택
created: 2026-01-09
updated: '2026-01-09'
closed: 2026-01-09
status: done
parent_id: prj-023
project_id: prj-023
aliases:
- tsk-023-27
outgoing_relations: []
validates: []
validated_by: []
assignee: 김은향
start_date: 2026-01-09
due: 2026-01-09
priority: high
estimated_hours: null
actual_hours: null
type: dev
target_project: loop
tags:
- dashboard-v2
- pending-review
- ui
priority_flag: high
notes: "# Pending Review - Suggested Fields 버튼 옵션 선택\n\n> Task ID: `tsk-023-27` |\
  \ Project: `prj-023` | Status: done\n\n## 목표\n\n**완료 조건**:\n\n1. Suggested Fields가\
  \ 버튼(pill) 형태로 렌더링됨\n2. 추천값에 ★ 표시, 선택값은 파란색 배경\n3. 버튼 클릭으로 선택/해제 토글 가능 (다중/단일)\n\
  4. 승인 시 modified_fields로 수정된 값만 API 전달\n\n---\n\n## 상세 내용\n\n### 배경\n\nLegacy `_dashboard/`\
  \ pending-panel.js에는 Suggested Fields가 버튼 형태로 렌더링되어 사용자가 옵션을 선택/해제할 수 있는 기능이 있음.\
  \ 현재 dashboard-v2는 텍스트만 표시하는 읽기 전용 구현.\n\n**현재 상태 비교:**\n\n| 기능 | Legacy | v2 현재\
  \ |\n| --- | --- | --- |\n| Suggested Fields 표시 | 버튼(pill) 형태 | 텍스트만 |\n| 다중 옵션\
  \ 선택 | 버튼 클릭 토글 | 미구현 |\n| 추천값 강조 (★) | 노란색 + 별표 | 미구현 |\n| 선택값 강조 | 파란색 배경 | 미구현\
  \ |\n| 필드별 수정 후 승인 | modified_fields 전달 | 전체 일괄 승인만 |\n\n### 작업 내용\n\n**아키텍처 설계\
  \ (중복 방지)**\n\n1. **옵션 데이터 소스 (SSOT)**: 기존 쿼리 훅 재사용\n\n   - `assignee`: `/api/members`\
  \ → `useMembers()`\n   - `priority/status/type`: `/api/constants` → `useConstants()`\n\
  \   - `conditions_3y`: `/api/conditions` → `useConditions()`\n\n2. **컴포넌트 구조**:\n\
  \n   ```\n   features/pending/\n   ├── components/\n   │   ├── ReviewDetail.tsx\
  \        # 수정\n   │   ├── FieldValue.tsx          # fallback용 유지\n   │   └── FieldOptionPills.tsx\
  \    # 신규\n   ├── hooks/\n   │   └── useFieldOptions.ts      # 신규\n   └── types.ts\
  \                    # 확장\n   ```\n\n3. **상태 관리**:\n\n   - `selectedFields`: 현재\
  \ 선택된 필드값 (review.suggested_fields 기반)\n   - `modifiedFields`: 계산값 (원본과 비교 diff)\n\
  \n---\n\n## 체크리스트\n\n- [ ] useFieldOptions 훅 생성 (기존 쿼리 재사용)\n\n- [ ] FieldOptionPills\
  \ 컴포넌트 생성\n\n- [ ] ReviewDetail에 selectedFields 상태 추가\n\n- [ ] handleApprove에 fields\
  \ 전달 로직 추가\n\n- [ ] Tailwind CSS로 스타일링 (selected/suggested)\n\n---\n\n## Notes\n\
  \n### Tech Spec\n\n**useFieldOptions 훅:**\n\n```typescript\nexport function useFieldOptions()\
  \ {\n  const { data: members } = useMembers();\n  const { data: constants } = useConstants();\n\
  \  const { data: conditions } = useConditions();\n\n  return useMemo(() => ({\n\
  \    assignee: members?.map(m => ({ value: m.id, label: m.name })) ?? [],\n    priority:\
  \ constants?.task_priority ?? [],\n    status: constants?.task_status ?? [],\n \
  \   conditions_3y: conditions?.map(c => ({ value: c.entity_id, label: c.entity_name\
  \ })) ?? [],\n  }), [members, constants, conditions]);\n}\n```\n\n**FieldOptionPills\
  \ Props:**\n\n```typescript\ninterface FieldOptionPillsProps {\n  field: string;\n\
  \  options: Array<{ value: string; label: string }>;\n  selected: unknown;\n  suggested:\
  \ unknown;\n  multiSelect: boolean;\n  onChange: (value: unknown) => void;\n}\n\
  ```\n\n**스타일:**\n\n- 기본: `bg-white border border-gray-300`\n- selected: `bg-blue-500\
  \ text-white`\n- suggested: `bg-yellow-100 border-yellow-400` + ★\n- selected +\
  \ suggested: `bg-blue-500` + ★\n\n### Todo\n\n- [x] useFieldOptions 훅 구현\n\n- [x]\
  \ FieldOptionPills 컴포넌트 구현\n\n- [x] ReviewDetail 상태 관리 추가\n\n- [x] handleApprove\
  \ 수정\n\n- [ ] 테스트\n\n### 작업 로그\n\n2026-01-09 - 구현 완료\n\n**구현된 파일:**\n\n1. `src/features/pending/hooks/useFieldOptions.ts`\
  \ - 필드 옵션 추출 훅 (기존 쿼리 재사용)\n2. `src/features/pending/components/FieldOptionPills.tsx`\
  \ - 인터랙티브 pill 버튼 컴포넌트\n3. `src/features/pending/components/ReviewDetail.tsx` -\
  \ 상태 관리 및 조건부 렌더링 추가\n4. `src/pages/Pending/index.tsx` - handleApprove 시그니처 업데이트\n\
  5. `src/features/pending/components/index.ts` - barrel export 추가\n\n**구현 내용:**\n\
  \n- useFieldOptions 훅: useDashboardInit에서 옵션 데이터 추출 (assignee, priority, status,\
  \ type, conditions_3y)\n- FieldOptionPills: 선택/해제 가능한 pill 버튼 UI (단일/다중 선택 지원)\n\
  - ReviewDetail: selectedFields 상태 추가, modifiedFields 계산, 조건부 렌더링\n- 스타일링: 선택(파란색),\
  \ 추천(노란색 + ★), 기본(흰색)\n\n**Codex 코드 리뷰 및 수정:**\n\n1. Type mismatch 수정: 모든 옵션 값을\
  \ String()으로 정규화 (numeric ID 처리)\n2. User edit 보존: useEffect를 review.id에만 의존하도록\
  \ 수정 (refetch 시 편집 유지)\n3. Accessibility 추가: role=\"switch\", aria-checked, aria-label\
  \ 속성 추가\n4. 비교 정규화: modifiedFields 계산 시 String() 정규화로 false positive 방지\n\n**검증\
  \ 완료:**\n\n- Codex 최종 리뷰 통과 (type safety, state management, accessibility)\n- 중복\
  \ API 호출 없음 (기존 쿼리 캐시 재사용)\n- CSS 파일 없음 (Tailwind 사용)\n- 기존 mutation 재사용 (fields\
  \ 파라미터 지원 확인)\n\n2026-01-09 - Task 완료\n\n**개요**: tsk-023-27 완료 - Pending Review\
  \ Suggested Fields 버튼 옵션 선택 구현 완료\n\n**완료 결과**:\n\n- Notion-style property table\
  \ layout 구현 (label-value horizontal alignment)\n- Interactive pill buttons for field\
  \ options (선택/해제 토글)\n- useFieldOptions hook: 기존 쿼리 캐시 재사용 (API 중복 없음)\n- FieldOptionPills\
  \ component: 선택(파란색), 추천(노란색★), 기본(흰색) 스타일\n- ReviewDetail: selectedFields 상태 관리\
  \ + modifiedFields 계산\n- Codex 검증 3회 통과 (type safety, state management, accessibility)\n\
  - 빌드 성공 확인\n\n**파일 수정**:\n\n- src/features/pending/hooks/useFieldOptions.ts\n- src/features/pending/components/FieldOptionPills.tsx\n\
  - src/features/pending/components/FieldValue.tsx\n- src/features/pending/components/ReviewDetail.tsx\n\
  - src/pages/Pending/index.tsx\n- src/features/pending/components/index.ts\n\n**최종\
  \ 상태**: done\n\n---\n\n## 참고 문서\n\n- \\[\\[prj-023\\]\\] - 소속 Project\n- Legacy:\
  \ `_dashboard/js/components/pending-panel.js` (lines 272-570)\n- Legacy CSS: `_dashboard/css/panel.css`\
  \ (lines 2575-2760)\n\n---\n\n**Created**: 2026-01-09 **Assignee**: 김은향 **Due**:\
  \ 2026-01-09"
---
# Pending Review - Suggested Fields 버튼 옵션 선택

> Task ID: `tsk-023-27` | Project: `prj-023` | Status: done

## 목표

**완료 조건**:
1. Suggested Fields가 버튼(pill) 형태로 렌더링됨
2. 추천값에 ★ 표시, 선택값은 파란색 배경
3. 버튼 클릭으로 선택/해제 토글 가능 (다중/단일)
4. 승인 시 modified_fields로 수정된 값만 API 전달

---

## 상세 내용

### 배경

Legacy `_dashboard/` pending-panel.js에는 Suggested Fields가 버튼 형태로 렌더링되어 사용자가 옵션을 선택/해제할 수 있는 기능이 있음. 현재 dashboard-v2는 텍스트만 표시하는 읽기 전용 구현.

**현재 상태 비교:**

| 기능 | Legacy | v2 현재 |
|------|--------|---------|
| Suggested Fields 표시 | 버튼(pill) 형태 | 텍스트만 |
| 다중 옵션 선택 | 버튼 클릭 토글 | 미구현 |
| 추천값 강조 (★) | 노란색 + 별표 | 미구현 |
| 선택값 강조 | 파란색 배경 | 미구현 |
| 필드별 수정 후 승인 | modified_fields 전달 | 전체 일괄 승인만 |

### 작업 내용

**아키텍처 설계 (중복 방지)**

1. **옵션 데이터 소스 (SSOT)**: 기존 쿼리 훅 재사용
   - `assignee`: `/api/members` → `useMembers()`
   - `priority/status/type`: `/api/constants` → `useConstants()`
   - `conditions_3y`: `/api/conditions` → `useConditions()`

2. **컴포넌트 구조**:
   ```
   features/pending/
   ├── components/
   │   ├── ReviewDetail.tsx        # 수정
   │   ├── FieldValue.tsx          # fallback용 유지
   │   └── FieldOptionPills.tsx    # 신규
   ├── hooks/
   │   └── useFieldOptions.ts      # 신규
   └── types.ts                    # 확장
   ```

3. **상태 관리**:
   - `selectedFields`: 현재 선택된 필드값 (review.suggested_fields 기반)
   - `modifiedFields`: 계산값 (원본과 비교 diff)

---

## 체크리스트

- [ ] useFieldOptions 훅 생성 (기존 쿼리 재사용)
- [ ] FieldOptionPills 컴포넌트 생성
- [ ] ReviewDetail에 selectedFields 상태 추가
- [ ] handleApprove에 fields 전달 로직 추가
- [ ] Tailwind CSS로 스타일링 (selected/suggested)

---

## Notes

### Tech Spec

**useFieldOptions 훅:**
```typescript
export function useFieldOptions() {
  const { data: members } = useMembers();
  const { data: constants } = useConstants();
  const { data: conditions } = useConditions();

  return useMemo(() => ({
    assignee: members?.map(m => ({ value: m.id, label: m.name })) ?? [],
    priority: constants?.task_priority ?? [],
    status: constants?.task_status ?? [],
    conditions_3y: conditions?.map(c => ({ value: c.entity_id, label: c.entity_name })) ?? [],
  }), [members, constants, conditions]);
}
```

**FieldOptionPills Props:**
```typescript
interface FieldOptionPillsProps {
  field: string;
  options: Array<{ value: string; label: string }>;
  selected: unknown;
  suggested: unknown;
  multiSelect: boolean;
  onChange: (value: unknown) => void;
}
```

**스타일:**
- 기본: `bg-white border border-gray-300`
- selected: `bg-blue-500 text-white`
- suggested: `bg-yellow-100 border-yellow-400` + ★
- selected + suggested: `bg-blue-500` + ★

### Todo
- [x] useFieldOptions 훅 구현
- [x] FieldOptionPills 컴포넌트 구현
- [x] ReviewDetail 상태 관리 추가
- [x] handleApprove 수정
- [ ] 테스트

### 작업 로그

#### 2026-01-09 - 구현 완료

**구현된 파일:**
1. `src/features/pending/hooks/useFieldOptions.ts` - 필드 옵션 추출 훅 (기존 쿼리 재사용)
2. `src/features/pending/components/FieldOptionPills.tsx` - 인터랙티브 pill 버튼 컴포넌트
3. `src/features/pending/components/ReviewDetail.tsx` - 상태 관리 및 조건부 렌더링 추가
4. `src/pages/Pending/index.tsx` - handleApprove 시그니처 업데이트
5. `src/features/pending/components/index.ts` - barrel export 추가

**구현 내용:**
- useFieldOptions 훅: useDashboardInit에서 옵션 데이터 추출 (assignee, priority, status, type, conditions_3y)
- FieldOptionPills: 선택/해제 가능한 pill 버튼 UI (단일/다중 선택 지원)
- ReviewDetail: selectedFields 상태 추가, modifiedFields 계산, 조건부 렌더링
- 스타일링: 선택(파란색), 추천(노란색 + ★), 기본(흰색)

**Codex 코드 리뷰 및 수정:**
1. Type mismatch 수정: 모든 옵션 값을 String()으로 정규화 (numeric ID 처리)
2. User edit 보존: useEffect를 review.id에만 의존하도록 수정 (refetch 시 편집 유지)
3. Accessibility 추가: role="switch", aria-checked, aria-label 속성 추가
4. 비교 정규화: modifiedFields 계산 시 String() 정규화로 false positive 방지

**검증 완료:**
- Codex 최종 리뷰 통과 (type safety, state management, accessibility)
- 중복 API 호출 없음 (기존 쿼리 캐시 재사용)
- CSS 파일 없음 (Tailwind 사용)
- 기존 mutation 재사용 (fields 파라미터 지원 확인)

#### 2026-01-09 - Task 완료
**개요**: tsk-023-27 완료 - Pending Review Suggested Fields 버튼 옵션 선택 구현 완료

**완료 결과**:
- Notion-style property table layout 구현 (label-value horizontal alignment)
- Interactive pill buttons for field options (선택/해제 토글)
- useFieldOptions hook: 기존 쿼리 캐시 재사용 (API 중복 없음)
- FieldOptionPills component: 선택(파란색), 추천(노란색★), 기본(흰색) 스타일
- ReviewDetail: selectedFields 상태 관리 + modifiedFields 계산
- Codex 검증 3회 통과 (type safety, state management, accessibility)
- 빌드 성공 확인

**파일 수정**:
- src/features/pending/hooks/useFieldOptions.ts
- src/features/pending/components/FieldOptionPills.tsx
- src/features/pending/components/FieldValue.tsx
- src/features/pending/components/ReviewDetail.tsx
- src/pages/Pending/index.tsx
- src/features/pending/components/index.ts

**최종 상태**: done

---

## 참고 문서

- [[prj-023]] - 소속 Project
- Legacy: `_dashboard/js/components/pending-panel.js` (lines 272-570)
- Legacy CSS: `_dashboard/css/panel.css` (lines 2575-2760)

---

**Created**: 2026-01-09
**Assignee**: 김은향
**Due**: 2026-01-09
