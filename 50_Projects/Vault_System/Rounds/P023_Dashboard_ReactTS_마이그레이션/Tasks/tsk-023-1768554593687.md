---
entity_type: Task
entity_id: tsk-023-1768554593687
entity_name: Dashboard - Entity Form 패턴 통일 (로컬 상태 + Save 버튼)
created: '2026-01-16'
updated: '2026-01-16'
status: todo
project_id: prj-023
parent_id: prj-023
assignee: 김은향
priority: medium
start_date: '2026-01-16'
due: '2026-01-16'
aliases:
- tsk-023-1768554593687
tags: []
type: dev
---

# Dashboard - Entity Form 패턴 통일 (로컬 상태 + Save 버튼)

## 설명

모든 엔티티 폼(Task/Project/Program/Track/Condition/Hypothesis)의 UX를 "로컬 상태에 모아 Save 눌러야 저장"으로 통일하고, 이를 지원하는 공통 Form 모듈을 도입하되 feature 경계를 보존.

**배경**: 현재 폼 UX가 엔티티별로 다름. TaskForm은 필드 단위 즉시 PATCH, ProjectForm은 onBlur 로컬 상태 + Save 버튼 조합. 사용자 혼란(입력 후 Save 비활성 등)과 코드 패턴 분산이 발생.

## Notes

### Tech Spec

**Architecture Compliance:**
- Parent Project: prj-023 (Dashboard - React+TS 마이그레이션)
- Target: loop (dashboard-v2)
- Scope: `dashboard-v2/src/**`

**Functional Requirements:**
- FR1: 모든 엔티티 폼에서 변경 즉시 로컬 상태/dirty 반영, Save 버튼을 눌러야만 서버 반영
- FR2: 공통 Form 모듈 추가 (ChipSelect/MarkdownEditor 등 slot/children 기반 레이아웃)
- FR3: ProjectForm를 새 패턴으로 교체, 기존은 ProjectFormLegacy로 보존
- FR4: Task/Program/Track/Condition/Hypothesis 단계적 전환 가능하도록 훅/레이아웃 재사용성 확보

**Non-Goals:**
- 자동 저장(Auto-save) 유지/추가 없음
- DrawerShell, UiContext 구조 변경 없음
- API 스키마 변경 없음

**Success Criteria:**
- 필드 타이핑만 해도 Save 버튼이 즉시 활성화 (포커스 전환 필요 없음)
- Save 누르기 전까지 서버 데이터 변경 없음
- `npm run build` 통과, TypeScript 에러 없음
- common→feature 역참조 0건

**File Structure:**
```
dashboard-v2/src/
├── features/forms/                          # 새 디렉토리
│   ├── index.ts                             # barrel export
│   ├── hooks/
│   │   └── useEntityFormState.ts            # 핵심 훅
│   ├── components/
│   │   ├── EntityFormLayout.tsx             # 헤더/바디/푸터 슬롯 레이아웃
│   │   ├── FormSection.tsx                  # 섹션 래퍼 (제목/설명)
│   │   ├── FormField.tsx                    # 필드 래퍼 (라벨/에러)
│   │   └── FormActions.tsx                  # Save/Cancel 버튼 바
│   └── types.ts                             # Form 관련 타입
├── features/projects/components/
│   ├── ProjectFormLegacy.tsx                # 기존 파일 리네임
│   └── ProjectForm.tsx                      # 새 구현
└── components/layout/
    └── EntityDrawer.tsx                     # import 경로 수정
```

**Implementation Details:**

1. **useEntityFormState<TData, TPayload> 훅**
   - 입력: `initialData`, `serialize(changes)`, `validate(data)`, `onSubmit(payload)`, `mode`
   - 기능:
     - `value/onChange`로 즉시 로컬 state 업데이트
     - `dirtyFields`/`hasChanges` 계산
     - `errors` 관리 (필수값, 비즈니스 룰)
     - `handleSave`: React Query mutation 주입, 성공 시 dirty reset
   - 출력: `values`, `setField`, `errors`, `isDirty`, `isSaving`, `canSave`

2. **EntityFormLayout 컴포넌트**
   - Props: `header`, `children`, `footer`, `onClose`
   - DrawerShell 안에서 사용
   - 기존 UI 컴포넌트(ChipSelect, MarkdownEditor 등) children으로 전달 가능

3. **ProjectForm 신규 구현**
   - 데이터 로드: 기존 `useProject`/`useDashboardInit` 사용 (SSOT 유지)
   - 상태: `useEntityFormState`로 로컬 값/dirty 관리
   - Save: `serialize(changes)` 결과만 PATCH (`useUpdateProject`)
   - 검증: 필수값(entity_name, owner) + active 시 expected_impact 필수 등

**Edge Cases:**
- 사용자가 필드 수정 후 Save 없이 Drawer 닫기 시 → 기존 정책 유지 (경고 없이 닫기, 후속 UX 개선 가능)
- serialize 중 빈 배열/객체 필드 → diff 비교 헬퍼로 정규화
- dirty 계산 시 배열/객체 비교 → 얕은 비교 헬퍼 제공

**Dependencies:**
- 기존 SSOT: `src/services/http.ts`, `src/types/*`, `src/queries/keys.ts`
- 기존 queries: `useProject`, `useUpdateProject`, `useDeleteProject`

### Todo
- [ ] T1: `src/features/forms/` 디렉토리 생성, `useEntityFormState` + 레이아웃 컴포넌트 추가
- [ ] T2: ProjectForm 레거시 리네임 (`ProjectForm.tsx` → `ProjectFormLegacy.tsx`)
- [ ] T3: EntityDrawer import 스위치 (새 ProjectForm으로 변경)
- [ ] T4: 새 ProjectForm 작성 (새 패턴 적용, 검증/삭제/리뷰 모드 호환)
- [ ] T5: 빌드 검증 (`npm run build` 통과)
- [ ] T6: 수동 테스트 (Project 드로어에서 필드 수정→Save 활성화 확인→Save 후 API 반영 확인)

## 체크리스트

- [ ] T1: forms 모듈 생성
- [ ] T2: ProjectFormLegacy 리네임
- [ ] T3: EntityDrawer import 수정
- [ ] T4: 새 ProjectForm 구현
- [ ] T5: 빌드 검증
- [ ] T6: 수동 테스트

## 참고

- PRD 원본: `.agent/plan/prd-techspec-entity-form-unification.md`
- 프로젝트 아키텍처: `prj-023` project.md (Dashboard V2 Architecture & LLM Work Rules)
- 후속 작업: Task/Program/Track/Condition/Hypothesis 폼 마이그레이션 (별도 Task)
