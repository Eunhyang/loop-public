---
entity_type: Task
entity_id: "tsk-023-1768155181799"
entity_name: "Dashboard - Pending Review Expected Impact UI 개선"
project_id: prj-023
assignee: "김은향"
status: todo
type: dev
created_at: "2026-01-12"
due_date: null
---

> Task ID: `tsk-023-1768155181799` | Project: `prj-023` | Status: todo

## Summary

Pending Review 페이지의 Expected Impact 섹션 UI 개선

## Notes

## Enhanced Requirements (Prompt Enhancer)

### 프로젝트 컨텍스트
- **Framework**: React 19 + TypeScript
- **Architecture**: Feature-based Clean Architecture (dashboard-v2 규칙)
- **State Management**: React Query (서버 상태), URL params + localStorage (UI 상태)
- **UI Library**: Tailwind CSS
- **Target File**: `ProjectForm.tsx` (39KB, 현재 view-only로 Expected Impact 표시)

### 아키텍처 도식

```
┌─────────────────────────────────────────────────────────────┐
│ Expected Impact UI 개선 아키텍처                             │
├─────────────────────────────────────────────────────────────┤
│                                                               │
│  ProjectForm.tsx (Orchestration)                             │
│       │                                                       │
│       ├─→ ExpectedImpactEditor                               │
│       │      ├─ Tier/Magnitude/Confidence 편집               │
│       │      ├─ ImpactScoreDisplay (점수 + ? 버튼)           │
│       │      └─ ImpactExplainerModal (점수 설명)             │
│       │                                                       │
│       ├─→ TrackContributionEditor                            │
│       │      ├─ Track 버튼 렌더링 (ChipSelect 활용)         │
│       │      ├─ weight 입력 + 합계 검증 (≤100%)              │
│       │      └─ Track 클릭 → UiContext → right panel         │
│       │                                                       │
│       └─→ HypothesisSelector                                 │
│              ├─ Validates 드롭다운 (multi-select)            │
│              ├─ Primary Hypothesis 드롭다운 (single)         │
│              └─ Hypothesis 클릭 → right panel                │
│                                                               │
├─────────────────────────────────────────────────────────────┤
│  Shared Utilities & Types                                    │
├─────────────────────────────────────────────────────────────┤
│                                                               │
│  features/impact/types.ts                                    │
│      └─ ImpactScore, TrackContribution 확장 타입            │
│                                                               │
│  features/impact/utils/calculator.ts                         │
│      └─ calculateExpectedScore()                             │
│         └─ magnitude_points[tier][magnitude] × confidence    │
│                                                               │
│  impact_model_config.yml (SSOT)                              │
│      └─ tier, magnitude, confidence 정의 + magnitude_points  │
│                                                               │
└─────────────────────────────────────────────────────────────┘

Data Flow:
1. ProjectForm → ExpectedImpactEditor → onChange → ProjectForm state
2. calculator.ts → magnitude_points 참조 → 점수 계산 (0.32/3.0 형식)
3. ImpactExplainerModal → impact_model_config.yml 읽어서 설명 렌더링
```

### 구현 범위

#### 1. `features/impact/types.ts` (신규)
- **위치**: `dashboard-v2/src/features/impact/types.ts`
- **목적**: Impact 관련 확장 타입 정의
- **구현 내용**:
  ```typescript
  // Extends existing types/project.ts
  export interface ImpactScoreCalculation {
    score: number;
    maxScore: number;
    tier: 'strategic' | 'enabling' | 'operational';
    magnitude: 'high' | 'mid' | 'low';
    confidence: number;
  }

  export interface TrackContributionExtended {
    to: string;
    weight: number;
    rationale?: string;
    trackName?: string; // for display
  }
  ```

#### 2. `features/impact/utils/calculator.ts` (신규)
- **위치**: `dashboard-v2/src/features/impact/utils/calculator.ts`
- **목적**: Expected Score 계산 (SSOT: impact_model_config.yml)
- **구현 내용**:
  ```typescript
  // magnitude_points from config (hardcoded for frontend, API is SSOT)
  const MAGNITUDE_POINTS = {
    strategic: { high: 10, mid: 6, low: 3 },
    enabling: { high: 5, mid: 3, low: 1.5 },
    operational: { high: 2, mid: 1, low: 0.5 }
  };

  export function calculateExpectedScore(
    tier: string,
    magnitude: string,
    confidence: number
  ): ImpactScoreCalculation {
    const points = MAGNITUDE_POINTS[tier]?.[magnitude] || 0;
    const score = points * confidence;
    const maxScore = MAGNITUDE_POINTS[tier]?.high || 10;

    return { score, maxScore, tier, magnitude, confidence };
  }
  ```

#### 3. `features/impact/components/ImpactExplainerModal.tsx` (신규)
- **위치**: `dashboard-v2/src/features/impact/components/ImpactExplainerModal.tsx`
- **목적**: "?" 클릭 시 점수 계산 방식 설명 모달
- **UI 요구사항**:
  - Overlay + center modal
  - 제목: "Expected Impact Score 계산 방식"
  - 본문:
    - `magnitude_points` 테이블 (tier × magnitude → 점수)
    - 공식: `score = points × confidence`
    - 예시: strategic + high + 0.8 → 10 × 0.8 = 8.0 / 10.0
  - Close 버튼
- **Props**: `isOpen: boolean`, `onClose: () => void`, `currentScore?: ImpactScoreCalculation`

#### 4. `features/impact/components/ImpactScoreDisplay.tsx` (신규)
- **위치**: `dashboard-v2/src/features/impact/components/ImpactScoreDisplay.tsx`
- **목적**: 실시간 점수 표시 + "?" 버튼
- **UI 요구사항**:
  - 형식: `0.32 / 3.0` (소수점 2자리)
  - "?" 버튼 (hover: "점수 계산 방식 보기")
  - 클릭 → ImpactExplainerModal open
- **Props**: `score: ImpactScoreCalculation`

#### 5. `features/impact/components/ExpectedImpactEditor.tsx` (신규)
- **위치**: `dashboard-v2/src/features/impact/components/ExpectedImpactEditor.tsx`
- **목적**: Tier/Magnitude/Confidence 편집기
- **UI 요구사항**:
  - Tier: 3개 버튼 (strategic, enabling, operational) - ChipSelect 활용
  - Magnitude: 3개 버튼 (high, mid, low) - ChipSelect 활용
  - Confidence: range slider (0.0 ~ 1.0, step 0.1) + 숫자 표시 (0% ~ 100%)
  - reasoning 텍스트 영역 (optional, placeholder: "Impact 근거를 입력하세요")
  - ImpactScoreDisplay 컴포넌트 포함
- **Props**:
  - `value: ExpectedImpact`
  - `onChange: (impact: ExpectedImpact) => void`
  - `readonly?: boolean`

#### 6. `features/impact/components/TrackContributionEditor.tsx` (신규)
- **위치**: `dashboard-v2/src/features/impact/components/TrackContributionEditor.tsx`
- **목적**: Track 선택 + weight 편집
- **UI 요구사항**:
  - 모든 Track 버튼으로 표시 (ChipSelect 활용, trackColor)
  - 선택된 Track: weight 입력 (0~100%, step 5)
  - weight 합계 표시: `Total: 85%` (≤100% 검증, 초과 시 경고)
  - Track 버튼 클릭 → `onTrackClick(trackId)` → UiContext right panel
- **Props**:
  - `tracks: Track[]` (from dashboardData)
  - `value: TrackContribution[]`
  - `onChange: (contribs: TrackContribution[]) => void`
  - `onTrackClick: (trackId: string) => void`
  - `readonly?: boolean`

#### 7. `features/impact/components/HypothesisSelector.tsx` (신규)
- **위치**: `dashboard-v2/src/features/impact/components/HypothesisSelector.tsx`
- **목적**: Validates (multi) + Primary Hypothesis (single) 선택
- **UI 요구사항**:
  - Validates: ChipSelectExpand (multi-select, purple color)
  - Primary Hypothesis: ChipSelectExpand (single-select, purple color)
  - Hypothesis 클릭 → `onHypothesisClick(hypId)` → UiContext right panel
- **Props**:
  - `hypotheses: Hypothesis[]` (from dashboardData)
  - `validates: string[]`
  - `primaryHypothesisId: string | null`
  - `onValidatesChange: (ids: string[]) => void`
  - `onPrimaryChange: (id: string | null) => void`
  - `onHypothesisClick: (hypId: string) => void`
  - `readonly?: boolean`

#### 8. `ProjectForm.tsx` 통합
- **위치**: `dashboard-v2/src/features/projects/components/ProjectForm.tsx`
- **변경 내용**:
  - Line 392~422: Expected Impact 섹션 교체
    - `<ExpectedImpactEditor>` 사용
  - Line 424~449: Track Contributes 섹션 교체
    - `<TrackContributionEditor>` 사용
  - Line 451~476: Validates 섹션 교체
  - Line 478~489: Primary Hypothesis 섹션 교체
    - `<HypothesisSelector>` 사용
  - `mode='view'` 또는 `mode='review'` 시 `readonly={true}` prop 전달
  - `mode='edit'` 또는 `mode='create'` 시 편집 가능

### 성공 기준

#### 필수 (Blocking)
- [ ] Tier/Magnitude/Confidence 수정 가능 (edit/create 모드)
- [ ] 실시간 점수 업데이트 (0.32/3.0 형식, 소수점 2자리)
- [ ] "?" 클릭 시 설명 모달 표시 (magnitude_points 테이블 + 공식)
- [ ] reasoning 텍스트 영역 표시 및 저장
- [ ] 모든 Track 버튼으로 표시 (dashboardData.tracks 기반)
- [ ] Track 선택/해제 + weight 입력 가능
- [ ] weight 합계 표시 (≤100% 검증, 초과 시 경고 UI)
- [ ] Validates 드롭다운 multi-select 동작
- [ ] Primary Hypothesis 드롭다운 single-select 동작
- [ ] `npm run build` 통과 (TypeScript 에러 0)

#### 권장 (Non-blocking)
- [ ] Track 클릭 → 오른쪽 패널 표시 (UiContext 연동)
- [ ] Hypothesis 클릭 → 오른쪽 패널 표시
- [ ] view/review 모드에서 readonly UI (현재 구현과 동일)
- [ ] 기존 코드 스타일 일관성 유지 (Tailwind, ChipSelect 패턴)

### 확인 사항 및 제약

1. **SSOT 준수**:
   - `magnitude_points`는 `impact_model_config.yml`이 SSOT
   - Frontend는 하드코딩 (API 호출 불필요, 설정 변경 빈도 낮음)
   - 변경 시 frontend 코드도 수동 업데이트 필요 (주석 추가)

2. **Dashboard-v2 규칙 준수**:
   - features/impact/ 모듈 생성 (feature-based 구조)
   - common/ import 가능, common→features import 금지
   - selectors는 순수 함수 (React/Query import 금지)

3. **기존 컴포넌트 재사용**:
   - ChipSelect, ChipSelectExpand (common/)
   - statusColors, trackColor 등 (chipColors.ts)
   - ReviewFieldWrapper (review 모드 지원)

4. **UiContext 연동**:
   - Track/Hypothesis 클릭 시 right panel 표시
   - `openEntityDrawer({ type: 'track', mode: 'view', id: trackId })`

5. **가정**:
   - Hypothesis 데이터는 `dashboardData.hypotheses` 에서 가져옴 (확인 필요)
   - Track 데이터는 `dashboardData.tracks` 에서 이미 로드됨 (확인됨)

---

위 요구사항으로 진행할까요? 수정이 필요한 부분이 있다면 말씀해주세요!

## PRD (from Plan Mode)

### 요구사항
1. **reasoning 표시** - Expected Impact 전체에 대한 근거
2. **Impact 값 수정** - Tier, Magnitude, Confidence 직접 편집
3. **Track 선택** - 모든 Track 버튼 + 선택/weight 수정 + 오른쪽 패널 상세
4. **Hypothesis 선택** - Validates, Primary Hypothesis 드롭다운 선택
5. **종합 점수** - 점수/만점 표시 + "?" 클릭 시 설명 모달

---

### 아키텍처

#### 신규 모듈: `features/impact/`
```
src/features/impact/
├── types.ts                  # ImpactScore, TrackContribution 확장 타입
├── utils/
│   └── calculator.ts         # 점수 계산 (tier × magnitude × confidence)
└── components/
    ├── ExpectedImpactEditor.tsx   # Tier/Magnitude/Confidence 편집
    ├── TrackContributionEditor.tsx # Track 선택 + weight 편집
    ├── HypothesisSelector.tsx      # Validates/Primary 드롭다운
    ├── ImpactScoreDisplay.tsx      # 종합 점수 표시 + ? 버튼
    └── ImpactExplainerModal.tsx    # 계산 방식 설명 모달
```

---

### 수정 대상 파일

| 파일 | 변경 내용 |
|------|----------|
| `features/impact/types.ts` | **신규** - Impact 관련 타입 |
| `features/impact/utils/calculator.ts` | **신규** - 점수 계산 유틸 |
| `features/impact/components/ExpectedImpactEditor.tsx` | **신규** - Impact 편집기 |
| `features/impact/components/TrackContributionEditor.tsx` | **신규** - Track 선택기 |
| `features/impact/components/HypothesisSelector.tsx` | **신규** - Hypothesis 드롭다운 |
| `features/impact/components/ImpactScoreDisplay.tsx` | **신규** - 점수 표시 |
| `features/impact/components/ImpactExplainerModal.tsx` | **신규** - 설명 모달 |
| `features/projects/components/ProjectForm.tsx` | Impact 섹션에 새 컴포넌트 통합 |

---

### 구현 순서

1. `features/impact/types.ts` - 타입 정의
2. `features/impact/utils/calculator.ts` - 점수 계산
3. `features/impact/components/ImpactExplainerModal.tsx` - 설명 모달
4. `features/impact/components/ImpactScoreDisplay.tsx` - 점수 표시
5. `features/impact/components/ExpectedImpactEditor.tsx` - Impact 편집
6. `features/impact/components/TrackContributionEditor.tsx` - Track 선택
7. `features/impact/components/HypothesisSelector.tsx` - Hypothesis 선택
8. `ProjectForm.tsx` 통합 - 새 컴포넌트 조립
9. 테스트 및 검증

---

### 검증 체크리스트
- [ ] Tier/Magnitude/Confidence 수정 가능
- [ ] 실시간 점수 업데이트 (0.32/3.0 형식)
- [ ] "?" 클릭 시 설명 모달
- [ ] reasoning 표시
- [ ] 모든 Track 버튼으로 표시
- [ ] Track 선택/해제 + weight 입력
- [ ] Track 클릭 → 오른쪽 패널
- [ ] weight 합계 표시 (≤100% 검증)
- [ ] Validates 드롭다운 multi-select
- [ ] Primary Hypothesis 드롭다운 single-select
- [ ] Hypothesis 클릭 → 오른쪽 패널

