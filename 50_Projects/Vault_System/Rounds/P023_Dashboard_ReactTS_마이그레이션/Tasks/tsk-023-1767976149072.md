---
entity_type: Task
entity_id: tsk-023-1767976149072
entity_name: Dashboard - Activity Panel Global Feed 구현
created: '2026-01-10'
updated: '2026-01-10'
status: doing
project_id: prj-023
parent_id: prj-023
assignee: 김은향
priority: high
start_date: '2026-01-10'
due: '2026-01-10'
aliases:
- tsk-023-1767976149072
tags:
- dashboard
- activity-panel
- clean-architecture
- react
- typescript
type: dev
---

# Dashboard - Activity Panel Global Feed 구현

> Task ID: `tsk-023-1767976149072` | Project: [[prj-023]] | Status: doing

## Summary

Activity Panel을 Clean Architecture로 재구현하여 전체 vault의 Global Activity Feed를 표시하고, Kanban 검은 화면 버그를 수정합니다.

---

## Notes

### PRD (Product Requirements Document)

#### 목표

1. Header의 Activity 토글 버튼 클릭 시 오른쪽에 패널 열림
2. **전체 vault의 최근 변경 내역** 표시 (Task, Project, Program 등)
3. **Notion 스타일 타임라인** (오늘, 어제, 이번 주 등 시간 그룹핑)
4. 각 항목 클릭 시 **EntityDrawer 열기**
5. **뒤로가기 연동**: EntityDrawer 닫으면 Activity Panel로 복귀
6. Kanban 영역은 그대로 보임 (검은 오버레이 없음)

**네비게이션 Flow**:
```
Activity Panel → entity 클릭 → EntityDrawer (뒤로가기) → Activity Panel
```

**버그 수정**:
| 버그 | 원인 | 해결 |
|------|------|------|
| Kanban 검은 화면 | ActivityPanel의 backdrop이 전체 화면을 20% 검은색으로 덮음 | Backdrop 제거 |
| 잘못된 로직 | Entity 선택 → 해당 entity 히스토리만 표시 | 전체 vault의 Global Activity Feed로 변경 |

---

#### Tech Spec

**기존 백엔드 API 사용 (새 API 불필요)**:
```
GET /api/audit?limit=50

Response:
{
  "logs": [
    {
      "timestamp": "2026-01-10T...",
      "action": "update",
      "entity_type": "Task",
      "entity_id": "tsk-023-xxx",
      "entity_name": "Dashboard - Activity Panel",
      "user": "api",
      "details": {...}
    }
  ],
  "total": 150
}
```

**Clean Architecture 폴더 구조**:
```
src/features/activity/
├── domain/                    # 도메인 레이어
│   ├── types.ts              # Entity, DTO 타입 정의
│   ├── utils.ts              # 순수 비즈니스 로직 (groupByDate 등)
│   └── index.ts              # exports
│
├── data/                      # 데이터 레이어
│   └── api.ts                # API 클라이언트 (infrastructure)
│
├── application/               # 애플리케이션 레이어
│   ├── useGlobalAuditLog.ts  # Use Case: 전체 피드 조회
│   └── index.ts              # exports
│
├── presentation/              # 프레젠테이션 레이어
│   ├── ActivityPanel.tsx     # Container (상태 연결)
│   ├── ActivityTimeline.tsx  # 타임라인 UI
│   ├── ActivityItem.tsx      # 개별 항목 UI
│   ├── TimeGroupHeader.tsx   # 날짜 그룹 헤더
│   └── index.ts              # exports
│
└── index.ts                   # Feature public API
```

**레이어별 책임**:
| 레이어 | 책임 | 의존성 |
|--------|------|--------|
| **Domain** | 타입, 비즈니스 로직 | 없음 (순수) |
| **Data** | API 호출, 데이터 변환 | Domain |
| **Application** | Use Cases (React Query hooks) | Data, Domain |
| **Presentation** | UI 렌더링 | Application, Domain |

**의존성 방향**:
```
Presentation → Application → Data → Domain
                              ↓
                           (외부 API)
```

**UI 스펙**:

패널:
- 너비: `w-96` (384px)
- 배경: `bg-gray-50`
- 그림자: `shadow-xl`
- 애니메이션: `animate-slide-in-right`
- 위치: `fixed right-0 top-0 h-full`
- **Backdrop: 없음** (Kanban 가리지 않음)

타임라인:
- 날짜 헤더: `sticky top-0 bg-gray-50 text-sm font-medium text-gray-500`
- 그룹: 오늘, 어제, 이번 주, M월 d일

Activity Item:
- 카드 스타일: `bg-white rounded-lg shadow-sm p-3 hover:bg-gray-100 cursor-pointer`
- Entity 타입 뱃지: Task(파랑), Project(초록), Program(보라)
- Action 아이콘: create(+), update(연필), delete(휴지통)
- 상대 시간: `text-gray-400 text-xs` (3분 전, 1시간 전 등)

**UiContext 변경사항**:

제거:
- `selectedActivityEntity` state
- `setActivityEntity` action

추가:
- `returnToActivity` state (Activity Panel에서 왔는지 추적)
- `openEntityFromActivity` action (Entity 클릭 → Drawer 열기)
- `closeEntityDrawer` 수정 (뒤로가기 연동)

---

#### Todo

##### Phase 1: 기존 파일 삭제/이동
- [ ] `src/features/activity/types.ts` 삭제
- [ ] `src/features/activity/api.ts` 삭제
- [ ] `src/features/activity/utils.ts` 삭제
- [ ] `src/features/activity/queries/useEntityHistory.ts` 삭제
- [ ] `src/features/activity/queries/useActivityFeed.ts` 삭제
- [ ] `src/features/activity/queries/index.ts` 삭제
- [ ] `src/features/activity/components/ActivityPanel.tsx` 삭제
- [ ] `src/features/activity/components/ActivityFeed.tsx` 삭제
- [ ] `src/features/activity/components/CommentActivityItem.tsx` 삭제
- [ ] `src/features/activity/components/HistoryItem.tsx` 삭제
- [ ] `src/features/activity/components/index.ts` 삭제

##### Phase 2: Domain Layer 생성
- [ ] `domain/types.ts` 생성 - EntityType, ActionType, AuditLogEntry, TimeGroup, GlobalAuditResponse
- [ ] `domain/utils.ts` 생성 - `groupByDate()`, `formatRelativeTime()` 순수 함수
- [ ] `domain/index.ts` 생성 - exports

##### Phase 3: Data Layer 생성
- [ ] `data/api.ts` 생성 - activityApi.getGlobalAuditLog()

##### Phase 4: Application Layer 생성
- [ ] `application/useGlobalAuditLog.ts` 생성 - React Query hook + 시간 그룹핑
- [ ] `application/index.ts` 생성 - exports

##### Phase 5: Presentation Layer 생성
- [ ] `presentation/ActivityPanel.tsx` 생성 - Container 컴포넌트 (Backdrop 없음)
- [ ] `presentation/ActivityTimeline.tsx` 생성 - 타임라인 UI
- [ ] `presentation/ActivityItem.tsx` 생성 - Notion 스타일 Activity 카드
- [ ] `presentation/TimeGroupHeader.tsx` 생성 - 날짜 그룹 헤더 (sticky)
- [ ] `presentation/index.ts` 생성 - exports

##### Phase 6: 통합
- [ ] `index.ts` 생성 - Feature public API (re-exports)
- [ ] `UiContext.tsx` 수정 - `returnToActivity` + `openEntityFromActivity` 추가
- [ ] `closeEntityDrawer` 수정 - 뒤로가기 연동

##### Phase 7: 검증
- [ ] `npm run build` 통과
- [ ] Activity 토글 → 패널 열림 (Kanban 안 가려짐 확인)
- [ ] Notion 스타일 타임라인 (오늘/어제/이번 주 그룹핑) 확인
- [ ] 항목 클릭 → EntityDrawer 열림 확인
- [ ] 뒤로가기 연동: EntityDrawer X 버튼 → Activity Panel 복귀 확인

---

## 참고

- Plan 파일: `/Users/gim-eunhyang/.claude/plans/mellow-growing-knuth.md`
- 기존 Activity Panel Task: `tsk-023-1767973768058` (완료, 현재 버그 있음)
- API 엔드포인트: `GET /api/audit?limit=50`
