---
entity_type: Task
entity_id: tsk-023-16
entity_name: Dashboard - FilterPanel Task 필터 연결 수정
created: 2026-01-08
updated: '2026-01-12'
status: done
project_id: prj-023
aliases:
- tsk-023-16
- Dashboard - FilterPanel Task 필터 연결 수정
assignee: 김은향
type: dev
priority: high
due: '2026-01-11'
closed: 2026-01-08
pr_url: null
notes: "> Task ID: `tsk-023-16` | Project: `prj-023` | Status: done\n\n## Summary\n\
  \nFilterPanel의 Task Status/Priority/Type 필터가 Kanban에 반영되지 않는 문제 수정.\n\n현재 TaskFilters.tsx가\
  \ FilterContext를 사용하지만, Kanban은 useCombinedFilters(localFilterStore)를 사용하여 두 시스템이\
  \ 분리되어 있음.\n\n## Notes\n\n### 문제 진단\n\nFilterPanel에서 \"todo\" 버튼 클릭 시 Kanban에 todo\
  \ 태스크만 표시되어야 하는데, **아무 변화 없음**.\n\n근본 원인: 두 개의 분리된 상태 시스템\n\n```\n┌─ FilterContext\
  \ (React Context) ─────────────────────────┐\n│                                \
  \                          │\n│  useState로 관리 (메모리 only, localStorage 저장 X)    \
  \  │\n│  - taskStatus: []                                        │\n│  - taskPriority:\
  \ []                                      │\n│  - taskTypes: []                \
  \                         │\n│                                                 \
  \         │\n│  ↓ 사용 (UI)                                             │\n│  TaskFilters.tsx\
  \ → useFilterContext()                    │\n│                                 \
  \                         │\n└──────────────────────────────────────────────────────────┘\n\
  \                         ❌ 연결 없음!\n┌─ localFilterStore (External Store) ─────────────────────┐\n\
  │                                                          │\n│  useSyncExternalStore로\
  \ 관리 + localStorage 저장         │\n│  - taskStatus: []                          \
  \              │\n│  - taskPriority: []                                      │\n\
  │  - taskTypes: []                                         │\n│                \
  \                                          │\n│  ↓ 사용 (필터링)                    \
  \                     │\n│  useCombinedFilters() → Kanban → buildKanbanColumns()\
  \    │\n│                                                          │\n└──────────────────────────────────────────────────────────┘\n\
  ```\n\n### Tech Spec\n\n목표\n\n- FilterContext 필터 상태 → localFilterStore로 이전\n- 모든\
  \ 필터 UI가 `useCombinedFilters` 또는 `useLocalFilters` 사용\n- FilterContext는 `isPanelOpen`\
  \ UI 상태만 유지\n\nPhase 1: TaskFilters 수정 (핵심)\n\n**파일**: `src/features/filters/components/FilterPanel/TaskFilters.tsx`\n\
  \n**현재**:\n\n```typescript\nimport { useFilterContext } from '../../context/FilterContext';\n\
  \nexport const TaskFilters = () => {\n  const { taskStatus, taskPriority, taskTypes,\
  \ toggleFilterArray } = useFilterContext();\n  // ...\n};\n```\n\n**수정 후**:\n\n\
  ```typescript\nimport { useCombinedFilters } from '@/hooks/useCombinedFilters';\n\
  \nexport const TaskFilters = () => {\n  const { taskStatus, taskPriority, taskTypes,\
  \ setFilter } = useCombinedFilters();\n\n  const toggleFilter = (key: 'taskStatus'\
  \ | 'taskPriority' | 'taskTypes', value: string) => {\n    const currentArray =\
  \ key === 'taskStatus' ? taskStatus :\n                         key === 'taskPriority'\
  \ ? taskPriority : taskTypes;\n    const isIncluded = currentArray.includes(value);\n\
  \    const newArray = isIncluded\n      ? currentArray.filter(item => item !== value)\n\
  \      : [...currentArray, value];\n    setFilter(key, newArray);\n  };\n\n  return\
  \ (\n    // onClick={() => toggleFilter('taskStatus', status)}\n  );\n};\n```\n\n\
  Phase 2: ProjectFilters 수정\n\n**파일**: `src/features/filters/components/FilterPanel/ProjectFilters.tsx`\n\
  \n동일한 패턴으로:\n\n- `useFilterContext` → `useCombinedFilters`\n- `toggleFilterArray`\
  \ → 직접 `setFilter` 호출\n\nPhase 3: DateFilters 수정\n\n**파일**: `src/features/filters/components/FilterPanel/DateFilters.tsx`\n\
  \n동일한 패턴 적용 (dueDateStart, dueDateEnd)\n\nPhase 4: FilterPanel 수정\n\n**파일**: `src/features/filters/components/FilterPanel/index.tsx`\n\
  \n**현재**:\n\n```typescript\nconst { resetFilters } = useFilterContext();\n```\n\n\
  **수정 후**:\n\n```typescript\nconst { clearAll } = useCombinedFilters();\n// 또는\n\
  const { resetLocal } = useCombinedFilters();\n```\n\nPhase 5: FilterContext 축소 (정리)\n\
  \n**파일**: `src/features/filters/context/FilterContext.tsx`\n\nisPanelOpen 전용으로 축소:\n\
  \n```typescript\ninterface FilterPanelContextType {\n  isPanelOpen: boolean;\n \
  \ togglePanel: () => void;\n}\n```\n\n### 수정 파일 목록\n\n| 파일 | 변경 내용 | 우선순위 |\n| ---\
  \ | --- | --- |\n| `features/filters/components/FilterPanel/TaskFilters.tsx` | useFilterContext\
  \ → useCombinedFilters | P1 |\n| `features/filters/components/FilterPanel/ProjectFilters.tsx`\
  \ | useFilterContext → useCombinedFilters | P1 |\n| `features/filters/components/FilterPanel/DateFilters.tsx`\
  \ | useFilterContext → useCombinedFilters | P1 |\n| `features/filters/components/FilterPanel/index.tsx`\
  \ | resetFilters → clearAll/resetLocal | P2 |\n| `features/filters/context/FilterContext.tsx`\
  \ | 필터 상태 제거, isPanelOpen만 유지 | P3 |\n| `pages/Kanban/index.tsx` | useFilterContext\
  \ → useFilterPanel (if needed) | P3 |\n\n### 검증 계획\n\n1. **TaskStatus 필터**\n\n \
  \  - FilterPanel 열기 → \"todo\" 클릭 → Kanban에 todo 태스크만 표시\n   - \"doing\" 추가 클릭 →\
  \ todo + doing 태스크 표시 (OR 연산)\n\n2. **TaskPriority 필터**\n\n   - \"critical\" 클릭\
  \ → critical 우선순위 태스크만 표시\n\n3. **TaskTypes 필터**\n\n   - \"dev\" 클릭 → dev 타입 태스크만\
  \ 표시\n\n4. **복합 필터**\n\n   - status=todo + priority=high → 조건 모두 만족하는 태스크만 표시\n\n\
  5. **페이지 새로고침 유지**\n\n   - 필터 설정 후 새로고침 → 필터 상태 유지 (localStorage)\n\n6. **Reset\
  \ All 동작**\n\n   - 여러 필터 설정 → Reset All → 모든 필터 초기화, Kanban 전체 태스크 표시\n\n### 참고\n\
  \n- **필터링 로직은 이미 구현됨**: `selectors.ts`의 `applyLocalFilters`에서 taskStatus, taskPriority,\
  \ taskTypes 처리\n- **UI 연결만 필요**: FilterPanel UI가 올바른 store를 사용하도록 수정하면 됨\n\n###\
  \ Codex Review Summary (2026-01-08)\n\n**Critical Issues**: 0개 **Suggestions**:\
  \ 9개\n\n주요 피드백\n\n| 항목 | 설명 | 대응 |\n| --- | --- | --- |\n| Filter source of truth\
  \ | FilterContext 제거 시 다른 사용처 영향 | grep으로 useFilterContext 사용처 확인 후 제거 |\n| Hook\
  \ API expectations | useCombinedFilters가 taskStatus, setFilter 제공 확인 필요 | 이미 확인됨\
  \ (filterDefaults.ts, useCombinedFilters.ts) |\n| Selection logic consistency |\
  \ 다중 선택 시 OR/AND 연산 확인 | selectors.ts 확인: taskStatus.includes() = OR 연산 |\n| Reset\
  \ semantics | clearAll vs resetLocal 명확화 필요 | resetLocal만 사용 (localStorage 초기화)\
  \ |\n| Persistence/SSR | localStorage SSR 이슈 | localFilterStore에 getServerSnapshot\
  \ 이미 있음 |\n| Date filter behavior | 날짜 필터 형식/직렬화 확인 | YYYY-MM-DD 문자열, localStorage\
  \ JSON 직렬화 |\n| Project filters | 프로젝트 필터 스키마 확인 | projectStatus: string\\[\\] (이미\
  \ 정의됨) |\n| UX regression risk | 필터 카운트/뱃지 영향 | 현재 없음, 추후 필요시 추가 |\n| Verification\
  \ gaps | 복합 필터 테스트 추가 필요 | 검증 계획에 추가 |\n\n확인 완료 사항\n\n1. **useCombinedFilters API**:\
  \ `taskStatus`, `taskPriority`, `taskTypes`, `setFilter` 모두 제공됨\n2. **필터링 로직**:\
  \ `applyLocalFilters`에서 `taskStatus.includes()` = OR 연산 (Codex 우려 해소)\n3. **SSR\
  \ 대응**: `localFilterStore.getServerSnapshot()`이 DEFAULT_LOCAL_FILTERS 반환\n\n추가 검증\
  \ 항목 (Codex 제안)\n\n- [ ] 복합 필터 테스트: status + priority + type 동시 적용\n\n- [ ] 새로고침\
  \ 후 필터 유지 확인\n\n- [ ] Reset All 후 Kanban + FilterPanel 모두 초기화 확인\n\n## Related\n\
  \n- \\[\\[prj-023|Dashboard - React+TS 마이그레이션\\]\\]\n- \\[\\[tsk-023-12|Dashboard\
  \ - Kanban Visibility 필터 수정\\]\\] - 이전 Task (Visibility 토글 수정)\n\n---\n\n### 작업\
  \ 로그\n\n2026-01-08\n\n**개요**: Task 완료 - FilterPanel Task 필터 연결 수정\n\n**구현 내용**:\n\
  \n- TaskFilters.tsx: `useFilterContext` → `useCombinedFilters` 전환\n  - taskStatus,\
  \ taskPriority, taskTypes 필터가 localFilterStore 사용\n  - toggleFilter 함수로 setFilter\
  \ 호출하여 상태 업데이트\n- FilterContext.tsx: 필터 상태 제거, isPanelOpen 전용으로 축소\n  - Legacy methods에\
  \ deprecation warning 추가\n  - 필터 상태는 모두 localFilterStore로 이전\n- filterDefaults.ts:\
  \ UrlFilterState에 projectIds\\[\\] 추가\n- showInactiveTasks 필터 제거 (의미 없는 필터였음)\n\n\
  **검증 완료**:\n\n- FilterPanel의 Task Status/Priority/Type 필터가 Kanban에 정상 반영\n- 두 개의\
  \ 분리된 상태 시스템 문제 해결 (FilterContext vs localFilterStore)\n- 모든 필터 UI가 useCombinedFilters를\
  \ 통해 동일한 store 사용\n\n**결과**:\n\n- Git commits:\n  - ef26ece: fix(dashboard): remove\
  \ showInactiveTasks filter\n  - 932859f: fix(dashboard): FilterContext cleanup +\
  \ filterDefaults projectIds\n\n**최종 상태**: done"
---
> Task ID: `tsk-023-16` | Project: `prj-023` | Status: done

## Summary

FilterPanel의 Task Status/Priority/Type 필터가 Kanban에 반영되지 않는 문제 수정.

현재 TaskFilters.tsx가 FilterContext를 사용하지만, Kanban은 useCombinedFilters(localFilterStore)를 사용하여 두 시스템이 분리되어 있음.

## Notes

### 문제 진단

FilterPanel에서 "todo" 버튼 클릭 시 Kanban에 todo 태스크만 표시되어야 하는데, **아무 변화 없음**.

#### 근본 원인: 두 개의 분리된 상태 시스템

```
┌─ FilterContext (React Context) ─────────────────────────┐
│                                                          │
│  useState로 관리 (메모리 only, localStorage 저장 X)      │
│  - taskStatus: []                                        │
│  - taskPriority: []                                      │
│  - taskTypes: []                                         │
│                                                          │
│  ↓ 사용 (UI)                                             │
│  TaskFilters.tsx → useFilterContext()                    │
│                                                          │
└──────────────────────────────────────────────────────────┘
                         ❌ 연결 없음!
┌─ localFilterStore (External Store) ─────────────────────┐
│                                                          │
│  useSyncExternalStore로 관리 + localStorage 저장         │
│  - taskStatus: []                                        │
│  - taskPriority: []                                      │
│  - taskTypes: []                                         │
│                                                          │
│  ↓ 사용 (필터링)                                         │
│  useCombinedFilters() → Kanban → buildKanbanColumns()    │
│                                                          │
└──────────────────────────────────────────────────────────┘
```

### Tech Spec

#### 목표
- FilterContext 필터 상태 → localFilterStore로 이전
- 모든 필터 UI가 `useCombinedFilters` 또는 `useLocalFilters` 사용
- FilterContext는 `isPanelOpen` UI 상태만 유지

#### Phase 1: TaskFilters 수정 (핵심)

**파일**: `src/features/filters/components/FilterPanel/TaskFilters.tsx`

**현재**:
```typescript
import { useFilterContext } from '../../context/FilterContext';

export const TaskFilters = () => {
  const { taskStatus, taskPriority, taskTypes, toggleFilterArray } = useFilterContext();
  // ...
};
```

**수정 후**:
```typescript
import { useCombinedFilters } from '@/hooks/useCombinedFilters';

export const TaskFilters = () => {
  const { taskStatus, taskPriority, taskTypes, setFilter } = useCombinedFilters();

  const toggleFilter = (key: 'taskStatus' | 'taskPriority' | 'taskTypes', value: string) => {
    const currentArray = key === 'taskStatus' ? taskStatus :
                         key === 'taskPriority' ? taskPriority : taskTypes;
    const isIncluded = currentArray.includes(value);
    const newArray = isIncluded
      ? currentArray.filter(item => item !== value)
      : [...currentArray, value];
    setFilter(key, newArray);
  };

  return (
    // onClick={() => toggleFilter('taskStatus', status)}
  );
};
```

#### Phase 2: ProjectFilters 수정

**파일**: `src/features/filters/components/FilterPanel/ProjectFilters.tsx`

동일한 패턴으로:
- `useFilterContext` → `useCombinedFilters`
- `toggleFilterArray` → 직접 `setFilter` 호출

#### Phase 3: DateFilters 수정

**파일**: `src/features/filters/components/FilterPanel/DateFilters.tsx`

동일한 패턴 적용 (dueDateStart, dueDateEnd)

#### Phase 4: FilterPanel 수정

**파일**: `src/features/filters/components/FilterPanel/index.tsx`

**현재**:
```typescript
const { resetFilters } = useFilterContext();
```

**수정 후**:
```typescript
const { clearAll } = useCombinedFilters();
// 또는
const { resetLocal } = useCombinedFilters();
```

#### Phase 5: FilterContext 축소 (정리)

**파일**: `src/features/filters/context/FilterContext.tsx`

isPanelOpen 전용으로 축소:
```typescript
interface FilterPanelContextType {
  isPanelOpen: boolean;
  togglePanel: () => void;
}
```

### 수정 파일 목록

| 파일 | 변경 내용 | 우선순위 |
|------|----------|---------|
| `features/filters/components/FilterPanel/TaskFilters.tsx` | useFilterContext → useCombinedFilters | P1 |
| `features/filters/components/FilterPanel/ProjectFilters.tsx` | useFilterContext → useCombinedFilters | P1 |
| `features/filters/components/FilterPanel/DateFilters.tsx` | useFilterContext → useCombinedFilters | P1 |
| `features/filters/components/FilterPanel/index.tsx` | resetFilters → clearAll/resetLocal | P2 |
| `features/filters/context/FilterContext.tsx` | 필터 상태 제거, isPanelOpen만 유지 | P3 |
| `pages/Kanban/index.tsx` | useFilterContext → useFilterPanel (if needed) | P3 |

### 검증 계획

1. **TaskStatus 필터**
   - FilterPanel 열기 → "todo" 클릭 → Kanban에 todo 태스크만 표시
   - "doing" 추가 클릭 → todo + doing 태스크 표시 (OR 연산)

2. **TaskPriority 필터**
   - "critical" 클릭 → critical 우선순위 태스크만 표시

3. **TaskTypes 필터**
   - "dev" 클릭 → dev 타입 태스크만 표시

4. **복합 필터**
   - status=todo + priority=high → 조건 모두 만족하는 태스크만 표시

5. **페이지 새로고침 유지**
   - 필터 설정 후 새로고침 → 필터 상태 유지 (localStorage)

6. **Reset All 동작**
   - 여러 필터 설정 → Reset All → 모든 필터 초기화, Kanban 전체 태스크 표시

### 참고

- **필터링 로직은 이미 구현됨**: `selectors.ts`의 `applyLocalFilters`에서 taskStatus, taskPriority, taskTypes 처리
- **UI 연결만 필요**: FilterPanel UI가 올바른 store를 사용하도록 수정하면 됨

### Codex Review Summary (2026-01-08)

**Critical Issues**: 0개
**Suggestions**: 9개

#### 주요 피드백

| 항목 | 설명 | 대응 |
|------|------|------|
| Filter source of truth | FilterContext 제거 시 다른 사용처 영향 | grep으로 useFilterContext 사용처 확인 후 제거 |
| Hook API expectations | useCombinedFilters가 taskStatus, setFilter 제공 확인 필요 | 이미 확인됨 (filterDefaults.ts, useCombinedFilters.ts) |
| Selection logic consistency | 다중 선택 시 OR/AND 연산 확인 | selectors.ts 확인: taskStatus.includes() = OR 연산 |
| Reset semantics | clearAll vs resetLocal 명확화 필요 | resetLocal만 사용 (localStorage 초기화) |
| Persistence/SSR | localStorage SSR 이슈 | localFilterStore에 getServerSnapshot 이미 있음 |
| Date filter behavior | 날짜 필터 형식/직렬화 확인 | YYYY-MM-DD 문자열, localStorage JSON 직렬화 |
| Project filters | 프로젝트 필터 스키마 확인 | projectStatus: string[] (이미 정의됨) |
| UX regression risk | 필터 카운트/뱃지 영향 | 현재 없음, 추후 필요시 추가 |
| Verification gaps | 복합 필터 테스트 추가 필요 | 검증 계획에 추가 |

#### 확인 완료 사항

1. **useCombinedFilters API**: `taskStatus`, `taskPriority`, `taskTypes`, `setFilter` 모두 제공됨
2. **필터링 로직**: `applyLocalFilters`에서 `taskStatus.includes()` = OR 연산 (Codex 우려 해소)
3. **SSR 대응**: `localFilterStore.getServerSnapshot()`이 DEFAULT_LOCAL_FILTERS 반환

#### 추가 검증 항목 (Codex 제안)

- [ ] 복합 필터 테스트: status + priority + type 동시 적용
- [ ] 새로고침 후 필터 유지 확인
- [ ] Reset All 후 Kanban + FilterPanel 모두 초기화 확인

## Related

- [[prj-023|Dashboard - React+TS 마이그레이션]]
- [[tsk-023-12|Dashboard - Kanban Visibility 필터 수정]] - 이전 Task (Visibility 토글 수정)

---

### 작업 로그

#### 2026-01-08
**개요**: Task 완료 - FilterPanel Task 필터 연결 수정

**구현 내용**:
- TaskFilters.tsx: `useFilterContext` → `useCombinedFilters` 전환
  - taskStatus, taskPriority, taskTypes 필터가 localFilterStore 사용
  - toggleFilter 함수로 setFilter 호출하여 상태 업데이트
- FilterContext.tsx: 필터 상태 제거, isPanelOpen 전용으로 축소
  - Legacy methods에 deprecation warning 추가
  - 필터 상태는 모두 localFilterStore로 이전
- filterDefaults.ts: UrlFilterState에 projectIds[] 추가
- showInactiveTasks 필터 제거 (의미 없는 필터였음)

**검증 완료**:
- FilterPanel의 Task Status/Priority/Type 필터가 Kanban에 정상 반영
- 두 개의 분리된 상태 시스템 문제 해결 (FilterContext vs localFilterStore)
- 모든 필터 UI가 useCombinedFilters를 통해 동일한 store 사용

**결과**:
- Git commits:
  - ef26ece: fix(dashboard): remove showInactiveTasks filter
  - 932859f: fix(dashboard): FilterContext cleanup + filterDefaults projectIds

**최종 상태**: done
