---
entity_type: Task
entity_id: "tsk-023-16"
entity_name: "Dashboard - FilterPanel Task 필터 연결 수정"
created: 2026-01-08
updated: 2026-01-08
status: doing

# === 계층 ===
project_id: "prj-023"
aliases: ["tsk-023-16", "Dashboard - FilterPanel Task 필터 연결 수정"]

# === Task 전용 ===
assignee: "김은향"
type: dev
priority: normal
due: null
closed: null
pr_url: null
---

> Task ID: `tsk-023-16` | Project: `prj-023` | Status: todo

## Summary

FilterPanel의 Task Status/Priority/Type 필터가 Kanban에 반영되지 않는 문제 수정.

현재 TaskFilters.tsx가 FilterContext를 사용하지만, Kanban은 useCombinedFilters(localFilterStore)를 사용하여 두 시스템이 분리되어 있음.

## Notes

### 문제 진단

FilterPanel에서 "todo" 버튼 클릭 시 Kanban에 todo 태스크만 표시되어야 하는데, **아무 변화 없음**.

#### 근본 원인: 두 개의 분리된 상태 시스템

```
┌─ FilterContext (React Context) ─────────────────────────┐
│                                                          │
│  useState로 관리 (메모리 only, localStorage 저장 X)      │
│  - taskStatus: []                                        │
│  - taskPriority: []                                      │
│  - taskTypes: []                                         │
│                                                          │
│  ↓ 사용 (UI)                                             │
│  TaskFilters.tsx → useFilterContext()                    │
│                                                          │
└──────────────────────────────────────────────────────────┘
                         ❌ 연결 없음!
┌─ localFilterStore (External Store) ─────────────────────┐
│                                                          │
│  useSyncExternalStore로 관리 + localStorage 저장         │
│  - taskStatus: []                                        │
│  - taskPriority: []                                      │
│  - taskTypes: []                                         │
│                                                          │
│  ↓ 사용 (필터링)                                         │
│  useCombinedFilters() → Kanban → buildKanbanColumns()    │
│                                                          │
└──────────────────────────────────────────────────────────┘
```

### Tech Spec

#### 목표
- FilterContext 필터 상태 → localFilterStore로 이전
- 모든 필터 UI가 `useCombinedFilters` 또는 `useLocalFilters` 사용
- FilterContext는 `isPanelOpen` UI 상태만 유지

#### Phase 1: TaskFilters 수정 (핵심)

**파일**: `src/features/filters/components/FilterPanel/TaskFilters.tsx`

**현재**:
```typescript
import { useFilterContext } from '../../context/FilterContext';

export const TaskFilters = () => {
  const { taskStatus, taskPriority, taskTypes, toggleFilterArray } = useFilterContext();
  // ...
};
```

**수정 후**:
```typescript
import { useCombinedFilters } from '@/hooks/useCombinedFilters';

export const TaskFilters = () => {
  const { taskStatus, taskPriority, taskTypes, setFilter } = useCombinedFilters();

  const toggleFilter = (key: 'taskStatus' | 'taskPriority' | 'taskTypes', value: string) => {
    const currentArray = key === 'taskStatus' ? taskStatus :
                         key === 'taskPriority' ? taskPriority : taskTypes;
    const isIncluded = currentArray.includes(value);
    const newArray = isIncluded
      ? currentArray.filter(item => item !== value)
      : [...currentArray, value];
    setFilter(key, newArray);
  };

  return (
    // onClick={() => toggleFilter('taskStatus', status)}
  );
};
```

#### Phase 2: ProjectFilters 수정

**파일**: `src/features/filters/components/FilterPanel/ProjectFilters.tsx`

동일한 패턴으로:
- `useFilterContext` → `useCombinedFilters`
- `toggleFilterArray` → 직접 `setFilter` 호출

#### Phase 3: DateFilters 수정

**파일**: `src/features/filters/components/FilterPanel/DateFilters.tsx`

동일한 패턴 적용 (dueDateStart, dueDateEnd)

#### Phase 4: FilterPanel 수정

**파일**: `src/features/filters/components/FilterPanel/index.tsx`

**현재**:
```typescript
const { resetFilters } = useFilterContext();
```

**수정 후**:
```typescript
const { clearAll } = useCombinedFilters();
// 또는
const { resetLocal } = useCombinedFilters();
```

#### Phase 5: FilterContext 축소 (정리)

**파일**: `src/features/filters/context/FilterContext.tsx`

isPanelOpen 전용으로 축소:
```typescript
interface FilterPanelContextType {
  isPanelOpen: boolean;
  togglePanel: () => void;
}
```

### 수정 파일 목록

| 파일 | 변경 내용 | 우선순위 |
|------|----------|---------|
| `features/filters/components/FilterPanel/TaskFilters.tsx` | useFilterContext → useCombinedFilters | P1 |
| `features/filters/components/FilterPanel/ProjectFilters.tsx` | useFilterContext → useCombinedFilters | P1 |
| `features/filters/components/FilterPanel/DateFilters.tsx` | useFilterContext → useCombinedFilters | P1 |
| `features/filters/components/FilterPanel/index.tsx` | resetFilters → clearAll/resetLocal | P2 |
| `features/filters/context/FilterContext.tsx` | 필터 상태 제거, isPanelOpen만 유지 | P3 |
| `pages/Kanban/index.tsx` | useFilterContext → useFilterPanel (if needed) | P3 |

### 검증 계획

1. **TaskStatus 필터**
   - FilterPanel 열기 → "todo" 클릭 → Kanban에 todo 태스크만 표시
   - "doing" 추가 클릭 → todo + doing 태스크 표시 (OR 연산)

2. **TaskPriority 필터**
   - "critical" 클릭 → critical 우선순위 태스크만 표시

3. **TaskTypes 필터**
   - "dev" 클릭 → dev 타입 태스크만 표시

4. **복합 필터**
   - status=todo + priority=high → 조건 모두 만족하는 태스크만 표시

5. **페이지 새로고침 유지**
   - 필터 설정 후 새로고침 → 필터 상태 유지 (localStorage)

6. **Reset All 동작**
   - 여러 필터 설정 → Reset All → 모든 필터 초기화, Kanban 전체 태스크 표시

### 참고

- **필터링 로직은 이미 구현됨**: `selectors.ts`의 `applyLocalFilters`에서 taskStatus, taskPriority, taskTypes 처리
- **UI 연결만 필요**: FilterPanel UI가 올바른 store를 사용하도록 수정하면 됨

### Codex Review Summary (2026-01-08)

**Critical Issues**: 0개
**Suggestions**: 9개

#### 주요 피드백

| 항목 | 설명 | 대응 |
|------|------|------|
| Filter source of truth | FilterContext 제거 시 다른 사용처 영향 | grep으로 useFilterContext 사용처 확인 후 제거 |
| Hook API expectations | useCombinedFilters가 taskStatus, setFilter 제공 확인 필요 | 이미 확인됨 (filterDefaults.ts, useCombinedFilters.ts) |
| Selection logic consistency | 다중 선택 시 OR/AND 연산 확인 | selectors.ts 확인: taskStatus.includes() = OR 연산 |
| Reset semantics | clearAll vs resetLocal 명확화 필요 | resetLocal만 사용 (localStorage 초기화) |
| Persistence/SSR | localStorage SSR 이슈 | localFilterStore에 getServerSnapshot 이미 있음 |
| Date filter behavior | 날짜 필터 형식/직렬화 확인 | YYYY-MM-DD 문자열, localStorage JSON 직렬화 |
| Project filters | 프로젝트 필터 스키마 확인 | projectStatus: string[] (이미 정의됨) |
| UX regression risk | 필터 카운트/뱃지 영향 | 현재 없음, 추후 필요시 추가 |
| Verification gaps | 복합 필터 테스트 추가 필요 | 검증 계획에 추가 |

#### 확인 완료 사항

1. **useCombinedFilters API**: `taskStatus`, `taskPriority`, `taskTypes`, `setFilter` 모두 제공됨
2. **필터링 로직**: `applyLocalFilters`에서 `taskStatus.includes()` = OR 연산 (Codex 우려 해소)
3. **SSR 대응**: `localFilterStore.getServerSnapshot()`이 DEFAULT_LOCAL_FILTERS 반환

#### 추가 검증 항목 (Codex 제안)

- [ ] 복합 필터 테스트: status + priority + type 동시 적용
- [ ] 새로고침 후 필터 유지 확인
- [ ] Reset All 후 Kanban + FilterPanel 모두 초기화 확인

## Related

- [[prj-023|Dashboard - React+TS 마이그레이션]]
- [[tsk-023-12|Dashboard - Kanban Visibility 필터 수정]] - 이전 Task (Visibility 토글 수정)
