---
entity_type: Task
entity_id: "tsk-023-10"
entity_name: "Dashboard v2 - Keyboard Shortcuts 구현"
created: 2026-01-08
updated: 2026-01-08
status: todo

# === 계층 ===
parent_id: "prj-023"
project_id: "prj-023"
aliases: ["tsk-023-10", "Dashboard v2 - Keyboard Shortcuts 구현"]

# === Task 전용 ===
type: dev
assignee: "김은향"
due: null
priority: high
closed: null
pr_url: null

# === Evidence 연결 ===
evidence_refs: []

# === External References ===
external_refs: []
---

> Task ID: `tsk-023-10` | Project: `prj-023` | Status: todo | Assignee: 김은향

# Dashboard v2 - Keyboard Shortcuts 구현

## Summary

legacy dashboard (_dashboard)의 키보드 단축키 기능을 React+TypeScript 기반 v2 dashboard에 이식

## Notes

### Tech Spec

#### 목표
legacy dashboard의 단축키를 v2 React dashboard에 구현

#### 결정 사항
- **FilterContext**: AppLayout으로 전역화 (모든 페이지에서 단축키 동작)
- **멤버 필터**: 동적 매핑 (members API에서 첫 2명 자동 선택)

#### 구현할 단축키

| 단축키 | 기능 | v2 구현 방식 |
|--------|------|-------------|
| `1` | Kanban View | `navigate('/kanban')` |
| `2` | Calendar View | `navigate('/calendar')` |
| `3` | Graph View | `navigate('/graph')` |
| `F` | Filter Panel 토글 | `FilterContext.togglePanel()` |
| `Shift+R` | 필터 전체 리셋 | `FilterContext.resetFilters()` + URL 필터 초기화 |
| `Shift+E` | 멤버1 선택 | members[0].id → URL assignees |
| `Shift+M` | 멤버2 선택 | members[1].id → URL assignees |
| `Shift+A` | All Members | URL assignees 초기화 |
| `Shift+C` | Cache Reload | `queryClient.invalidateQueries()` |
| `Escape` | Modal/Drawer 닫기 | 기존 DrawerShell + 보완 |
| `?` (Shift+/) | Help 모달 | 새로운 HelpModal 컴포넌트 |
| `Shift+Cmd+F` | Fullscreen 토글 | `document.fullscreenElement` API |

#### 아키텍처

```
src/
├── hooks/
│   └── useKeyboardShortcuts.ts    # 새로 생성
├── components/
│   └── common/
│       └── HelpModal.tsx          # 새로 생성
└── components/layout/
    └── AppLayout.tsx              # 훅 연결
```

#### 주요 구현 포인트

1. **IME 호환**: `e.key` 대신 `e.code` 사용 (한글 입력 중에도 작동)
2. **입력 중 스킵**: input/textarea 포커스 시 단축키 무시
3. **동적 멤버 매핑**: members 배열에서 첫 2명 자동 선택

#### Codex Review Findings (적용 필요)

**Critical:**
1. **Input guarding 확장**: contenteditable, role="textbox", isComposing 체크 추가
2. **event.repeat 방지**: `if (e.repeat) return` 추가
3. **멤버 fallback**: members < 2명일 경우 해당 단축키 비활성화

**Improvements:**
4. **Escape 우선순위**: Modal > Drawer > FilterPanel 순서로 닫기
5. **현재 route 체크**: 이미 해당 뷰면 navigate 스킵
6. **Fullscreen try/catch**: 권한 없을 때 실패 처리
7. **queryClient scope**: `['dashboard']` 키만 무효화

**코드 패턴:**
```typescript
const isTyping = (e: KeyboardEvent) => {
  const target = e.target as HTMLElement;
  const isEditable = target.isContentEditable || target.getAttribute('role') === 'textbox';
  return ['INPUT', 'TEXTAREA', 'SELECT'].includes(target.tagName) || isEditable || e.isComposing;
};
if (e.repeat) return;
if (e.shiftKey && e.code === 'KeyE' && members[0]) { ... }
```

### Todo

- [x] Step 1: useKeyboardShortcuts 훅 생성 (`src/hooks/useKeyboardShortcuts.ts`)
- [x] Step 2: HelpModal 컴포넌트 생성 (`src/components/common/HelpModal.tsx`)
- [x] Step 3: AppLayout에 훅 연결 + HelpModal 추가
- [x] Step 4: FilterProvider를 AppLayout으로 이동
- [x] Step 5: KanbanPage에서 FilterProvider 제거
- [ ] Step 6: 검증 - 각 단축키 동작 테스트 (사용자 테스트 필요)

### Files to Modify

| 파일 | 작업 |
|------|------|
| `src/hooks/useKeyboardShortcuts.ts` | **신규 생성** |
| `src/components/common/HelpModal.tsx` | **신규 생성** |
| `src/components/layout/AppLayout.tsx` | FilterProvider 추가, 훅 연결, HelpModal 추가 |
| `src/pages/Kanban/index.tsx` | FilterProvider 제거 |

### Verification

1. 각 단축키 동작 테스트
   - `1/2/3` → 뷰 전환 확인
   - `F` → FilterPanel 토글 확인
   - `Shift+R` → 필터 리셋 확인
   - `?` → HelpModal 표시 확인
2. 입력 필드에서 단축키 무시되는지 확인
3. 한글 입력 중에도 단축키 동작 확인 (IME 호환)
4. Drawer 열린 상태에서 Escape 동작 확인

### Implementation Summary (2026-01-08)

#### Files Created
1. `/dashboard-v2/src/hooks/useKeyboardShortcuts.ts` (257 lines)
   - Global keyboard shortcuts hook with route guard
   - Comprehensive input detection (IME compatible)
   - Cross-platform fullscreen support (Mac: Cmd, Win/Linux: Ctrl)
   - Escape priority handling (HelpModal > Modal > Drawer > FilterPanel)

2. `/dashboard-v2/src/components/common/HelpModal.tsx` (118 lines)
   - Categorized shortcuts display (Navigation, Filters, Utilities)
   - Platform-aware modifier key display
   - Click-outside and Escape to close
   - Focus trap and accessibility

#### Files Modified
1. `/dashboard-v2/src/components/layout/AppLayout.tsx`
   - Added FilterProvider wrapper (moved from KanbanPage)
   - Integrated useKeyboardShortcuts hook
   - Added HelpModal component

2. `/dashboard-v2/src/pages/Kanban/index.tsx`
   - Removed FilterProvider wrapper (now in AppLayout)

#### Codex Review Findings
- ✅ Plan validation passed (with minor edge case notes)
- ✅ Implementation review ongoing (comprehensive codebase analysis)
- ⚠️ Note: FilterProvider at AppLayout level may cause re-renders on filter changes (acceptable tradeoff for global shortcuts)

#### Known Limitations
- Member shortcuts (Shift+E/M) assume members[0] and members[1] exist (fallback checks added)
- Fullscreen API not supported in all browsers (try/catch guard added)
- Route guard uses startsWith() matching (sufficient for current routes)

### Phase 2 (향후)
- Quick Search (Cmd+K) - 별도 SearchModal 컴포넌트 필요

## Linked

- **Project**: [[project|prj-023]]
