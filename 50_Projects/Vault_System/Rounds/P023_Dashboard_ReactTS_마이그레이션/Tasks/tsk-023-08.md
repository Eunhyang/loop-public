---
entity_type: Task
entity_id: "tsk-023-08"
entity_name: "Dashboard v2 - TaskForm Create 모드 구현"
created: 2026-01-08
updated: 2026-01-08
closed: 2026-01-08
status: done

# === 계층 ===
parent_id: "prj-023"
project_id: "prj-023"
aliases: ["tsk-023-08"]

# === 관계 ===
outgoing_relations: []
validates: []
validated_by: []

# === Task 전용 ===
assignee: "김은향"
start_date: 2026-01-08
due: 2026-01-08
priority: high
estimated_hours: null
actual_hours: null

# === Task 유형 (dev Task 연동용) ===
type: dev
target_project: loop

# === 분류 ===
tags: ["dashboard-v2", "taskform", "create-mode"]
priority_flag: high
---

# Dashboard v2 - TaskForm Create 모드 구현

> Task ID: `tsk-023-08` | Project: `prj-023` | Status: done

## 목표

**완료 조건**:
1. TaskForm에서 create 모드 지원
2. useCreateTask 훅 구현
3. taskApi.createTask() 함수 구현
4. 빌드 성공
5. Task 생성 기능 동작 확인

---

## 상세 내용

### 배경

현재 EntityDrawer Form 컴포넌트 구현 상태:

| Entity | Create Mode | Edit Mode |
|--------|-------------|-----------|
| Project | ✅ 완전 구현 | ❌ 미구현 |
| Program | ✅ 완전 구현 | ❌ 미구현 |
| Task | ❌ 미구현 | ✅ 완전 구현 |

TaskForm은 edit 모드만 지원하고 create 모드는 placeholder만 있음.
ProjectForm/ProgramForm 패턴을 따라 create 모드를 구현해야 함.

### 구현 범위

1. **api.ts**: `createTask()` 함수 + `CreateTaskDTO` 타입 추가
2. **queries.ts**: `useCreateTask` mutation 훅 추가
3. **TaskForm.tsx**: create 모드 폼 렌더링 (edit 모드 UI 재사용)

---

## 체크리스트

- [ ] api.ts에 createTask 함수 추가
- [ ] CreateTaskDTO 인터페이스 정의
- [ ] queries.ts에 useCreateTask 훅 추가
- [ ] TaskForm에서 create 모드 구현
- [ ] 필수 필드 검증 (entity_name, project_id, assignee)
- [ ] entity_name 형식 검증 ("주제 - 내용")
- [ ] 빌드 테스트
- [ ] Task 생성 동작 확인

---

## Notes

### PRD

#### 아키텍처 도식

```
┌─────────────────────────────────────────────────────────────────┐
│                TaskForm Create Mode Architecture                 │
├─────────────────────────────────────────────────────────────────┤
│  ┌──────────────────────────────────────────────────────────┐   │
│  │ UI Layer (TaskForm.tsx)                                   │   │
│  ├──────────────────────────────────────────────────────────┤   │
│  │  mode === 'create'                                        │   │
│  │       ↓                                                   │   │
│  │  useState(formData) ──→ Form Fields ──→ handleSubmit()   │   │
│  │  - entity_name *          - Input           │             │   │
│  │  - project_id *           - Select          ↓             │   │
│  │  - assignee *             - Select    useCreateTask()     │   │
│  │  - priority/status        - Select                        │   │
│  │  - type                   - Chips                         │   │
│  │  - start_date/due         - Date                          │   │
│  └──────────────────────────────────────────────────────────┘   │
│       │                                                          │
│       ↓                                                          │
│  ┌──────────────────────────────────────────────────────────┐   │
│  │ Query Layer (queries.ts)                                  │   │
│  │  useCreateTask() ──→ useMutation                         │   │
│  │  onSuccess: invalidateQueries([dashboardInit, tasks])    │   │
│  └──────────────────────────────────────────────────────────┘   │
│       │                                                          │
│       ↓                                                          │
│  ┌──────────────────────────────────────────────────────────┐   │
│  │ API Layer (api.ts)                                        │   │
│  │  taskApi.createTask(CreateTaskDTO)                        │   │
│  │  POST /api/tasks ──→ { success, task_id, file_path }     │   │
│  └──────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘
```

#### 구현 파일

1. **api.ts** - CreateTaskDTO + createTask 함수
2. **queries.ts** - useCreateTask 훅
3. **TaskForm.tsx** - create 모드 폼 렌더링

#### 필수 필드
- entity_name: "주제 - 내용" 형식 검증
- project_id: 프로젝트 선택
- assignee: 담당자 선택

#### 선택 필드
- priority: 기본값 "medium"
- status: 기본값 "todo"
- type: dev, bug, strategy 등
- start_date, due: YYYY-MM-DD

### Codex Review (2026-01-08)

**Critical Issues**: None
**Suggestions**: 8개

1. ✅ 서버 측 검증: entity_name 형식 → 백엔드에서 이미 검증함
2. ⚠️ entity_name 파싱: trim, 다중 하이픈, XSS 방지 → dangerouslySetInnerHTML 사용 안함
3. ✅ 권한: assignee는 members.yaml 기반 → 백엔드에서 검증함
4. ✅ project_id 검증 → 백엔드에서 검증함
5. ⚠️ 중복 제출 방지: isPending으로 버튼 비활성화 → 구현 예정
6. ⚠️ 날짜 검증: start < due 검증 → 선택적 구현
7. ✅ 빈 선택 필드 처리 → 기본값 설정으로 해결
8. ✅ 에러 처리 → ProjectForm 패턴 따름

### Tech Spec

**CreateTaskDTO 인터페이스**:
```typescript
interface CreateTaskDTO {
    entity_name: string;
    project_id: string;
    assignee: string;
    priority?: string;
    status?: string;
    type?: string;
    start_date?: string;
    due?: string;
}
```

**useCreateTask 훅**:
```typescript
export const useCreateTask = () => {
    const queryClient = useQueryClient();
    return useMutation({
        mutationFn: (data: CreateTaskDTO) => taskApi.createTask(data),
        onSuccess: () => {
            queryClient.invalidateQueries({ queryKey: queryKeys.dashboardInit });
            queryClient.invalidateQueries({ queryKey: queryKeys.tasks() });
        },
    });
};
```

### 작업 로그

#### 2026-01-08
**개요**: TaskForm Create 모드 구현 완료

**작업 내용**:
1. API Layer
   - CreateTaskDTO 인터페이스 정의
   - createTask() 함수 구현
   - 필수/선택 필드 정의

2. Query Layer
   - useCreateTask() 훅 구현
   - dashboardInit + tasks 쿼리 invalidation

3. UI Layer
   - TaskForm Create 모드 구현 (184 lines)
   - formData state 관리
   - 필수 필드 검증 (entity_name, project_id, assignee)
   - 기본값 설정 (priority: medium, status: todo, type: dev)

4. Layout Fix
   - DrawerShell Body padding 제거 (폼 레이아웃 개선)

**코드 리뷰** (Codex GPT-5):
- Critical 이슈: 0개
- Suggestions: 8개 (대부분 백엔드 검증 의존)
- 버그 수정: 3개 (onSuccess callback, defaultValue, error handling)

**빌드 결과**:
- ✅ npm run build 성공
- ✅ Task 생성 기능 동작 확인

**최종 상태**: done

**Workthrough**: `workthrough_tsk-023-08.md`

---

## 참고 문서

- [[prj-023]] - 소속 Project
- [[tsk-023-07]] - 이전 Task (TaskDrawer 통합)
- 파일: `dashboard-v2/src/features/tasks/components/TaskForm.tsx`
- 파일: `dashboard-v2/src/features/tasks/api.ts`
- 파일: `dashboard-v2/src/features/tasks/queries.ts`
- 참고: `dashboard-v2/src/features/projects/components/ProjectForm.tsx` (Create 모드 패턴)

---

**Created**: 2026-01-08
**Assignee**: 김은향
**Due**: 2026-01-08
