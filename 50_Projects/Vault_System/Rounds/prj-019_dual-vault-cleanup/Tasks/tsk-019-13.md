---
entity_type: Task
entity_id: tsk-019-13
entity_name: ID System - Hash+Epoch ID 마이그레이션
created: '2026-01-09'
updated: '2026-01-09'
status: todo
project_id: prj-019
parent_id: prj-019
assignee: 김은향
priority: high
start_date: '2026-01-09'
due: '2026-01-09'
aliases:
- tsk-019-13
tags: []
type: dev
---

# ID System - Hash+Epoch ID 마이그레이션

## 설명

Migrate the ID generation system from sequential numbers to Hash+Epoch based IDs to ensure global uniqueness and prevent collisions across distributed systems.

## 체크리스트

- [ ] Update `ssot_service.py` - Implement hash+epoch ID generation functions
- [ ] Update `entity_generator.py` - Update exec vault ID generation functions
- [ ] Update `schema_constants.yaml` - Update id_patterns regex to support new format
- [ ] Update `loop-entity-creator/SKILL.md` - Document new ID rules
- [ ] Test ID generation with collision detection
- [ ] Validate backward compatibility with existing IDs

## 참고

### PRD (Product Requirements Document)

**Problem**:
- Current sequential ID system (prj-001, tsk-001-01) can cause collisions in distributed environments
- No guarantee of global uniqueness when multiple agents create entities simultaneously
- Difficult to ensure uniqueness across public and exec vaults

**Goals**:
- Project: `prj-001` → `prj-{4자리hash}` (예: `prj-a7k9`)
- Task: `tsk-001-01` → `tsk-{4자리hash}-{에폭밀리초}` (예: `tsk-a7k9-1736412652123`)
- Ensure global uniqueness through hash+timestamp combination
- Maintain readability with short hash prefixes

**Success Criteria**:
- ID generation produces unique IDs even with concurrent creation
- Hash collision rate < 0.01% for 10,000 entities
- Existing ID patterns remain valid (backward compatibility)
- All validation scripts accept new ID format

### Tech Spec

**Architecture**:
- Hash algorithm: SHA-256 of (entity_name + timestamp + random_salt)
- Hash length: 4 characters (base36 encoding for readability)
- Epoch: Unix milliseconds (13 digits)

**Files to Modify**:

1. **`api/services/ssot_service.py`**:
   - `generate_project_id()`: Return `prj-{hash4}`
   - `generate_task_id()`: Return `tsk-{hash4}-{epoch13}`
   - Add hash generation utility function

2. **`api/utils/entity_generator.py`**:
   - `generate_exec_project_id()`: Return `prj-exec-{hash4}` or `prj-{keyword}-{hash4}`
   - `generate_exec_task_id()`: Return `tsk-exec-{epoch13}` or `tsk-{keyword}-{epoch13}`
   - Update validation functions to accept new patterns

3. **`00_Meta/schema_constants.yaml`**:
   - Update `id_patterns.prj`: `^prj-(\\d{3}|[a-z0-9]{4}|[a-z][a-z0-9-]+)$`
   - Update `id_patterns.tsk`: `^tsk-(\\d{3}-\\d{2}|[a-z0-9]{4}-\\d{13}|[a-z][a-z0-9-]+-\\d{2})$`

4. **`.claude/skills/loop-entity-creator/SKILL.md`**:
   - Document new ID generation rules
   - Add examples for hash+epoch format

**Implementation Strategy**:
- Phase 1: Add new ID generation functions (backward compatible)
- Phase 2: Update validation regex to accept both old and new formats
- Phase 3: Switch ID generation to use new format by default
- Phase 4: Test with collision detection script

**Testing Plan**:
- Unit tests for hash collision probability
- Integration tests for concurrent entity creation
- Validation tests with `validate_schema.py`
- Backward compatibility tests with existing entities

**Dependencies**:
- Python hashlib (built-in)
- Python time (built-in)
- Python random (built-in)

**Risks**:
- Hash collisions (mitigated by 4-char base36 = 1.6M combinations)
- Regex complexity increase in validation scripts
- Potential confusion with mixed old/new ID formats during transition
