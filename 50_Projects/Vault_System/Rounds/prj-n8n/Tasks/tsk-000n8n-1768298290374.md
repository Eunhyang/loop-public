---
entity_type: Task
entity_id: tsk-000n8n-1768298290374
entity_name: AC Batch - Daily Digest
created: '2026-01-13'
updated: '2026-01-14'
status: done
project_id: prj-n8n
parent_id: prj-n8n
assignee: 김은향
priority: medium
start_date: '2026-01-13'
due: '2026-01-13'
closed: '2026-01-14'
aliases:
- tsk-000n8n-1768298290374
tags: []
type: dev
---

# AC Batch - Daily Digest

## 설명

Daily digest of accelerator batch program announcements from K-Startup and Google search, posted to Discord at 15:00 KST.

## Notes

### Tech Spec

**Architecture Compliance:**
- Parent Project: prj-n8n
- Architecture Pattern: n8n workflow automation with LOOP API integration
- HTTP Request nodes must use `authentication: predefinedCredentialType` with `LOOP API Token` credential
- Error handling: `onError: continueRegularOutput` (workflow continues even on partial failures)

**File Structure:**
```
public/_build/n8n_workflows/
├── ac_batch_daily_digest.json         # Main workflow (to be created)

public/50_Projects/Vault_System/Rounds/prj-n8n/Sources/
├── ac_batch_programs.json             # SSOT: Source configuration
```

**Implementation Details:**

**1. Source Configuration (JSON - SSOT):**
- Location: `public/50_Projects/Vault_System/Rounds/prj-n8n/Sources/ac_batch_programs.json`
- Structure:
  ```json
  {
    "sources": [
      {
        "name": "k-startup",
        "type": "listing",
        "url": "https://www.k-startup.go.kr/...",
        "parse": {
          "item_selector": "...",
          "title_selector": "...",
          "date_selector": "...",
          "url_selector": "..."
        }
      },
      {
        "name": "google",
        "type": "search",
        "query_template": "2026 batch program 모집 {ac_name}",
        "result_limit": 5,
        "parse": {
          "link_selector": "a[href]"
        }
      }
    ],
    "accelerators": [
      { "name": "Antler Korea", "search_enabled": true },
      { "name": "Primer", "search_enabled": true }
    ],
    "config": {
      "deadline_threshold_days": 14,
      "discord_webhook": "${DISCORD_WEBHOOK_URL}",
      "schedule_cron": "0 15 * * *"
    }
  }
  ```

**2. n8n Workflow Nodes (ac_batch_daily_digest.json):**

Node sequence:
1. **Cron Trigger**: Schedule at 15:00 KST daily
2. **HTTP Request - Load Config JSON**: Fetch source config from vault file
3. **Code - Parse Config JSON**: Parse JSON into structured data
4. **HTTP Request - Fetch K-Startup**: Fetch K-Startup listing page
5. **Code - Parse K-Startup**: Extract program data using selectors from JSON config
   - Extract: title, deadline, status, URL
   - Normalize to schema
6. **Split In Batches**: Loop through each accelerator
7. **Code - Build Google Query**: Construct query from template + ac_name
8. **HTTP Request - Google Search**: Fetch Google results (with rate limiting)
9. **Code - Parse Google Results**: Extract official page URLs
10. **HTTP Request - Fetch Official Pages**: Fetch top 3 URLs per accelerator
11. **Code - Parse Official Pages**: Extract deadline, status, program details
12. **Code - Normalize Data**: Convert all entries to normalized schema
13. **Code - Redact Sensitive**: Remove numeric amounts, funding details
14. **HTTP Request - Load Previous Snapshot**: GET from n8n static data or file
15. **Code - Diff and Classify**: Compare with previous snapshot
    - Classify: New, Updated, Deadline Soon, Active
    - Generate program_id hash: `hash(ac_name + program_name + cohort + url)`
16. **Code - Format Discord Message**: Build digest message
17. **HTTP Request - Send Discord**: POST to webhook
18. **HTTP Request - Save Snapshot**: POST to n8n static data or write file
19. **Error Handling Path**:
    - **Code - Build Error Message**: If any HTTP node fails
    - **HTTP Request - Discord Error Alert**: Send compact error summary

**3. Data Schema (Normalized Program Entry):**
```typescript
{
  ac_name: string;             // Accelerator name (ASCII only)
  program_name: string;        // Program name
  cohort?: string;            // "Batch 23", "Gen 8", etc.
  status: "open" | "closed" | "rolling" | "unknown";
  application_deadline?: string;  // YYYY-MM-DD or null
  apply_open_date?: string;       // YYYY-MM-DD or null
  start_date?: string;            // YYYY-MM-DD or null
  location?: string;
  url: string;
  source: "k-startup" | "google";
  first_seen: string;          // YYYY-MM-DD
  last_seen: string;           // YYYY-MM-DD
  notes?: string;              // Non-numeric summary only
}
```

**4. State Storage:**
- Primary: n8n Static Data (key: `ac_batch_programs_snapshot`)
- Fallback: `public/_build/_state/ac_batch_programs.json` (derived)
- Program ID hash: `sha256(ac_name + program_name + cohort + url).slice(0, 12)`
- Retention: Keep last 7 snapshots for diff troubleshooting

**5. Discord Output Format:**
```
AC Batch Digest - 2026-01-13 (KST)
New: 3 | Updated: 2 | Deadline Soon: 1 | Open/Rolling: 5

**New**
- Antler Korea - Startup Generator (Gen 5) | deadline: 2026-02-20 | https://...
- Primer - Primer Batch (Batch 32) | deadline: 2026-02-18 | https://...

**Updated**
- SparkLabs - Batch Program (Batch 23) | deadline: 2026-02-25 → 2026-02-28 | https://...

**Deadline Soon (≤14d)**
- D.CAMP - Batch Program | deadline: 2026-01-20 | https://...

**Open / Rolling**
- Plug and Play - Global Accelerator | rolling | https://...
```

**6. Dependencies:**
- n8n credential: `LOOP API Token` (Header Auth with `x-api-token`)
- Discord webhook URL (configured in JSON or n8n env var)
- No new npm packages required (use built-in n8n nodes)

**7. Parsing Rules:**
- Date extraction patterns:
  - `YYYY.MM.DD`, `YYYY-MM-DD`, `YYYY년 MM월 DD일`
  - `MM/DD` (infer current year if within 6 months)
- Status detection:
  - "모집중", "접수중" → `status: open`
  - "마감", "종료" → `status: closed`
  - "상시모집", "rolling" → `status: rolling`
  - Otherwise → `status: unknown`
- Date validation: Must match `YYYY-MM-DD` format or null

**8. Redaction Policy:**
- Remove patterns: `\d+억원`, `\d+만원`, `$\d+[KM]`, `equity \d+%`, `SAFE \$\d+`
- Keep: Program name, accelerator name, deadline, status, URL, location
- Notes field: Only high-level summary (no investment terms)

**Edge Cases:**
- **Google search blocked**: Workflow continues with K-Startup data only; log warning
- **K-Startup page structure changed**: Parse returns empty array; send error alert to Discord
- **Discord webhook fails**: Log error to n8n execution log; retry once after 5s
- **No deadline found**: Set `status: rolling` if page mentions "상시", else `status: unknown`
- **Duplicate programs**: De-duplicate by program_id hash before diff
- **Message exceeds Discord limit (2000 chars)**: Split into multiple messages (header + sections)
- **All sources fail**: Send error-only message to Discord; do not save empty snapshot
- **Date parsing ambiguity**: If year is ambiguous, prefer nearest future date within 12 months

### Todo

- [x] Create JSON source configuration at `public/50_Projects/Vault_System/Rounds/prj-n8n/Sources/ac_batch_programs.json`
- [x] Build n8n workflow JSON with all 19 nodes (+ error path) at `public/_build/n8n_workflows/ac_batch_daily_digest.json`
- [x] Implement date extraction and normalization in "Parse K-Startup" node
- [x] Implement Google search result parsing in "Parse Google Results" node
- [x] Implement diff logic and classification in "Diff and Classify" node
- [x] Implement redaction logic in "Redact Sensitive" node
- [x] Implement Discord message formatting in "Format Discord Message" node
- [x] Configure rate limiting for Google search (2s delay between requests)
- [ ] Test workflow manually with sample data
- [ ] Verify Discord output format matches spec
- [ ] Confirm error handling triggers Discord alert on partial failure
- [ ] Import workflow to n8n UI
- [ ] Connect `LOOP API Token` credential to HTTP nodes
- [ ] Activate workflow and verify 15:00 KST schedule
- [x] Update project.md to add this workflow to "현재 워크플로우" table

## 체크리스트

- [x] JSON source config created
- [x] n8n workflow JSON implemented
- [x] Date parsing logic complete
- [x] Diff and classification logic complete
- [ ] Discord message format verified
- [ ] Error handling tested
- [ ] Workflow imported to n8n
- [ ] Credential connected
- [ ] Schedule activated
- [x] Documentation updated

## 참고
