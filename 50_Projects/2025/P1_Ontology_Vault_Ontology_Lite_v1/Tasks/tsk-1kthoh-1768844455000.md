---
entity_type: Task
entity_id: tsk-1kthoh-1768844455000
entity_name: GTM Subgraph Deterministic Merge (v1.1)
project_id: prj-1kthoh
assignee: 김은향
status: done
type: dev
target_project: loop-code
created: 2026-01-20
updated: 2026-01-20
---

# GTM Subgraph Deterministic Merge (v1.1)

## Notes

### Summary
`normalize_strategic_context()`에 v1.1 기능 추가: doc_body의 `[GTM_SUBGRAPH]` 섹션을 파싱하여 GTM nodes/edges를 결정론적으로 merge하는 기능 구현 완료.

### Changes Made
- `api/utils/normalize_strategic_context.py` (+287줄)
  - EDGE_TYPES에 5개 GTM edge types 추가 (gtm_activates_into, gtm_includes, gtm_upsells_to, gtm_monetized_by, gtm_data_feeds)
  - `parse_gtm_subgraph()` 함수 구현 (YAML 파싱, 노드/엣지 검증)
  - `normalize_strategic_context()` 파이프라인에 GTM 처리 로직 추가 (Step 4)
  - DEFAULT_OPTIONS에 GTM 관련 옵션 4개 추가

- `api/tests/test_normalize_strategic_context.py` (+441줄)
  - GTM 테스트 케이스 13개 추가
  - 기존 테스트 1개 수정 (triggers_shutdown 지원 반영)

### Test Results
- 31개 테스트 모두 통과
- 결정론성 검증 완료 (동일 입력 → 동일 출력)
- 기존 v1 기능 회귀 없음

### Commit
```
feat(ontology): Add GTM Subgraph parsing to normalize_strategic_context (v1.1)
```
