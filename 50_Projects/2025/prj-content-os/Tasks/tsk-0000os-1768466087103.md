---
entity_type: Task
entity_id: tsk-0000os-1768466087103
entity_name: Content OS - Auth Flow in Vite
created: '2026-01-15'
updated: '2026-01-15'
closed: '2026-01-15'
status: done
project_id: prj-content-os
parent_id: prj-content-os
assignee: 김은향
priority: medium
start_date: '2026-01-15'
due: '2026-01-15'
aliases:
- tsk-0000os-1768466087103
tags: []
type: dev
target_project: loop
---

# Content OS - Auth Flow in Vite

## 설명

Align Content OS authentication with existing Dashboard V2 auth flows and integrate YouTube OAuth status into the UI.

## Notes

### Tech Spec

**IMPORTANT**: Read `/Users/gim-eunhyang/dev/loop/.agent/plan/prd-techspec-merge-content-os-into-dashboard-v2.md` before starting.

**Current auth baseline (Dashboard V2)**:
- Guard: `code/dashboard-v2/src/routes/ProtectedRoute.tsx`
- Token storage: `code/dashboard-v2/src/features/auth/storage.ts`
- HTTP client: `code/dashboard-v2/src/services/http.ts`

**Required behavior**:
- `/content-os/*` routes remain behind `ProtectedRoute`
- Login uses Dashboard V2 login page; no separate Content OS login route
- YouTube OAuth status is available for Content OS pages (especially Performance)

**Required changes**:
- Add Content OS auth hooks in `code/dashboard-v2/src/features/content-os/shared` or similar
- Replace any direct `/api/auth/youtube/*` calls with `/api/content-os/auth/youtube/*`
- Ensure redirect after login returns to the original Content OS route

**Redirect handling (explicit)**:
- Update `ProtectedRoute` to redirect to `/login?redirect=<encoded>` when unauthenticated
- Update `LoginPage` to read `redirect` from query params and navigate to it after login
- Default redirect remains `/kanban` when no param is present

**Storage decision**:
- Continue using `authStorage` in localStorage (`LOOP_API_TOKEN`, `LOOP_USER_ROLE`)
- All API calls remain authenticated via `httpClient` interceptor

### Todo

- [ ] Read master PRD document (`prd-techspec-merge-content-os-into-dashboard-v2.md`)
- [ ] Identify existing login flow in `code/dashboard-v2/src/pages/Login` and reuse
- [ ] Add Content OS auth helper (hook or service) that wraps:
  - Status check: `GET /api/content-os/auth/youtube/status`
  - Logout: `POST /api/content-os/auth/youtube/logout`
  - Login URL: `/api/content-os/auth/youtube/login`
- [ ] Ensure httpClient is used for any authenticated calls
- [ ] Update `ProtectedRoute` to redirect to `/login?redirect=<encoded>` when unauthenticated
- [ ] Update `LoginPage` to read `redirect` from query params and navigate after login
- [ ] Verify Content OS routes require authentication and use existing dashboard token
- [ ] Verify YouTube OAuth status can be checked from Vite app
- [ ] Verify OAuth login redirects back to `/content-os/performance`
- [ ] Manual test: login with deep-link to `/content-os/performance`
- [ ] Manual test: verify status and logout behavior

## 체크리스트

- [ ] Tech Spec reviewed
- [ ] Implementation complete
- [ ] Tests passed
- [ ] Code review complete

## 참고

**Acceptance criteria**:
- Content OS routes require authentication and use the existing dashboard token
- YouTube OAuth status can be checked from the Vite app
- OAuth login redirects back to `/content-os/performance`

**Validation**:
- Manual login with deep-link to `/content-os/performance`
- Verify status and logout behavior

### 작업 로그

#### 2026-01-15 20:09
**개요**: Dashboard V2에 Content OS 인증 흐름 정합성 적용 (로그인 리다이렉트 + YouTube OAuth 훅)

**변경사항**
- `ProtectedRoute`: 인증 없을 때 `/login?redirect=<현재 경로>`로 리디렉션
- `LoginPage`: `redirect` 쿼리 파라미터를 읽어 로그인 성공 후 해당 경로로 이동(기본 `/kanban`)
- `features/content-os/auth/useYoutubeAuth.ts`: YouTube OAuth 상태 조회/로그아웃/로그인 시작 헬퍼 추가 (`/api/content-os/auth/youtube/*` 사용)

**테스트**
- `npm run build` 미실행 (node_modules 미설치로 tsc 없음; deps 설치 후 빌드 필요)

**커밋**: `450d356c2` on branch `task/tsk-0000os-1768466087103`
