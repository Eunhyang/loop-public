# LOOP Impact Model Configuration
# Version: 1.1.0
# Last Updated: 2025-12-20
#
# Changelog (v1.1.0):
# - realized_status에 학습 기반 상태 추가 (succeeded, failed_but_high_signal, etc.)
# - learning_value 정의 추가 (정보 엔트로피 감소량)
# - Evidence 확장 필드 정의 추가 (impact_metric, learning_value)
#
# 이 파일은 Impact A/B 점수 계산에 사용되는 모든 상수를 정의합니다.
# build_impact.py, API autofill 등에서 참조합니다.

version: "1.1.0"  # v5.1: condition_contributes + track_contributes

# ============================================
# Tier 정의
# ============================================
tiers:
  strategic:
    description: "비전/전략에 직접 기여하는 핵심 프로젝트"
    examples:
      - "신규 시장 진출"
      - "핵심 제품 출시"
      - "전략적 파트너십"

  enabling:
    description: "전략 실행을 가속하는 기반 프로젝트"
    examples:
      - "인프라 구축"
      - "팀 채용"
      - "프로세스 개선"

  operational:
    description: "일상 운영을 유지하는 필수 프로젝트"
    examples:
      - "유지보수"
      - "정기 업데이트"
      - "운영 지원"

# ============================================
# Expected Score (A) 계산
# ============================================
# ExpectedScore = magnitude_points[tier][magnitude] × confidence

magnitude_points:
  strategic:
    high: 10
    mid: 6
    low: 3
  enabling:
    high: 5
    mid: 3
    low: 1.5
  operational:
    high: 2
    mid: 1
    low: 0.5

# impact_magnitude 정의
magnitude_levels:
  high:
    description: "핵심 지표에 직접적이고 큰 영향"
    threshold: "목표 달성의 30% 이상 기여"
  mid:
    description: "지표에 중간 수준의 영향"
    threshold: "목표 달성의 10-30% 기여"
  low:
    description: "지표에 간접적이거나 작은 영향"
    threshold: "목표 달성의 10% 미만 기여"

# confidence 범위
confidence:
  min: 0.0
  max: 1.0
  default: 0.7
  guidelines:
    high: 0.8    # 실행 계획이 명확하고 리스크가 낮음
    medium: 0.5  # 불확실성이 있지만 관리 가능
    low: 0.3     # 리스크가 높거나 실험적

# ============================================
# Realized Score (B) 계산
# ============================================
# RealizedScore = normalized_delta × strength_mult × attribution_share

strength_multipliers:
  strong: 1.0   # 정량적 데이터, 명확한 인과관계
  medium: 0.7   # 정성적 증거, 합리적 추론
  weak: 0.4     # 간접 증거, 약한 연관성

# normalized_delta 범위
normalized_delta:
  min: 0.0
  max: 1.0
  description: "목표 대비 실제 달성 비율 (0=미달, 1=완전달성)"

# attribution_share 범위
attribution_share:
  min: 0.0
  max: 1.0
  default: 1.0
  description: "해당 프로젝트의 기여 비율 (다른 요인 배제)"

# ============================================
# Realized Status 정의
# ============================================
realized_status:
  planned:
    description: "아직 시작 전"
    can_have_evidence: false
    outcome_type: null

  in_progress:
    description: "진행 중, 부분 증거 가능"
    can_have_evidence: true
    outcome_type: null

  completed:
    description: "완료, 최종 증거 필요"
    can_have_evidence: true
    outcome_type: neutral

  validated:
    description: "증거 검증 완료"
    can_have_evidence: true
    outcome_type: neutral

  # === 학습 기반 상태 (v1.1 추가) ===
  succeeded:
    description: "목표 달성 + 가설 검증됨"
    can_have_evidence: true
    outcome_type: success

  failed_but_high_signal:
    description: "목표 미달 + 명확한 학습 (전략 변경 근거)"
    can_have_evidence: true
    outcome_type: learning_success
    # 이 상태는 RealizedScore가 낮아도 "전략적 가치"가 있음을 표시

  failed_low_signal:
    description: "목표 미달 + 노이즈가 많아 판단 어려움"
    can_have_evidence: true
    outcome_type: failure

  inconclusive:
    description: "외부 요인으로 결과 판단 불가"
    can_have_evidence: true
    outcome_type: null

# ============================================
# Learning Value 정의 (v1.1 추가)
# ============================================
# 실패해도 배운 게 있는가? (정보 엔트로피 감소량)
learning_value:
  high:
    description: "다음 전략 선택을 명확히 바꿈"
    criteria:
      - "주요 가설이 명확히 반증됨"
      - "전략 옵션이 줄어듦"
      - "의사결정이 쉬워짐"
    examples:
      - "와디즈 메시지 전략 폐기 확정"
      - "사회적 증거 없이 전환 불가 확인"

  medium:
    description: "가설 일부 검증/반증"
    criteria:
      - "일부 가설만 검증됨"
      - "추가 실험 필요"
    examples:
      - "가격 문제인지 메시지 문제인지 분리 안 됨"

  low:
    description: "노이즈가 많아 판단 어려움"
    criteria:
      - "외부 변수 영향이 큼"
      - "데이터 품질 낮음"
      - "실험 설계 오류"
    examples:
      - "코로나 영향으로 결과 해석 불가"

# ============================================
# Roll-up 설정 (v5.1 업데이트)
# ============================================
rollup:
  # Condition 롤업: condition_contributes 필드 사용
  condition:
    method: "weighted_sum"
    formula: "sum(project.expected × project.condition_contributes[cond].weight)"
    field: "condition_contributes"

  # Track 롤업 (v5.1 신규)
  track:
    method: "weighted_sum"
    primary_formula: "sum(project.expected × 1.0)"  # parent_id = Primary Track
    secondary_formula: "sum(project.expected × project.track_contributes[trk].weight)"
    primary_field: "parent_id"        # 암묵적 weight 1.0
    secondary_field: "track_contributes"  # 명시적 weight

  # NorthStar 롤업: Condition들의 가중 합
  northstar:
    method: "weighted_sum"
    formula: "sum(condition.score × condition.weight_to_northstar)"

# ============================================
# LLM Autofill 설정
# ============================================
autofill:
  model: "claude-sonnet-4-20250514"
  max_tokens: 1024
  temperature: 0.3

  # Context 수집 제한
  context_limits:
    max_similar_projects: 3
    max_condition_chars: 2000
    max_northstar_chars: 500

# ============================================
# 검증 규칙
# ============================================
validation:
  project:
    required_fields:
      - tier
      - track
      - contributes
      - impact_magnitude
      - confidence

    contributes_rules:
      min_count: 1
      max_count: 5
      weight_sum_max: 1.0

  evidence:
    required_fields:
      - project
      - summary
      - normalized_delta
      - evidence_strength

    # 확장 필드 (권장, 필수 아님)
    extended_fields:
      - attribution_share     # 기여 비율 (기본값: 1.0)
      - impact_metric         # 측정 지표명
      - learning_value        # 학습 가치 (high/medium/low)
      - falsified_hypotheses  # 반증된 가설 목록
      - confirmed_insights    # 확인된 인사이트 목록
