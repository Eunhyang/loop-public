<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LOOP Strategy Dashboard</title>
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/sidebar.css">
    <link rel="stylesheet" href="css/kanban.css">
    <link rel="stylesheet" href="css/modal.css">
    <link rel="stylesheet" href="css/panel.css">
    <link rel="stylesheet" href="css/filter-panel.css">
    <link rel="stylesheet" href="css/graph.css">
    <link rel="stylesheet" href="css/calendar.css">
    <link rel="stylesheet" href="css/quick-search.css">
    <link rel="stylesheet" href="css/program-rounds.css">
    <link rel="stylesheet" href="css/pdf-viewer.css">
    <!-- D3.js for Graph Visualization -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <!-- FullCalendar for Calendar View -->
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js"></script>
    <!-- FullCalendar Google Calendar Plugin -->
    <script src="https://cdn.jsdelivr.net/npm/@fullcalendar/google-calendar@6.1.10/index.global.min.js"></script>
</head>
<body>
    <!-- Login Modal -->
    <div class="modal-overlay login-modal" id="loginModal" style="display: none;">
        <div class="modal modal-small">
            <div class="modal-header">
                <h2>üîê Dashboard Login</h2>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="loginEmail" placeholder="Enter email" autofocus>
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="loginPassword" placeholder="Enter password">
                </div>
                <p class="login-error" id="loginError" style="color: #e74c3c; display: none;">Invalid credentials</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" id="loginSubmit">Login</button>
            </div>
        </div>
    </div>

    <!-- App Layout: Sidebar + Main Content -->
    <div class="app-layout">
        <!-- Sidebar Navigation -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h2>LOOP</h2>
                <button class="sidebar-toggle" id="sidebarToggle" title="Toggle Sidebar">&#9776;</button>
            </div>

            <!-- Tracks Section -->
            <div class="sidebar-section">
                <div class="sidebar-section-header" data-section="tracks">
                    <span class="sidebar-section-icon">&#9776;</span>
                    <span class="sidebar-section-title">Tracks</span>
                    <span class="sidebar-section-arrow">&#9662;</span>
                </div>
                <ul class="sidebar-list" id="sidebarTracks">
                    <!-- Dynamically populated -->
                </ul>
            </div>

            <!-- Hypotheses Section -->
            <div class="sidebar-section">
                <div class="sidebar-section-header" data-section="hypotheses">
                    <span class="sidebar-section-icon">&#128161;</span>
                    <span class="sidebar-section-title">Hypotheses</span>
                    <span class="sidebar-section-arrow">&#9662;</span>
                </div>
                <ul class="sidebar-list" id="sidebarHypotheses">
                    <!-- Dynamically populated -->
                </ul>
            </div>

            <!-- Conditions Section -->
            <div class="sidebar-section">
                <div class="sidebar-section-header" data-section="conditions">
                    <span class="sidebar-section-icon">&#9888;</span>
                    <span class="sidebar-section-title">Conditions</span>
                    <span class="sidebar-section-arrow">&#9662;</span>
                </div>
                <ul class="sidebar-list" id="sidebarConditions">
                    <!-- Dynamically populated -->
                </ul>
            </div>
        </aside>

        <!-- Main Content Area -->
        <div class="main-content">
            <!-- Header -->
            <header class="header">
                <div class="header-left">
                    <h1>LOOP Strategy Dashboard</h1>
                    <div class="meta" id="headerMeta">Task & Project Management</div>
                </div>
                <div class="header-actions">
                    <!-- View Toggle -->
                    <div class="view-toggle">
                        <button class="view-toggle-btn active" id="viewKanban" title="Kanban View">Kanban</button>
                        <button class="view-toggle-btn" id="viewCalendar" title="Calendar View">Calendar</button>
                        <button class="view-toggle-btn" id="viewGraph" title="Graph View">Graph</button>
                        <button class="view-toggle-btn view-toggle-admin" id="viewProgram" title="Program-Round View (Admin only)" style="display: none;">Program</button>
                    </div>
                    <button class="btn btn-primary" id="btnNewTask">+ New Task</button>
                    <button class="btn btn-primary" id="btnNewProject">+ New Project</button>
                    <button class="btn btn-icon" id="btnReloadCache" title="Reload Cache">
                        <span class="reload-icon">üîÑ</span>
                    </button>
                    <button class="btn btn-icon" id="btnFilter" title="Filters">
                        <span class="filter-icon">&#9881;</span>
                    </button>
                    <button class="btn btn-icon" id="btnPendingReviews" title="Pending Reviews">
                        <span class="pending-icon">üìã</span>
                        <span class="pending-review-badge" id="pendingReviewBadge" style="display: none;">0</span>
                    </button>
                    <!-- User Info & Logout -->
                    <div class="user-info" id="userInfo">
                        <span class="user-role" id="userRole"></span>
                        <button class="btn btn-secondary btn-small" id="btnLogout" title="Logout">Logout</button>
                    </div>
                </div>
            </header>

            <!-- Shared Tabs & Filters (Kanban + Calendar Í≥µÏö©) -->
            <div class="shared-filters" id="sharedFilters">
                <!-- Assignee Tabs + Quick Date Toggle -->
                <div class="tabs-row">
                    <nav class="tabs" id="tabs">
                        <!-- Dynamically populated -->
                    </nav>

                    <!-- Quick Date Toggle ([W][M] + ÌïòÏúÑ ÌïÑÌÑ∞) -->
                    <div class="quick-date-toggle" id="quickDateToggle">
                        <div class="qd-mode-buttons">
                            <button class="qd-toggle-btn" data-mode="week" title="Week Filter">W</button>
                            <button class="qd-toggle-btn" data-mode="month" title="Month Filter">M</button>
                        </div>
                        <div class="qd-buttons" id="qdButtons">
                            <!-- Dynamically populated: W-2, W-1, W0... or 11Ïõî, 12Ïõî... -->
                        </div>
                    </div>
                </div>

                <!-- Project Filter (ÌïòÏúÑ ÌÉ≠) -->
                <div class="filter-bar" id="filterBar">
                    <div class="filter-buttons" id="assigneeFilter">
                        <!-- Dynamically populated -->
                    </div>
                </div>
            </div>

            <!-- Kanban View (default) -->
            <div class="kanban-view active" id="kanbanView">
                <!-- Kanban Board -->
                <main class="board-container">
                    <div class="kanban-board" id="board">
                        <!-- Dynamically populated -->
                    </div>
                </main>
            </div>

            <!-- Graph View -->
            <div class="graph-view" id="graphView">
                <div class="graph-container" id="graphContainer">
                    <!-- D3.js graph will be rendered here -->
                </div>
                <!-- Graph Detail Panel -->
                <div class="graph-detail-panel collapsed" id="graphDetailPanel">
                    <!-- Dynamically populated when node is selected -->
                </div>
            </div>

            <!-- Calendar View -->
            <div class="calendar-view" id="calendarView">
                <div class="calendar-container" id="calendarContainer">
                    <!-- FullCalendar will be rendered here -->
                </div>
            </div>

            <!-- Program-Round View (Admin only) -->
            <div class="program-rounds-view" id="programRoundsView">
                <!-- Dynamically populated by ProgramRoundsView -->
            </div>
        </div>
    </div>

    <!-- Task Modal -->
    <div class="modal-overlay" id="taskModal">
        <div class="modal">
            <div class="modal-header">
                <h2 id="taskModalTitle">New Task</h2>
                <button class="modal-close" id="taskModalClose">&times;</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="taskId">
                <div class="form-group">
                    <label>Task Name *</label>
                    <input type="text" id="taskName" placeholder="Enter task name">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Project *</label>
                        <select id="taskProject"></select>
                    </div>
                    <div class="form-group">
                        <label>Assignee *</label>
                        <select id="taskAssignee"></select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Priority</label>
                        <select id="taskPriority"></select>
                    </div>
                    <div class="form-group">
                        <label>Status</label>
                        <select id="taskStatus"></select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Start Date</label>
                        <input type="date" id="taskStartDate">
                    </div>
                    <div class="form-group">
                        <label>Due Date</label>
                        <input type="date" id="taskDue">
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="taskModalCancel">Cancel</button>
                <button class="btn btn-success" id="taskModalSave">Save</button>
            </div>
        </div>
    </div>

    <!-- Project Modal -->
    <div class="modal-overlay" id="projectModal">
        <div class="modal">
            <div class="modal-header">
                <h2 id="projectModalTitle">New Project</h2>
                <button class="modal-close" id="projectModalClose">&times;</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="projectId">
                <div class="form-group">
                    <label>Project Name *</label>
                    <input type="text" id="projectName" placeholder="Enter project name">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Owner *</label>
                        <select id="projectOwner"></select>
                    </div>
                    <div class="form-group">
                        <label>Parent Track</label>
                        <select id="projectTrack"></select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Priority</label>
                        <select id="projectPriority"></select>
                    </div>
                    <div class="form-group">
                        <label>Status</label>
                        <select id="projectStatus"></select>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="projectModalCancel">Cancel</button>
                <button class="btn btn-success" id="projectModalSave">Save</button>
            </div>
        </div>
    </div>

    <!-- Delete Confirm Modal -->
    <div class="modal-overlay" id="deleteModal">
        <div class="modal modal-small">
            <div class="modal-header">
                <h2>Confirm Delete</h2>
                <button class="modal-close" id="deleteModalClose">&times;</button>
            </div>
            <div class="modal-body">
                <p id="deleteMessage">Are you sure you want to delete this item?</p>
                <input type="hidden" id="deleteId">
                <input type="hidden" id="deleteType">
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="deleteModalCancel">Cancel</button>
                <button class="btn btn-danger" id="deleteModalConfirm">Delete</button>
            </div>
        </div>
    </div>

    <!-- Keyboard Shortcuts Help Modal -->
    <div class="modal-overlay" id="helpModal">
        <div class="modal modal-small">
            <div class="modal-header">
                <h2>Keyboard Shortcuts</h2>
                <button class="modal-close" id="helpModalClose">&times;</button>
            </div>
            <div class="modal-body">
                <div class="shortcuts-list">
                    <div class="shortcut-section">
                        <h4>Views</h4>
                        <div class="shortcut-item"><kbd>1</kbd> Kanban View</div>
                        <div class="shortcut-item"><kbd>2</kbd> Calendar View</div>
                        <div class="shortcut-item"><kbd>3</kbd> Graph View</div>
                    </div>
                    <div class="shortcut-section">
                        <h4>Filters</h4>
                        <div class="shortcut-item"><kbd>F</kbd> Toggle Filter Panel</div>
                        <div class="shortcut-item"><kbd>Shift</kbd>+<kbd>R</kbd> Reset All Filters</div>
                    </div>
                    <div class="shortcut-section">
                        <h4>Members</h4>
                        <div class="shortcut-item"><kbd>Shift</kbd>+<kbd>E</kbd> ÍπÄÏùÄÌñ•</div>
                        <div class="shortcut-item"><kbd>Shift</kbd>+<kbd>M</kbd> ÌïúÎ™ÖÌïô</div>
                        <div class="shortcut-item"><kbd>Shift</kbd>+<kbd>A</kbd> All Members</div>
                    </div>
                    <div class="shortcut-section">
                        <h4>Navigation</h4>
                        <div class="shortcut-item"><kbd>Cmd/Ctrl</kbd>+<kbd>K</kbd> Quick Search</div>
                        <div class="shortcut-item"><kbd>Shift</kbd>+<kbd>C</kbd> Reload Cache</div>
                        <div class="shortcut-item"><kbd>Esc</kbd> Close Modal/Panel</div>
                        <div class="shortcut-item"><kbd>?</kbd> Show This Help</div>
                    </div>
                    <div class="shortcut-section">
                        <h4>Panel</h4>
                        <div class="shortcut-item"><kbd>Shift</kbd>+<kbd>Cmd/Ctrl</kbd>+<kbd>F</kbd> Toggle Fullscreen</div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" id="helpModalClose2">Got it!</button>
            </div>
        </div>
    </div>

    <!-- Quick Search Modal (Cmd+K) -->
    <div class="quick-search-overlay" id="quickSearchOverlay">
        <div class="quick-search-modal" id="quickSearchModal">
            <div class="quick-search-input-wrapper">
                <span class="quick-search-icon">üîç</span>
                <input type="text" id="quickSearchInput" placeholder="Search tasks, projects, commands..." autocomplete="off">
                <kbd class="quick-search-esc">ESC</kbd>
            </div>
            <div class="quick-search-results" id="quickSearchResults">
                <!-- Dynamically populated -->
            </div>
            <div class="quick-search-footer">
                <span><kbd>‚Üë‚Üì</kbd> Navigate</span>
                <span><kbd>Enter</kbd> Select</span>
                <span><kbd>></kbd> Commands</span>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- PDF Viewer Modal (tsk-dashboard-ux-v1-20) -->
    <div class="pdf-viewer-overlay" id="pdfViewerOverlay" role="dialog" aria-modal="true" aria-labelledby="pdfViewerFilename">
        <div class="pdf-viewer-modal">
            <!-- Toolbar -->
            <div class="pdf-viewer-toolbar">
                <div class="pdf-viewer-toolbar-left">
                    <span class="pdf-viewer-filename" id="pdfViewerFilename">document.pdf</span>
                </div>
                <div class="pdf-viewer-toolbar-center">
                    <button class="pdf-viewer-btn" id="pdfViewerPrev" title="Previous page (‚Üê)" aria-label="Previous page">
                        <span>&lt;</span>
                    </button>
                    <span class="pdf-viewer-page-info">
                        <input type="number" id="pdfViewerPageInput" class="pdf-viewer-page-input" min="1" value="1" aria-label="Current page">
                        <span>/</span>
                        <span id="pdfViewerTotalPages">1</span>
                    </span>
                    <button class="pdf-viewer-btn" id="pdfViewerNext" title="Next page (‚Üí)" aria-label="Next page">
                        <span>&gt;</span>
                    </button>
                </div>
                <div class="pdf-viewer-toolbar-right">
                    <button class="pdf-viewer-btn" id="pdfViewerZoomOut" title="Zoom out (-)" aria-label="Zoom out">
                        <span>‚àí</span>
                    </button>
                    <span class="pdf-viewer-zoom-level" id="pdfViewerZoomLevel">100%</span>
                    <button class="pdf-viewer-btn" id="pdfViewerZoomIn" title="Zoom in (+)" aria-label="Zoom in">
                        <span>+</span>
                    </button>
                    <button class="pdf-viewer-btn" id="pdfViewerDownload" title="Download" aria-label="Download PDF">
                        <span>‚¨á</span>
                    </button>
                    <button class="pdf-viewer-btn pdf-viewer-close" id="pdfViewerClose" title="Close (ESC)" aria-label="Close viewer">
                        <span>‚úï</span>
                    </button>
                </div>
            </div>
            <!-- Canvas Container -->
            <div class="pdf-viewer-container" id="pdfViewerContainer">
                <div class="pdf-viewer-loading" id="pdfViewerLoading">
                    <div class="pdf-viewer-spinner"></div>
                    <span>Loading PDF...</span>
                </div>
                <canvas id="pdfViewerCanvas"></canvas>
            </div>
        </div>
    </div>

    <!-- Filter Side Panel -->
    <div class="panel-overlay" id="filterPanelOverlay"></div>
    <aside class="side-panel filter-panel" id="filterPanel">
        <div class="panel-header">
            <h2>Filters</h2>
            <button class="panel-close" id="filterPanelClose">&times;</button>
        </div>
        <div class="panel-body">
            <!-- Activate Filters (Show Inactive) -->
            <div class="panel-section">
                <div class="panel-section-title">VISIBILITY</div>
                <div class="filter-toggles" id="activateFilters">
                    <!-- Dynamically populated -->
                </div>
            </div>

            <!-- Project Filters -->
            <div class="panel-section">
                <div class="panel-section-title">PROJECT FILTERS</div>

                <div class="filter-group">
                    <label class="filter-group-label">Status</label>
                    <div class="filter-checkboxes" id="projectStatusFilters">
                        <!-- Dynamically populated -->
                    </div>
                </div>

                <div class="filter-group">
                    <label class="filter-group-label">Priority</label>
                    <div class="filter-checkboxes" id="projectPriorityFilters">
                        <!-- Dynamically populated -->
                    </div>
                </div>
            </div>

            <!-- Task Filters -->
            <div class="panel-section">
                <div class="panel-section-title">TASK FILTERS</div>

                <div class="filter-group">
                    <label class="filter-group-label">Status</label>
                    <div class="filter-checkboxes" id="taskStatusFilters">
                        <!-- Dynamically populated -->
                    </div>
                </div>

                <div class="filter-group">
                    <label class="filter-group-label">Priority</label>
                    <div class="filter-checkboxes" id="taskPriorityFilters">
                        <!-- Dynamically populated -->
                    </div>
                </div>

                <div class="filter-group">
                    <label class="filter-group-label">Type</label>
                    <div class="filter-checkboxes" id="taskTypeFilters">
                        <!-- Dynamically populated -->
                    </div>
                </div>

                <div class="filter-group">
                    <label class="filter-group-label">Due Date</label>
                    <div class="filter-date-range">
                        <input type="date" id="filterDueDateStart" placeholder="Start">
                        <span class="date-separator">~</span>
                        <input type="date" id="filterDueDateEnd" placeholder="End">
                    </div>
                    <!-- Quick Date Filter moved to tabs row -->
                </div>
            </div>
        </div>
        <div class="panel-footer">
            <button class="btn btn-secondary" id="filterResetBtn">Reset All</button>
        </div>
    </aside>

    <!-- Project Side Panel -->
    <div class="panel-overlay" id="projectPanelOverlay"></div>
    <aside class="side-panel" id="projectPanel">
        <div class="panel-header">
            <h2 id="projectPanelTitle">Project Detail</h2>
            <div class="panel-header-actions">
                <button class="panel-expand" id="projectPanelExpand" title="Expand">‚õ∂</button>
                <button class="panel-close" id="projectPanelClose">&times;</button>
            </div>
        </div>
        <div class="panel-body">
            <div class="panel-columns">
                <!-- Left Column: Basic Info + Relations -->
                <div class="panel-column-left">
                    <div class="panel-id-row">
                        <div class="panel-field-id" id="panelProjectId"></div>
                        <button class="btn-copy-link" id="panelProjectCopyLink" title="Copy link to clipboard">üîó</button>
                    </div>

                    <!-- Basic Info -->
                    <div class="panel-section">
                        <div class="panel-section-title">Basic Info</div>
                        <div class="panel-field">
                            <label>Project Name *</label>
                            <input type="text" id="panelProjectName" placeholder="Enter project name">
                        </div>
                        <div class="panel-field-row">
                            <div class="panel-field">
                                <label>Owner *</label>
                                <select id="panelProjectOwner"></select>
                            </div>
                            <div class="panel-field">
                                <label>Parent Track</label>
                                <select id="panelProjectTrack"></select>
                            </div>
                        </div>
                        <div class="panel-field-row">
                            <div class="panel-field">
                                <label>Status</label>
                                <select id="panelProjectStatus"></select>
                            </div>
                            <div class="panel-field">
                                <label>Priority</label>
                                <select id="panelProjectPriority"></select>
                            </div>
                        </div>
                    </div>

                    <!-- Impact Score -->
                    <div class="panel-section" id="panelProjectImpactSection">
                        <div class="panel-section-title">Impact Score</div>
                        <div class="impact-scores">
                            <div class="impact-score-card expected">
                                <div class="impact-score-label">Expected (A)</div>
                                <div class="impact-score-value" id="panelExpectedScore">-</div>
                                <div class="impact-score-details" id="panelExpectedDetails"></div>
                            </div>
                            <div class="impact-score-card realized">
                                <div class="impact-score-label">Realized (B)</div>
                                <div class="impact-score-value" id="panelRealizedScore">-</div>
                                <div class="impact-score-details" id="panelRealizedDetails"></div>
                            </div>
                        </div>
                        <div class="impact-contributes" id="panelImpactContributes">
                            <!-- contributes Ï†ïÎ≥¥ ÌëúÏãú -->
                        </div>
                    </div>

                    <!-- Relations -->
                    <div class="panel-section">
                        <div class="panel-section-title">Relations</div>
                        <div class="panel-relations" id="panelProjectRelations">
                            <!-- Dynamically populated -->
                        </div>
                    </div>

                    <!-- Links -->
                    <div class="panel-section" id="panelProjectLinksSection" style="display: none;">
                        <div class="panel-section-title">üìé Links</div>
                        <div class="panel-links" id="panelProjectLinks">
                            <!-- Dynamically populated -->
                        </div>
                    </div>

                    <!-- Tasks in Project -->
                    <div class="panel-section">
                        <div class="panel-section-title">Tasks</div>
                        <div class="panel-project-tasks" id="panelProjectTasks">
                            <!-- Dynamically populated -->
                        </div>
                    </div>
                </div>

                <!-- Right Column: Body + Notes -->
                <div class="panel-column-right">
                    <!-- Project Body (Markdown) -->
                    <div class="panel-section panel-section-body">
                        <div class="panel-section-title">Project Body</div>
                        <div class="panel-body-container">
                            <div class="panel-body-preview" id="panelProjectBodyPreview">
                                <div class="body-placeholder">No body content</div>
                            </div>
                        </div>
                    </div>

                    <!-- Notes (Editable) -->
                    <div class="panel-section panel-section-notes">
                        <div class="panel-section-title">
                            Notes
                            <button class="notes-toggle-btn" id="projectNotesToggleBtn" title="Toggle Edit">‚úèÔ∏è</button>
                        </div>
                        <div class="panel-notes-container">
                            <div class="panel-notes-preview" id="panelProjectNotesPreview">
                                <div class="notes-placeholder">No notes</div>
                            </div>
                            <div class="panel-field panel-notes-edit" id="panelProjectNotesEdit" style="display: none;">
                                <textarea id="panelProjectNotes" placeholder="Add notes... (Markdown supported)"></textarea>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="panel-footer">
            <div class="panel-footer-left">
                <button class="btn btn-danger" id="panelProjectDelete">Delete</button>
            </div>
            <div class="panel-footer-right">
                <button class="btn btn-secondary" id="panelProjectCancel">Cancel</button>
                <button class="btn btn-success" id="panelProjectSave">Save</button>
            </div>
        </div>
    </aside>

    <!-- Task Side Panel -->
    <div class="panel-overlay" id="taskPanelOverlay"></div>
    <aside class="side-panel" id="taskPanel">
        <div class="panel-header">
            <h2 id="taskPanelTitle">Task Detail</h2>
            <div class="panel-header-actions">
                <a class="panel-obsidian-link" id="taskPanelObsidian" href="#" title="Open in Obsidian" style="display: none;">üìù</a>
                <button class="panel-expand" id="taskPanelExpand" title="Expand">‚õ∂</button>
                <button class="panel-close" id="taskPanelClose">&times;</button>
            </div>
        </div>
        <div class="panel-body">
            <div class="panel-columns">
                <!-- Left Column: Basic Info + Relations -->
                <div class="panel-column-left">
                    <div class="panel-id-row">
                        <div class="panel-field-id" id="panelTaskId"></div>
                        <button class="btn-copy-link" id="panelTaskCopyLink" title="Copy link to clipboard">üîó</button>
                    </div>

                    <!-- Basic Info -->
                    <div class="panel-section">
                        <div class="panel-section-title">Basic Info</div>
                        <div class="panel-field">
                            <label>Task Name *</label>
                            <input type="text" id="panelTaskName" placeholder="Enter task name">
                        </div>
                        <div class="panel-field-row">
                            <div class="panel-field">
                                <label>Project *</label>
                                <select id="panelTaskProject"></select>
                            </div>
                            <div class="panel-field">
                                <label>Assignee *</label>
                                <select id="panelTaskAssignee"></select>
                            </div>
                        </div>
                        <div class="panel-field-row">
                            <div class="panel-field">
                                <label>Status</label>
                                <select id="panelTaskStatus"></select>
                            </div>
                            <div class="panel-field">
                                <label>Priority</label>
                                <select id="panelTaskPriority"></select>
                            </div>
                        </div>
                        <div class="panel-field-row">
                            <div class="panel-field">
                                <label>Start Date</label>
                                <input type="date" id="panelTaskStartDate">
                            </div>
                            <div class="panel-field">
                                <label>Due Date</label>
                                <input type="date" id="panelTaskDue">
                            </div>
                        </div>
                    </div>

                    <!-- Relations -->
                    <div class="panel-section">
                        <div class="panel-section-title">Relations</div>
                        <div class="panel-relations" id="panelTaskRelations">
                            <!-- Dynamically populated -->
                        </div>
                    </div>

                    <!-- Links -->
                    <div class="panel-section" id="panelTaskLinksSection" style="display: none;">
                        <div class="panel-section-title">üìé Links</div>
                        <div class="panel-links" id="panelTaskLinks">
                            <!-- Dynamically populated -->
                        </div>
                    </div>

                    <!-- Attachments (tsk-dashboard-ux-v1-19) -->
                    <div class="panel-section" id="panelTaskAttachmentsSection">
                        <div class="panel-section-title">üìÅ Attachments</div>
                        <div class="panel-attachments" id="panelTaskAttachments">
                            <!-- Upload Area -->
                            <div class="attachment-dropzone" id="attachmentDropzone">
                                <input type="file" id="attachmentFileInput" multiple hidden>
                                <div class="dropzone-content">
                                    <span class="dropzone-icon">üì§</span>
                                    <span class="dropzone-text">Drop files here or click to upload</span>
                                    <span class="dropzone-hint">Max 100MB per file</span>
                                </div>
                            </div>
                            <!-- Upload Progress -->
                            <div class="attachment-progress" id="attachmentProgress" style="display: none;">
                                <div class="progress-info">
                                    <span class="progress-filename" id="attachmentProgressFilename"></span>
                                    <span class="progress-percent" id="attachmentProgressPercent">0%</span>
                                </div>
                                <div class="progress-bar-container">
                                    <div class="progress-bar" id="attachmentProgressBar"></div>
                                </div>
                            </div>
                            <!-- Attachment List -->
                            <div class="attachment-list" id="attachmentList">
                                <!-- Dynamically populated -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Right Column: Notes -->
                <div class="panel-column-right">
                    <div class="panel-section panel-section-notes">
                        <div class="panel-section-title">
                            Notes
                            <button class="notes-toggle-btn" id="notesToggleBtn" title="Toggle Edit">‚úèÔ∏è</button>
                        </div>
                        <div class="panel-notes-container">
                            <div class="panel-notes-preview" id="panelTaskNotesPreview">
                                <div class="notes-placeholder">No notes</div>
                            </div>
                            <div class="panel-field panel-notes-edit" id="panelTaskNotesEdit" style="display: none;">
                                <textarea id="panelTaskNotes" placeholder="Add notes... (Markdown supported: ## heading, **bold**, *italic*, - list)"></textarea>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="panel-footer">
            <div class="panel-footer-left">
                <button class="btn btn-danger" id="panelTaskDelete">Delete</button>
            </div>
            <div class="panel-footer-right">
                <button class="btn btn-secondary" id="panelTaskCancel">Cancel</button>
                <button class="btn btn-success" id="panelTaskSave">Save</button>
            </div>
        </div>
    </aside>

    <!-- Program Side Panel -->
    <div class="panel-overlay" id="programPanelOverlay"></div>
    <aside class="side-panel program-panel" id="programPanel">
        <div class="panel-header">
            <h2>Program Detail</h2>
            <div class="panel-header-actions">
                <button class="panel-expand" id="programPanelExpand" title="Expand">‚õ∂</button>
                <button class="panel-close" id="programPanelClose">&times;</button>
            </div>
        </div>
        <div class="panel-body">
            <div class="panel-field-id" id="panelProgramId"></div>
            <h3 class="program-name" id="panelProgramName"></h3>
            <span class="program-status-badge" id="panelProgramStatus"></span>

            <!-- Description -->
            <div class="panel-section">
                <div class="panel-section-title">Description</div>
                <div class="program-description" id="panelProgramDescription"></div>
            </div>

            <!-- Statistics -->
            <div class="panel-section">
                <div class="panel-section-title">Statistics</div>
                <div class="program-stats" id="panelProgramStats"></div>
            </div>

            <!-- Child Projects -->
            <div class="panel-section">
                <div class="panel-section-title">Projects</div>
                <div class="program-projects" id="panelProgramProjects"></div>
            </div>
        </div>
    </aside>

    <!-- Entity Detail Side Panel (Track, Condition, Hypothesis) -->
    <div class="panel-overlay" id="entityPanelOverlay"></div>
    <aside class="side-panel entity-panel" id="entityPanel">
        <div class="panel-header">
            <h2 id="entityPanelTitle">Entity Detail</h2>
            <div class="panel-header-actions">
                <button class="panel-close" id="entityPanelClose">&times;</button>
            </div>
        </div>
        <div class="panel-body" id="entityPanelBody">
            <!-- Dynamically populated by EntityDetailPanel -->
        </div>
    </aside>

    <!-- Scripts -->
    <script src="js/api.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/state.js"></script>
    <script src="js/components/sidebar.js"></script>
    <script src="js/components/tabs.js"></script>
    <script src="js/components/kanban.js"></script>
    <script src="js/components/calendar.js"></script>
    <script src="js/components/task-card.js"></script>
    <script src="js/components/task-modal.js"></script>
    <script src="js/components/project-modal.js"></script>
    <script src="js/components/relations.js"></script>
    <script src="js/components/task-panel.js"></script>
    <script src="js/components/project-panel.js"></script>
    <script src="js/components/program-panel.js"></script>
    <script src="js/components/entity-panel.js"></script>
    <script src="js/components/filter-panel.js"></script>
    <script src="js/components/graph.js"></script>
    <script src="js/components/graphDetailPanel.js"></script>
    <script src="js/components/quick-search.js"></script>
    <script src="js/components/pending-panel.js"></script>
    <script src="js/components/program-rounds-view.js"></script>
    <script src="js/components/pdf-viewer.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
