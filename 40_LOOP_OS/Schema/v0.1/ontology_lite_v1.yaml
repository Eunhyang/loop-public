schema_name: ontology_lite_v1
schema_version: "1.0"
updated_at: "2026-01-18"
principles:
  - "ID는 불변. 제목/슬러그는 변경 가능."
  - "모든 엔티티는 entity_id + entity_type으로 유일."
  - "alias는 사람/LLM 친화 키(검색/호출용), canonical은 entity_id."
  - "관계(edge)는 명시적 edge_type + 방향(from->to) + 옵션 메타로 표현."

# -------------------------
# 1) Entity Types
# -------------------------
entity_types:

  NorthStar:
    description: "조직의 최상위 방향/북극성(장기 불변 목표)"
    id_format:
      pattern: "^ns-[0-9]{2}$"
      examples: ["ns-01"]
    required_fields:
      - entity_type
      - entity_id
      - title
      - status
      - created_at
      - updated_at
    optional_fields:
      - description
      - one_liner
      - owner
      - tags
      - aliases
      - slug
      - horizon
      - rationale
      - references
    indexing_keys:
      - entity_id
      - title
      - aliases
      - slug
      - tags

  MetaHypothesis:
    description: "NorthStar를 성립시키는 상위 가설 묶음(전략 전제)"
    id_format:
      pattern: "^mh-[0-9]{2}$"
      examples: ["mh-03"]
    required_fields:
      - entity_type
      - entity_id
      - title
      - parent_id         # -> NorthStar.entity_id
      - status
      - created_at
      - updated_at
    optional_fields:
      - hypothesis        # 한 줄 정의
      - falsification     # 반증 조건(거짓이 되는 트리거)
      - confidence        # 0~1
      - owner
      - tags
      - aliases
      - slug
      - notes
      - references
    indexing_keys:
      - entity_id
      - parent_id
      - title
      - aliases
      - slug
      - tags

  Condition:
    description: "3Y/12M 전략을 진행할 수 있는 ‘임계조건’(충족/붕괴가 의사결정 트리거)"
    id_format:
      pattern: "^cond-[a-z]$"
      examples: ["cond-b", "cond-d"]
    required_fields:
      - entity_type
      - entity_id
      - title
      - parent_id         # -> MetaHypothesis.entity_id
      - status
      - created_at
      - updated_at
    optional_fields:
      - condition         # 조건 선언문
      - unlock            # 충족 시 unlock 설명
      - if_broken         # 붕괴 시 전략 전환/중단 설명
      - metrics           # [{name, threshold, current, status}]
      - break_triggers    # [string]
      - confidence        # 0~1
      - risk_level        # low|medium|high
      - owner
      - tags
      - aliases
      - slug
      - notes
      - references
    indexing_keys:
      - entity_id
      - parent_id
      - title
      - aliases
      - slug
      - tags

  Track:
    description: "12개월 실행 축(책임 단위). Condition을 충족시키기 위한 실행 라인"
    id_format:
      pattern: "^trk-[0-9]{1,2}$"
      examples: ["trk-6"]
    required_fields:
      - entity_type
      - entity_id
      - title
      - parent_id         # -> Condition.entity_id (기본)
      - status
      - created_at
      - updated_at
    optional_fields:
      - horizon           # 12month|quarter|etc
      - hypothesis        # 트랙 선언문(가설 형태)
      - focus             # [string]
      - objectives        # [{metric,target,current,status}]
      - progress          # 0~1
      - risk_level        # low|medium|high
      - owner
      - tags
      - aliases
      - slug
      - notes
      - references
    indexing_keys:
      - entity_id
      - parent_id
      - title
      - aliases
      - slug
      - tags

  Project:
    description: "Track 아래 실행 단위(프로젝트). 여러 Task를 포함하고 Hypothesis를 validates 할 수 있음"
    id_format:
      pattern: "^prj-[0-9]{3}$"
      examples: ["prj-002"]
    required_fields:
      - entity_type
      - entity_id
      - title
      - parent_id         # -> Track.entity_id
      - status
      - created_at
      - updated_at
    optional_fields:
      - tier              # tactical|enabling|strategic
      - deadline          # YYYY-MM-DD
      - owner
      - hypothesis_text   # 프로젝트 단위 가설
      - confidence        # 0~1
      - impact_magnitude  # low|mid|high
      - tags
      - aliases
      - slug
      - links
      - attachments
      - notes
      - references
    indexing_keys:
      - entity_id
      - parent_id
      - title
      - aliases
      - slug
      - tags

  Hypothesis:
    description: "검증 가능한 질문 단위(실험/측정 설계 포함). Track 또는 Project에 매달림"
    id_format:
      pattern: "^hyp-[0-9]+-[0-9]{2}$"
      examples: ["hyp-2-11", "hyp-6-09"]
    required_fields:
      - entity_type
      - entity_id
      - title
      - parent_id         # -> Track.entity_id (기본)
      - status
      - created_at
      - updated_at
      - question
      - success_criteria
      - failure_criteria
      - measurement
    optional_fields:
      - deadline
      - horizon
      - confidence        # 0~1
      - loop_layer        # [emotional,eating,habit,reward,autonomic,...]
      - tags
      - aliases
      - slug
      - notes
      - references
    indexing_keys:
      - entity_id
      - parent_id
      - title
      - aliases
      - slug
      - tags
      - question

  # ---- Optional (v1에 포함하되 사용은 선택) ----
  StrategyPhase:
    description: "전략 단계(예: 0→1, 1→10 등). unlock 대상으로 사용"
    id_format:
      pattern: "^phase-[0-9]{2}$"
      examples: ["phase-01"]
    required_fields: [entity_type, entity_id, title, status, created_at, updated_at]
    optional_fields: [description, owner, tags, aliases, slug]
    indexing_keys: [entity_id, title, aliases, slug, tags]

  Strategy:
    description: "상위 전략 객체(조건 붕괴 시 breaks 대상으로 연결)"
    id_format:
      pattern: "^str-[0-9]{2}$"
      examples: ["str-01"]
    required_fields: [entity_type, entity_id, title, status, created_at, updated_at]
    optional_fields: [description, owner, tags, aliases, slug]
    indexing_keys: [entity_id, title, aliases, slug, tags]

  Company:
    description: "회사 엔티티(terminates 대상으로 연결)"
    id_format:
      pattern: "^co-[0-9]{2}$"
      examples: ["co-01"]
    required_fields: [entity_type, entity_id, title, status, created_at, updated_at]
    optional_fields: [description, owner, tags, aliases, slug]
    indexing_keys: [entity_id, title, aliases, slug, tags]


# -------------------------
# 2) Shared Field Specs
# -------------------------
field_specs:
  status:
    enum: ["planning", "todo", "doing", "done", "hold", "cancelled", "assumed"]
  timestamps:
    created_at: "YYYY-MM-DD"
    updated_at: "YYYY-MM-DD"
  slug:
    rules:
      - "소문자, 공백은 '-', 특수문자 제거"
      - "제목 변경 시 slug는 함께 변경 가능"
  aliases:
    rules:
      - "사람이 부르는 이름/약칭/기존 노션 키 등을 넣음"
      - "중복 허용(전역 유니크 강제 X)하지만 검색 충돌 가능성은 운영으로 관리"
  parent_id:
    rules:
      - "상위 계층 1개만 가리키는 기본 링크"
      - "다중 상위는 edge로 표현(예: Track이 여러 Condition에 기여)"


# -------------------------
# 3) Edge Types Dictionary (v1)
# -------------------------
edge_types:
  validates:
    description: "A가 B의 참/거짓(충족)을 검증한다"
    from: ["Track", "Project", "Hypothesis"]
    to: ["Condition", "MetaHypothesis"]
    recommended_fields:
      - evidence        # 링크/리포트/로그
      - strength        # weak|medium|strong
      - measured_at     # YYYY-MM-DD
      - note

  enables:
    description: "A가 B를 가능하게 하는 선행조건/인프라를 제공한다"
    from: ["Track", "Project"]
    to: ["Condition", "Track"]
    recommended_fields: [note]

  depends_on:
    description: "A가 B에 의존한다(막히면 A도 막힘)"
    from: ["Track", "Project"]
    to: ["Track", "Condition"]
    recommended_fields: [note, risk_level]

  unlocks:
    description: "Condition이 충족되면 다음 단계/트랙이 열린다"
    from: ["Condition"]
    to: ["StrategyPhase", "Track"]
    recommended_fields: [note]

  breaks:
    description: "Condition이 붕괴되면 전략/트랙을 깨뜨린다(전환/중단 트리거)"
    from: ["Condition"]
    to: ["Strategy", "Track"]
    recommended_fields: [break_trigger, note]

  terminates:
    description: "트랙 실패가 회사 존속을 위협/종료한다"
    from: ["Track"]
    to: ["Company"]
    recommended_fields: [note]


# -------------------------
# 4) Minimal Graph Representation (for LLM/Agent I/O)
# -------------------------
graph_io:
  node:
    required: ["entity_type", "entity_id", "title"]
    optional: ["status", "parent_id", "aliases", "slug", "tags"]
  edge:
    required: ["type", "from_id", "to_id"]
    optional: ["note", "weight", "evidence", "strength", "measured_at", "risk_level", "break_trigger"]


# -------------------------
# 5) Samples (3 cases)
# -------------------------
samples:

  - case: "Track validates Condition"
    nodes:
      - {entity_type: "Condition", entity_id: "cond-d", title: "Condition_D_Runway", status: "doing"}
      - {entity_type: "Track", entity_id: "trk-6", title: "Track_6_Revenue", status: "doing", parent_id: "cond-d"}
    edges:
      - type: "validates"
        from_id: "trk-6"
        to_id: "cond-d"
        evidence: "revenue_dashboard_link"
        strength: "medium"
        measured_at: "2026-01-18"

  - case: "Project contributes to multiple Conditions (use edges, not parent_id)"
    nodes:
      - {entity_type: "Project", entity_id: "prj-002", title: "와디즈 - 12주 습관 코칭 패키지", status: "doing", parent_id: "trk-6"}
      - {entity_type: "Condition", entity_id: "cond-d", title: "Condition_D_Runway", status: "doing"}
      - {entity_type: "Condition", entity_id: "cond-b", title: "Condition_B_Loop_Dataset", status: "doing"}
    edges:
      - type: "enables"
        from_id: "prj-002"
        to_id: "cond-d"
        note: "펀딩 성공 시 런웨이 확보"
        weight: 0.6
      - type: "enables"
        from_id: "prj-002"
        to_id: "cond-b"
        note: "코칭 데이터 수집 기반"
        weight: 0.3

  - case: "Track depends_on other Tracks"
    nodes:
      - {entity_type: "Track", entity_id: "trk-6", title: "Track_6_Revenue", status: "doing"}
      - {entity_type: "Track", entity_id: "trk-1", title: "Track_1_Product", status: "doing"}
      - {entity_type: "Track", entity_id: "trk-3", title: "Track_3_Content", status: "doing"}
    edges:
      - type: "depends_on"
        from_id: "trk-6"
        to_id: "trk-1"
        note: "제품이 유료화 기반"
        risk_level: "high"
      - type: "depends_on"
        from_id: "trk-6"
        to_id: "trk-3"
        note: "콘텐츠가 유입 견인"
        risk_level: "medium"
